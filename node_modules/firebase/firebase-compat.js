!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).firebase=t()}(this,function(){"use strict";!function(e){var t,n,o,r,i,s,a,c,l,u;function h(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function d(e){return e="string"!=typeof e?String(e):e}function f(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return n&&(e[Symbol.iterator]=function(){return e}),e}function p(t){this.map={},t instanceof p?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function g(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function m(n){return new Promise(function(e,t){n.onload=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function y(e){var t=new FileReader,n=m(t);return t.readAsArrayBuffer(e),n}function v(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e)if("string"==typeof e)this._bodyText=e;else if(o&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(r&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(i&&o&&a(e))this._bodyArrayBuffer=v(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(e)&&!c(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=g(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?g(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var e,t,n=g(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=m(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(b)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(e,t){var n,r=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new p(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new p(t.headers)),this.method=(n=t.method||this.method||"GET",e=n.toUpperCase(),-1<l.indexOf(e)?e:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function b(e){var n=new FormData;return e.trim().split("&").forEach(function(e){var t;e&&(e=(t=e.split("=")).shift().replace(/\+/g," "),t=t.join("=").replace(/\+/g," "),n.append(decodeURIComponent(e),decodeURIComponent(t)))}),n}function I(e,t){t=t||{},this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new p(t.headers),this.url=t.url||"",this._initBody(e)}e.fetch||(t="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,o="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),r="FormData"in e,(i="ArrayBuffer"in e)&&(s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=function(e){return e&&DataView.prototype.isPrototypeOf(e)},c=ArrayBuffer.isView||function(e){return e&&-1<s.indexOf(Object.prototype.toString.call(e))}),p.prototype.append=function(e,t){e=h(e),t=d(t);var n=this.map[e];this.map[e]=n?n+","+t:t},p.prototype.delete=function(e){delete this.map[h(e)]},p.prototype.get=function(e){return e=h(e),this.has(e)?this.map[e]:null},p.prototype.has=function(e){return this.map.hasOwnProperty(h(e))},p.prototype.set=function(e,t){this.map[h(e)]=d(t)},p.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},p.prototype.keys=function(){var n=[];return this.forEach(function(e,t){n.push(t)}),f(n)},p.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),f(t)},p.prototype.entries=function(){var n=[];return this.forEach(function(e,t){n.push([t,e])}),f(n)},n&&(p.prototype[Symbol.iterator]=p.prototype.entries),l=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},_.call(w.prototype),_.call(I.prototype),I.prototype.clone=function(){return new I(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new p(this.headers),url:this.url})},I.error=function(){var e=new I(null,{status:0,statusText:""});return e.type="error",e},u=[301,302,303,307,308],I.redirect=function(e,t){if(-1===u.indexOf(t))throw new RangeError("Invalid status code");return new I(null,{status:t,headers:{location:e}})},e.Headers=p,e.Request=w,e.Response=I,e.fetch=function(n,s){return new Promise(function(r,e){var t=new w(n,s),i=new XMLHttpRequest;i.onload=function(){var n,e={status:i.status,statusText:i.statusText,headers:(t=i.getAllResponseHeaders()||"",n=new p,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t=e.split(":"),e=t.shift().trim();e&&(t=t.join(":").trim(),n.append(e,t))}),n)};e.url="responseURL"in i?i.responseURL:e.headers.get("X-Request-URL");var t="response"in i?i.response:i.responseText;r(new I(t,e))},i.onerror=function(){e(new TypeError("Network request failed"))},i.ontimeout=function(){e(new TypeError("Network request failed"))},i.open(t.method,t.url,!0),"include"===t.credentials?i.withCredentials=!0:"omit"===t.credentials&&(i.withCredentials=!1),"responseType"in i&&o&&(i.responseType="blob"),t.headers.forEach(function(e,t){i.setRequestHeader(t,e)}),i.send(void 0===t._bodyInit?null:t._bodyInit)})},e.fetch.polyfill=!0)}("undefined"!=typeof self?self:void 0);var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){var t={exports:{}};return e(t,t.exports),t.exports}function m(e){try{return!!e()}catch(e){return!0}}function y(e){return"object"==typeof e?null!==e:"function"==typeof e}function n(e){return h?u.createElement(e):{}}function f(e){if(!y(e))throw TypeError(String(e)+" is not an object");return e}function r(e,t){if(!y(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!y(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!y(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!y(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}function g(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function l(t,n){try{b(v,t,n)}catch(e){v[t]=n}return n}function c(e,t){return S.call(e,t)}function a(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++k+C).toString(36)}function i(e){return c(R,e)||(A&&c(P,e)?R[e]=P[e]:R[e]=O("Symbol."+e)),R[e]}var s=function(e){return e&&e.Math==Math&&e},v=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof e&&e)||Function("return this")(),o=!1,d=!m(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),u=v.document,h=y(u)&&y(u.createElement),p=!d&&!m(function(){return 7!=Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a}),_=Object.defineProperty,w={f:d?_:function(e,t,n){if(f(e),t=r(t,!0),f(n),p)try{return _(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},b=d?function(e,t,n){return w.f(e,t,g(1,n))}:function(e,t,n){return e[t]=n,e},I="__core-js_shared__",T=v[I]||l(I,{}),E=t(function(e){(e.exports=function(e,t){return T[e]||(T[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})}),S={}.hasOwnProperty,k=0,C=Math.random(),A=!!Object.getOwnPropertySymbols&&!m(function(){return!String(Symbol())}),N=A&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,R=E("wks"),P=v.Symbol,O=N?P:P&&P.withoutSetter||a,x={};x[i("toStringTag")]="z";var D="[object z]"===String(x),L=Function.toString;"function"!=typeof T.inspectSource&&(T.inspectSource=function(e){return L.call(e)});var M,F,U,j,q,V,B,K,z=T.inspectSource,W=v.WeakMap,s="function"==typeof W&&/native code/.test(z(W)),$=E("keys"),e=function(e){return $[e]||($[e]=a(e))},H={},I=v.WeakMap;B=s?(M=new I,F=M.get,U=M.has,j=M.set,q=function(e,t){return j.call(M,e,t),t},V=function(e){return F.call(M,e)||{}},function(e){return U.call(M,e)}):(K=e("state"),H[K]=!0,q=function(e,t){return b(e,K,t),t},V=function(e){return c(e,K)?e[K]:{}},function(e){return c(e,K)});function G(e){return J.call(e).slice(8,-1)}var Q={set:q,get:V,has:B,enforce:function(e){return B(e)?V(e):q(e,{})},getterFor:function(n){return function(e){var t;if(!y(e)||(t=V(e)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return t}}},Y=t(function(e){var t=Q.get,o=Q.enforce,a=String(String).split("String");(e.exports=function(e,t,n,r){var i=!!r&&!!r.unsafe,s=!!r&&!!r.enumerable,r=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof t||c(n,"name")||b(n,"name",t),o(n).source=a.join("string"==typeof t?t:"")),e!==v?(i?!r&&e[t]&&(s=!0):delete e[t],s?e[t]=n:b(e,t,n)):s?e[t]=n:l(t,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&t(this).source||z(this)})}),J={}.toString,X=i("toStringTag"),Z="Arguments"==G(function(){return arguments}()),ee=D?G:function(e){var t;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(e=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),X))?e:Z?G(t):"Object"==(e=G(t))&&"function"==typeof t.callee?"Arguments":e};D||Y(Object.prototype,"toString",D?{}.toString:function(){return"[object "+ee(this)+"]"},{unsafe:!0});function te(e){return isNaN(e=+e)?0:(0<e?de:he)(e)}function ne(e){if(null==e)throw TypeError("Can't call method on "+e);return e}function re(e){return me(ne(e))}function ie(e){return"function"==typeof e?e:void 0}function se(e,t){return arguments.length<2?ie(_e[e])||ie(v[e]):_e[e]&&_e[e][t]||v[e]&&v[e][t]}function oe(e){return 0<e?we(te(e),9007199254740991):0}function ae(e,t){var n,r=re(e),i=0,s=[];for(n in r)!c(H,n)&&c(r,n)&&s.push(n);for(;t.length>i;)c(r,n=t[i++])&&(~Te(s,n)||s.push(n));return s}function ce(e,t){for(var n=Ae(t),r=w.f,i=ve.f,s=0;s<n.length;s++){var o=n[s];c(e,o)||r(e,o,i(t,o))}}function le(e,t){var n,r,i,s=e.target,o=e.global,a=e.stat,c=o?v:a?v[s]||l(s,{}):(v[s]||{}).prototype;if(c)for(n in t){if(r=t[n],i=e.noTargetGet?(i=Le(c,n))&&i.value:c[n],!De(o?n:s+(a?".":"#")+n,e.forced)&&void 0!==i){if(typeof r==typeof i)continue;ce(r,i)}(e.sham||i&&i.sham)&&b(r,"sham",!0),Y(c,n,r,e)}}function ue(e){return Object(ne(e))}var he=Math.ceil,de=Math.floor,x=function(s){return function(e,t){var n,r=String(ne(e)),i=te(t),e=r.length;return i<0||e<=i?s?"":void 0:(t=r.charCodeAt(i))<55296||56319<t||i+1===e||(n=r.charCodeAt(i+1))<56320||57343<n?s?r.charAt(i):t:s?r.slice(i,i+2):n-56320+(t-55296<<10)+65536}},W={codeAt:x(!1),charAt:x(!0)},s={}.propertyIsEnumerable,fe=Object.getOwnPropertyDescriptor,pe={f:fe&&!s.call({1:2},1)?function(e){e=fe(this,e);return!!e&&e.enumerable}:s},ge="".split,me=m(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==G(e)?ge.call(e,""):Object(e)}:Object,ye=Object.getOwnPropertyDescriptor,ve={f:d?ye:function(e,t){if(e=re(e),t=r(t,!0),p)try{return ye(e,t)}catch(e){}if(c(e,t))return g(!pe.f.call(e,t),e[t])}},_e=v,we=Math.min,be=Math.max,Ie=Math.min,I=function(a){return function(e,t,n){var r,i=re(e),s=oe(i.length),o=function(e,t){e=te(e);return e<0?be(e+t,0):Ie(e,t)}(n,s);if(a&&t!=t){for(;o<s;)if((r=i[o++])!=r)return!0}else for(;o<s;o++)if((a||o in i)&&i[o]===t)return a||o||0;return!a&&-1}},Te={includes:I(!0),indexOf:I(!1)}.indexOf,Ee=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Se=Ee.concat("length","prototype"),ke={f:Object.getOwnPropertyNames||function(e){return ae(e,Se)}},Ce={f:Object.getOwnPropertySymbols},Ae=se("Reflect","ownKeys")||function(e){var t=ke.f(f(e)),n=Ce.f;return n?t.concat(n(e)):t},Ne=/#|\.prototype\./,D=function(e,t){e=Pe[Re(e)];return e==xe||e!=Oe&&("function"==typeof t?m(t):!!t)},Re=D.normalize=function(e){return String(e).replace(Ne,".").toLowerCase()},Pe=D.data={},Oe=D.NATIVE="N",xe=D.POLYFILL="P",De=D,Le=ve.f,x=!m(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),Me=e("IE_PROTO"),Fe=Object.prototype,Ue=x?Object.getPrototypeOf:function(e){return e=ue(e),c(e,Me)?e[Me]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Fe:null},s=i("iterator"),I=!1;[].keys&&("next"in(Xt=[].keys())?(Zt=Ue(Ue(Xt)))!==Object.prototype&&(tn=Zt):I=!0),c(tn=null==tn?{}:tn,s)||b(tn,s,function(){return this});function je(){}function qe(e){return"<script>"+e+"</"+$e+">"}var Ve,D={IteratorPrototype:tn,BUGGY_SAFARI_ITERATORS:I},Be=Object.keys||function(e){return ae(e,Ee)},Ke=d?Object.defineProperties:function(e,t){f(e);for(var n,r=Be(t),i=r.length,s=0;s<i;)w.f(e,n=r[s++],t[n]);return e},ze=se("document","documentElement"),We="prototype",$e="script",He=e("IE_PROTO"),Ge=function(){try{Ve=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e;Ge=Ve?function(e){e.write(qe("")),e.close();var t=e.parentWindow.Object;return e=null,t}(Ve):((e=n("iframe")).style.display="none",ze.appendChild(e),e.src=String("javascript:"),(e=e.contentWindow.document).open(),e.write(qe("document.F=Object")),e.close(),e.F);for(var t=Ee.length;t--;)delete Ge[We][Ee[t]];return Ge()};H[He]=!0;function Qe(e,t,n){e&&!c(e=n?e:e.prototype,tt)&&et(e,tt,{configurable:!0,value:t})}function Ye(){return this}function Je(){return this}function Xe(e,t,n,r,i,s,o){function a(e){if(e===i&&p)return p;if(!ot&&e in d)return d[e];switch(e){case"keys":case ct:case lt:return function(){return new n(this,e)}}return function(){return new n(this)}}!function(e,t,n){t+=" Iterator";e.prototype=Ze(rt,{next:g(1,n)}),Qe(e,t,!1),nt[t]=Ye}(n,t,r);var c,l,u=t+" Iterator",h=!1,d=e.prototype,f=d[at]||d["@@iterator"]||i&&d[i],p=!ot&&f||a(i);if((r="Array"==t&&d.entries||f)&&(e=Ue(r.call(new e)),st!==Object.prototype&&e.next&&(Ue(e)!==st&&(it?it(e,st):"function"!=typeof e[at]&&b(e,at,Je)),Qe(e,u,!0))),i==ct&&f&&f.name!==ct&&(h=!0,p=function(){return f.call(this)}),d[at]!==p&&b(d,at,p),nt[t]=p,i)if(c={values:a(ct),keys:s?p:a("keys"),entries:a(lt)},o)for(l in c)!ot&&!h&&l in d||Y(d,l,c[l]);else le({target:t,proto:!0,forced:ot||h},c);return c}var Ze=Object.create||function(e,t){var n;return null!==e?(je[We]=f(e),n=new je,je[We]=null,n[He]=e):n=Ge(),void 0===t?n:Ke(n,t)},et=w.f,tt=i("toStringTag"),nt={},rt=D.IteratorPrototype,it=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,e={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(e,[]),r=e instanceof Array}catch(e){}return function(e,t){return f(e),function(e){if(!y(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(t),r?n.call(e,t):e.__proto__=t,e}}():void 0),st=D.IteratorPrototype,ot=D.BUGGY_SAFARI_ITERATORS,at=i("iterator"),ct="values",lt="entries",ut=W.charAt,ht="String Iterator",dt=Q.set,ft=Q.getterFor(ht);Xe(String,"String",function(e){dt(this,{type:ht,string:String(e),index:0})},function(){var e=ft(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(n=ut(t,n),e.index+=n.length,{value:n,done:!1})});var pt={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},gt=i("unscopables"),mt=Array.prototype;null==mt[gt]&&w.f(mt,gt,{configurable:!0,value:Ze(null)});var x=function(e){mt[gt][e]=!0},yt="Array Iterator",vt=Q.set,_t=Q.getterFor(yt),wt=Xe(Array,"Array",function(e,t){vt(this,{type:yt,target:re(e),index:0,kind:t})},function(){var e=_t(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values");nt.Arguments=nt.Array,x("keys"),x("values"),x("entries");var bt,It=i("iterator"),Tt=i("toStringTag"),Et=wt.values;for(bt in pt){var St=v[bt],kt=St&&St.prototype;if(kt){if(kt[It]!==Et)try{b(kt,It,Et)}catch(wp){kt[It]=Et}if(kt[Tt]||b(kt,Tt,bt),pt[bt])for(var Ct in wt)if(kt[Ct]!==wt[Ct])try{b(kt,Ct,wt[Ct])}catch(wp){kt[Ct]=wt[Ct]}}}function At(e,t,n){for(var r in t)Y(e,r,t[r],n);return e}function Nt(e){var t=se(e),e=w.f;d&&t&&!t[Ft]&&e(t,Ft,{configurable:!0,get:function(){return this}})}function Rt(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}function Pt(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}function Ot(e){return void 0!==e&&(nt.Array===e||jt[Ut]===e)}function xt(r,i,e){if(Rt(r),void 0===i)return r;switch(e){case 0:return function(){return r.call(i)};case 1:return function(e){return r.call(i,e)};case 2:return function(e,t){return r.call(i,e,t)};case 3:return function(e,t,n){return r.call(i,e,t,n)}}return function(){return r.apply(i,arguments)}}function Dt(e){if(null!=e)return e[qt]||e["@@iterator"]||nt[ee(e)]}function Lt(t,e,n,r){try{return r?e(f(n)[0],n[1]):e(n)}catch(e){n=t.return;throw void 0!==n&&f(n.call(t)),e}}var Mt=v.Promise,Ft=i("species"),Ut=i("iterator"),jt=Array.prototype,qt=i("iterator"),Vt=t(function(e){function d(e,t){this.stopped=e,this.result=t}(e.exports=function(e,t,n,r,i){var s,o,a,c,l,u,h=xt(t,n,r?2:1);if(i)s=e;else{if("function"!=typeof(i=Dt(e)))throw TypeError("Target is not iterable");if(Ot(i)){for(o=0,a=oe(e.length);o<a;o++)if((c=r?h(f(u=e[o])[0],u[1]):h(e[o]))&&c instanceof d)return c;return new d(!1)}s=i.call(e)}for(l=s.next;!(u=l.call(s)).done;)if("object"==typeof(c=Lt(s,h,u.value,r))&&c&&c instanceof d)return c;return new d(!1)}).stop=function(e){return new d(!0,e)}}),Bt=i("iterator"),Kt=!1;try{var zt=0,Wt={next:function(){return{done:!!zt++}},return:function(){Kt=!0}};Wt[Bt]=function(){return this},Array.from(Wt,function(){throw 2})}catch(wp){}function $t(e,t){if(!t&&!Kt)return!1;var n=!1;try{var r={};r[Bt]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n}function Ht(e,t){var n;return void 0===(e=f(e).constructor)||null==(n=f(e)[Jt])?t:Rt(n)}function Gt(e){var t;on.hasOwnProperty(e)&&(t=on[e],delete on[e],t())}function Qt(e){return function(){Gt(e)}}var Yt,Jt=i("species"),Xt=se("navigator","userAgent")||"",Zt=/(iphone|ipod|ipad).*applewebkit/i.test(Xt),en=v.location,s=v.setImmediate,tn=v.clearImmediate,nn=v.process,I=v.MessageChannel,rn=v.Dispatch,sn=0,on={},an="onreadystatechange",D=function(e){Gt(e.data)},W=function(e){v.postMessage(e+"",en.protocol+"//"+en.host)};s&&tn||(s=function(e){for(var t=[],n=1;n<arguments.length;)t.push(arguments[n++]);return on[++sn]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Yt(sn),sn},tn=function(e){delete on[e]},"process"==G(nn)?Yt=function(e){nn.nextTick(Qt(e))}:rn&&rn.now?Yt=function(e){rn.now(Qt(e))}:I&&!Zt?(I=(Wt=new I).port2,Wt.port1.onmessage=D,Yt=xt(I.postMessage,I,1)):!v.addEventListener||"function"!=typeof postMessage||v.importScripts||m(W)||"file:"===en.protocol?Yt=an in n("script")?function(e){ze.appendChild(n("script"))[an]=function(){ze.removeChild(this),Gt(e)}}:function(e){setTimeout(Qt(e),0)}:(Yt=W,v.addEventListener("message",D,!1)));var cn,ln,un,hn,dn,fn,pn,gn,W={set:s,clear:tn},D=ve.f,mn=W.set,s=v.MutationObserver||v.WebKitMutationObserver,yn=v.process,tn=v.Promise,vn="process"==G(yn),D=D(v,"queueMicrotask"),D=D&&D.value;D||(cn=function(){var e,t;for(vn&&(e=yn.domain)&&e.exit();ln;){t=ln.fn,ln=ln.next;try{t()}catch(e){throw ln?hn():un=void 0,e}}un=void 0,e&&e.enter()},hn=vn?function(){yn.nextTick(cn)}:s&&!Zt?(dn=!0,fn=document.createTextNode(""),new s(cn).observe(fn,{characterData:!0}),function(){fn.data=dn=!dn}):tn&&tn.resolve?(pn=tn.resolve(void 0),gn=pn.then,function(){gn.call(pn,cn)}):function(){mn.call(v,cn)});function _n(e){var n,r;this.promise=new e(function(e,t){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=e,r=t}),this.resolve=Rt(n),this.reject=Rt(r)}function wn(e,t){return f(e),y(t)&&t.constructor===e?t:((0,(e=Tn.f(e)).resolve)(t),e.promise)}function bn(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}var In=D||function(e){e={fn:e,next:void 0};un&&(un.next=e),ln||(ln=e,hn()),un=e},Tn={f:function(e){return new _n(e)}},tn=v.process,D=tn&&tn.versions,tn=D&&D.v8;tn?ur=(lr=tn.split("."))[0]+lr[1]:Xt&&(!(lr=Xt.match(/Edge\/(\d+)/))||74<=lr[1])&&(lr=Xt.match(/Chrome\/(\d+)/))&&(ur=lr[1]);function En(e){var t;return!(!y(e)||"function"!=typeof(t=e.then))&&t}function Sn(h,d,f){var p;d.notified||(d.notified=!0,p=d.reactions,In(function(){for(var e=d.value,t=1==d.state,n=0;p.length>n;){var r,i,s,o=p[n++],a=t?o.ok:o.fail,c=o.resolve,l=o.reject,u=o.domain;try{a?(t||(2===d.rejection&&Xn(h,d),d.rejection=1),!0===a?r=e:(u&&u.enter(),r=a(e),u&&(u.exit(),s=!0)),r===o.promise?l(Vn("Promise-chain cycle")):(i=En(r))?i.call(r,c,l):c(r)):l(e)}catch(e){u&&!s&&u.exit(),l(e)}}d.reactions=[],d.notified=!1,f&&!d.rejection&&Yn(h,d)}))}function kn(e,t,n){var r;Gn?((r=Bn.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),v.dispatchEvent(r)):r={promise:t,reason:n},(t=v["on"+e])?t(r):e===Qn&&function(e,t){var n=v.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)}function Cn(t,n,r,i){return function(e){t(n,r,e,i)}}function An(e,t,n,r){t.done||(t.done=!0,(t=r?r:t).value=n,t.state=2,Sn(e,t,!0))}var Nn,Rn,Pn,On,xn=ur&&+ur,Dn=W.set,Ln=i("species"),Mn="Promise",Fn=Q.get,Un=Q.set,jn=Q.getterFor(Mn),qn=Mt,Vn=v.TypeError,Bn=v.document,Kn=v.process,zn=se("fetch"),Wn=Tn.f,$n=Wn,Hn="process"==G(Kn),Gn=!!(Bn&&Bn.createEvent&&v.dispatchEvent),Qn="unhandledrejection",D=De(Mn,function(){if(!(z(qn)!==String(qn))){if(66===xn)return!0;if(!Hn&&"function"!=typeof PromiseRejectionEvent)return!0}if(51<=xn&&/native code/.test(qn))return!1;function e(e){e(function(){},function(){})}var t=qn.resolve(1);return(t.constructor={})[Ln]=e,!(t.then(function(){})instanceof e)}),tn=D||!$t(function(e){qn.all(e).catch(function(){})}),Yn=function(r,i){Dn.call(v,function(){var e,t=i.value,n=Jn(i);if(n&&(e=bn(function(){Hn?Kn.emit("unhandledRejection",t,r):kn(Qn,r,t)}),i.rejection=Hn||Jn(i)?2:1,e.error))throw e.value})},Jn=function(e){return 1!==e.rejection&&!e.parent},Xn=function(e,t){Dn.call(v,function(){Hn?Kn.emit("rejectionHandled",e):kn("rejectionhandled",e,t.value)})},Zn=function(n,r,e,t){if(!r.done){r.done=!0,t&&(r=t);try{if(n===e)throw Vn("Promise can't be resolved itself");var i=En(e);i?In(function(){var t={done:!1};try{i.call(e,Cn(Zn,n,t,r),Cn(An,n,t,r))}catch(e){An(n,t,e,r)}}):(r.value=e,r.state=1,Sn(n,r,!1))}catch(e){An(n,{done:!1},e,r)}}};D&&(qn=function(e){Pt(this,qn,Mn),Rt(e),Nn.call(this);var t=Fn(this);try{e(Cn(Zn,this,t),Cn(An,this,t))}catch(e){An(this,t,e)}},(Nn=function(e){Un(this,{type:Mn,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=At(qn.prototype,{then:function(e,t){var n=jn(this),r=Wn(Ht(this,qn));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Hn?Kn.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Sn(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Rn=function(){var e=new Nn,t=Fn(e);this.promise=e,this.resolve=Cn(Zn,e,t),this.reject=Cn(An,e,t)},Tn.f=Wn=function(e){return e===qn||e===Pn?new Rn:$n(e)},"function"==typeof Mt&&(On=Mt.prototype.then,Y(Mt.prototype,"then",function(e,t){var n=this;return new qn(function(e,t){On.call(n,e,t)}).then(e,t)},{unsafe:!0}),"function"==typeof zn&&le({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return wn(qn,zn.apply(v,arguments))}}))),le({global:!0,wrap:!0,forced:D},{Promise:qn}),Qe(qn,Mn,!1),Nt(Mn),Pn=se(Mn),le({target:Mn,stat:!0,forced:D},{reject:function(e){var t=Wn(this);return t.reject.call(void 0,e),t.promise}}),le({target:Mn,stat:!0,forced:D},{resolve:function(e){return wn(this,e)}}),le({target:Mn,stat:!0,forced:tn},{all:function(e){var a=this,t=Wn(a),c=t.resolve,l=t.reject,n=bn(function(){var r=Rt(a.resolve),i=[],s=0,o=1;Vt(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(a,e).then(function(e){n||(n=!0,i[t]=e,--o||c(i))},l)}),--o||c(i)});return n.error&&l(n.value),t.promise},race:function(e){var n=this,r=Wn(n),i=r.reject,t=bn(function(){var t=Rt(n.resolve);Vt(e,function(e){t.call(n,e).then(r.resolve,i)})});return t.error&&i(t.value),r.promise}}),le({target:"Promise",stat:!0},{allSettled:function(e){var a=this,t=Tn.f(a),c=t.resolve,n=t.reject,r=bn(function(){var r=Rt(a.resolve),i=[],s=0,o=1;Vt(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(a,e).then(function(e){n||(n=!0,i[t]={status:"fulfilled",value:e},--o||c(i))},function(e){n||(n=!0,i[t]={status:"rejected",reason:e},--o||c(i))})}),--o||c(i)});return r.error&&n(r.value),t.promise}});Xt=!!Mt&&m(function(){Mt.prototype.finally.call({then:function(){}},function(){})});le({target:"Promise",proto:!0,real:!0,forced:Xt},{finally:function(t){var n=Ht(this,se("Promise")),e="function"==typeof t;return this.then(e?function(e){return wn(n,t()).then(function(){return e})}:t,e?function(e){return wn(n,t()).then(function(){throw e})}:t)}}),"function"!=typeof Mt||Mt.prototype.finally||Y(Mt.prototype,"finally",se("Promise").prototype.finally),_e.Promise;var er=Q.set,tr=Q.getterFor("AggregateError"),nr=function(e,t){var n=this;if(!(n instanceof nr))return new nr(e,t);it&&(n=it(new Error(t),Ue(n)));var r=[];return Vt(e,r.push,r),d?er(n,{errors:r,type:"AggregateError"}):n.errors=r,void 0!==t&&b(n,"message",String(t)),n};nr.prototype=Ze(Error.prototype,{constructor:g(5,nr),message:g(5,""),name:g(5,"AggregateError")}),d&&w.f(nr.prototype,"errors",{get:function(){return tr(this).errors},configurable:!0}),le({global:!0},{AggregateError:nr}),le({target:"Promise",stat:!0},{try:function(e){var t=Tn.f(this),e=bn(e);return(e.error?t.reject:t.resolve)(e.value),t.promise}});var rr="No one promise resolved";le({target:"Promise",stat:!0},{any:function(e){var c=this,t=Tn.f(c),l=t.resolve,u=t.reject,n=bn(function(){var r=Rt(c.resolve),i=[],s=0,o=1,a=!1;Vt(e,function(e){var t=s++,n=!1;i.push(void 0),o++,r.call(c,e).then(function(e){n||a||(a=!0,l(e))},function(e){n||a||(n=!0,i[t]=e,--o||u(new(se("AggregateError"))(i,rr)))})}),--o||u(new(se("AggregateError"))(i,rr))});return n.error&&u(n.value),t.promise}});function ir(e,t){var n;return new(void 0===(n=or(e)&&("function"==typeof(n=e.constructor)&&(n===Array||or(n.prototype))||y(n)&&null===(n=n[ar]))?void 0:n)?Array:n)(0===t?0:t)}function sr(e){throw e}var or=Array.isArray||function(e){return"Array"==G(e)},ar=i("species"),cr=[].push,lr=function(d){var f=1==d,p=2==d,g=3==d,m=4==d,y=6==d,v=5==d||y;return function(e,t,n,r){for(var i,s,o=ue(e),a=me(o),c=xt(t,n,3),l=oe(a.length),u=0,r=r||ir,h=f?r(e,l):p?r(e,0):void 0;u<l;u++)if((v||u in a)&&(s=c(i=a[u],u,o),d))if(f)h[u]=s;else if(s)switch(d){case 3:return!0;case 5:return i;case 6:return u;case 2:cr.call(h,i)}else if(m)return!1;return y?-1:g||m?m:h}},ur={forEach:lr(0),map:lr(1),filter:lr(2),some:lr(3),every:lr(4),find:lr(5),findIndex:lr(6)},hr=Object.defineProperty,dr={},W=function(e,t){if(c(dr,e))return dr[e];var n=[][e],r=!!c(t=t||{},"ACCESSORS")&&t.ACCESSORS,i=c(t,0)?t[0]:sr,s=c(t,1)?t[1]:void 0;return dr[e]=!!n&&!m(function(){if(r&&!d)return 1;var e={length:-1};r?hr(e,1,{enumerable:!0,get:sr}):e[1]=1,n.call(e,i,s)})},fr=ur.find,D="find",pr=!0,tn=W(D);D in[]&&Array(1)[D](function(){pr=!1}),le({target:"Array",proto:!0,forced:pr||!tn},{find:function(e){return fr(this,e,1<arguments.length?arguments[1]:void 0)}}),x(D);var gr=Function.call,Xt=function(e,t,n){return xt(gr,v[e].prototype[t],n)};Xt("Array","find");var mr=ur.findIndex,lr="findIndex",yr=!0,tn=W(lr);lr in[]&&Array(1)[lr](function(){yr=!1}),le({target:"Array",proto:!0,forced:yr||!tn},{findIndex:function(e){return mr(this,e,1<arguments.length?arguments[1]:void 0)}}),x(lr),Xt("Array","findIndex");function vr(e,t,n){(t=r(t))in e?w.f(e,t,g(0,n)):e[t]=n}D=!$t(function(e){Array.from(e)});le({target:"Array",stat:!0,forced:D},{from:function(e){var t,n,r,i,s,o,a=ue(e),c="function"==typeof this?this:Array,l=arguments.length,u=1<l?arguments[1]:void 0,h=void 0!==u,e=Dt(a),d=0;if(h&&(u=xt(u,2<l?arguments[2]:void 0,2)),null==e||c==Array&&Ot(e))for(n=new c(t=oe(a.length));d<t;d++)o=h?u(a[d],d):a[d],vr(n,d,o);else for(s=(i=e.call(a)).next,n=new c;!(r=s.call(i)).done;d++)o=h?Lt(i,u,[r.value,d],!0):r.value,vr(n,d,o);return n.length=d,n}}),_e.Array.from;var _r,wr,br=ur.some,tn=!!(wr=[]["some"])&&m(function(){wr.call(null,_r||function(){throw 1},1)}),x=W("some");le({target:"Array",proto:!0,forced:!tn||!x},{some:function(e){return br(this,e,1<arguments.length?arguments[1]:void 0)}}),Xt("Array","some");function Ir(e){return y(e)&&c(Rr,ee(e))}var Tr,lr="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,D=w.f,Er=v.Int8Array,Sr=Er&&Er.prototype,W=v.Uint8ClampedArray,tn=W&&W.prototype,kr=Er&&Ue(Er),Cr=Sr&&Ue(Sr),x=Object.prototype,W=(x.isPrototypeOf,i("toStringTag")),Ar=a("TYPED_ARRAY_TAG"),Nr=lr&&!!it&&"Opera"!==ee(v.opera),lr=!1,Rr={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(Tr in Rr)v[Tr]||(Nr=!1);if((!Nr||"function"!=typeof kr||kr===Function.prototype)&&(kr=function(){throw TypeError("Incorrect invocation")},Nr))for(Tr in Rr)v[Tr]&&it(v[Tr],kr);if((!Nr||!Cr||Cr===x)&&(Cr=kr.prototype,Nr))for(Tr in Rr)v[Tr]&&it(v[Tr].prototype,Cr);if(Nr&&Ue(tn)!==Cr&&it(tn,Cr),d&&!c(Cr,W))for(Tr in lr=!0,D(Cr,W,{get:function(){return y(this)?this[Ar]:void 0}}),Rr)v[Tr]&&b(v[Tr],Ar,Tr);var tn=function(e){if(Ir(e))return e;throw TypeError("Target is not a typed array")},D=function(e,t,n){if(d){if(n)for(var r in Rr){r=v[r];r&&c(r.prototype,e)&&delete r.prototype[e]}Cr[e]&&!n||Y(Cr,e,!n&&Nr&&Sr[e]||t)}},W=i("iterator"),lr=v.Uint8Array,Pr=wt.values,Or=wt.keys,xr=wt.entries,Dr=tn,tn=D,D=lr&&lr.prototype[W],lr=!!D&&("values"==D.name||null==D.name),D=function(){return Pr.call(Dr(this))};tn("entries",function(){return xr.call(Dr(this))}),tn("keys",function(){return Or.call(Dr(this))}),tn("values",D,!lr),tn(W,D,!lr);var Lr=Object.assign,Mr=Object.defineProperty,D=!Lr||m(function(){if(d&&1!==Lr({b:1},Lr(Mr({},"a",{enumerable:!0,get:function(){Mr(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return 1;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=Lr({},e)[n]||Be(Lr({},t)).join("")!=r})?function(e,t){for(var n=ue(e),r=arguments.length,i=1,s=Ce.f,o=pe.f;i<r;)for(var a,c=me(arguments[i++]),l=s?Be(c).concat(s(c)):Be(c),u=l.length,h=0;h<u;)a=l[h++],d&&!o.call(c,a)||(n[a]=c[a]);return n}:Lr;le({target:"Object",stat:!0,forced:Object.assign!==D},{assign:D}),_e.Object.assign;var Fr=pe.f,lr=function(a){return function(e){for(var t,n=re(e),r=Be(n),i=r.length,s=0,o=[];s<i;)t=r[s++],d&&!Fr.call(n,t)||o.push(a?[t,n[t]]:n[t]);return o}},D={entries:lr(!0),values:lr(!1)},Ur=D.entries;le({target:"Object",stat:!0},{entries:function(e){return Ur(e)}}),_e.Object.entries;var jr=D.values;le({target:"Object",stat:!0},{values:function(e){return jr(e)}}),_e.Object.values;function qr(e){if(y(t=e)&&(void 0!==(n=t[Vr])?!!n:"RegExp"==G(t)))throw TypeError("The method doesn't accept regular expressions");var t,n;return e}var Vr=i("match"),Br=i("match"),lr=function(t){var n=/./;try{"/./"[t](n)}catch(e){try{return n[Br]=!1,"/./"[t](n)}catch(e){}}return!1};le({target:"String",proto:!0,forced:!lr("includes")},{includes:function(e){return!!~String(ne(this)).indexOf(qr(e),1<arguments.length?arguments[1]:void 0)}}),Xt("String","includes");var Kr,D=ve.f,zr="".startsWith,Wr=Math.min,lr=lr("startsWith"),Kr=!(lr||(!(Kr=D(String.prototype,"startsWith"))||Kr.writable));le({target:"String",proto:!0,forced:!Kr&&!lr},{startsWith:function(e){var t=String(ne(this));qr(e);var n=oe(Wr(1<arguments.length?arguments[1]:void 0,t.length)),e=String(e);return zr?zr.call(t,e,n):t.slice(n,n+e.length)===e}}),Xt("String","startsWith"),le({target:"String",proto:!0},{repeat:"".repeat||function(e){var t=String(ne(this)),n="",r=te(e);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n}}),Xt("String","repeat");var $r,Hr=i("species"),Gr=i("isConcatSpreadable"),Qr=9007199254740991,Yr="Maximum allowed index exceeded",lr=51<=xn||!m(function(){var e=[];return e[Gr]=!1,e.concat()[0]!==e}),Xt=($r="concat",51<=xn||!m(function(){var e=[];return(e.constructor={})[Hr]=function(){return{foo:1}},1!==e[$r](Boolean).foo}));le({target:"Array",proto:!0,forced:!lr||!Xt},{concat:function(e){for(var t,n,r,i=ue(this),s=ir(i,0),o=0,a=-1,c=arguments.length;a<c;a++)if(function(e){if(!y(e))return!1;var t=e[Gr];return void 0!==t?!!t:or(e)}(r=-1===a?i:arguments[a])){if(n=oe(r.length),Qr<o+n)throw TypeError(Yr);for(t=0;t<n;t++,o++)t in r&&vr(s,o,r[t])}else{if(Qr<=o)throw TypeError(Yr);vr(s,o++,r)}return s.length=o,s}});function Jr(e){var t=_e.Symbol||(_e.Symbol={});c(t,e)||ii(t,e,{value:ri.f(e)})}function Xr(e,t){var n=vi[e]=Ze(di[ci]);return li(n,{type:ai,tag:e,description:t}),d||(n.description=t),n}function Zr(t,e){f(t);var n=re(e),e=Be(n).concat(Ci(n));return si(e,function(e){d&&!ki.call(n,e)||Si(t,e,n[e])}),t}var ei=ke.f,ti={}.toString,ni="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Xt={f:function(e){return ni&&"[object Window]"==ti.call(e)?function(e){try{return ei(e)}catch(e){return ni.slice()}}(e):ei(re(e))}},ri={f:i},ii=w.f,si=ur.forEach,oi=e("hidden"),ai="Symbol",ci="prototype",ur=i("toPrimitive"),li=Q.set,ui=Q.getterFor(ai),hi=Object[ci],di=v.Symbol,fi=se("JSON","stringify"),pi=ve.f,gi=w.f,mi=Xt.f,yi=pe.f,vi=E("symbols"),_i=E("op-symbols"),wi=E("string-to-symbol-registry"),bi=E("symbol-to-string-registry"),e=E("wks"),E=v.QObject,Ii=!E||!E[ci]||!E[ci].findChild,Ti=d&&m(function(){return 7!=Ze(gi({},"a",{get:function(){return gi(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=pi(hi,t);r&&delete hi[t],gi(e,t,n),r&&e!==hi&&gi(hi,t,r)}:gi,Ei=N?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof di},Si=function(e,t,n){e===hi&&Si(_i,t,n),f(e);t=r(t,!0);return f(n),c(vi,t)?(n.enumerable?(c(e,oi)&&e[oi][t]&&(e[oi][t]=!1),n=Ze(n,{enumerable:g(0,!1)})):(c(e,oi)||gi(e,oi,g(1,{})),e[oi][t]=!0),Ti(e,t,n)):gi(e,t,n)},ki=function(e){var t=r(e,!0),e=yi.call(this,t);return!(this===hi&&c(vi,t)&&!c(_i,t))&&(!(e||!c(this,t)||!c(vi,t)||c(this,oi)&&this[oi][t])||e)},E=function(e,t){var n=re(e),e=r(t,!0);if(n!==hi||!c(vi,e)||c(_i,e)){t=pi(n,e);return!t||!c(vi,e)||c(n,oi)&&n[oi][e]||(t.enumerable=!0),t}},N=function(e){var e=mi(re(e)),t=[];return si(e,function(e){c(vi,e)||c(H,e)||t.push(e)}),t},Ci=function(e){var t=e===hi,e=mi(t?_i:re(e)),n=[];return si(e,function(e){!c(vi,e)||t&&!c(hi,e)||n.push(vi[e])}),n};A||(Y((di=function(){if(this instanceof di)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=a(e),n=function(e){this===hi&&n.call(_i,e),c(this,oi)&&c(this[oi],t)&&(this[oi][t]=!1),Ti(this,t,g(1,e))};return d&&Ii&&Ti(hi,t,{configurable:!0,set:n}),Xr(t,e)})[ci],"toString",function(){return ui(this).tag}),Y(di,"withoutSetter",function(e){return Xr(a(e),e)}),pe.f=ki,w.f=Si,ve.f=E,ke.f=Xt.f=N,Ce.f=Ci,ri.f=function(e){return Xr(i(e),e)},d&&(gi(di[ci],"description",{configurable:!0,get:function(){return ui(this).description}}),Y(hi,"propertyIsEnumerable",ki,{unsafe:!0}))),le({global:!0,wrap:!0,forced:!A,sham:!A},{Symbol:di}),si(Be(e),function(e){Jr(e)}),le({target:ai,stat:!0,forced:!A},{for:function(e){var t=String(e);if(c(wi,t))return wi[t];e=di(t);return wi[t]=e,bi[e]=t,e},keyFor:function(e){if(!Ei(e))throw TypeError(e+" is not a symbol");if(c(bi,e))return bi[e]},useSetter:function(){Ii=!0},useSimple:function(){Ii=!1}}),le({target:"Object",stat:!0,forced:!A,sham:!d},{create:function(e,t){return void 0===t?Ze(e):Zr(Ze(e),t)},defineProperty:Si,defineProperties:Zr,getOwnPropertyDescriptor:E}),le({target:"Object",stat:!0,forced:!A},{getOwnPropertyNames:N,getOwnPropertySymbols:Ci}),le({target:"Object",stat:!0,forced:m(function(){Ce.f(1)})},{getOwnPropertySymbols:function(e){return Ce.f(ue(e))}}),fi&&(qi=!A||m(function(){var e=di();return"[null]"!=fi([e])||"{}"!=fi({a:e})||"{}"!=fi(Object(e))}),le({target:"JSON",stat:!0,forced:qi},{stringify:function(e,t,n){for(var r,i=[e],s=1;s<arguments.length;)i.push(arguments[s++]);if((y(r=t)||void 0!==e)&&!Ei(e))return or(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Ei(t))return t}),i[1]=t,fi.apply(null,i)}})),di[ci][ur]||b(di[ci],ur,di[ci].valueOf),Qe(di,ai),H[oi]=!0,Jr("asyncIterator");var Ai,Ni,Ri,Pi,Oi,E=w.f,xi=v.Symbol;!d||"function"!=typeof xi||"description"in xi.prototype&&void 0===xi().description||(Ai={},ce(Ni=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Ni?new xi(e):void 0===e?xi():xi(e);return""===e&&(Ai[t]=!0),t},xi),(Ki=Ni.prototype=xi.prototype).constructor=Ni,Ri=Ki.toString,Pi="Symbol(test)"==String(xi("test")),Oi=/^Symbol\((.*)\)[^)]+$/,E(Ki,"description",{configurable:!0,get:function(){var e=y(this)?this.valueOf():this,t=Ri.call(e);if(c(Ai,e))return"";t=Pi?t.slice(7,-1):t.replace(Oi,"$1");return""===t?void 0:t}}),le({global:!0,forced:!0},{Symbol:Ni})),Jr("hasInstance"),Jr("isConcatSpreadable"),Jr("iterator"),Jr("match"),Jr("matchAll"),Jr("replace"),Jr("search"),Jr("species"),Jr("split"),Jr("toPrimitive"),Jr("toStringTag"),Jr("unscopables"),Qe(Math,"Math",!0),Qe(v.JSON,"JSON",!0),_e.Symbol,Jr("asyncDispose"),Jr("dispose"),Jr("observable"),Jr("patternMatch"),Jr("replaceAll"),ri.f("iterator");var Di=!m(function(){return Object.isExtensible(Object.preventExtensions({}))}),Li=t(function(e){function n(e){t(e,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var t=w.f,r=a("meta"),i=0,s=Object.isExtensible||function(){return!0},o=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!y(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!c(e,r)){if(!s(e))return"F";if(!t)return"E";n(e)}return e[r].objectID},getWeakData:function(e,t){if(!c(e,r)){if(!s(e))return!0;if(!t)return!1;n(e)}return e[r].weakData},onFreeze:function(e){return Di&&o.REQUIRED&&s(e)&&!c(e,r)&&n(e),e}};H[r]=!0}),N=function(o,e,t){function n(e){var n=f[e];Y(f,e,"add"==e?function(e){return n.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(u&&!y(e))&&n.call(this,0===e?0:e)}:"get"==e?function(e){return u&&!y(e)?void 0:n.call(this,0===e?0:e)}:"has"==e?function(e){return!(u&&!y(e))&&n.call(this,0===e?0:e)}:function(e,t){return n.call(this,0===e?0:e,t),this})}var r,i,s,a,c,l=-1!==o.indexOf("Map"),u=-1!==o.indexOf("Weak"),h=l?"set":"add",d=v[o],f=d&&d.prototype,p=d,g={};return De(o,"function"!=typeof d||!(u||f.forEach&&!m(function(){(new d).entries().next()})))?(p=t.getConstructor(e,o,l,h),Li.REQUIRED=!0):De(o,!0)&&(i=(r=new p)[h](u?{}:-0,1)!=r,s=m(function(){r.has(1)}),a=$t(function(e){new d(e)}),c=!u&&m(function(){for(var e=new d,t=5;t--;)e[h](t,t);return!e.has(-0)}),a||(((p=e(function(e,t){Pt(e,p,o);var n,r,i,s,n=(n=new d,r=e,e=p,it&&"function"==typeof(i=r.constructor)&&i!==e&&y(s=i.prototype)&&s!==e.prototype&&it(n,s),n);return null!=t&&Vt(t,n[h],n,l),n})).prototype=f).constructor=p),(s||c)&&(n("delete"),n("has"),l&&n("get")),(c||i)&&n(h),u&&f.clear&&delete f.clear),g[o]=p,le({global:!0,forced:p!=d},g),Qe(p,o),u||t.setStrong(p,o,l),p},Mi=w.f,Fi=Li.fastKey,Ui=Q.set,ji=Q.getterFor,qi={getConstructor:function(e,n,r,i){function s(e,t,n){var r,i=a(e),s=c(e,t);return s?s.value=n:(i.last=s={index:r=Fi(t,!0),key:t,value:n,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=s),n&&(n.next=s),d?i.size++:e.size++,"F"!==r&&(i.index[r]=s)),e}var o=e(function(e,t){Pt(e,o,n),Ui(e,{type:n,index:Ze(null),first:void 0,last:void 0,size:0}),d||(e.size=0),null!=t&&Vt(t,e[i],e,r)}),a=ji(n),c=function(e,t){var n,r=a(e),e=Fi(t);if("F"!==e)return r.index[e];for(n=r.first;n;n=n.next)if(n.key==t)return n};return At(o.prototype,{clear:function(){for(var e=a(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,d?e.size=0:this.size=0},delete:function(e){var t,n=a(this),r=c(this,e);return r&&(t=r.next,e=r.previous,delete n.index[r.index],r.removed=!0,e&&(e.next=t),t&&(t.previous=e),n.first==r&&(n.first=t),n.last==r&&(n.last=e),d?n.size--:this.size--),!!r},forEach:function(e){for(var t,n=a(this),r=xt(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),At(o.prototype,r?{get:function(e){e=c(this,e);return e&&e.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),d&&Mi(o.prototype,"size",{get:function(){return a(this).size}}),o},setStrong:function(e,t,n){var r=t+" Iterator",i=ji(t),s=ji(r);Xe(e,t,function(e,t){Ui(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=s(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:e.target=void 0,done:!0}},n?"entries":"values",!n,!0),Nt(t)}};N("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},qi),_e.Map;ur=function(e){var t,n,r,i,s=arguments.length,o=1<s?arguments[1]:void 0;return Rt(this),(t=void 0!==o)&&Rt(o),null==e?new this:(n=[],t?(r=0,i=xt(o,2<s?arguments[2]:void 0,2),Vt(e,function(e){n.push(i(e,r++))})):Vt(e,n.push,n),new this(n))};le({target:"Map",stat:!0},{from:ur});E=function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)};le({target:"Map",stat:!0},{of:E});function Vi(){for(var e,t=f(this),n=Rt(t.delete),r=!0,i=0,s=arguments.length;i<s;i++)e=n.call(t,arguments[i]),r=r&&e;return!!r}le({target:"Map",proto:!0,real:!0,forced:o},{deleteAll:function(){return Vi.apply(this,arguments)}});function Bi(e){return Map.prototype.entries.call(e)}le({target:"Map",proto:!0,real:!0,forced:o},{every:function(e){var n=f(this),t=Bi(n),r=xt(e,1<arguments.length?arguments[1]:void 0,3);return!Vt(t,function(e,t){if(!r(t,e,n))return Vt.stop()},void 0,!0,!0).stopped}}),le({target:"Map",proto:!0,real:!0,forced:o},{filter:function(e){var n=f(this),t=Bi(n),r=xt(e,1<arguments.length?arguments[1]:void 0,3),i=new(Ht(n,se("Map"))),s=Rt(i.set);return Vt(t,function(e,t){r(t,e,n)&&s.call(i,e,t)},void 0,!0,!0),i}}),le({target:"Map",proto:!0,real:!0,forced:o},{find:function(e){var n=f(this),t=Bi(n),r=xt(e,1<arguments.length?arguments[1]:void 0,3);return Vt(t,function(e,t){if(r(t,e,n))return Vt.stop(t)},void 0,!0,!0).result}}),le({target:"Map",proto:!0,real:!0,forced:o},{findKey:function(e){var n=f(this),t=Bi(n),r=xt(e,1<arguments.length?arguments[1]:void 0,3);return Vt(t,function(e,t){if(r(t,e,n))return Vt.stop(e)},void 0,!0,!0).result}}),le({target:"Map",stat:!0},{groupBy:function(e,n){var r=new this;Rt(n);var i=Rt(r.has),s=Rt(r.get),o=Rt(r.set);return Vt(e,function(e){var t=n(e);i.call(r,t)?s.call(r,t).push(e):o.call(r,t,[e])}),r}});le({target:"Map",proto:!0,real:!0,forced:o},{includes:function(r){return Vt(Bi(f(this)),function(e,t){if((n=t)===(t=r)||n!=n&&t!=t)return Vt.stop();var n},void 0,!0,!0).stopped}}),le({target:"Map",stat:!0},{keyBy:function(e,t){var n=new this;Rt(t);var r=Rt(n.set);return Vt(e,function(e){r.call(n,t(e),e)}),n}}),le({target:"Map",proto:!0,real:!0,forced:o},{keyOf:function(n){return Vt(Bi(f(this)),function(e,t){if(t===n)return Vt.stop(e)},void 0,!0,!0).result}}),le({target:"Map",proto:!0,real:!0,forced:o},{mapKeys:function(e){var n=f(this),t=Bi(n),r=xt(e,1<arguments.length?arguments[1]:void 0,3),i=new(Ht(n,se("Map"))),s=Rt(i.set);return Vt(t,function(e,t){s.call(i,r(t,e,n),t)},void 0,!0,!0),i}}),le({target:"Map",proto:!0,real:!0,forced:o},{mapValues:function(e){var n=f(this),t=Bi(n),r=xt(e,1<arguments.length?arguments[1]:void 0,3),i=new(Ht(n,se("Map"))),s=Rt(i.set);return Vt(t,function(e,t){s.call(i,e,r(t,e,n))},void 0,!0,!0),i}}),le({target:"Map",proto:!0,real:!0,forced:o},{merge:function(e){for(var t=f(this),n=Rt(t.set),r=0;r<arguments.length;)Vt(arguments[r++],n,t,!0);return t}}),le({target:"Map",proto:!0,real:!0,forced:o},{reduce:function(n){var r=f(this),e=Bi(r),i=arguments.length<2,s=i?void 0:arguments[1];if(Rt(n),Vt(e,function(e,t){s=i?(i=!1,t):n(s,t,e,r)},void 0,!0,!0),i)throw TypeError("Reduce of empty map with no initial value");return s}}),le({target:"Map",proto:!0,real:!0,forced:o},{some:function(e){var n=f(this),t=Bi(n),r=xt(e,1<arguments.length?arguments[1]:void 0,3);return Vt(t,function(e,t){if(r(t,e,n))return Vt.stop()},void 0,!0,!0).stopped}}),le({target:"Map",proto:!0,real:!0,forced:o},{update:function(e,t){var n=f(this),r=arguments.length;Rt(t);var i=n.has(e);if(!i&&r<3)throw TypeError("Updating absent value");r=i?n.get(e):Rt(2<r?arguments[2]:void 0)(e,n);return n.set(e,t(r,e,n)),n}});var Ki=function(e,t){var n,r=f(this),i=2<arguments.length?arguments[2]:void 0;if("function"!=typeof t&&"function"!=typeof i)throw TypeError("At least one callback required");return r.has(e)?(n=r.get(e),"function"==typeof t&&(n=t(n),r.set(e,n))):"function"==typeof i&&(n=i(),r.set(e,n)),n};le({target:"Map",proto:!0,real:!0,forced:o},{upsert:Ki}),le({target:"Map",proto:!0,real:!0,forced:o},{updateOrInsert:Ki}),N("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},qi),_e.Set,le({target:"Set",stat:!0},{from:ur}),le({target:"Set",stat:!0},{of:E});le({target:"Set",proto:!0,real:!0,forced:o},{addAll:function(){return function(){for(var e=f(this),t=Rt(e.add),n=0,r=arguments.length;n<r;n++)t.call(e,arguments[n]);return e}.apply(this,arguments)}}),le({target:"Set",proto:!0,real:!0,forced:o},{deleteAll:function(){return Vi.apply(this,arguments)}});function zi(e){return Set.prototype.values.call(e)}le({target:"Set",proto:!0,real:!0,forced:o},{every:function(e){var t=f(this),n=zi(t),r=xt(e,1<arguments.length?arguments[1]:void 0,3);return!Vt(n,function(e){if(!r(e,e,t))return Vt.stop()},void 0,!1,!0).stopped}}),le({target:"Set",proto:!0,real:!0,forced:o},{difference:function(e){var t=f(this),n=new(Ht(t,se("Set")))(t),r=Rt(n.delete);return Vt(e,function(e){r.call(n,e)}),n}}),le({target:"Set",proto:!0,real:!0,forced:o},{filter:function(e){var t=f(this),n=zi(t),r=xt(e,1<arguments.length?arguments[1]:void 0,3),i=new(Ht(t,se("Set"))),s=Rt(i.add);return Vt(n,function(e){r(e,e,t)&&s.call(i,e)},void 0,!1,!0),i}}),le({target:"Set",proto:!0,real:!0,forced:o},{find:function(e){var t=f(this),n=zi(t),r=xt(e,1<arguments.length?arguments[1]:void 0,3);return Vt(n,function(e){if(r(e,e,t))return Vt.stop(e)},void 0,!1,!0).result}}),le({target:"Set",proto:!0,real:!0,forced:o},{intersection:function(e){var t=f(this),n=new(Ht(t,se("Set"))),r=Rt(t.has),i=Rt(n.add);return Vt(e,function(e){r.call(t,e)&&i.call(n,e)}),n}}),le({target:"Set",proto:!0,real:!0,forced:o},{isDisjointFrom:function(e){var t=f(this),n=Rt(t.has);return!Vt(e,function(e){if(!0===n.call(t,e))return Vt.stop()}).stopped}}),le({target:"Set",proto:!0,real:!0,forced:o},{isSubsetOf:function(e){var t=function(e){var t=Dt(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return f(t.call(e))}(this),n=f(e),r=n.has;return"function"!=typeof r&&(n=new(se("Set"))(e),r=Rt(n.has)),!Vt(t,function(e){if(!1===r.call(n,e))return Vt.stop()},void 0,!1,!0).stopped}}),le({target:"Set",proto:!0,real:!0,forced:o},{isSupersetOf:function(e){var t=f(this),n=Rt(t.has);return!Vt(e,function(e){if(!1===n.call(t,e))return Vt.stop()}).stopped}}),le({target:"Set",proto:!0,real:!0,forced:o},{join:function(e){var t=f(this),n=zi(t),t=void 0===e?",":String(e),e=[];return Vt(n,e.push,e,!1,!0),e.join(t)}}),le({target:"Set",proto:!0,real:!0,forced:o},{map:function(e){var t=f(this),n=zi(t),r=xt(e,1<arguments.length?arguments[1]:void 0,3),i=new(Ht(t,se("Set"))),s=Rt(i.add);return Vt(n,function(e){s.call(i,r(e,e,t))},void 0,!1,!0),i}}),le({target:"Set",proto:!0,real:!0,forced:o},{reduce:function(t){var n=f(this),e=zi(n),r=arguments.length<2,i=r?void 0:arguments[1];if(Rt(t),Vt(e,function(e){i=r?(r=!1,e):t(i,e,e,n)},void 0,!1,!0),r)throw TypeError("Reduce of empty set with no initial value");return i}}),le({target:"Set",proto:!0,real:!0,forced:o},{some:function(e){var t=f(this),n=zi(t),r=xt(e,1<arguments.length?arguments[1]:void 0,3);return Vt(n,function(e){if(r(e,e,t))return Vt.stop()},void 0,!1,!0).stopped}}),le({target:"Set",proto:!0,real:!0,forced:o},{symmetricDifference:function(e){var t=f(this),n=new(Ht(t,se("Set")))(t),r=Rt(n.delete),i=Rt(n.add);return Vt(e,function(e){r.call(n,e)||i.call(n,e)}),n}}),le({target:"Set",proto:!0,real:!0,forced:o},{union:function(e){var t=f(this),t=new(Ht(t,se("Set")))(t);return Vt(e,Rt(t.add),t),t}});var Wi=Math.floor;le({target:"Number",stat:!0},{isInteger:function(e){return!y(e)&&isFinite(e)&&Wi(e)===e}}),_e.Number.isInteger;var $i=function(e,t){return($i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};var Hi=function(){return(Hi=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Gi(e,t){var n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function Qi(e,o,a,c){return new(a=a||Promise)(function(n,t){function r(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(e){var t;e.done?n(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,i)}s((c=c.apply(e,o||[])).next())})}function Yi(n,r){var i,s,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(o=2&t[0]?s.return:t[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,t[1])).done)return o;switch(s=0,(t=o?[2&t[0],o.value]:t)[0]){case 0:case 1:o=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(o=0<(o=a.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){a.label=t[1];break}if(6===t[0]&&a.label<o[1]){a.label=o[1],o=t;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(t);break}o[2]&&a.ops.pop(),a.trys.pop();continue}t=r.call(n,a)}catch(e){t=[6,e],s=0}finally{i=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function Ji(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xi(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),o=[];try{for(;(void 0===t||0<t--)&&!(r=s.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return o}function Zi(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}function es(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t}function ts(e){return e=es(e),os.encodeByteArray(e,!0)}var ns=!1,rs="${JSCORE_VERSION}",is=function(e,t){if(!e)throw ss(t)},ss=function(e){return new Error("Firebase Database ("+rs+") INTERNAL ASSERT FAILED: "+e)},os={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var s=e[i],o=i+1<e.length,a=o?e[i+1]:0,c=i+2<e.length,l=c?e[i+2]:0,u=(15&a)<<2|l>>6,l=63&l;c||(l=64,o||(u=64)),r.push(n[s>>2],n[(3&s)<<4|a>>4],n[u],n[l])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(es(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i,s,o,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(s=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&s)):239<a&&a<365?(i=((7&a)<<18|(63&(s=e[n++]))<<12|(63&(o=e[n++]))<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))):(s=e[n++],o=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&s)<<6|63&o))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var s=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,a=++i<e.length?n[e.charAt(i)]:64,c=++i<e.length?n[e.charAt(i)]:64;if(++i,null==s||null==o||null==a||null==c)throw Error();r.push(s<<2|o>>4),64!==a&&(r.push(o<<4&240|a>>2),64!==c&&r.push(a<<6&192|c))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},as=function(e){return ts(e).replace(/\./g,"")},cs=function(e){try{return os.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function ls(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=ls(e[n],t[n]));return e}var us=(hs.prototype.wrapCallback=function(n){var r=this;return function(e,t){e?r.reject(e):r.resolve(t),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(e):n(e,t))}},hs);function hs(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,t){n.resolve=e,n.reject=t})}function ds(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,t=e.sub||e.user_id;if(!t)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");e=Hi({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:t,user_id:t,firebase:{sign_in_provider:"custom",identities:{}}},e);return[as(JSON.stringify({alg:"none",type:"JWT"})),as(JSON.stringify(e)),""].join(".")}function fs(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function ps(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fs())}function gs(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function ms(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function ys(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function vs(){var e=fs();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}function _s(){return!0===ns}function ws(){return"indexedDB"in self&&null!=indexedDB}function bs(){return new Promise(function(e,t){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=function(){i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})}function Is(){return!(!navigator||!navigator.cookieEnabled)}var Ts,Es="FirebaseError",Ss=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}$i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(ks,Ts=Error),ks);function ks(e,t,n){t=Ts.call(this,t)||this;return t.code=e,t.customData=n,t.name=Es,Object.setPrototypeOf(t,ks.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,Cs.prototype.create),t}var Cs=(As.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i=t[0]||{},s=this.service+"/"+e,e=this.errors[e],e=e?(r=i,e.replace(Ns,function(e,t){var n=r[t];return null!=n?String(n):"<"+t+"?>"})):"Error",e=this.serviceName+": "+e+" ("+s+").";return new Ss(s,e,i)},As);function As(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var Ns=/\{\$([^}]+)}/g;function Rs(e){return JSON.parse(e)}function Ps(e){return JSON.stringify(e)}function Os(e){var t={},n={},r={},i="";try{var s=e.split("."),t=Rs(cs(s[0])||""),n=Rs(cs(s[1])||""),i=s[2],r=n.d||{};delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function xs(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ds(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function Ls(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Ms(e,t,n){var r,i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function Fs(e,t){if(e===t)return 1;for(var n=Object.keys(e),r=Object.keys(t),i=0,s=n;i<s.length;i++){var o=s[i];if(!r.includes(o))return;var a=e[o],c=t[o];if(Us(a)&&Us(c)){if(!Fs(a,c))return}else if(a!==c)return}for(var l=0,u=r;l<u.length;l++){o=u[l];if(!n.includes(o))return}return 1}function Us(e){return null!==e&&"object"==typeof e}function js(e){for(var n=[],t=0,r=Object.entries(e);t<r.length;t++){var i=r[t];!function(t,e){Array.isArray(e)?e.forEach(function(e){n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}):n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}(i[0],i[1])}return n.length?"&"+n.join("&"):""}function qs(e){var n={};return e.replace(/^\?/,"").split("&").forEach(function(e){var t;e&&(e=(t=e.split("="))[0],t=t[1],n[decodeURIComponent(e)]=decodeURIComponent(t))}),n}function Vs(e){var t=e.indexOf("?");if(!t)return"";var n=e.indexOf("#",t);return e.substring(t,0<n?n:void 0)}var Bs=(Ks.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},Ks.prototype.compress_=function(e,t){t=t||0;var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}for(var s,o=this.chain_[0],a=this.chain_[1],c=this.chain_[2],l=this.chain_[3],u=this.chain_[4],r=0;r<80;r++)var h=r<40?r<20?(s=l^a&(c^l),1518500249):(s=a^c^l,1859775393):r<60?(s=a&c|l&(a|c),2400959708):(s=a^c^l,3395469782),i=(o<<5|o>>>27)+s+u+h+n[r]&4294967295,u=l,l=c,c=4294967295&(a<<30|a>>>2),a=o,o=i;this.chain_[0]=this.chain_[0]+o&4294967295,this.chain_[1]=this.chain_[1]+a&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295},Ks.prototype.update=function(e,t){if(null!=e){for(var n=(t=void 0===t?e.length:t)-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++r,++s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++r,++s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}},Ks.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);for(var r=0,n=0;n<5;n++)for(var i=24;0<=i;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},Ks);function Ks(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}function zs(e,t){t=new Ws(e,t);return t.subscribe.bind(t)}var Ws=($s.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},$s.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},$s.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},$s.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=Hs),void 0===r.error&&(r.error=Hs),void 0===r.complete&&(r.complete=Hs);n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),n},$s.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],--this.observerCount,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},$s.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},$s.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},$s.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},$s);function $s(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}function Hs(){}function Gs(e,t,n,r){var i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function Qs(e,t){return e+" failed: "+t+" argument "}function Ys(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Qs(e,t)+"must be a valid function.")}function Js(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Qs(e,t)+"must be a valid context object.")}function Xs(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:55296<=r&&r<=56319?(t+=4,n++):t+=3}return t}var Zs=1e3,eo=2,to=144e5,no=.5;function ro(e,t,n){void 0===n&&(n=eo);n=(t=void 0===t?Zs:t)*Math.pow(n,e),e=Math.round(no*n*(Math.random()-.5)*2);return Math.min(to,n+e)}function io(e){return e&&e._delegate?e._delegate:e}var so=(oo.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},oo.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},oo.prototype.setServiceProps=function(e){return this.serviceProps=e,this},oo.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},oo);function oo(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}var ao="[DEFAULT]",co=(lo.prototype.get=function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){e=new us;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise},lo.prototype.getImmediate=function(t){var e=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),t=null!==(t=null==t?void 0:t.optional)&&void 0!==t&&t;if(!this.isInitialized(e)&&!this.shouldAutoInitialize()){if(t)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:e})}catch(e){if(t)return null;throw e}},lo.prototype.getComponent=function(){return this.component},lo.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:ao})}catch(e){}try{for(var r=Ji(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var s=Xi(i.value,2),o=s[0],a=s[1],c=this.normalizeInstanceIdentifier(o);try{var l=this.getOrInitializeService({instanceIdentifier:c});a.resolve(l)}catch(e){}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},lo.prototype.clearInstance=function(e){this.instancesDeferred.delete(e=void 0===e?ao:e),this.instancesOptions.delete(e),this.instances.delete(e)},lo.prototype.delete=function(){return Qi(this,void 0,void 0,function(){var t;return Yi(this,function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(Zi(Zi([],Xi(t.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()}))),Xi(t.filter(function(e){return"_delete"in e}).map(function(e){return e._delete()}))))];case 1:return e.sent(),[2]}})})},lo.prototype.isComponentSet=function(){return null!=this.component},lo.prototype.isInitialized=function(e){return this.instances.has(e=void 0===e?ao:e)},lo.prototype.getOptions=function(e){return this.instancesOptions.get(e=void 0===e?ao:e)||{}},lo.prototype.initialize=function(e){var t,n,r=(e=void 0===e?{}:e).options,r=void 0===r?{}:r,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(this.name+"("+i+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var s=this.getOrInitializeService({instanceIdentifier:i,options:r});try{for(var o=Ji(this.instancesDeferred.entries()),a=o.next();!a.done;a=o.next()){var c=Xi(a.value,2),l=c[0],u=c[1];i===this.normalizeInstanceIdentifier(l)&&u.resolve(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return s},lo.prototype.onInit=function(e,t){var n=this.normalizeInstanceIdentifier(t),r=null!==(t=this.onInitCallbacks.get(n))&&void 0!==t?t:new Set;r.add(e),this.onInitCallbacks.set(n,r);t=this.instances.get(n);return t&&e(t,n),function(){r.delete(e)}},lo.prototype.invokeOnInitCallbacks=function(e,t){var n,r,i=this.onInitCallbacks.get(t);if(i)try{for(var s=Ji(i),o=s.next();!o.done;o=s.next()){var a=o.value;try{a(e,t)}catch(e){}}}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}},lo.prototype.getOrInitializeService=function(e){var t=e.instanceIdentifier,n=e.options,r=void 0===n?{}:n,e=this.instances.get(t);if(!e&&this.component&&(e=this.component.instanceFactory(this.container,{instanceIdentifier:(n=t)===ao?void 0:n,options:r}),this.instances.set(t,e),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(e,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,e)}catch(e){}return e||null},lo.prototype.normalizeInstanceIdentifier=function(e){return void 0===e&&(e=ao),!this.component||this.component.multipleInstances?e:ao},lo.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},lo);function lo(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}var uo=(ho.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},ho.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},ho.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new co(e,this);return this.providers.set(e,t),t},ho.prototype.getProviders=function(){return Array.from(this.providers.values())},ho);function ho(e){this.name=e,this.providers=new Map}var fo,po=[];(qi=fo=fo||{})[qi.DEBUG=0]="DEBUG",qi[qi.VERBOSE=1]="VERBOSE",qi[qi.INFO=2]="INFO",qi[qi.WARN=3]="WARN",qi[qi.ERROR=4]="ERROR",qi[qi.SILENT=5]="SILENT";function go(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),s=vo[t];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[s].apply(console,Zi(["["+i+"]  "+e.name+":"],n))}}var mo={debug:fo.DEBUG,verbose:fo.VERBOSE,info:fo.INFO,warn:fo.WARN,error:fo.ERROR,silent:fo.SILENT},yo=fo.INFO,vo=((ur={})[fo.DEBUG]="log",ur[fo.VERBOSE]="log",ur[fo.INFO]="info",ur[fo.WARN]="warn",ur[fo.ERROR]="error",ur),_o=(Object.defineProperty(wo.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in fo))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),wo.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?mo[e]:e},Object.defineProperty(wo.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(wo.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),wo.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,fo.DEBUG],e)),this._logHandler.apply(this,Zi([this,fo.DEBUG],e))},wo.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,fo.VERBOSE],e)),this._logHandler.apply(this,Zi([this,fo.VERBOSE],e))},wo.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,fo.INFO],e)),this._logHandler.apply(this,Zi([this,fo.INFO],e))},wo.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,fo.WARN],e)),this._logHandler.apply(this,Zi([this,fo.WARN],e))},wo.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,Zi([this,fo.ERROR],e)),this._logHandler.apply(this,Zi([this,fo.ERROR],e))},wo);function wo(e){this.name=e,this._logLevel=yo,this._logHandler=go,this._userLogHandler=null,po.push(this)}function bo(o,t){for(var e=0,n=po;e<n.length;e++)!function(e){var s=null;t&&t.level&&(s=mo[t.level]),e.userLogHandler=null===o?null:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=n.map(function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(function(e){return e}).join(" ");t>=(null!=s?s:e.logLevel)&&o({level:fo[t].toLowerCase(),message:i,args:n,type:e.name})}}(n[e])}class Io{constructor(e){this.container=e}getPlatformInfoString(){const e=this.container.getProviders();return e.map(e=>{if(function(e){e=e.getComponent();return"VERSION"===(null==e?void 0:e.type)}(e)){e=e.getImmediate();return`${e.library}/${e.version}`}return null}).filter(e=>e).join(" ")}}const To="@firebase/app",Eo=new _o("@firebase/app");var So;const ko="[DEFAULT]",Co={"@firebase/app":"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Ao=new Map,No=new Map;function Ro(t,n){try{t.container.addComponent(n)}catch(e){Eo.debug(`Component ${n.name} failed to register with FirebaseApp ${t.name}`,e)}}function Po(e,t){e.container.addOrOverwriteComponent(t)}function Oo(e){var t=e.name;if(No.has(t))return Eo.debug(`There were multiple attempts to register component ${t}.`),!1;No.set(t,e);for(const n of Ao.values())Ro(n,e);return!0}function xo(e,t){return e.container.getProvider(t)}const Do=new Cs("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class Lo{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new so("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Do.create("app-deleted",{appName:this._name})}}const Mo="9.0.2";function Fo(e,t={}){if("object"!=typeof t){const r=t;t={name:r}}var n=Object.assign({name:ko,automaticDataCollectionEnabled:!1},t);const r=n.name;if("string"!=typeof r||!r)throw Do.create("bad-app-name",{appName:String(r)});t=Ao.get(r);if(t){if(Fs(e,t.options)&&Fs(n,t.config))return t;throw Do.create("duplicate-app",{appName:r})}const i=new uo(r);for(const s of No.values())i.addComponent(s);n=new Lo(e,n,i);return Ao.set(r,n),n}function Uo(e=ko){var t=Ao.get(e);if(!t)throw Do.create("no-app",{appName:e});return t}async function jo(e){var t=e.name;Ao.has(t)&&(Ao.delete(t),await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function qo(e,t,n){var r;let i=null!==(r=Co[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);e=i.match(/\s|\//),n=t.match(/\s|\//);if(e||n){const s=[`Unable to register library "${i}" with version "${t}":`];return e&&s.push(`library name "${i}" contains illegal characters (whitespace or "/")`),e&&n&&s.push("and"),n&&s.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Eo.warn(s.join(" "))}Oo(new so(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}function Vo(e,t){if(null!==e&&"function"!=typeof e)throw Do.create("invalid-log-argument");bo(e,t)}function Bo(e){var t;t=e,po.forEach(function(e){e.setLogLevel(t)})}Oo(new so("platform-logger",e=>new Io(e),"PRIVATE")),qo(To,"0.7.0",So),qo("fire-js","");var Ko=Object.freeze({__proto__:null,SDK_VERSION:Mo,_DEFAULT_ENTRY_NAME:ko,_addComponent:Ro,_addOrOverwriteComponent:Po,_apps:Ao,_clearComponents:function(){No.clear()},_components:No,_getProvider:xo,_registerComponent:Oo,_removeServiceInstance:function(e,t,n=ko){xo(e,t).clearInstance(n)},deleteApp:jo,getApp:Uo,getApps:function(){return Array.from(Ao.values())},initializeApp:Fo,onLog:Vo,registerVersion:qo,setLogLevel:Bo,FirebaseError:Ss});class zo{constructor(e,t){this._delegate=e,this.firebase=t,Ro(e,new so("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),jo(this._delegate)))}_getService(e,t=ko){this._delegate.checkDestroyed();const n=this._delegate.container.getProvider(e);return n.isInitialized()||"EXPLICIT"!==(null===(e=n.getComponent())||void 0===e?void 0:e.instantiationMode)||n.initialize(),n.getImmediate({identifier:t})}_removeServiceInstance(e,t=ko){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Ro(this._delegate,e)}_addOrOverwriteComponent(e){Po(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Wo=new Cs("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});function $o(i){const n={},s={__esModule:!0,initializeApp:function(e,t={}){e=Fo(e,t);if(xs(n,e.name))return n[e.name];t=new i(e,s);return n[e.name]=t},app:o,registerVersion:qo,setLogLevel:Bo,onLog:Vo,apps:null,SDK_VERSION:Mo,INTERNAL:{registerComponent:function(n){const r=n.name,t=r.replace("-compat","");{var e;Oo(n)&&"PUBLIC"===n.type&&(e=(e=o())=>{if("function"!=typeof e[t])throw Wo.create("invalid-app-argument",{appName:r});return e[t]()},void 0!==n.serviceProps&&ls(e,n.serviceProps),s[t]=e,i.prototype[t]=function(...e){const t=this._getService.bind(this,r);return t.apply(this,n.multipleInstances?e:[])})}return"PUBLIC"===n.type?s[t]:null},removeApp:function(e){delete n[e]},useAsService:function(e,t){if("serverAuth"===t)return null;return t},modularAPIs:Ko}};function o(e){if(e=e||ko,!xs(n,e))throw Wo.create("no-app",{appName:e});return n[e]}return s.default=s,Object.defineProperty(s,"apps",{get:function(){return Object.keys(n).map(e=>n[e])}}),o.App=i,s}E=function e(){const t=$o(zo);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){ls(t,e)},createSubscribe:zs,ErrorFactory:Cs,deepExtend:ls}),t}();const Ho=new _o("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Ho.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const YM=self.firebase.SDK_VERSION;YM&&0<=YM.indexOf("LITE")&&Ho.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const Go=E;qo("@firebase/app-compat","0.1.1",void 0);Go.registerVersion("firebase","9.0.2","app-compat");function Qo(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function Yo(n,r,i){var s,e=new Promise(function(e,t){Qo(s=n[r].apply(n,i)).then(e,t)});return e.request=s,e}function Jo(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function Xo(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return Yo(this[n],e,arguments)})})}function Zo(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function ea(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=Yo(e,n,arguments)).then(function(e){if(e)return new na(e,t.request)});var e,t})})}function ta(e){this._index=e}function na(e,t){this._cursor=e,this._request=t}function ra(e){this._store=e}function ia(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function sa(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new ia(n)}function oa(e){this._db=e}function aa(e,t,n){var t=Yo(indexedDB,"open",[e,t]),r=t.request;return r&&(r.onupgradeneeded=function(e){n&&n(new sa(r.result,e.oldVersion,r.transaction))}),t.then(function(e){return new oa(e)})}function ca(e){return Yo(indexedDB,"deleteDatabase",[e])}Jo(ta,"_index",["name","keyPath","multiEntry","unique"]),Xo(ta,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),ea(ta,"_index",IDBIndex,["openCursor","openKeyCursor"]),Jo(na,"_cursor",["direction","key","primaryKey","value"]),Xo(na,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(na.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),Qo(t._request).then(function(e){if(e)return new na(e,t._request)})})})}),ra.prototype.createIndex=function(){return new ta(this._store.createIndex.apply(this._store,arguments))},ra.prototype.index=function(){return new ta(this._store.index.apply(this._store,arguments))},Jo(ra,"_store",["name","keyPath","indexNames","autoIncrement"]),Xo(ra,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),ea(ra,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),Zo(ra,"_store",IDBObjectStore,["deleteIndex"]),ia.prototype.objectStore=function(){return new ra(this._tx.objectStore.apply(this._tx,arguments))},Jo(ia,"_tx",["objectStoreNames","mode"]),Zo(ia,"_tx",IDBTransaction,["abort"]),sa.prototype.createObjectStore=function(){return new ra(this._db.createObjectStore.apply(this._db,arguments))},Jo(sa,"_db",["name","version","objectStoreNames"]),Zo(sa,"_db",IDBDatabase,["deleteObjectStore","close"]),oa.prototype.transaction=function(){return new ia(this._db.transaction.apply(this._db,arguments))},Jo(oa,"_db",["name","version","objectStoreNames"]),Zo(oa,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[ra,ta].forEach(function(e){i in e.prototype&&(e.prototype[i.replace("open","iterate")]=function(){var e=(n=arguments,Array.prototype.slice.call(n)),t=e[e.length-1],n=this._store||this._index,r=n[i].apply(n,e.slice(0,-1));r.onsuccess=function(){t(r.result)}})})}),[ta,ra].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,i=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(i.push(e.value),void 0===n||i.length!=n?e.continue():t(i)):t(i)})})})});const la=1e4,ua="w:0.5.0",ha="FIS_v2",da="https://firebaseinstallations.googleapis.com/v1",fa=36e5;const pa=new Cs("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function ga(e){return e instanceof Ss&&e.code.includes("request-failed")}function ma({projectId:e}){return`${da}/projects/${e}/installations`}function ya(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function va(e,t){t=(await t.json()).error;return pa.create("request-failed",{requestName:e,serverCode:t.code,serverMessage:t.message,serverStatus:t.status})}function _a({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function wa(e,{refreshToken:t}){const n=_a(e);return n.append("Authorization",(t=t,`${ha} ${t}`)),n}async function ba(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function Ia(t){return new Promise(e=>{setTimeout(e,t)})}const Ta=/^[cdef][\w-]{21}$/,Ea="";function Sa(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=function(e){const t=function(e){const t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}(e);return t.substr(0,22)}(t);return Ta.test(e)?e:Ea}catch(e){return Ea}}function ka(e){return`${e.appName}!${e.appId}`}const Ca=new Map;function Aa(e,t){e=ka(e);Na(e,t),function(e,t){const n=function(){!Ra&&"BroadcastChannel"in self&&(Ra=new BroadcastChannel("[Firebase] FID Change"),Ra.onmessage=e=>{Na(e.data.key,e.data.fid)});return Ra}();n&&n.postMessage({key:e,fid:t});0===Ca.size&&Ra&&(Ra.close(),Ra=null)}(e,t)}function Na(e,t){e=Ca.get(e);if(e)for(const n of e)n(t)}let Ra=null;const Pa="firebase-installations-database",Oa=1,xa="firebase-installations-store";let Da=null;function La(){return Da=Da||aa(Pa,Oa,e=>{0===e.oldVersion&&e.createObjectStore(xa)}),Da}async function Ma(e,t){var n=ka(e);const r=await La(),i=r.transaction(xa,"readwrite"),s=i.objectStore(xa);var o=await s.get(n);return await s.put(t,n),await i.complete,o&&o.fid===t.fid||Aa(e,t.fid),t}async function Fa(e){e=ka(e);const t=await La(),n=t.transaction(xa,"readwrite");await n.objectStore(xa).delete(e),await n.complete}async function Ua(e,t){var n=ka(e);const r=await La(),i=r.transaction(xa,"readwrite"),s=i.objectStore(xa);var o=await s.get(n),t=t(o);return void 0===t?await s.delete(n):await s.put(t,n),await i.complete,!t||o&&o.fid===t.fid||Aa(e,t.fid),t}async function ja(t){let n;var e=await Ua(t,e=>{e=function(e){e=e||{fid:Sa(),registrationStatus:0};return Va(e)}(e),e=function(e,t){{if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:async function(e){let t=await qa(e);for(;1===t.registrationStatus;)await Ia(100),t=await qa(e);if(0!==t.registrationStatus)return t;{var{installationEntry:n,registrationPromise:r}=await ja(e);return r||n}}(e)}:{installationEntry:t};if(!navigator.onLine){var n=Promise.reject(pa.create("app-offline"));return{installationEntry:t,registrationPromise:n}}t={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},e=async function(t,n){try{var e=await async function(e,{fid:t}){const n=ma(e);var r=_a(e),e={fid:t,authVersion:ha,appId:e.appId,sdkVersion:ua};const i={method:"POST",headers:r,body:JSON.stringify(e)},s=await ba(()=>fetch(n,i));if(s.ok){e=await s.json();return{fid:e.fid||t,registrationStatus:2,refreshToken:e.refreshToken,authToken:ya(e.authToken)}}throw await va("Create Installation",s)}(t,n);return Ma(t,e)}catch(e){throw ga(e)&&409===e.customData.serverCode?await Fa(t):await Ma(t,{fid:n.fid,registrationStatus:0}),e}}(e,t);return{installationEntry:t,registrationPromise:e}}}(t,e);return n=e.registrationPromise,e.installationEntry});return e.fid===Ea?{installationEntry:await n}:{installationEntry:e,registrationPromise:n}}function qa(e){return Ua(e,e=>{if(!e)throw pa.create("installation-not-found");return Va(e)})}function Va(e){return 1===(t=e).registrationStatus&&t.registrationTime+la<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function Ba({appConfig:e,platformLoggerProvider:t},n){const r=([i,{fid:s}]=[e,n],`${ma(i)}/${s}/authTokens:generate`);var i,s;const o=wa(e,n),a=t.getImmediate({optional:!0});a&&o.append("x-firebase-client",a.getPlatformInfoString());t={installation:{sdkVersion:ua}};const c={method:"POST",headers:o,body:JSON.stringify(t)},l=await ba(()=>fetch(r,c));if(l.ok)return ya(await l.json());throw await va("Generate Auth Token",l)}async function Ka(r,i=!1){let s;var e=await Ua(r.appConfig,e=>{if(!Wa(e))throw pa.create("not-registered");var t,n=e.authToken;if(i||2!==(t=n).requestStatus||function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+fa}(t)){if(1===n.requestStatus)return s=async function(e,t){let n=await za(e.appConfig);for(;1===n.authToken.requestStatus;)await Ia(100),n=await za(e.appConfig);var r=n.authToken;return 0===r.requestStatus?Ka(e,t):r}(r,i),e;if(!navigator.onLine)throw pa.create("app-offline");n=(t=e,n={requestStatus:1,requestTime:Date.now()},Object.assign(Object.assign({},t),{authToken:n}));return s=async function(t,n){try{var e=await Ba(t,n),r=Object.assign(Object.assign({},n),{authToken:e});return await Ma(t.appConfig,r),e}catch(e){throw!ga(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(n=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),await Ma(t.appConfig,n)):await Fa(t.appConfig),e}}(r,n),n}return e});return s?await s:e.authToken}function za(e){return Ua(e,e=>{if(!Wa(e))throw pa.create("not-registered");var t=e.authToken;return 1===(t=t).requestStatus&&t.requestTime+la<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function Wa(e){return void 0!==e&&2===e.registrationStatus}async function $a(e,t=!1){return await async function(e){var{registrationPromise:e}=await ja(e);e&&await e}(e.appConfig),(await Ka(e,t)).token}function Ha(e){return pa.create("missing-app-config-values",{valueName:e})}const Ga="installations";Oo(new so(Ga,e=>{e=e.getProvider("app").getImmediate();return{app:e,appConfig:function(e){if(!e||!e.options)throw Ha("App Configuration");if(!e.name)throw Ha("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw Ha(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(e),platformLoggerProvider:xo(e,"platform-logger"),_delete:()=>Promise.resolve()}},"PUBLIC")),Oo(new so("installations-internal",e=>{const t=xo(e.getProvider("app").getImmediate(),Ga).getImmediate();return{getId:()=>async function(e){const{installationEntry:t,registrationPromise:n}=await ja(e.appConfig);return(n||Ka(e)).catch(console.error),t.fid}(t),getToken:e=>$a(t,e)}},"PRIVATE")),qo("@firebase/installations","0.5.0");const Qa="analytics",Ya="firebase_id",Ja="origin",Xa=6e4,Za="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",ec="https://www.googletagmanager.com/gtag/js",tc=new _o("@firebase/analytics");function nc(e){return Promise.all(e.map(e=>e.catch(e=>e)))}function rc(r,i,s,o){return async function(e,t,n){try{"event"===e?await async function(e,n,r,i,s){try{let t=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const c=await nc(r);for(const l of e){var o=c.find(e=>e.measurementId===l),a=o&&n[o.appId];if(!a){t=[];break}t.push(a)}}0===t.length&&(t=Object.values(n)),await Promise.all(t),e("event",i,s||{})}catch(e){tc.error(e)}}(r,i,s,t,n):"config"===e?await async function(e,t,n,r,i,s){r=r[i];try{if(r)await t[r];else{const a=await nc(n);var o=a.find(e=>e.measurementId===i);o&&await t[o.appId]}}catch(e){tc.error(e)}e("config",i,s)}(r,i,s,o,t,n):r("set",t)}catch(e){tc.error(e)}}}const ic=new Cs("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),sc=30;const oc=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function ac(e){var t,{appId:n,apiKey:e}=e,e={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":e})},n=Za.replace("{app-id}",n);const r=await fetch(n,e);if(200===r.status||304===r.status)return r.json();{let e="";try{var i=await r.json();null!==(t=i.error)&&void 0!==t&&t.message&&(e=i.error.message)}catch(e){}throw ic.create("config-fetch-failed",{httpStatus:r.status,responseMessage:e})}}async function cc(e,t=oc,n){var{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw ic.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw ic.create("no-api-key")}e=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()};const o=new hc;return setTimeout(async()=>{o.abort()},void 0!==n?n:Xa),async function t(n,{throttleEndTimeMillis:e,backoffCount:r},i,s=oc){const{appId:o,measurementId:a}=n;try{await lc(i,e)}catch(e){if(a)return tc.warn("Timed out fetching this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${a}`+` provided in the "measurementId" field in the local Firebase config. [${e.message}]`),{appId:o,measurementId:a};throw e}try{const c=await ac(n);return s.deleteThrottleMetadata(o),c}catch(e){if(!uc(e)){if(s.deleteThrottleMetadata(o),a)return tc.warn("Failed to fetch this Firebase app's measurement ID from the server."+` Falling back to the measurement ID ${a}`+` provided in the "measurementId" field in the local Firebase config. [${e.message}]`),{appId:o,measurementId:a};throw e}const l=503===Number(e.customData.httpStatus)?ro(r,s.intervalMillis,sc):ro(r,s.intervalMillis),u={throttleEndTimeMillis:Date.now()+l,backoffCount:r+1};return s.setThrottleMetadata(o,u),tc.debug(`Calling attemptFetch again in ${l} millis`),t(n,u,i,s)}}({appId:r,apiKey:i,measurementId:s},e,o,t)}function lc(i,s){return new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(ic.create("fetch-throttle",{throttleEndTimeMillis:s}))})})}function uc(e){if(e instanceof Ss&&e.customData){e=Number(e.customData.httpStatus);return 429===e||500===e||503===e||504===e}}class hc{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function dc(t,e,n,r,i,s,o){const a=cc(t);a.then(e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&tc.warn(`The measurement ID in the local Firebase config (${t.options.measurementId})`+` does not match the measurement ID fetched from the server (${e.measurementId}).`+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")}).catch(e=>tc.error(e)),e.push(a);var c=async function(){if(!ws())return tc.warn(ic.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await bs()}catch(e){return tc.warn(ic.create("indexeddb-unavailable",{errorInfo:e}).message),!1}return!0}().then(e=>{if(e)return r.getId()}),[e,c]=await Promise.all([a,c]);!function(){var e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(ec))return t}()&&function(e,t){const n=document.createElement("script");n.src=`${ec}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(s,e.measurementId),i("js",new Date);const l=null!==(o=null==o?void 0:o.config)&&void 0!==o?o:{};return l[Ja]="firebase",l.update=!0,null!=c&&(l[Ya]=c),i("config",e.measurementId,l),e.measurementId}class fc{constructor(e){this.app=e}_delete(){return delete pc[this.app.options.appId],Promise.resolve()}}let pc={},gc=[];const mc={};let yc="dataLayer",vc="gtag",_c,wc,bc=!1;function Ic(e){if(bc)throw ic.create("already-initialized");e.dataLayerName&&(yc=e.dataLayerName),e.gtagName&&(vc=e.gtagName)}function Tc(e,t,n){!function(){const e=[];var t;ms()&&e.push("This is a browser extension environment."),Is()||e.push("Cookies are not available."),0<e.length&&(t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=ic.create("invalid-analytics-context",{errorInfo:t}),tc.warn(t.message))}();var r,i,s=e.options.appId;if(!s)throw ic.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw ic.create("no-api-key");tc.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+` measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId}`+' provided in the "measurementId" field in the local Firebase config.')}if(null!=pc[s])throw ic.create("already-exists",{id:s});return bc||(function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t,t}(yc),{wrappedGtag:r,gtagCore:i}=function(e,t,n,r,i){let s=function(){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=rc(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(pc,gc,mc,yc,vc),wc=r,_c=i,bc=!0),pc[s]=dc(e,gc,mc,t,_c,yc,n),new fc(e)}async function Ec(){if(ms())return!1;if(!Is())return!1;if(!ws())return!1;try{return await bs()}catch(e){return!1}}function Sc(e,t,n){e=io(e),async function(e,t,n,r){if(r&&r.global)return e("set",{screen_name:n}),Promise.resolve();e("config",await t,{update:!0,screen_name:n})}(wc,pc[e.app.options.appId],t,n).catch(e=>tc.error(e))}function kc(e,t,n){e=io(e),async function(e,t,n,r){if(r&&r.global)return e("set",{user_id:n}),Promise.resolve();e("config",await t,{update:!0,user_id:n})}(wc,pc[e.app.options.appId],t,n).catch(e=>tc.error(e))}function Cc(e,t,n){e=io(e),async function(e,t,n,r){if(r&&r.global){const i={};for(const s of Object.keys(n))i[`user_properties.${s}`]=n[s];return e("set",i),Promise.resolve()}e("config",await t,{update:!0,user_properties:n})}(wc,pc[e.app.options.appId],t,n).catch(e=>tc.error(e))}function Ac(e,t){e=io(e),async function(e,t){e=await e,window[`ga-disable-${e}`]=!t}(pc[e.app.options.appId],t).catch(e=>tc.error(e))}function Nc(e,t,n,r){e=io(e),async function(e,t,n,r,i){i&&i.global?e("event",n,r):(t=await t,e("event",n,Object.assign(Object.assign({},r),{send_to:t})))}(wc,pc[e.app.options.appId],t,n,r).catch(e=>tc.error(e))}Oo(new so(Qa,(e,{options:t})=>{return Tc(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)},"PUBLIC")),Oo(new so("analytics-internal",function(e){try{const r=e.getProvider(Qa).getImmediate();return{logEvent:(e,t,n)=>Nc(r,e,t,n)}}catch(e){throw ic.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),qo("@firebase/analytics","0.7.0");var Rc,Pc;class Oc{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,n){Nc(this._delegate,e,t,n)}setCurrentScreen(e,t){Sc(this._delegate,e,t)}setUserId(e,t){kc(this._delegate,e,t)}setUserProperties(e,t){Cc(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){Ac(this._delegate,e)}}(o=Rc=Rc||{}).ADD_SHIPPING_INFO="add_shipping_info",o.ADD_PAYMENT_INFO="add_payment_info",o.ADD_TO_CART="add_to_cart",o.ADD_TO_WISHLIST="add_to_wishlist",o.BEGIN_CHECKOUT="begin_checkout",o.CHECKOUT_PROGRESS="checkout_progress",o.EXCEPTION="exception",o.GENERATE_LEAD="generate_lead",o.LOGIN="login",o.PAGE_VIEW="page_view",o.PURCHASE="purchase",o.REFUND="refund",o.REMOVE_FROM_CART="remove_from_cart",o.SCREEN_VIEW="screen_view",o.SEARCH="search",o.SELECT_CONTENT="select_content",o.SELECT_ITEM="select_item",o.SELECT_PROMOTION="select_promotion",o.SET_CHECKOUT_OPTION="set_checkout_option",o.SHARE="share",o.SIGN_UP="sign_up",o.TIMING_COMPLETE="timing_complete",o.VIEW_CART="view_cart",o.VIEW_ITEM="view_item",o.VIEW_ITEM_LIST="view_item_list",o.VIEW_PROMOTION="view_promotion",o.VIEW_SEARCH_RESULTS="view_search_results";const xc=e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("analytics").getImmediate();return new Oc(t,e)};Pc={Analytics:Oc,settings:Ic,isSupported:Ec,EventName:Rc},Go.INTERNAL.registerComponent(new so("analytics-compat",xc,"PUBLIC").setServiceProps(Pc).setMultipleInstances(!0)),Go.registerVersion("@firebase/analytics-compat","0.1.1");const Dc=new Map,Lc={activated:!1,tokenObservers:[]},Mc={enabled:!1};function Fc(e){return Dc.get(e)||Lc}function Uc(e,t){Dc.set(e,t)}const jc="https://content-firebaseappcheck.googleapis.com/v1beta",qc="exchangeDebugToken",Vc={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4};class Bc{constructor(e,t,n,r,i){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=i,this.pending=null,i<(this.nextErrorWaitInterval=r))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new us,t=this.getNextRun(e),await new Promise(e=>{setTimeout(e,t)}),this.pending.resolve(),await this.pending.promise,this.pending=new us,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}var t}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}const Kc=new Cs("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error."});function zc(){return self.grecaptcha}function Wc(e){if(!Fc(e).activated)throw Kc.create("use-before-activation",{appName:e.name})}async function $c({url:e,body:t},n){const r={"Content-Type":"application/json"},i=n.getImmediate({optional:!0});i&&(r["X-Firebase-Client"]=i.getPlatformInfoString());t={method:"POST",body:JSON.stringify(t),headers:r};let s;try{s=await fetch(e,t)}catch(e){throw Kc.create("fetch-network-error",{originalErrorMessage:e.message})}if(200!==s.status)throw Kc.create("fetch-status-error",{httpStatus:s.status});let o;try{o=await s.json()}catch(e){throw Kc.create("fetch-parse-error",{originalErrorMessage:e.message})}e=o.ttl.match(/^([\d.]+)(s)$/);if(!e||!e[2]||isNaN(Number(e[1])))throw Kc.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration "+`format: ${o.ttl}`});t=1e3*Number(e[1]),e=Date.now();return{token:o.attestationToken,expireTimeMillis:e+t,issuedAtTimeMillis:e}}const Hc="firebase-app-check-database",Gc=1,Qc="firebase-app-check-store",Yc="debug-token";let Jc=null;function Xc(){return Jc||(Jc=new Promise((t,n)=>{try{const e=indexedDB.open(Hc,Gc);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(Kc.create("storage-open",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(Qc,{keyPath:"compositeKey"})}}catch(e){n(Kc.create("storage-open",{originalErrorMessage:e.message}))}}),Jc)}async function Zc(e,t){const n=await Xc(),r=n.transaction(Qc,"readwrite"),i=r.objectStore(Qc),s=i.put({compositeKey:e,value:t});return new Promise((t,n)=>{s.onsuccess=e=>{t()},r.onerror=e=>{n(Kc.create("storage-set",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))}})}async function el(e){const t=await Xc(),r=t.transaction(Qc,"readonly"),n=r.objectStore(Qc),i=n.get(e);return new Promise((t,n)=>{i.onsuccess=e=>{e=e.target.result;t(e?e.value:void 0)},r.onerror=e=>{n(Kc.create("storage-get",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))}})}function tl(e){return`${e.options.appId}-${e.name}`}const nl=new _o("@firebase/app-check");async function rl(t){if(ws()){let e=void 0;try{e=await el(tl(t))}catch(e){nl.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return e}}function il(e,t){return ws()?Zc(tl(e),t).catch(e=>{nl.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}async function sl(){let e=void 0;try{e=await el(Yc)}catch(e){}if(e)return e;var t,n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)});return t=n,Zc(Yc,t).catch(e=>nl.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`)),console.log(`App Check debug token: ${n}. You will need to add it to your app's App Check settings in the Firebase console for it to work`),n}const ol={error:"UNKNOWN_ERROR"};async function al(e,t=!1){var n,r=e.app;Wc(r);const i=Fc(r);let s=i.token,o=void 0;if(s||(n=await i.cachedTokenPromise)&&hl(n)&&(s=n,Uc(r,Object.assign(Object.assign({},i),{token:s})),ul(r,{token:s.token})),!t&&s&&hl(s))return{token:s.token};if(Mc.enabled){var a=await $c(function(e,t){var{projectId:n,appId:r,apiKey:e}=e.options;return{url:`${jc}/projects/${n}/apps/${r}:${qc}?key=${e}`,body:{debug_token:t}}}(r,await async function(){var e=Mc;if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}()),e.platformLoggerProvider);return await il(r,a),Uc(r,Object.assign(Object.assign({},i),{token:a})),{token:a.token}}try{s=await i.provider.getToken()}catch(e){nl.error(e),o=e}let c;return s?(c={token:s.token},Uc(r,Object.assign(Object.assign({},i),{token:s})),await il(r,s)):c=(a=o,{token:function(e){return os.encodeString(JSON.stringify(e),!1)}(ol),error:a}),ul(r,c),c}function cl(e,t,n,r){var{app:i}=e;const s=Fc(i);t={next:n,error:r,type:t};const o=Object.assign(Object.assign({},s),{tokenObservers:[...s.tokenObservers,t]});if(o.tokenRefresher||(e=function(n){const{app:r}=n;return new Bc(async()=>{var e=Fc(r);let t;if(t=e.token?await al(n,!0):await al(n),t.error)throw t.error},()=>!0,()=>{var e=Fc(r);if(e.token){var t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5,e=e.token.expireTimeMillis-3e5,t=Math.min(t,e);return Math.max(0,t-Date.now())}return 0},Vc.RETRIAL_MIN_WAIT,Vc.RETRIAL_MAX_WAIT)}(e),o.tokenRefresher=e),!o.tokenRefresher.isRunning()&&s.isTokenAutoRefreshEnabled&&o.tokenRefresher.start(),s.token&&hl(s.token)){const a=s.token;Promise.resolve().then(()=>n({token:a.token})).catch(()=>{})}else null==s.token&&s.cachedTokenPromise.then(e=>{e&&hl(e)&&n({token:e.token})}).catch(()=>{});Uc(i,o)}function ll(e,t){const n=Fc(e);var r=n.tokenObservers.filter(e=>e.next!==t);0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),Uc(e,Object.assign(Object.assign({},n),{tokenObservers:r}))}function ul(e,t){for(const n of Fc(e).tokenObservers)try{"EXTERNAL"===n.type&&null!=t.error?n.error(t.error):n.next(t)}catch(e){}}function hl(e){return 0<e.expireTimeMillis-Date.now()}class dl{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){var{tokenObservers:e}=Fc(this.app);for(const t of e)ll(this.app,t.next);return Promise.resolve()}}const fl="https://www.google.com/recaptcha/api.js";function pl(t,n){var e=Fc(t);const r=new us;Uc(t,Object.assign(Object.assign({},e),{reCAPTCHAState:{initialized:r}}));const i=`fire_app_check_${t.name}`,s=document.createElement("div");s.id=i,s.style.display="none",document.body.appendChild(s);const o=zc();return o?o.ready(()=>{gl(t,n,o,i),r.resolve(o)}):function(e){const t=document.createElement("script");t.src=`${fl}`,t.onload=e,document.head.appendChild(t)}(()=>{const e=zc();if(!e)throw new Error("no recaptcha");e.ready(()=>{gl(t,n,e,i),r.resolve(e)})}),r.promise}function gl(e,t,n,r){r=n.render(r,{sitekey:t,size:"invisible"}),t=Fc(e);Uc(e,Object.assign(Object.assign({},t),{reCAPTCHAState:Object.assign(Object.assign({},t.reCAPTCHAState),{widgetId:r})}))}class ml{constructor(e){this._siteKey=e}async getToken(){if(!this._app||!this._platformLoggerProvider)throw Kc.create("use-before-activation",{appName:""});var e=await async function(r){Wc(r);const i=await Fc(r).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const n=Fc(r).reCAPTCHAState;i.ready(()=>{e(i.execute(n.widgetId,{action:"fire_app_check"}))})})}(this._app).catch(e=>{throw Kc.create("recaptcha-error")});return $c(function(e,t){var{projectId:n,appId:r,apiKey:e}=e.options;return{url:`${jc}/projects/${n}/apps/${r}:exchangeRecaptchaToken?key=${e}`,body:{recaptcha_token:t}}}(this._app,e),this._platformLoggerProvider)}initialize(e){this._app=e,this._platformLoggerProvider=xo(e,"platform-logger"),pl(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof ml&&this._siteKey===e._siteKey}}class yl{constructor(e){this._customProviderOptions=e}async getToken(){if(!this._app)throw Kc.create("use-before-activation",{appName:""});var e=await this._customProviderOptions.getToken(),t=function(e){e=Os(e).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null}(e.token),t=null!==t&&t<Date.now()&&0<t?1e3*t:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:t})}initialize(e){this._app=e}isEqual(e){return e instanceof yl&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function vl(e=Uo(),t){const n=xo(e=io(e),"app-check");if(n.isInitialized()){var r=n.getImmediate();const i=n.getOptions();if(i.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&i.provider.isEqual(t.provider))return r;throw Kc.create("already-initialized",{appName:e.name})}r=n.initialize({options:t});return function(t,e,n){const r=Fc(t),i=Object.assign(Object.assign({},r),{activated:!0});i.provider=e,i.cachedTokenPromise=rl(t).then(e=>(e&&hl(e)&&Uc(t,Object.assign(Object.assign({},Fc(t)),{token:e})),e)),i.isTokenAutoRefreshEnabled=void 0===n?t.automaticDataCollectionEnabled:n,Uc(t,i),i.provider.initialize(t)}(e,t.provider,t.isTokenAutoRefreshEnabled),r}const _l="app-check-internal";Oo(new so("app-check",e=>{var t=e.getProvider("app").getImmediate(),e=e.getProvider("platform-logger");return t=t,e=e,new dl(t,e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider(_l).initialize()})),Oo(new so(_l,e=>{var t,e=e.getProvider("app-check").getImmediate();return t=e,{getToken:e=>al(t,e),addTokenListener:e=>cl(t,"INTERNAL",e),removeTokenListener:e=>ll(t.app,e)}},"PUBLIC").setInstantiationMode("EXPLICIT")),qo("@firebase/app-check","0.4.0"),function(){var e=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}();if("string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){const t=Mc;t.enabled=!0;const n=new us;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(sl())}}();const wl=new Cs("appCheck","AppCheck",{"use-before-activation":"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."});class bl{constructor(e){this.app=e}activate(e,t){let n;n="string"==typeof e?new ml(e):new yl({getToken:e.getToken}),this._delegate=vl(this.app,{provider:n,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw wl.create("use-before-activation",{appName:this.app.name});!function(e,t){const n=Fc(e=e.app);n.tokenRefresher&&(!0===t?n.tokenRefresher.start():n.tokenRefresher.stop()),Uc(e,Object.assign(Object.assign({},n),{isTokenAutoRefreshEnabled:t}))}(this._delegate,e)}getToken(e){if(!this._delegate)throw wl.create("use-before-activation",{appName:this.app.name});return async function(e,t){if((t=await al(e,t)).error)throw t.error;return{token:t.token}}(this._delegate,e)}onTokenChanged(e,t,n){if(!this._delegate)throw wl.create("use-before-activation",{appName:this.app.name});return function(e,t,n){let r=()=>{},i=()=>{};return r=null!=t.next?t.next.bind(t):t,null!=t.error?i=t.error.bind(t):n&&(i=n),cl(e,"EXTERNAL",r,i),()=>ll(e.app,r)}(this._delegate,e,t)}}Go.INTERNAL.registerComponent(new so("appCheck-compat",e=>{e=e.getProvider("app-compat").getImmediate();return new bl(e)},"PUBLIC")),Go.registerVersion("@firebase/app-check-compat","0.1.1");const Il={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Tl={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function El(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Sl=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},kl=El,Cl=new Cs("auth","Firebase",El()),Al=new _o("@firebase/auth");function Nl(e,...t){Al.logLevel<=fo.ERROR&&Al.error(`Auth (${Mo}): ${e}`,...t)}function Rl(e,...t){throw Dl(e,...t)}function Pl(e,...t){return Dl(e,...t)}function Ol(e,t,n){n=Object.assign(Object.assign({},kl()),{[t]:n});const r=new Cs("auth","Firebase",n);return r.create(t,{appName:e.name})}function xl(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&Rl(e,"argument-error"),Ol(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.`+"Did you pass a reference from a different Auth SDK?")}function Dl(e,...t){if("string"==typeof e)return Cl.create(e,...t);{var n=t[0];const r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}}function Ll(e,t,...n){if(!e)throw Dl(t,...n)}function Ml(e){e="INTERNAL ASSERTION FAILED: "+e;throw Nl(e),new Error(e)}function Fl(e,t){e||Ml(t)}const Ul=new Map;function jl(e){Fl(e instanceof Function,"Expected a class definition");let t=Ul.get(e);return t?Fl(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,Ul.set(e,t)),t}function ql(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Vl(){return"http:"===Bl()||"https:"===Bl()}function Bl(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Kl{constructor(e,t){Fl((this.shortDelay=e)<(this.longDelay=t),"Short delay should be less than long delay!"),this.isMobile=ps()||ys()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Vl()||ms()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function zl(e,t){Fl(e.emulator,"Emulator should always be set here");var{url:e}=e.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}class Wl{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl||("undefined"!=typeof self&&"fetch"in self?self.fetch:void Ml("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static headers(){return this.headersImpl||("undefined"!=typeof self&&"Headers"in self?self.Headers:void Ml("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}static response(){return this.responseImpl||("undefined"!=typeof self&&"Response"in self?self.Response:void Ml("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill"))}}const $l={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Hl=new Kl(3e4,6e4);function Gl(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Ql(i,s,o,a,e={}){return Yl(i,e,()=>{let e={},t={};a&&("GET"===s?t=a:e={body:JSON.stringify(a)});var n=js(Object.assign({key:i.config.apiKey},t)).slice(1);const r=new(Wl.headers());return r.set("Content-Type","application/json"),r.set("X-Client-Version",i._getSdkClientVersion()),i.languageCode&&r.set("X-Firebase-Locale",i.languageCode),Wl.fetch()(Xl(i,i.config.apiHost,o,n),Object.assign({method:s,headers:r,referrerPolicy:"no-referrer"},e))})}async function Yl(t,e,n){t._canInitEmulator=!1;e=Object.assign(Object.assign({},$l),e);try{const s=new Zl(t),o=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();var r=await o.json();if("needConfirmation"in r)throw eu(t,"account-exists-with-different-credential",r);if(o.ok&&!("errorMessage"in r))return r;{const a=o.ok?r.errorMessage:r.error.message,[c,l]=a.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===c)throw eu(t,"credential-already-in-use",r);if("EMAIL_EXISTS"===c)throw eu(t,"email-already-in-use",r);var i=e[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw Ol(t,i,l);Rl(t,i)}}catch(e){if(e instanceof Ss)throw e;Rl(t,"network-request-failed")}}async function Jl(e,t,n,r,i={}){i=await Ql(e,t,n,r,i);return"mfaPendingCredential"in i&&Rl(e,"multi-factor-auth-required",{serverResponse:i}),i}function Xl(e,t,n,r){r=`${t}${n}?${r}`;return e.config.emulator?zl(e.config,r):`${e.config.apiScheme}://${r}`}class Zl{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Pl(this.auth,"timeout")),Hl.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function eu(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Pl(e,t,r);return i.customData._tokenResponse=n,i}function tu(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function nu(e){return 1e3*Number(e)}function ru(e){var[t,n,e]=e.split(".");if(void 0===t||void 0===n||void 0===e)return Nl("JWT malformed, contained fewer than 3 sections"),null;try{var r=cs(n);return r?JSON.parse(r):(Nl("Failed to decode base64 JWT payload"),null)}catch(e){return Nl("Caught error parsing JWT payload as JSON",e),null}}async function iu(t,n,e=!1){if(e)return n;try{return await n}catch(e){throw e instanceof Ss&&([{code:n}]=[e],"auth/user-disabled"===n||"auth/user-token-expired"===n)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class su{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(e){var t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}this.errorBackoff=3e4;t=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,t)}schedule(e=!1){this.isRunning&&(e=this.getInterval(e),this.timerId=setTimeout(async()=>{await this.iteration()},e))}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class ou{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=tu(this.lastLoginAt),this.creationTime=tu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function au(e){var t=e.auth,n=await e.getIdToken(),r=await iu(e,async function(e,t){return Ql(e,"POST","/v1/accounts:lookup",t)}(t,{idToken:n}));Ll(null==r?void 0:r.users.length,t,"internal-error");var i=r.users[0];e._notifyReloadListener(i);t=null!==(n=i.providerUserInfo)&&void 0!==n&&n.length?i.providerUserInfo.map(e=>{var{providerId:t}=e,e=Gi(e,["providerId"]);return{providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}}):[],r=function(e,n){e=e.filter(t=>!n.some(e=>e.providerId===t.providerId));return[...e,...n]}(e.providerData,t),n=e.isAnonymous,t=!(e.email&&i.passwordHash||null!=r&&r.length),t=!!n&&t,t={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new ou(i.createdAt,i.lastLoginAt),isAnonymous:t};Object.assign(e,t)}class cu{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ll(e.idToken,"internal-error"),Ll(void 0!==e.idToken,"internal-error"),Ll(void 0!==e.refreshToken,"internal-error");var t,t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):(Ll(t=ru(t=e.idToken),"internal-error"),Ll(void 0!==t.exp,"internal-error"),Ll(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat));this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Ll(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){var r,i,{accessToken:t,refreshToken:e,expiresIn:n}=(i=t,await{accessToken:(n=await Yl(r=e,{},()=>{var e=js({grant_type:"refresh_token",refresh_token:i}).slice(1),{tokenApiHost:t,apiKey:n}=r.config,n=Xl(r,t,"/v1/token",`key=${n}`);return Wl.fetch()(n,{method:"POST",headers:{"X-Client-Version":r._getSdkClientVersion(),"Content-Type":"application/x-www-form-urlencoded"},body:e})})).access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token});this.updateTokensAndExpiration(t,e,Number(n))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){var{refreshToken:n,accessToken:r,expirationTime:t}=t;const i=new cu;return n&&(Ll("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(Ll("string"==typeof r,"internal-error",{appName:e}),i.accessToken=r),t&&(Ll("number"==typeof t,"internal-error",{appName:e}),i.expirationTime=t),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new cu,this.toJSON())}_performRefresh(){return Ml("not implemented")}}function lu(e,t){Ll("string"==typeof e||void 0===e,"internal-error",{appName:t})}class uu{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,e=Gi(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new su(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=e.displayName||null,this.email=e.email||null,this.phoneNumber=e.phoneNumber||null,this.photoURL=e.photoURL||null,this.isAnonymous=e.isAnonymous||!1,this.metadata=new ou(e.createdAt||void 0,e.lastLoginAt||void 0)}async getIdToken(e){e=await iu(this,this.stsTokenManager.getToken(this.auth,e));return Ll(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(e){return async function(e,t=!1){const n=io(e);var r=await n.getIdToken(t),i=ru(r);return Ll(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error"),e="object"==typeof i.firebase?i.firebase:void 0,t=null==e?void 0:e.sign_in_provider,{claims:i,token:r,authTime:tu(nu(i.auth_time)),issuedAtTime:tu(nu(i.iat)),expirationTime:tu(nu(i.exp)),signInProvider:t||null,signInSecondFactor:(null==e?void 0:e.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=io(e);await au(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Ll(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new uu(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){Ll(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await au(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){var e=await this.getIdToken();return await iu(this,async function(e,t){return Ql(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n=null!==(l=t.displayName)&&void 0!==l?l:void 0,r=null!==(o=t.email)&&void 0!==o?o:void 0,i=null!==(c=t.phoneNumber)&&void 0!==c?c:void 0,s=null!==(a=t.photoURL)&&void 0!==a?a:void 0,o=null!==(l=t.tenantId)&&void 0!==l?l:void 0,a=null!==(c=t._redirectEventId)&&void 0!==c?c:void 0,c=null!==(l=t.createdAt)&&void 0!==l?l:void 0,l=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0;const{uid:u,emailVerified:h,isAnonymous:d,providerData:f,stsTokenManager:p}=t;Ll(u&&p,e,"internal-error");t=cu.fromJSON(this.name,p);Ll("string"==typeof u,e,"internal-error"),lu(n,e.name),lu(r,e.name),Ll("boolean"==typeof h,e,"internal-error"),Ll("boolean"==typeof d,e,"internal-error"),lu(i,e.name),lu(s,e.name),lu(o,e.name),lu(a,e.name),lu(c,e.name),lu(l,e.name);const g=new uu({uid:u,auth:e,email:r,emailVerified:h,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:o,stsTokenManager:t,createdAt:c,lastLoginAt:l});return f&&Array.isArray(f)&&(g.providerData=f.map(e=>Object.assign({},e))),a&&(g._redirectEventId=a),g}static async _fromIdTokenResponse(e,t,n=!1){const r=new cu;r.updateFromServerResponse(t);n=new uu({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await au(n),n}}class hu{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){e=this.storage[e];return void 0===e?null:e}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}hu.type="NONE";const du=hu;function fu(e,t,n){return`firebase:${e}:${t}:${n}`}class pu{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;var{config:e,name:n}=this.auth;this.fullUserKey=fu(this.userKey,e.apiKey,n),this.fullPersistenceKey=fu("persistence",e.apiKey,n),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){var e=await this.persistence._get(this.fullUserKey);return e?uu._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence!==e){var t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new pu(jl(du),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||jl(du);const s=fu(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{var a=await u._get(s);if(a){var c=uu._fromJSON(e,a);u!==i&&(o=c),i=u;break}}catch(e){}var l=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&l.length&&(i=l[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new pu(i,e,n)}}function gu(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(_u(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(mu(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(bu(t))return"Blackberry";if(Iu(t))return"Webos";if(yu(t))return"Safari";if((t.includes("chrome/")||vu(t))&&!t.includes("edge/"))return"Chrome";if(wu(t))return"Android";e=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);return 2===(null==e?void 0:e.length)?e[1]:"Other"}function mu(e=fs()){return/firefox\//i.test(e)}function yu(e=fs()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function vu(e=fs()){return/crios\//i.test(e)}function _u(e=fs()){return/iemobile/i.test(e)}function wu(e=fs()){return/android/i.test(e)}function bu(e=fs()){return/blackberry/i.test(e)}function Iu(e=fs()){return/webos/i.test(e)}function Tu(e=fs()){return/iphone|ipad|ipod/i.test(e)}function Eu(e=fs()){return Tu(e)||wu(e)||Iu(e)||bu(e)||/windows phone/i.test(e)||_u(e)}function Su(e,t=[]){let n;switch(e){case"Browser":n=gu(fs());break;case"Worker":n=`${gu(fs())}-${e}`;break;default:n=e}t=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Mo}/${t}`}class ku{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Au(this),this.idTokenSubscription=new Au(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Cl,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=jl(n)),this._initializationPromise=this.queue(async()=>{var e;this._deleted||(this.persistenceManager=await pu.create(this,t),this._deleted||(null!==(e=this._popupRedirectResolver)&&void 0!==e&&e._shouldInitProactively&&await this._popupRedirectResolver._initialize(this),await this.initializeCurrentUser(n),this._deleted||(this._isInitialized=!0)))}),this._initializationPromise}async _onStorageEvent(){if(!this._deleted){var e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e)return this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e)}}async initializeCurrentUser(e){var t,n;let r=await this.assertedPersistence.getCurrentUser();return e&&this.config.authDomain&&(await this.getOrInitRedirectPersistenceManager(),t=null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId,n=null===r||void 0===r?void 0:r._redirectEventId,e=await this.tryRedirectSignIn(e),t&&t!==n||null==e||!e.user||(r=e.user)),r?r._redirectEventId?(Ll(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)):this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await au(e)}catch(e){if("auth/network-request-failed"!==e.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;var e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?io(e):null;return t&&Ll(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&Ll(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(jl(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Cs("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){return this.redirectPersistenceManager||(Ll(e=e&&jl(e)||this._popupRedirectResolver,this,"argument-error"),this.redirectPersistenceManager=await pu.create(this,[jl(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()),this.redirectPersistenceManager}async _redirectUserForId(e){var t;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e;this._isInitialized&&(this.idTokenSubscription.next(this.currentUser),e=null!==(e=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==e?e:null,this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser)))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return Ll(s,this,"internal-error"),s.then(()=>i(this.currentUser)),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),(this.currentUser=e)?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ll(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Su(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getSdkClientVersion(){return this.clientVersion}}function Cu(e){return io(e)}class Au{constructor(e){this.auth=e,this.observer=null,this.addObserver=zs(e=>this.observer=e)}get next(){return Ll(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Nu(e,t,n){const r=Cu(e);Ll(r._canInitEmulator,r,"emulator-config-failed"),Ll(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");e=!(null==n||!n.disableWarnings);const i=Ru(t);var{host:n,port:t}=function(e){const t=Ru(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);{if(i){var s=i[1];return{host:s,port:Pu(r.substr(s.length+1))}}var[e,s]=r.split(":");return{host:e,port:Pu(s)}}}(t);r.config.emulator={url:`${i}//${n}${null===t?"":`:${t}`}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:n,port:t,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:e})}),function(e){function t(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"==typeof window||"undefined"==typeof document||e||("loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t())}(e)}function Ru(e){var t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Pu(e){if(!e)return null;e=Number(e);return isNaN(e)?null:e}class Ou{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ml("not implemented")}_getIdTokenResponse(e){return Ml("not implemented")}_linkToIdToken(e,t){return Ml("not implemented")}_getReauthenticationResolver(e){return Ml("not implemented")}}async function xu(e,t){return Ql(e,"POST","/v1/accounts:resetPassword",Gl(e,t))}async function Du(e,t){return Ql(e,"POST","/v1/accounts:update",t)}async function Lu(e,t){return Ql(e,"POST","/v1/accounts:sendOobCode",Gl(e,t))}class Mu extends Ou{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Mu(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Mu(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){e="string"==typeof e?JSON.parse(e):e;if(null!=e&&e.email&&null!=e&&e.password){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return Jl(e,"POST","/v1/accounts:signInWithPassword",Gl(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Jl(e,"POST","/v1/accounts:signInWithEmailLink",Gl(e,t))}(e,{email:this._email,oobCode:this._password});default:Rl(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Du(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Jl(e,"POST","/v1/accounts:signInWithEmailLink",Gl(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Rl(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Fu(e,t){return Jl(e,"POST","/v1/accounts:signInWithIdp",Gl(e,t))}class Uu extends Ou{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Uu(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Rl("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){var t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:e}=t,t=Gi(t,["providerId","signInMethod"]);if(!n||!e)return null;e=new Uu(n,e);return Object.assign(e,t),e}_getIdTokenResponse(e){return Fu(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Fu(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Fu(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=js(t)}return e}}const ju={USER_NOT_FOUND:"user-not-found"};class qu extends Ou{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new qu({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new qu({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Jl(e,"POST","/v1/accounts:signInWithPhoneNumber",Gl(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){if((t=await Jl(e,"POST","/v1/accounts:signInWithPhoneNumber",Gl(e,t))).temporaryProof)throw eu(e,"account-exists-with-different-credential",t);return t}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Jl(e,"POST","/v1/accounts:signInWithPhoneNumber",Gl(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),ju)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){var{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){var{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:e}=e="string"==typeof e?JSON.parse(e):e;return n||t||r||e?new qu({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:e}):null}}class Vu{constructor(e){var t=qs(Vs(e)),n=null!==(r=t.apiKey)&&void 0!==r?r:null,r=null!==(e=t.oobCode)&&void 0!==e?e:null,e=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(e=t.mode)&&void 0!==e?e:null);Ll(n&&r&&e,"argument-error"),this.apiKey=n,this.operation=e,this.code=r,this.continueUrl=null!==(r=t.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(r=t.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(t=t.tenantId)&&void 0!==t?t:null}static parseLink(e){var t,n,r,t=(n=qs(Vs(t=e)).link,r=n?qs(Vs(n)).deep_link_id:null,((e=qs(Vs(t)).deep_link_id)?qs(Vs(e)).link:null)||e||r||n||t);try{return new Vu(t)}catch(e){return null}}}class Bu{constructor(){this.providerId=Bu.PROVIDER_ID}static credential(e,t){return Mu._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){t=Vu.parseLink(t);return Ll(t,"argument-error"),Mu._fromEmailAndCode(e,t.code,t.tenantId)}}Bu.PROVIDER_ID="password",Bu.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Bu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ku{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class zu extends Ku{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Wu extends zu{static credentialFromJSON(e){e="string"==typeof e?JSON.parse(e):e;return Ll("providerId"in e&&"signInMethod"in e,"argument-error"),Uu._fromParams(e)}credential(e){return this._credential(e)}_credential(e){return Ll(e.idToken||e.accessToken,"argument-error"),Uu._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Wu.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Wu.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:e}=e;if(!(n||r||t||i))return null;if(!e)return null;try{return new Wu(e)._credential({idToken:t,accessToken:n,rawNonce:s,pendingToken:i})}catch(e){return null}}}class $u extends zu{constructor(){super("facebook.com")}static credential(e){return Uu._fromParams({providerId:$u.PROVIDER_ID,signInMethod:$u.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $u.credentialFromTaggedObject(e)}static credentialFromError(e){return $u.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return $u.credential(e.oauthAccessToken)}catch(e){return null}}}$u.FACEBOOK_SIGN_IN_METHOD="facebook.com",$u.PROVIDER_ID="facebook.com";class Hu extends zu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Uu._fromParams({providerId:Hu.PROVIDER_ID,signInMethod:Hu.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Hu.credentialFromTaggedObject(e)}static credentialFromError(e){return Hu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthIdToken:t,oauthAccessToken:e}=e;if(!t&&!e)return null;try{return Hu.credential(t,e)}catch(e){return null}}}Hu.GOOGLE_SIGN_IN_METHOD="google.com",Hu.PROVIDER_ID="google.com";class Gu extends zu{constructor(){super("github.com")}static credential(e){return Uu._fromParams({providerId:Gu.PROVIDER_ID,signInMethod:Gu.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Gu.credentialFromTaggedObject(e)}static credentialFromError(e){return Gu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!(e&&"oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Gu.credential(e.oauthAccessToken)}catch(e){return null}}}Gu.GITHUB_SIGN_IN_METHOD="github.com",Gu.PROVIDER_ID="github.com";class Qu extends Ou{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Fu(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Fu(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Fu(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){var{providerId:t,signInMethod:n,pendingToken:e}="string"==typeof e?JSON.parse(e):e;return t&&n&&e&&t===n?new Qu(t,e):null}static _create(e,t){return new Qu(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Yu extends zu{constructor(){super("twitter.com")}static credential(e,t){return Uu._fromParams({providerId:Yu.PROVIDER_ID,signInMethod:Yu.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Yu.credentialFromTaggedObject(e)}static credentialFromError(e){return Yu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{oauthAccessToken:t,oauthTokenSecret:e}=e;if(!t||!e)return null;try{return Yu.credential(t,e)}catch(e){return null}}}Yu.TWITTER_SIGN_IN_METHOD="twitter.com",Yu.PROVIDER_ID="twitter.com";async function Ju(e,t){return Jl(e,"POST","/v1/accounts:signUp",Gl(e,t))}class Xu{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){e=await uu._fromIdTokenResponse(e,n,r),r=Zu(n);return new Xu({user:e,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);var r=Zu(n);return new Xu({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Zu(e){return e.providerId||("phoneNumber"in e?"phone":null)}class eh extends Ss{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,this.name="FirebaseError",Object.setPrototypeOf(this,eh.prototype),this.appName=e.name,this.code=t.code,this.tenantId=null!==(e=e.tenantId)&&void 0!==e?e:void 0,this.serverResponse=t.customData.serverResponse}static _fromErrorAndOperation(e,t,n,r){return new eh(e,t,n,r)}}function th(t,n,e,r){const i="reauthenticate"===n?e._getReauthenticationResolver(t):e._getIdTokenResponse(t);return i.catch(e=>{if("auth/multi-factor-auth-required"===e.code)throw eh._fromErrorAndOperation(t,e,n,r);throw e})}function nh(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function rh(e,t){const n=io(e);await sh(!0,n,t);var{providerUserInfo:t}=(e=n.auth,t={idToken:await n.getIdToken(),deleteProvider:[t]},await Ql(e,"POST","/v1/accounts:update",t));const r=nh(t||[]);return n.providerData=n.providerData.filter(e=>r.has(e.providerId)),r.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function ih(e,t,n=!1){n=await iu(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Xu._forOperation(e,"link",n)}async function sh(e,t,n){await au(t);const r=nh(t.providerData);var i=!1===e?"provider-already-linked":"no-such-provider";Ll(r.has(n)===e,t.auth,i)}async function oh(e,t,n=!1){var{auth:r}=e,i="reauthenticate";try{var s=await iu(e,th(r,i,t,e),n);Ll(s.idToken,r,"internal-error");var o=ru(s.idToken);Ll(o,r,"internal-error");var{sub:a}=o;return Ll(e.uid===a,r,"user-mismatch"),Xu._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Rl(r,"user-mismatch"),e}}async function ah(e,t,n=!1){t=await th(e,"signIn",t),t=await Xu._fromIdTokenResponse(e,"signIn",t);return n||await e._updateCurrentUser(t.user),t}async function ch(e,t){return ah(Cu(e),t)}async function lh(e,t){e=io(e);return await sh(!1,e,t.providerId),ih(e,t)}async function uh(e,t){return oh(io(e),t)}async function hh(e,t){const n=Cu(e);t=await Jl(n,"POST","/v1/accounts:signInWithCustomToken",Gl(n,{token:t,returnSecureToken:!0})),t=await Xu._fromIdTokenResponse(n,"signIn",t);return await n._updateCurrentUser(t.user),t}class dh{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?fh._fromServerResponse(e,t):Rl(e,"internal-error")}}class fh extends dh{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new fh(t)}}function ph(e,t,n){var r;Ll(0<(null===(r=n.url)||void 0===r?void 0:r.length),e,"invalid-continue-uri"),Ll(void 0===n.dynamicLinkDomain||0<n.dynamicLinkDomain.length,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(Ll(0<n.iOS.bundleId.length,e,"missing-ios-bundle-id"),t.iosBundleId=n.iOS.bundleId),n.android&&(Ll(0<n.android.packageName.length,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function gh(e,t,n){e=io(e),t={requestType:"PASSWORD_RESET",email:t};n&&ph(e,t,n),await Lu(e,t)}async function mh(e,t){await Ql(e=io(e),"POST","/v1/accounts:update",Gl(e,{oobCode:t}))}async function yh(e,t){var n=io(e),r=await xu(n,{oobCode:t}),t=r.requestType;switch(Ll(t,n,"internal-error"),t){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Ll(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Ll(r.mfaInfo,n,"internal-error");default:Ll(r.email,n,"internal-error")}let i=null;return r.mfaInfo&&(i=dh._fromServerResponse(Cu(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:i},operation:t}}async function vh(e,t,n){e=io(e),t={requestType:"EMAIL_SIGNIN",email:t};Ll(n.handleCodeInApp,e,"argument-error"),n&&ph(e,t,n),await Lu(e,t)}async function _h(e,t){var n=Vl()?ql():"http://localhost",{signinMethods:n}=await Ql(e=io(e),"POST","/v1/accounts:createAuthUri",Gl(e,{identifier:t,continueUri:n}));return n||[]}async function wh(e,t){var n=io(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&ph(n.auth,r,t);var{email:r}=await Lu(n.auth,r);r!==e.email&&await e.reload()}async function bh(e,t,n){var r=io(e),t={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&ph(r.auth,t,n);var{email:t}=await Lu(r.auth,t);t!==e.email&&await e.reload()}async function Ih(e,{displayName:t,photoURL:n}){if(void 0!==t||void 0!==n){const r=io(e);e=await r.getIdToken(),n=await iu(r,async function(e,t){return Ql(e,"POST","/v1/accounts:update",t)}(r.auth,{idToken:e,displayName:t,photoUrl:n,returnSecureToken:!0}));r.displayName=n.displayName||null,r.photoURL=n.photoUrl||null;const i=r.providerData.find(({providerId:e})=>"password"===e);i&&(i.displayName=r.displayName,i.photoURL=r.photoURL),await r._updateTokensIfNecessary(n)}}async function Th(e,t,n){var{auth:r}=e;const i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);r=await iu(e,Du(r,i));await e._updateTokensIfNecessary(r,!0)}class Eh{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Sh extends Eh{constructor(e,t,n,r){super(e,t,n),this.username=r}}class kh extends Eh{constructor(e,t){super(e,"facebook.com",t)}}class Ch extends Sh{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Ah extends Eh{constructor(e,t){super(e,"google.com",t)}}class Nh extends Sh{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Rh(e){var{user:t,_tokenResponse:e}=e;return t.isAnonymous&&!e?{providerId:null,isNewUser:!1,profile:null}:function(e){if(!e)return null;var{providerId:t}=e,n=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},r=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!t&&null!=e&&e.idToken){var i=null===(i=null===(i=ru(e.idToken))||void 0===i?void 0:i.firebase)||void 0===i?void 0:i.sign_in_provider;if(i){i="anonymous"!==i&&"custom"!==i?i:null;return new Eh(r,i)}}if(!t)return null;switch(t){case"facebook.com":return new kh(r,n);case"github.com":return new Ch(r,n);case"google.com":return new Ah(r,n);case"twitter.com":return new Nh(r,n,e.screenName||null);case"custom":case"anonymous":return new Eh(r,null);default:return new Eh(r,t,n)}}(e)}class Ph{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new Ph("enroll",e)}static _fromMfaPendingCredential(e){return new Ph("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t;if(null!=e&&e.multiFactorSession){if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.pendingCredential)return Ph._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null!==(t=e.multiFactorSession)&&void 0!==t&&t.idToken)return Ph._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Oh{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,r){const i=Cu(e);e=(r.serverResponse.mfaInfo||[]).map(e=>dh._fromServerResponse(i,e));Ll(r.serverResponse.mfaPendingCredential,i,"internal-error");const s=Ph._fromMfaPendingCredential(r.serverResponse.mfaPendingCredential);return new Oh(s,e,async e=>{e=await e._process(i,s);delete r.serverResponse.mfaInfo,delete r.serverResponse.mfaPendingCredential;var t=Object.assign(Object.assign({},r.serverResponse),{idToken:e.idToken,refreshToken:e.refreshToken});switch(r.operationType){case"signIn":var n=await Xu._fromIdTokenResponse(i,r.operationType,t);return await i._updateCurrentUser(n.user),n;case"reauthenticate":return Ll(r.user,i,"internal-error"),Xu._forOperation(r.user,r.operationType,t);default:Rl(i,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}class xh{constructor(t){this.user=t,this.enrolledFactors=[],t._onReload(e=>{e.mfaInfo&&(this.enrolledFactors=e.mfaInfo.map(e=>dh._fromServerResponse(t.auth,e)))})}static _fromUser(e){return new xh(e)}async getSession(){return Ph._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e;e=await this.getSession(),t=await iu(this.user,n._process(this.user.auth,e,t));return await this.user._updateTokensIfNecessary(t),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid;var n=await this.user.getIdToken(),n=await iu(this.user,(e=this.user.auth,n={idToken:n,mfaEnrollmentId:t},Ql(e,"POST","/v2/accounts/mfaEnrollment:withdraw",Object.assign({tenantId:e.tenantId},n))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(n);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==e.code)throw e}}}const Dh=new WeakMap;const Lh="__sak";class Mh{constructor(e,t){this.storage=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Lh,"1"),this.storage.removeItem(Lh),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){e=this.storage.getItem(e);return Promise.resolve(e?JSON.parse(e):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}}class Fh extends Mh{constructor(){var e;super(window.localStorage,"LOCAL"),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=(yu(e=fs())||Tu(e))&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Eu(),this._shouldAllowMigration=!0,this.boundEventHandler=this.onStorageEvent.bind(this)}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){var t=this.storage.getItem(r),n=this.localCache[r];t!==n&&e(r,n,t)}}onStorageEvent(e,t=!1){if(e.key){const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(r);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}var n=()=>{var e=this.storage.getItem(r);!t&&this.localCache[r]===e||this.notifyListeners(r,e)};const i=this.storage.getItem(r);vs()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}else this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)})}notifyListeners(e,t){this.localCache[e]=t;e=this.listeners[e];if(e)for(const n of Array.from(e))n(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){var t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Fh.type="LOCAL";const Uh=Fh;class jh extends Mh{constructor(){super(window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}jh.type="SESSION";const qh=jh;class Vh{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){var e=this.receivers.find(e=>e.isListeningto(t));if(e)return e;e=new Vh(t);return this.receivers.push(e),e}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data;e=this.handlersMap[r];null!=e&&e.size&&(t.ports[0].postMessage({status:"ack",eventId:n,eventType:r}),e=Array.from(e).map(async e=>e(t.origin,i)),e=await Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})),t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:e}))}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Bh(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Vh.receivers=[];class Kh{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,o=50){const a="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let c,l;return new Promise((n,r)=>{const i=Bh("",20);a.port1.start();const s=setTimeout(()=>{r(new Error("unsupported_event"))},o);l={messageChannel:a,onMessage(e){var t=e;if(t.data.eventId===i)switch(t.data.status){case"ack":clearTimeout(s),c=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(c),n(t.data.response);break;default:clearTimeout(s),clearTimeout(c),r(new Error("invalid_response"))}}},this.handlers.add(l),a.port1.addEventListener("message",l.onMessage),this.target.postMessage({eventType:e,eventId:i,data:t},[a.port2])}).finally(()=>{l&&this.removeMessageHandler(l)})}}function zh(){return window}function Wh(){return void 0!==zh().WorkerGlobalScope&&"function"==typeof zh().importScripts}const $h="firebaseLocalStorageDb",Hh=1,Gh="firebaseLocalStorage",Qh="fbase_key";class Yh{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Jh(e,t){return e.transaction([Gh],t?"readwrite":"readonly").objectStore(Gh)}function Xh(){const r=indexedDB.open($h,Hh);return new Promise((n,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const e=r.result;try{e.createObjectStore(Gh,{keyPath:Qh})}catch(e){t(e)}}),r.addEventListener("success",async()=>{const e=r.result;var t;e.objectStoreNames.contains(Gh)?n(e):(e.close(),t=indexedDB.deleteDatabase($h),await new Yh(t).toPromise(),n(await Xh()))})})}async function Zh(e,t,n){n=Jh(e,!0).put({[Qh]:t,value:n});return new Yh(n).toPromise()}function ed(e,t){t=Jh(e,!0).delete(t);return new Yh(t).toPromise()}class td{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await Xh(),this.db)}async _withRetries(e){let t=0;for(;;)try{return await e(await this._openDb())}catch(e){if(3<t++)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Wh()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Vh._getInstance(Wh()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>{const n=await this._poll();return{keyProcessed:n.includes(t.key)}}),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t,n;this.activeServiceWorker=await async function(){if(null===navigator||void 0===navigator||!navigator.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),this.activeServiceWorker&&(this.sender=new Kh(this.activeServiceWorker),(n=await this.sender._send("ping",{},800))&&null!==(e=n[0])&&void 0!==e&&e.fulfilled&&null!==(t=n[0])&&void 0!==t&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0))}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;var e=await Xh();return await Zh(e,Lh,"1"),await ed(e,Lh),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(t,n){return this._withPendingWrite(async()=>(await this._withRetries(e=>Zh(e,t,n)),this.localCache[t]=n,this.notifyServiceWorker(t)))}async _get(t){var e=await this._withRetries(e=>async function(e,t){return t=Jh(e,!1).get(t),void 0===(t=await new Yh(t).toPromise())?null:t.value}(e,t));return this.localCache[t]=e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>ed(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){var e,t,n=await this._withRetries(e=>{e=Jh(e,!1).getAll();return new Yh(e).toPromise()});if(!n)return[];if(0!==this.pendingWrites)return[];const r=[],i=new Set;for({fbase_key:e,value:t}of n)i.add(e),JSON.stringify(this.localCache[e])!==JSON.stringify(t)&&(this.notifyListeners(e,t),r.push(e));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),r.push(s));return r}notifyListeners(e,t){this.localCache[e]=t;e=this.listeners[e];if(e)for(const n of Array.from(e))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}td.type="LOCAL";const nd=td;function rd(r){return new Promise((e,n)=>{const t=document.createElement("script");t.setAttribute("src",r),t.onload=e,t.onerror=e=>{const t=Pl("internal-error");t.customData=e,n(t)},t.type="text/javascript",t.charset="UTF-8",(null!==(e=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==e?e:document).appendChild(t)})}function id(e){return`__${e}${Math.floor(1e6*Math.random())}`}class sd{constructor(e){this.auth=e,this.counter=1e12,this._widgets=new Map}render(e,t){var n=this.counter;return this._widgets.set(n,new od(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t=e||1e12;null===(e=this._widgets.get(t))||void 0===e||e.delete(),this._widgets.delete(t)}getResponse(e){return(null===(e=this._widgets.get(e||1e12))||void 0===e?void 0:e.getResponse())||""}async execute(e){return null===(e=this._widgets.get(e||1e12))||void 0===e||e.execute(),""}}class od{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};e="string"==typeof e?document.getElementById(e):e;Ll(e,"argument-error",{appName:t}),this.container=e,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout(()=>{this.responseToken=function(t){const n=[],r="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<t;e++)n.push(r.charAt(Math.floor(Math.random()*r.length)));return n.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const ad=id("rcb"),cd=new Kl(3e4,6e4);class ld{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!zh().grecaptcha}load(s,o=""){var e;return Ll((e=o).length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e),s,"argument-error"),this.shouldResolveImmediately(o)?Promise.resolve(zh().grecaptcha):new Promise((t,r)=>{const i=zh().setTimeout(()=>{r(Pl(s,"network-request-failed"))},cd.get());zh()[ad]=()=>{zh().clearTimeout(i),delete zh()[ad];const e=zh().grecaptcha;if(e){const n=e.render;e.render=(e,t)=>{t=n(e,t);return this.counter++,t},this.hostLanguage=o,t(e)}else r(Pl(s,"internal-error"))},rd(`https://www.google.com/recaptcha/api.js??${js({onload:ad,render:"explicit",hl:o})}`).catch(()=>{clearTimeout(i),r(Pl(s,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!zh().grecaptcha&&(e===this.hostLanguage||0<this.counter||this.librarySeparatelyLoaded)}}class ud{async load(e){return new sd(e)}clearedOneInstance(){}}const hd="recaptcha",dd={theme:"light",type:"image"};class fd{constructor(e,t=Object.assign({},dd),n){this.parameters=t,this.type=hd,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Cu(n),this.isInvisible="invisible"===this.parameters.size,Ll("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");e="string"==typeof e?document.getElementById(e):e;Ll(e,this.auth,"argument-error"),this.container=e,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=new(this.auth.settings.appVerificationDisabledForTesting?ud:ld),this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),r=this.getAssertedRecaptcha();var t=r.getResponse(e);return t||new Promise(t=>{const n=e=>{e&&(this.tokenChangeListeners.delete(n),t(e))};this.tokenChangeListeners.add(n),this.isInvisible&&r.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Ll(!this.parameters.sitekey,this.auth,"argument-error"),Ll(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Ll("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(n){return t=>{if(this.tokenChangeListeners.forEach(e=>e(t)),"function"==typeof n)n(t);else if("string"==typeof n){const e=zh()[n];"function"==typeof e&&e(t)}}}assertNotDestroyed(){Ll(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;var t;this.isInvisible||(t=document.createElement("div"),e.appendChild(t),e=t),this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Ll(Vl()&&!Wh(),this.auth,"internal-error"),await function(){let t=null;return new Promise(e=>{"complete"!==document.readyState?(t=()=>e(),window.addEventListener("load",t)):e()}).catch(e=>{throw t&&window.removeEventListener("load",t),e})}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);var e=await((await Ql(this.auth,"GET","/v1/recaptchaParams")).recaptchaSiteKey||"");Ll(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Ll(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class pd{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){e=qu._fromVerification(this.verificationId,e);return this.onConfirmation(e)}}async function gd(t,n,r){var i,s,o,a,c,l,u=await r.verify();try{Ll("string"==typeof u,t,"argument-error"),Ll(r.type===hd,t,"argument-error");let e;if(e="string"==typeof n?{phoneNumber:n}:n,"session"in e){var h=e.session;if("phoneNumber"in e)return Ll("enroll"===h.type,t,"internal-error"),(c=t,l={idToken:h.credential,phoneEnrollmentInfo:{phoneNumber:e.phoneNumber,recaptchaToken:u}},await Ql(c,"POST","/v2/accounts/mfaEnrollment:start",Object.assign({tenantId:c.tenantId},l))).phoneSessionInfo.sessionInfo;Ll("signin"===h.type,t,"internal-error");var d=(null===(i=e.multiFactorHint)||void 0===i?void 0:i.uid)||e.multiFactorUid;return Ll(d,t,"missing-multi-factor-info"),(a={mfaPendingCredential:h.credential,mfaEnrollmentId:d,phoneSignInInfo:{recaptchaToken:u}},await Ql(t,"POST","/v2/accounts/mfaSignIn:start",Object.assign({tenantId:t.tenantId},a))).phoneResponseInfo.sessionInfo}var{sessionInfo:f}=(s=t,o={phoneNumber:e.phoneNumber,recaptchaToken:u},await Ql(s,"POST","/v1/accounts:sendVerificationCode",Gl(s,o)));return f}finally{r._reset()}}class md{constructor(e){this.providerId=md.PROVIDER_ID,this.auth=Cu(e)}verifyPhoneNumber(e,t){return gd(this.auth,e,io(t))}static credential(e,t){return qu._fromVerification(e,t)}static credentialFromResult(e){return md.credentialFromTaggedObject(e)}static credentialFromError(e){return md.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;var{phoneNumber:t,temporaryProof:e}=e;return t&&e?qu._fromTokenResponse(t,e):null}}function yd(e,t){return t?jl(t):(Ll(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}md.PROVIDER_ID="phone",md.PHONE_SIGN_IN_METHOD="phone";class vd extends Ou{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Fu(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Fu(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Fu(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function _d(e){return ah(e.auth,new vd(e),e.bypassAuthState)}function wd(e){var{auth:t,user:n}=e;return Ll(n,t,"internal-error"),oh(n,new vd(e),e.bypassAuthState)}async function bd(e){var{auth:t,user:n}=e;return Ll(n,t,"internal-error"),ih(n,new vd(e),e.bypassAuthState)}class Id{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){var{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:e}=e;if(s)this.reject(s);else{r={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(e)(r))}catch(e){this.reject(e)}}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return _d;case"linkViaPopup":case"linkViaRedirect":return bd;case"reauthViaPopup":case"reauthViaRedirect":return wd;default:Rl(this.auth,"internal-error")}}resolve(e){Fl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Fl(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Td=new Kl(2e3,1e4);class Ed extends Id{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Ed.currentPopupAction&&Ed.currentPopupAction.cancel(),Ed.currentPopupAction=this}async executeNotNull(){var e=await this.execute();return Ll(e,this.auth,"internal-error"),e}async onExecution(){Fl(1===this.filter.length,"Popup operations only handle one event");var e=Bh();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Pl(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Pl(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ed.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e;null!==(e=null===(e=this.authWindow)||void 0===e?void 0:e.window)&&void 0!==e&&e.closed?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Pl(this.auth,"popup-closed-by-user"))},2e3):this.pollId=window.setTimeout(t,Td.get())};t()}}Ed.currentPopupAction=null;const Sd="pendingRedirect",kd=new Map;class Cd extends Id{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let t=kd.get(this.auth._key());if(!t){try{const i=(e=this.resolver,n=this.auth,r=Rd(n),n="true"===await Nd(e)._get(r),await Nd(e)._remove(r),await n)?await super.execute():null;t=()=>Promise.resolve(i)}catch(e){t=()=>Promise.reject(e)}kd.set(this.auth._key(),t)}var e,n,r;return t()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){var t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Ad(e,t){return Nd(e)._set(Rd(t),"true")}function Nd(e){return jl(e._redirectPersistence)}function Rd(e){return fu(Sd,e.config.apiKey,e.name)}function Pd(e,t,n){return async function(e,t,n){var r=Cu(e);xl(e,t,Ku);const i=yd(r,n);return await Ad(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function Od(e,t,n){return async function(e,t,n){e=io(e);xl(e.auth,t,Ku);const r=yd(e.auth,n);await Ad(r,e.auth);n=await Ld(e);return r._openRedirect(e.auth,t,"reauthViaRedirect",n)}(e,t,n)}function xd(e,t,n){return async function(e,t,n){e=io(e);xl(e.auth,t,Ku);const r=yd(e.auth,n);await sh(!1,e,t.providerId),await Ad(r,e.auth);n=await Ld(e);return r._openRedirect(e.auth,t,"linkViaRedirect",n)}(e,t,n)}async function Dd(e,t,n=!1){const r=Cu(e);e=yd(r,t);const i=new Cd(r,e,n),s=await i.execute();return s&&!n&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,t)),s}async function Ld(e){var t=Bh(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Md{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let n=!1;return this.consumers.forEach(e=>{this.isEventForConsumer(t,e)&&(n=!0,this.sendToConsumer(t,e),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ud(e);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=t,n=!0)),n}sendToConsumer(e,t){var n;e.error&&!Ud(e)?(n=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error",t.onError(Pl(this.auth,n))):t.onAuthEvent(e)}isEventForConsumer(e,t){var n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return 6e5<=Date.now()-this.lastProcessedEventTime&&this.cachedEventUids.clear(),this.cachedEventUids.has(Fd(e))}saveEventToCache(e){this.cachedEventUids.add(Fd(e)),this.lastProcessedEventTime=Date.now()}}function Fd(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Ud({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function jd(e,t={}){return Ql(e,"GET","/v1/projects",t)}const qd=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Vd=/^https?/;async function Bd(e){if(!e.config.emulator){var{authorizedDomains:t}=await jd(e);for(const n of t)try{if(function(e){const t=ql(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){var i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Vd.test(n))return!1;if(qd.test(e))return r===e;const s=e.replace(/\./g,"\\."),o=new RegExp("^(.+\\."+s+"|"+s+")$","i");return o.test(r)}(n))return}catch(e){}Rl(e,"unauthorized-domain")}}const Kd=new Kl(3e4,6e4);function zd(){const t=zh().___jsl;if(null!==t&&void 0!==t&&t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let Wd=null;function $d(e){var i;return Wd=Wd||(i=e,new Promise((e,t)=>{function n(){zd(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{zd(),t(Pl(i,"network-request-failed"))},timeout:Kd.get()})}if(null!==(r=null===(r=zh().gapi)||void 0===r?void 0:r.iframes)&&void 0!==r&&r.Iframe)e(gapi.iframes.getContext());else{if(null===(r=zh().gapi)||void 0===r||!r.load){var r=id("iframefcb");return zh()[r]=()=>{gapi.load?n():t(Pl(i,"network-request-failed"))},rd(`https://apis.google.com/js/api.js?onload=${r}`)}n()}}).catch(e=>{throw Wd=null,e})),Wd}const Hd=new Kl(5e3,15e3),Gd="__/auth/iframe",Qd="emulator/auth/iframe",Yd={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},Jd=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function Xd(o){const e=await $d(o);var t=zh().gapi;return Ll(t,o,"internal-error"),e.open({where:document.body,url:function(e){var t=e.config;Ll(t.authDomain,e,"auth-domain-config-required");var n=t.emulator?zl(t,Qd):`https://${e.config.authDomain}/${Gd}`;const r={apiKey:t.apiKey,appName:e.name,v:Mo};(t=Jd.get(e.config.apiHost))&&(r.eid=t);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${js(r).slice(1)}`}(o),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Yd,dontclear:!0},s=>new Promise(async(e,t)=>{await s.restyle({setHideOnLeave:!1});const n=Pl(o,"network-request-failed"),r=zh().setTimeout(()=>{t(n)},Hd.get());function i(){zh().clearTimeout(r),e(s)}s.ping(i).then(i,()=>{t(n)})}))}const Zd={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ef{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function tf(e,t,n,r=500,i=600){var s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Zd),{width:r.toString(),height:i.toString(),top:s,left:o});o=fs().toLowerCase();n&&(a=vu(o)?"_blank":n),mu(o)&&(t=t||"http://localhost",c.scrollbars="yes");var l,n=Object.entries(c).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if([o=fs()]=[o],Tu(o)&&null!==(l=window.navigator)&&void 0!==l&&l.standalone&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new ef(null);const u=window.open(t||"",a,n);Ll(u,e,"popup-blocked");try{u.focus()}catch(e){}return new ef(u)}const nf="__/auth/handler",rf="emulator/auth/handler";function sf(e,t,n,r,i,s){Ll(e.config.authDomain,e,"auth-domain-config-required"),Ll(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Mo,eventId:i};if(t instanceof Ku){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",Ls(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(var[a,c]of Object.entries(s||{}))o[a]=c}if(t instanceof zu){const u=t.getScopes().filter(e=>""!==e);0<u.length&&(o.scopes=u.join(","))}e.tenantId&&(o.tid=e.tenantId);const l=o;for(const h of Object.keys(l))void 0===l[h]&&delete l[h];return`${[{config:e}]=[e],e.emulator?zl(e,rf):`https://${e.authDomain}/${nf}`}?${js(l).slice(1)}`}const of="webStorageSupport";const af=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=qh,this._completeRedirectFn=Dd}async _openPopup(e,t,n,r){var i;return Fl(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),tf(e,sf(e,t,n,ql(),r),Bh())}async _openRedirect(e,t,n,r){return await this._originValidation(e),r=sf(e,t,n,ql(),r),zh().location.href=r,new Promise(()=>{})}_initialize(e){var t=e._key();if(this.eventManagers[t]){const{manager:r,promise:n}=this.eventManagers[t];return r?Promise.resolve(r):(Fl(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n}async initAndGetManager(t){const e=await Xd(t),n=new Md(t);return e.register("authEvent",e=>{return Ll(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,n){const e=this.iframes[t._key()];e.send(of,{type:of},e=>{e=null===(e=null==e?void 0:e[0])||void 0===e?void 0:e[of];void 0!==e&&n(!!e),Rl(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Bd(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Eu()||yu()||Tu()}};class cf extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return Ml("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new cf(e)}_finalizeEnroll(e,t,n){return e=e,n={idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()},Ql(e,"POST","/v2/accounts/mfaEnrollment:finalize",Object.assign({tenantId:e.tenantId},n))}_finalizeSignIn(e,t){return e=e,t={mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()},Ql(e,"POST","/v2/accounts/mfaSignIn:finalize",Object.assign({tenantId:e.tenantId},t))}}class lf{constructor(){}static assertion(e){return cf._fromCredential(e)}}var uf;class hf{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(t){var e;this.assertAuthConfigured(),this.internalListeners.has(t)||(e=this.auth.onIdTokenChanged(e=>{t((null===e||void 0===e?void 0:e.stsTokenManager.accessToken)||null)}),this.internalListeners.set(t,e),this.updateProactiveRefresh())}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ll(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){0<this.internalListeners.size?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function df(){return window}uf="Browser",Oo(new so("auth",(e,{options:n})=>{e=e.getProvider("app").getImmediate();const{apiKey:r,authDomain:i}=e.options;return(e=>{Ll(r&&!r.includes(":"),"invalid-api-key",{appName:e.name}),Ll(!(null!==i&&void 0!==i&&i.includes(":")),"argument-error",{appName:e.name});var t={apiKey:r,authDomain:i,clientPlatform:uf,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Su(uf)},t=new ku(e,t);return function(e,t){const n=(null==t?void 0:t.persistence)||[];var r=(Array.isArray(n)?n:[n]).map(jl);null!=t&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(t,n),t})(e)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{const r=e.getProvider("auth-internal");r.initialize()})),Oo(new so("auth-internal",e=>{e=Cu(e.getProvider("auth").getImmediate());return e=e,new hf(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),qo("@firebase/auth","0.17.2",function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(uf));async function ff(e,t,n){var{BuildInfo:r}=df();Fl(t.sessionId,"AuthEvent did not contain a session ID");var i=await async function(e){const t=function(t){if(Fl(/[0-9a-zA-Z]+/.test(t),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(t);const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(e),n=await crypto.subtle.digest("SHA-256",t),r=Array.from(new Uint8Array(n));return r.map(e=>e.toString(16).padStart(2,"0")).join("")}(t.sessionId);const s={};return Tu()?s.ibi=r.packageName:wu()?s.apn=r.packageName:Rl(e,"operation-not-supported-in-this-environment"),r.displayName&&(s.appDisplayName=r.displayName),s.sessionId=i,sf(e,n,t.type,void 0,null!==(t=t.eventId)&&void 0!==t?t:void 0,s)}function pf(r){const{cordova:i}=df();return new Promise(n=>{i.plugins.browsertab.isAvailable(e=>{let t=null;e?i.plugins.browsertab.openUrl(r):t=i.InAppBrowser.open(r,(e=fs(),/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)?"_blank":"_system"),"location=yes"),n(t)})})}const gf=20;class mf extends Md{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(t){return this.resolveInialized(),this.passiveListeners.forEach(e=>e(t)),super.onEvent(t)}async initialized(){await this.initPromise}}function yf(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:function(){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<gf;e++){var r=Math.floor(Math.random()*n.length);t.push(n.charAt(r))}return t.join("")}(),postBody:null,tenantId:e.tenantId,error:Pl(e,"no-auth-event")}}async function vf(e){var t=await wf()._get(bf(e));return t&&await wf()._remove(bf(e)),t}function _f(e,t){var n,r,i;const s=(n=If(o=t),r=n.link?decodeURIComponent(n.link):void 0,i=If(r).link,t=n.deep_link_id?decodeURIComponent(n.deep_link_id):void 0,(n=If(t).link)||t||i||r||o);if(s.includes("/__/auth/callback")){var o=If(s),o=o.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(o.firebaseError)):null,o=null===(o=null===(o=null==o?void 0:o.code)||void 0===o?void 0:o.split("auth/"))||void 0===o?void 0:o[1],o=o?Pl(o):null;return o?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:o,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:s,postBody:null}}return null}function wf(){return jl(Uh)}function bf(e){return fu("authEvent",e.config.apiKey,e.name)}function If(e){if(null==e||!e.includes("?"))return{};const[,...t]=e.split("?");return qs(t.join("?"))}const Tf=class{constructor(){this._redirectPersistence=qh,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Dd}async _initialize(e){var t=e._key();let n=this.eventManagers.get(t);return n||(n=new mf(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){Rl(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){var i,s;a=e,s=df(),Ll("function"==typeof(null===(i=null==s?void 0:s.universalLinks)||void 0===i?void 0:i.subscribe),a,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),Ll(void 0!==(null===(i=null==s?void 0:s.BuildInfo)||void 0===i?void 0:i.packageName),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),Ll("function"==typeof(null===(i=null===(i=null===(i=null==s?void 0:s.cordova)||void 0===i?void 0:i.plugins)||void 0===i?void 0:i.browsertab)||void 0===i?void 0:i.openUrl),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Ll("function"==typeof(null===(i=null===(i=null===(i=null==s?void 0:s.cordova)||void 0===i?void 0:i.plugins)||void 0===i?void 0:i.browsertab)||void 0===i?void 0:i.isAvailable),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Ll("function"==typeof(null===(s=null===(s=null==s?void 0:s.cordova)||void 0===s?void 0:s.InAppBrowser)||void 0===s?void 0:s.open),a,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"});const o=await this._initialize(e);await o.initialized(),o.resetRedirect(),kd.clear(),await this._originValidation(e);var a=yf(e,n,r);n=e,r=a,await wf()._set(bf(n),r);t=await pf(await ff(e,a,t));return async function(o,a,c){const{cordova:l}=df();let u=()=>{};try{await new Promise((n,e)=>{let t=null;function r(){var e;n();const t=null===(e=l.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==c?void 0:c.close)&&c.close()}function i(){t=t||window.setTimeout(()=>{e(Pl(o,"redirect-cancelled-by-user"))},2e3)}function s(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&i()}a.addPassiveListener(r),document.addEventListener("resume",i,!1),wu()&&document.addEventListener("visibilitychange",s,!1),u=()=>{a.removePassiveListener(r),document.removeEventListener("resume",i,!1),document.removeEventListener("visibilitychange",s,!1),t&&window.clearTimeout(t)}})}finally{u()}}(e,o,t)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){var t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){var{BuildInfo:t}=df();const n={};Tu()?n.iosBundleId=t.packageName:wu()?n.androidPackageName=t.packageName:Rl(e,"operation-not-supported-in-this-environment"),await jd(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(r,i){const{universalLinks:e,handleOpenURL:t,BuildInfo:n}=df(),s=setTimeout(async()=>{await vf(r),i.onEvent(Ef())},500),o=async e=>{clearTimeout(s);var t=await vf(r);let n=null;t&&null!=e&&e.url&&(n=_f(t,e.url)),i.onEvent(n||Ef())};void 0!==e&&"function"==typeof e.subscribe&&e.subscribe(null,o);const a=t,c=`${n.packageName.toLowerCase()}://`;df().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}};function Ef(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Pl("no-auth-event")}}var Sf;function kf(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Cf(e=fs()){return!("file:"!==kf()&&"ionic:"!==kf()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Af(e=fs()){return vs()&&11===(null===document||void 0===document?void 0:document.documentMode)||([e=fs()]=[e],/Edge\/\d+/.test(e))}function Nf(){try{const t=self.localStorage;var e=Bh();if(t)return t.setItem(e,"1"),t.removeItem(e),!Af()||ws()}catch(e){return Rf()&&ws()}return!1}function Rf(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function Pf(){return("http:"===kf()||"https:"===kf()||ms()||Cf())&&!(ys()||gs())&&Nf()&&!Rf()}function Of(){return Cf()&&"undefined"!=typeof document}const xf={LOCAL:"local",NONE:"none",SESSION:"session"},Df=Ll,Lf="persistence";async function Mf(e){await e._initializationPromise;const t=Ff();var n=fu(Lf,e.config.apiKey,e.name);null!==t&&void 0!==t&&t.sessionStorage&&t.sessionStorage.setItem(n,e._getPersistence())}function Ff(){return"undefined"!=typeof window?window:null}const Uf=Ll;class jf{constructor(){this.browserResolver=jl(af),this.cordovaResolver=jl(Tf),this.underlyingResolver=null,this._redirectPersistence=qh,this._completeRedirectFn=Dd}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Of()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Uf(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){var e;this.underlyingResolver||(e=await(!!Of()&&new Promise(e=>{const t=setTimeout(()=>{e(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(t),e(!0)})})),this.underlyingResolver=e?this.cordovaResolver:this.browserResolver)}}function qf(e){return e.unwrap()}function Vf(e,t){var n,r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===t.code){const s=t;s.resolver=new Wf(e,(n=t,e=io(i=e),Ll((i=n).operationType,e,"argument-error"),Ll(null===(n=i.serverResponse)||void 0===n?void 0:n.mfaPendingCredential,e,"argument-error"),Oh._fromError(e,i)))}else if(r){var i=Bf(t);const o=t;i&&(o.credential=i,o.tenantId=r.tenantId||void 0,o.email=r.email||void 0,o.phoneNumber=r.phoneNumber||void 0)}}function Bf(e){var{_tokenResponse:t}=e instanceof Ss?e.customData:e;if(!t)return null;if(!(e instanceof Ss)&&"temporaryProof"in t&&"phoneNumber"in t)return md.credentialFromResult(e);const n=t.providerId;if(!n||n===Il.PASSWORD)return null;let r;switch(n){case Il.GOOGLE:r=Hu;break;case Il.FACEBOOK:r=$u;break;case Il.GITHUB:r=Gu;break;case Il.TWITTER:r=Yu;break;default:var{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:a,nonce:c}=t;return s||o||i||a?a?n.startsWith("saml.")?Qu._create(n,a):Uu._fromParams({providerId:n,signInMethod:n,pendingToken:a,idToken:i,accessToken:s}):new Wu(n).credential({idToken:i,accessToken:s,rawNonce:c}):null}return e instanceof Ss?r.credentialFromError(e):r.credentialFromResult(e)}async function Kf(t,e){let n;try{n=await e}catch(e){throw e instanceof Ss&&Vf(t,e),e}var{operationType:e,user:t}=n;return{operationType:e,credential:Bf(n),additionalUserInfo:Rh(n),user:$f.getOrCreate(t)}}async function zf(t,e){const n=await e;return{verificationId:n.verificationId,confirm:e=>Kf(t,n.confirm(e))}}class Wf{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Kf(qf(this.auth),this.resolver.resolveSignIn(e))}}class $f{constructor(e){this._delegate=e,this.multiFactor=(e=io(e=e),Dh.has(e)||Dh.set(e,xh._fromUser(e)),Dh.get(e))}static getOrCreate(e){return $f.USER_MAP.has(e)||$f.USER_MAP.set(e,new $f(e)),$f.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Kf(this.auth,lh(this._delegate,e))}async linkWithPhoneNumber(e,t){return zf(this.auth,async function(e,t,n){const r=io(e);return await sh(!1,r,"phone"),n=await gd(r.auth,t,io(n)),new pd(n,e=>lh(r,e))}(this._delegate,e,t))}async linkWithPopup(e){return Kf(this.auth,async function(e,t,n){xl((e=io(e)).auth,t,Ku),n=yd(e.auth,n);const r=new Ed(e.auth,"linkViaPopup",t,n,e);return r.executeNotNull()}(this._delegate,e,jf))}async linkWithRedirect(e){return await Mf(Cu(this.auth)),xd(this._delegate,e,jf)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Kf(this.auth,uh(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return zf(this.auth,async function(e,t,n){const r=io(e);return n=await gd(r.auth,t,io(n)),new pd(n,e=>uh(r,e))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Kf(this.auth,async function(e,t,n){xl((e=io(e)).auth,t,Ku),n=yd(e.auth,n);const r=new Ed(e.auth,"reauthViaPopup",t,n,e);return r.executeNotNull()}(this._delegate,e,jf))}async reauthenticateWithRedirect(e){return await Mf(Cu(this.auth)),Od(this._delegate,e,jf)}sendEmailVerification(e){return wh(this._delegate,e)}async unlink(e){return await rh(this._delegate,e),this}updateEmail(e){return Th(io(this._delegate),e,null)}updatePassword(e){return Th(io(this._delegate),null,e)}updatePhoneNumber(e){return async function(e,t){await ih(io(e),t)}(this._delegate,e)}updateProfile(e){return Ih(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return bh(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}$f.USER_MAP=new WeakMap;const Hf=Ll;class Gf{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();var{apiKey:n}=e.options;Hf(n,"invalid-api-key",{appName:e.name});let r=[du];if("undefined"!=typeof window){r=function(e,t){const n=Ff();if(null===n||void 0===n||!n.sessionStorage)return[];switch(t=fu(Lf,e,t),n.sessionStorage.getItem(t)){case xf.NONE:return[du];case xf.LOCAL:return[nd,qh];case xf.SESSION:return[qh];default:return[]}}(n,e.name);for(const i of[nd,Uh,qh])r.includes(i)||r.push(i)}Hf(n,"invalid-api-key",{appName:e.name});e="undefined"!=typeof window?jf:void 0;this._delegate=t.initialize({options:{persistence:r,popupRedirectResolver:e}}),this._delegate._updateErrorMap(Sl),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?$f.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){Nu(this._delegate,e,t)}applyActionCode(e){return mh(this._delegate,e)}checkActionCode(e){return yh(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await xu(io(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Kf(this._delegate,async function(e,t,n){const r=Cu(e);return n=await Ju(r,{returnSecureToken:!0,email:t,password:n}),n=await Xu._fromIdTokenResponse(r,"signIn",n),await r._updateCurrentUser(n.user),n}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return _h(this._delegate,e)}isSignInWithEmailLink(e){return this._delegate,e=e,"EMAIL_SIGNIN"===(null==(e=Vu.parseLink(e))?void 0:e.operation)}async getRedirectResult(){Hf(Pf(),this._delegate,"operation-not-supported-in-this-environment");var e,t,t=(e=this._delegate,t=jf,await Cu(e)._initializationPromise,await Dd(e,t,!1));return t?Kf(this._delegate,Promise.resolve(t)):{credential:null,user:null}}addFrameworkForLogging(e){Cu(this._delegate)._logFramework(e)}onAuthStateChanged(e,t,n){var{next:e,error:t,complete:n}=Qf(e,t,n);return this._delegate.onAuthStateChanged(e,t,n)}onIdTokenChanged(e,t,n){var{next:e,error:t,complete:n}=Qf(e,t,n);return this._delegate.onIdTokenChanged(e,t,n)}sendSignInLinkToEmail(e,t){return vh(this._delegate,e,t)}sendPasswordResetEmail(e,t){return gh(this._delegate,e,t||void 0)}async setPersistence(e){var t,n;t=this._delegate,n=e,Df(Object.values(xf).includes(n),t,"invalid-persistence-type"),ys()?Df(n!==xf.SESSION,t,"unsupported-persistence-type"):gs()?Df(n===xf.NONE,t,"unsupported-persistence-type"):Rf()?Df(n===xf.NONE||n===xf.LOCAL&&ws(),t,"unsupported-persistence-type"):Df(n===xf.NONE||Nf(),t,"unsupported-persistence-type");let r;switch(e){case xf.SESSION:r=qh;break;case xf.LOCAL:var i=await jl(nd)._isAvailable();r=i?nd:Uh;break;case xf.NONE:r=du;break;default:return Rl("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(r)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Kf(this._delegate,async function(e){const t=Cu(e);return await t._initializationPromise,null!==(e=t.currentUser)&&void 0!==e&&e.isAnonymous?new Xu({user:t.currentUser,providerId:null,operationType:"signIn"}):(e=await Ju(t,{returnSecureToken:!0}),e=await Xu._fromIdTokenResponse(t,"signIn",e,!0),await t._updateCurrentUser(e.user),e)}(this._delegate))}signInWithCredential(e){return Kf(this._delegate,ch(this._delegate,e))}signInWithCustomToken(e){return Kf(this._delegate,hh(this._delegate,e))}signInWithEmailAndPassword(e,t){return Kf(this._delegate,(n=this._delegate,e=e,t=t,ch(io(n),Bu.credential(e,t))));var n}signInWithEmailLink(e,t){return Kf(this._delegate,async function(e,t,n){return e=io(e),Ll((n=Bu.credentialWithLink(t,n||ql()))._tenantId===(e.tenantId||null),e,"tenant-id-mismatch"),ch(e,n)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return zf(this._delegate,async function(e,t,n){const r=Cu(e);return n=await gd(r,t,io(n)),new pd(n,e=>ch(r,e))}(this._delegate,e,t))}async signInWithPopup(e){return Hf(Pf(),this._delegate,"operation-not-supported-in-this-environment"),Kf(this._delegate,async function(e,t,n){var r=Cu(e);xl(e,t,Ku),n=yd(r,n);const i=new Ed(r,"signInViaPopup",t,n);return i.executeNotNull()}(this._delegate,e,jf))}async signInWithRedirect(e){return Hf(Pf(),this._delegate,"operation-not-supported-in-this-environment"),await Mf(this._delegate),Pd(this._delegate,e,jf)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){var{data:t}=await yh(io(e),t);return t.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Qf(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&$f.getOrCreate(e)),error:t,complete:n}}Gf.Persistence=xf;class Yf{constructor(){this.providerId="phone",this._delegate=new md(qf(Go.auth()))}static credential(e,t){return md.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Yf.PHONE_SIGN_IN_METHOD=md.PHONE_SIGN_IN_METHOD,Yf.PROVIDER_ID=md.PROVIDER_ID;const Jf=Ll;class Xf{constructor(e,t,n=Go.app()){var r;Jf(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new fd(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}(Sf=Go).INTERNAL.registerComponent(new so("auth-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("auth");return new Gf(t,e)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Tl.EMAIL_SIGNIN,PASSWORD_RESET:Tl.PASSWORD_RESET,RECOVER_EMAIL:Tl.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Tl.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Tl.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Tl.VERIFY_EMAIL}},EmailAuthProvider:Bu,FacebookAuthProvider:$u,GithubAuthProvider:Gu,GoogleAuthProvider:Hu,OAuthProvider:Wu,PhoneAuthProvider:Yf,PhoneMultiFactorGenerator:lf,RecaptchaVerifier:Xf,TwitterAuthProvider:Yu,Auth:Gf,AuthCredential:Ou,Error:Ss}).setInstantiationMode("LAZY").setMultipleInstances(!1)),Sf.registerVersion("@firebase/auth-compat","0.1.2");let Zf="";function ep(e){Zf=e}class tp{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ps(t))}get(e){e=this.domStorage_.getItem(this.prefixedName_(e));return null==e?null:Rs(e)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class np{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return xs(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}var rp,ip,sp,op,ap,cp,qi=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new tp(t)}}catch(e){}return new np};const lp=qi("localStorage"),up=qi("sessionStorage"),hp=new _o("@firebase/database"),dp=function(){let e=1;return function(){return e++}}(),fp=function(e){e=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i,s=e.charCodeAt(r);55296<=s&&s<=56319&&(i=s-55296,is(++r<e.length,"Surrogate pair missing trail surrogate."),s=65536+(i<<10)+(e.charCodeAt(r)-56320)),s<128?t[n++]=s:(s<2048?t[n++]=s>>6|192:(s<65536?t[n++]=s>>12|224:(t[n++]=s>>18|240,t[n++]=s>>12&63|128),t[n++]=s>>6&63|128),t[n++]=63&s|128)}return t}(e);const t=new Bs;t.update(e);e=t.digest();return os.encodeByteArray(e)},pp=function(...t){let n="";for(let e=0;e<t.length;e++){var r=t[e];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?n+=pp.apply(null,r):n+="object"==typeof r?Ps(r):r,n+=" "}return n};let gp=null,mp=!0;const yp=function(e,t){is(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(hp.logLevel=fo.VERBOSE,gp=hp.log.bind(hp),t&&up.set("logging_enabled",!0)):"function"==typeof e?gp=e:(gp=null,up.remove("logging_enabled"))},vp=function(...e){!0===mp&&(mp=!1,null===gp&&!0===up.get("logging_enabled")&&yp(!0)),gp&&(e=pp.apply(null,e),gp(e))},_p=function(t){return function(...e){vp(t,...e)}},wp=function(...e){e="FIREBASE INTERNAL ERROR: "+pp(...e);hp.error(e)},bp=function(...e){e=`FIREBASE FATAL ERROR: ${pp(...e)}`;throw hp.error(e),new Error(e)},Ip=function(...e){e="FIREBASE WARNING: "+pp(...e);hp.warn(e)},Tp=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Ep="[MIN_NAME]",Sp="[MAX_NAME]",kp=function(e,t){if(e===t)return 0;if(e===Ep||t===Sp)return-1;if(t===Ep||e===Sp)return 1;var n=Mp(e),r=Mp(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1},Cp=function(e,t){return e===t?0:e<t?-1:1},Ap=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Ps(t))},Np=function(t){if("object"!=typeof t||null===t)return Ps(t);const n=[];for(const e in t)n.push(e);n.sort();let r="{";for(let e=0;e<n.length;e++)0!==e&&(r+=","),r+=Ps(n[e]),r+=":",r+=Np(t[n[e]]);return r+="}",r},Rp=function(t,n){var r=t.length;if(r<=n)return[t];const i=[];for(let e=0;e<r;e+=n)e+n>r?i.push(t.substring(e,r)):i.push(t.substring(e,e+n));return i};function Pp(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const Op=function(e){is(!Tp(e),"Invalid JSON number");let t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,e=Math.abs(e),r=e>=Math.pow(2,-1022)?(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=i+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));const o=[];for(s=52;s;--s)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;--s)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();const a=o.join("");let c="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),c+=e}return c.toLowerCase()};const xp=new RegExp("^-?(0*)\\d{1,10}$"),Dp=-2147483648,Lp=2147483647,Mp=function(e){if(xp.test(e)){e=Number(e);if(e>=Dp&&e<=Lp)return e}return null},Fp=function(e){try{e()}catch(t){setTimeout(()=>{var e=t.stack||"";throw Ip("Exception was thrown by user callback.",e),t},Math.floor(0))}},Up=function(){const e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return 0<=e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)},jp=function(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n};class qp{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then(e=>this.appCheck=e)}getToken(n){return this.appCheck?this.appCheck.getToken(n):new Promise((e,t)=>{setTimeout(()=>{this.appCheck?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){var e;null!==(e=this.appCheckProvider)&&void 0!==e&&e.get().then(e=>e.addTokenListener(t))}notifyForInvalidToken(){Ip(`Provided AppCheck credentials for the app named "${this.appName_}" `+"are invalid. This usually indicates your app was not initialized correctly.")}}class Vp{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(n){return this.auth_?this.auth_.getToken(n).catch(e=>e&&"auth/token-not-initialized"===e.code?(vp("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,t)=>{setTimeout(()=>{this.auth_?this.getToken(n).then(e,t):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ip(e)}}class Bp{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Bp.OWNER="owner";const Kp=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,zp="websocket",Wp="long_polling";class $p{constructor(e,t,n,r,i=!1,s="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=lp.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&lp.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Hp(e,t,n){is("string"==typeof t,"typeof type must == string"),is("object"==typeof n,"typeof params must == object");let r;if(t===zp)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Wp)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);const i=[];return Pp(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class Gp{constructor(){this.counters_={}}incrementCounter(e,t=1){xs(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return ls(void 0,this.counters_)}}const Qp={},Yp={};function Jp(e){e=e.toString();return Qp[e]||(Qp[e]=new Gp),Qp[e]}class Xp{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let e=0;e<n.length;++e)n[e]&&Fp(()=>{this.onMessage_(n[e])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Zp{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=_p(e),this.stats_=Jp(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),Hp(t,Wp,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Xp(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{let e=!1;const n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(()=>{if(!this.isClosed_){this.scriptTagHolder=new eg((...e)=>{var[t,n,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===t)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_()}},(...e)=>{var[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);const t={start:"t"};t.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=this.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",this.transportSessionId&&(t.s=this.transportSessionId),this.lastSessionId&&(t.ls=this.lastSessionId),this.applicationId&&(t.p=this.applicationId),this.appCheckToken&&(t.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Kp.test(location.hostname)&&(t.r="f");var e=this.urlFn(t);this.log_("Connecting via long-poll to "+e),this.scriptTagHolder.addTag(e,()=>{})}})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Zp.forceAllow_=!0}static forceDisallow(){Zp.forceDisallow_=!0}static isAvailable(){return!!Zp.forceAllow_||!(Zp.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){e=Ps(e);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var e=ts(e),t=Rp(e,1840);for(let e=0;e<t.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,t.length,t[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){e=Ps(e).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}}class eg{constructor(t,n,e,r){this.onDisconnect=e,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=dp(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=eg.createIFrame_();let e="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i=document.domain,e='<script>document.domain="'+i+'";<\/script>');var i="<html><body>"+e+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){vp("frame writing exception"),e.stack&&vp(e.stack),vp(e)}}}static createIFrame_(){const t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||vp("No IE domain setting required")}catch(e){var n=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;const i={};i.id=this.myID,i.pw=this.myPW,i.ser=this.currentSerial;var n=this.urlFn(i);let e="",t=0;for(;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+e.length<=1870))break;var r=this.pendingSegs.shift();e=e+"&seg"+t+"="+r.seg+"&ts"+t+"="+r.ts+"&d"+t+"="+r.d,t++}return n+=e,this.addLongPollTag_(n,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const t=this.myIFrame.doc.createElement("script");t.type="text/javascript",t.async=!0,t.src=e,t.onload=t.onreadystatechange=function(){var e=t.readyState;e&&"loaded"!==e&&"complete"!==e||(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),n())},t.onerror=()=>{vp("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(t)}catch(e){}},Math.floor(1))}}let tg=null;"undefined"!=typeof MozWebSocket?tg=MozWebSocket:"undefined"!=typeof WebSocket&&(tg=WebSocket);class ng{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=_p(this.connId),this.stats_=Jp(t),this.connURL=ng.connectionURL_(t,s,o,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r){const i={v:"5"};return"undefined"!=typeof location&&location.hostname&&Kp.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),Hp(e,zp,i)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,lp.set("previous_websocket_failure",!0);try{_s()||(n={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}},this.mySock=new tg(this.connURL,[],n))}catch(e){this.log_("Error instantiating WebSocket.");var n=e.message||e.data;return n&&this.log_(n),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");e=e.message||e.data;e&&this.log_(e),this.onClosed_()}}start(){}static forceDisallow(){ng.forceDisallow_=!0}static isAvailable(){let e=!1;var t;return"undefined"==typeof navigator||!navigator.userAgent||(t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<t.length&&parseFloat(t[1])<4.4&&(e=!0),!e&&null!==tg&&!ng.forceDisallow_}static previouslyFailed(){return lp.isInMemoryStorage||!0===lp.get("previous_websocket_failure")}markConnectionHealthy(){lp.remove("previous_websocket_failure")}appendFrame_(e){this.frames.push(e),this.frames.length===this.totalFrames&&(e=this.frames.join(""),this.frames=null,e=Rs(e),this.onMessage(e))}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(is(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){null!==this.mySock&&(e=e.data,this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames?this.appendFrame_(e):null!==(e=this.extractFrameCount_(e))&&this.appendFrame_(e))}send(e){this.resetKeepAlive();e=Ps(e);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var t=Rp(e,16384);1<t.length&&this.sendString_(String(t.length));for(let e=0;e<t.length;e++)this.sendString_(t[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}ng.responsesRequiredToBeHealthy=2,ng.healthyTimeout=3e4;class rg{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Zp,ng]}initTransports_(e){var t=ng&&ng.isAvailable();let n=t&&!ng.previouslyFailed();if(e.webSocketOnly&&(t||Ip("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[ng];else{const r=this.transports_=[];for(const i of rg.ALL_TRANSPORTS)i&&i.isAvailable()&&r.push(i)}}initialTransport(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return 1<this.transports_.length?this.transports_[1]:null}}class ig{constructor(e,t,n,r,i,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=_p("c:"+this.id+":"),this.transportManager_=new rg(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));var r=e.healthyTimeout||0;0<r&&(this.healthyTimeout_=jp(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&102400<this.conn_.bytesReceived?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&10240<this.conn_.bytesSent?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{2!==this.state_&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){"t"in e&&("a"===(e=e.t)?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))}onSecondaryMessageReceived_(e){var t=Ap("t",e),e=Ap("d",e);if("c"===t)this.onSecondaryControl_(e);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(e)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){var t=Ap("t",e),e=Ap("d",e);"c"===t?this.onControl_(e):"d"===t&&this.onDataMessage_(e)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){var t=Ap("t",e);if("d"in e){e=e.d;if("h"===t)this.onHandshake_(e);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(e):"r"===t?this.onReset_(e):"e"===t?wp("Server Error: "+e):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):wp("Unknown control packet command: "+t)}}onHandshake_(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&Ip("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),e=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,e),jp(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):jp(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(lp.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class sg{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class og{constructor(e){this.allowedEvents_=e,this.listeners_={},is(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});e=this.getInitialEvent(e);e&&t.apply(n,e)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(t){is(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}}class ag extends og{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||ps()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new ag}getInitialEvent(e){return is("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const cg=32,lg=768;class ug{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)0<this.pieces_[e].length&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"}}function hg(){return new ug("")}function dg(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function fg(e){return e.pieces_.length-e.pieceNum_}function pg(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new ug(e.pieces_,t)}function gg(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function mg(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function yg(t){if(t.pieceNum_>=t.pieces_.length)return null;const n=[];for(let e=t.pieceNum_;e<t.pieces_.length-1;e++)n.push(t.pieces_[e]);return new ug(n,0)}function vg(t,n){const r=[];for(let e=t.pieceNum_;e<t.pieces_.length;e++)r.push(t.pieces_[e]);if(n instanceof ug)for(let e=n.pieceNum_;e<n.pieces_.length;e++)r.push(n.pieces_[e]);else{var i=n.split("/");for(let e=0;e<i.length;e++)0<i[e].length&&r.push(i[e])}return new ug(r,0)}function _g(e){return e.pieceNum_>=e.pieces_.length}function wg(e,t){var n=dg(e),r=dg(t);if(null===n)return t;if(n===r)return wg(pg(e),pg(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function bg(e,t){var n=mg(e,0),r=mg(t,0);for(let e=0;e<n.length&&e<r.length;e++){var i=kp(n[e],r[e]);if(0!==i)return i}return n.length===r.length?0:n.length<r.length?-1:1}function Ig(n,r){if(fg(n)!==fg(r))return!1;for(let e=n.pieceNum_,t=r.pieceNum_;e<=n.pieces_.length;e++,t++)if(n.pieces_[e]!==r.pieces_[t])return!1;return!0}function Tg(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(fg(e)>fg(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class Eg{constructor(e,t){this.errorPrefix_=t,this.parts_=mg(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=Xs(this.parts_[e]);Sg(this)}}function Sg(e){if(e.byteLength_>lg)throw new Error(e.errorPrefix_+"has a key path longer than "+lg+" bytes ("+e.byteLength_+").");if(e.parts_.length>cg)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+cg+") or object contains a cycle "+kg(e))}function kg(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Cg extends og{constructor(){super(["visible"]);let t,e;"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(e="visibilitychange",t="hidden"):void 0!==document.mozHidden?(e="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(e="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{var e=!document[t];e!==this.visible_&&(this.visible_=e,this.trigger("visible",e))},!1)}static getInstance(){return new Cg}getInitialEvent(e){return is("visible"===e,"Unknown event type: "+e),[this.visible_]}}class Ag extends sg{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=Ag.nextPersistentConnectionId_++,this.log_=_p("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!_s())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Cg.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&ag.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){var r=++this.requestNumber_,t={r:r,a:e,b:t};this.log_(Ps(t)),is(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(t),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const n=new us,r={p:e._path.toString(),q:e._queryObject},t={action:"g",request:r,onComplete:e=>{var t=e.d;"ok"===e.s?(this.onDataUpdate_(r.p,t,!1,null),n.resolve(t)):n.reject(t)}};this.outstandingGets_.push(t),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_||setTimeout(()=>{var e=this.outstandingGets_[i];void 0!==e&&t===e&&(delete this.outstandingGets_[i],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),this.log_("get "+i+" timed out on connection"),n.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(i),n.promise}listen(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),is(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),is(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");n={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,n),this.connected_&&this.sendListen_(n)}sendGet_(t){const n=this.outstandingGets_[t];this.sendRequest("g",n.request,e=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(e)})}sendListen_(r){const i=r.query,s=i._path.toString(),o=i._queryIdentifier;this.log_("Listen on "+s+" for "+o);const e={p:s};r.tag&&(e.q=i._queryObject,e.t=r.tag),e.h=r.hashFn(),this.sendRequest("q",e,e=>{var t=e.d,n=e.s;Ag.warnOnListenWarnings_(t,i),(this.listens.get(s)&&this.listens.get(s).get(o))===r&&(this.log_("listen response",e),"ok"!==n&&this.removeListen_(s,o),r.onComplete&&r.onComplete(n,t))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&xs(e,"w")){const n=Ds(e,"w");Array.isArray(n)&&~n.indexOf("no_index")&&(e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',t=t._path.toString(),Ip("Using an unspecified index. Your data will be downloaded and "+`filtered on the client. Consider adding ${e} at `+`${t} to your security rules for better performance.`))}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){e=Os(e).claims;return"object"==typeof e&&!0===e.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const n=this.authToken_;var e=function(e){e=Os(e).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(n)?"auth":"gauth";const t={cred:n};null===this.authOverride_?t.noauth=!0:"object"==typeof this.authOverride_&&(t.authvar=this.authOverride_),this.sendRequest(e,t,e=>{var t=e.s,e=e.d||"error";this.authToken_===n&&("ok"===t?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(t,e))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{var t=e.s,e=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,e)})}unlisten(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),is(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){n={p:t,d:n};this.log_("onDisconnect "+e,n),this.sendRequest(e,n,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;r=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(r):this.log_("Buffering put: "+t)}sendPut_(t){const n=this.outstandingPuts_[t].action;var e=this.outstandingPuts_[t].request;const r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,e,e=>{this.log_(n+" response",e),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(e.s,e.d)})}reportStats(e){this.connected_&&(this.log_("reportStats",e={c:e}),this.sendRequest("s",e,e=>{"ok"!==e.s&&(e=e.d,this.log_("reportStats","Error sending stats: "+e))}))}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ps(e));var t=e.r;const n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):wp("Unrecognized action received from server: "+Ps(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){is(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),r=this.onReady_.bind(this);const u=this.onRealtimeDisconnect_.bind(this);var i=this.id+":"+Ag.nextConnectionId_++,s=this.lastSessionId;let t=!1,n=null;var o=function(){n?n.close():(t=!0,u())};this.realtime_={close:o,sendRequest:function(e){is(n,"sendRequest call when we're not connected not allowed."),n.sendRequest(e)}};var a=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{var[c,l]=await Promise.all([this.authTokenProvider_.getToken(a),this.appCheckTokenProvider_.getToken(a)]);t?vp("getToken() completed but was canceled"):(vp("getToken() completed. Creating connection."),this.authToken_=c&&c.accessToken,this.appCheckToken_=l&&l.token,n=new ig(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,r,u,e=>{Ip(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},s))}catch(e){this.log_("Failed to get token: "+e),t||(this.repoInfo_.nodeAdmin&&Ip(e),o())}}}interrupt(e){vp("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){vp("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ls(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){e-=(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>Np(e)).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){e=new ug(e).toString();let n;if(this.listens.has(e)){const r=this.listens.get(e);n=r.get(t),r.delete(t),0===r.size&&this.listens.delete(e)}else n=void 0;return n}onAuthRevoked_(e,t){vp("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){vp("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const n of t.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+Zf.replace(/\./g,"-")]=1,ps()?e["framework.cordova"]=1:ys()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){var e=ag.getInstance().currentlyOnline();return Ls(this.interruptReasons_)&&e}}Ag.nextPersistentConnectionId_=0,Ag.nextConnectionId_=0;class Ng{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ng(e,t)}}class Rg{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){e=new Ng(Ep,e),t=new Ng(Ep,t);return 0!==this.compare(e,t)}minPost(){return Ng.MIN}}let Pg;class Og extends Rg{static get __EMPTY_NODE(){return Pg}static set __EMPTY_NODE(e){Pg=e}compare(e,t){return kp(e.name,t.name)}isDefinedOn(e){throw ss("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ng.MIN}maxPost(){return new Ng(Sp,Pg)}makePost(e,t){return is("string"==typeof e,"KeyIndex indexValue must always be a string."),new Ng(e,Pg)}toString(){return".key"}}const xg=new Og;class Dg{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_.pop(),t;if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack_.length}peek(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Lg{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Lg.RED,this.left=null!=r?r:Mg.EMPTY_NODE,this.right=null!=i?i:Mg.EMPTY_NODE}copy(e,t,n,r,i){return new Lg(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Mg.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Mg.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){var e=this.copy(null,null,Lg.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){var e=this.copy(null,null,Lg.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Lg.RED=!0,Lg.BLACK=!1;class Mg{constructor(e,t=Mg.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Mg(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Lg.BLACK,null,null))}remove(e){return new Mg(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Lg.BLACK,null,null))}get(e){var t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Dg(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Dg(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Dg(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Dg(this.root_,null,this.comparator_,!0,e)}}function Fg(e,t){return kp(e.name,t.name)}function Ug(e,t){return kp(e,t)}Mg.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new Lg(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let jg;const qg=function(e){return"number"==typeof e?"number:"+Op(e):"string:"+e},Vg=function(e){var t;e.isLeafNode()?(t=e.val(),is("string"==typeof t||"number"==typeof t||"object"==typeof t&&xs(t,".sv"),"Priority must be a string or number.")):is(e===jg||e.isEmpty(),"priority of unexpected type."),is(e===jg||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Bg;class Kg{constructor(e,t=Kg.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,is(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Vg(this.priorityNode_)}static set __childrenNodeConstructor(e){Bg=e}static get __childrenNodeConstructor(){return Bg}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Kg(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Kg.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return _g(e)?this:".priority"===dg(e)?this.priorityNode_:Kg.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Kg.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){var n=dg(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(is(".priority"!==n||1===fg(e),".priority must be the last token in a path"),this.updateImmediateChild(n,Kg.__childrenNodeConstructor.EMPTY_NODE.updateChild(pg(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+qg(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"==t?Op(this.value_):this.value_,this.lazyHash_=fp(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Kg.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Kg.__childrenNodeConstructor?-1:(is(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){var t=typeof e.value_,n=typeof this.value_,r=Kg.VALUE_TYPE_ORDER.indexOf(t),i=Kg.VALUE_TYPE_ORDER.indexOf(n);return is(0<=r,"Unknown leaf type: "+t),is(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&(this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_))}}Kg.VALUE_TYPE_ORDER=["object","boolean","number","string"];let zg,Wg;const $g=new class extends Rg{compare(e,t){const n=e.node.getPriority();var r=t.node.getPriority(),r=n.compareTo(r);return 0===r?kp(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ng.MIN}maxPost(){return new Ng(Sp,new Kg("[PRIORITY-POST]",Wg))}makePost(e,t){e=zg(e);return new Ng(t,new Kg("[PRIORITY-POST]",e))}toString(){return".priority"}},Hg=Math.log(2);class Gg{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Hg,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}nextBitIsOne(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Qg=function(l,e,u,t){l.sort(e);const h=function(e,t){var n=t-e;let r,i;if(0==n)return null;if(1==n)return r=l[e],i=u?u(r):r,new Lg(i,r.node,Lg.BLACK,null,null);n=parseInt(n/2,10)+e,e=h(e,n),t=h(n+1,t);return r=l[n],i=u?u(r):r,new Lg(i,r.node,Lg.BLACK,e,t)};var n=function(t){let n=null,r=null,i=l.length;function s(e,t){var n=i-e,r=i;i-=e,e=h(1+n,r),r=l[n],n=u?u(r):r,o(new Lg(n,r.node,t,null,e))}const o=function(e){n=(n?n.left=e:r=e,e)};for(let e=0;e<t.count;++e){var a=t.nextBitIsOne(),c=Math.pow(2,t.count-(e+1));a?s(c,Lg.BLACK):(s(c,Lg.BLACK),s(c,Lg.RED))}return r}(new Gg(l.length));return new Mg(t||e,n)};let Yg;const Jg={};class Xg{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return is((Jg,$g),"ChildrenNode.ts has not been loaded"),Yg=Yg||new Xg({".priority":Jg},{".priority":$g}),Yg}get(e){var t=Ds(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Mg?t:null}hasIndex(e){return xs(this.indexSet_,e.toString())}addIndex(e,t){is(e!==xg,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(Ng.Wrap);let s=i.getNext();for(;s;)r=r||e.isDefinedOn(s.node),n.push(s),s=i.getNext();let o;o=r?Qg(n,e.getCompare()):Jg;t=e.toString();const a=Object.assign({},this.indexSet_);a[t]=e;const c=Object.assign({},this.indexes_);return c[t]=o,new Xg(c,a)}addToIndexes(o,a){var e=Ms(this.indexes_,(t,n)=>{const r=Ds(this.indexSet_,n);if(is(r,"Missing index implementation for "+n),t===Jg){if(r.isDefinedOn(o.node)){const i=[],s=a.getIterator(Ng.Wrap);let e=s.getNext();for(;e;)e.name!==o.name&&i.push(e),e=s.getNext();return i.push(o),Qg(i,r.getCompare())}return Jg}{n=a.get(o.name);let e=t;return n&&(e=e.remove(new Ng(o.name,n))),e.insert(o,o.node)}});return new Xg(e,this.indexSet_)}removeFromIndexes(n,r){var e=Ms(this.indexes_,e=>{if(e===Jg)return e;var t=r.get(n.name);return t?e.remove(new Ng(n.name,t)):e});return new Xg(e,this.indexSet_)}}let Zg;class em{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Vg(this.priorityNode_),this.children_.isEmpty()&&is(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Zg=Zg||new em(new Mg(Ug),null,Xg.Default)}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Zg}updatePriority(e){return this.children_.isEmpty()?this:new em(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();e=this.children_.get(e);return null===e?Zg:e}getChild(e){var t=dg(e);return null===t?this:this.getImmediateChild(t).getChild(pg(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(n,r){if(is(r,"We should always be passing snapshot nodes"),".priority"===n)return this.updatePriority(r);{var i=new Ng(n,r);let e,t;t=r.isEmpty()?(e=this.children_.remove(n),this.indexMap_.removeFromIndexes(i,this.children_)):(e=this.children_.insert(n,r),this.indexMap_.addToIndexes(i,this.children_));i=e.isEmpty()?Zg:this.priorityNode_;return new em(e,i,t)}}updateChild(e,t){var n=dg(e);if(null===n)return t;is(".priority"!==dg(e)||1===fg(e),".priority must be the last token in a path");t=this.getImmediateChild(n).updateChild(pg(e),t);return this.updateImmediateChild(n,t)}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;const r={};let i=0,s=0,o=!0;if(this.forEachChild($g,(e,t)=>{r[e]=t.val(n),i++,o&&em.INTEGER_REGEXP_.test(e)?s=Math.max(s,Number(e)):o=!1}),!n&&o&&s<2*i){const e=[];for(const t in r)e[t]=r[t];return e}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(null===this.lazyHash_){let n="";this.getPriority().isEmpty()||(n+="priority:"+qg(this.getPriority().val())+":"),this.forEachChild($g,(e,t)=>{t=t.hash();""!==t&&(n+=":"+e+":"+t)}),this.lazyHash_=""===n?"":fp(n)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){t=r.getPredecessorKey(new Ng(e,t));return t?t.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){e=this.getFirstChildName(e);return e?new Ng(e,this.children_.get(e)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){e=this.getLastChildName(e);return e?new Ng(e,this.children_.get(e)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getIteratorFrom(t,e=>e);{const r=this.children_.getIteratorFrom(t.name,Ng.Wrap);let e=r.peek();for(;null!=e&&n.compare(e,t)<0;)r.getNext(),e=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(t,n){const e=this.resolveIndex_(n);if(e)return e.getReverseIteratorFrom(t,e=>e);{const r=this.children_.getReverseIteratorFrom(t.name,Ng.Wrap);let e=r.peek();for(;null!=e&&0<n.compare(e,t);)r.getNext(),e=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===nm?-1:0}withIndex(e){if(e===xg||this.indexMap_.hasIndex(e))return this;e=this.indexMap_.addIndex(e,this.children_);return new em(this.children_,this.priorityNode_,e)}isIndexed(e){return e===xg||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority())){if(this.children_.count()!==n.children_.count())return!1;{const r=this.getIterator($g),i=n.getIterator($g);let e=r.getNext(),t=i.getNext();for(;e&&t;){if(e.name!==t.name||!e.node.equals(t.node))return!1;e=r.getNext(),t=i.getNext()}return null===e&&null===t}}return!1}}resolveIndex_(e){return e===xg?null:this.indexMap_.get(e.toString())}}em.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class tm extends em{constructor(){super(new Mg(Ug),em.EMPTY_NODE,Xg.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return em.EMPTY_NODE}isEmpty(){return!1}}const nm=new tm;Object.defineProperties(Ng,{MIN:{value:new Ng(Ep,em.EMPTY_NODE)},MAX:{value:new Ng(Sp,nm)}}),Og.__EMPTY_NODE=em.EMPTY_NODE,Kg.__childrenNodeConstructor=em,rp=nm,jg=rp,ip=nm,Wg=ip;const rm=!0;function im(i,e=null){if(null===i)return em.EMPTY_NODE;if("object"==typeof i&&".priority"in i&&(e=i[".priority"]),is(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"!=typeof(i="object"==typeof i&&".value"in i&&null!==i[".value"]?i[".value"]:i)||".sv"in i){var t=i;return new Kg(t,im(e))}if(i instanceof Array||!rm){let r=em.EMPTY_NODE;return Pp(i,(e,t)=>{if(xs(i,e)&&"."!==e.substring(0,1)){const n=im(t);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(e,n))}}),r.updatePriority(im(e))}{const s=[];let r=!1;if(Pp(i,(e,t)=>{if("."!==e.substring(0,1)){const n=im(t);n.isEmpty()||(r=r||!n.getPriority().isEmpty(),s.push(new Ng(e,n)))}}),0===s.length)return em.EMPTY_NODE;var n=Qg(s,Fg,e=>e.name,Ug);if(r){t=Qg(s,$g.getCompare());return new em(n,im(e),new Xg({".priority":t},{".priority":$g}))}return new em(n,im(e),Xg.Default)}}zg=im;class sm extends Rg{constructor(e){super(),this.indexPath_=e,is(!_g(e)&&".priority"!==dg(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node);var r=this.extractChild(t.node),r=n.compareTo(r);return 0===r?kp(e.name,t.name):r}makePost(e,t){e=im(e),e=em.EMPTY_NODE.updateChild(this.indexPath_,e);return new Ng(t,e)}maxPost(){var e=em.EMPTY_NODE.updateChild(this.indexPath_,nm);return new Ng(Sp,e)}toString(){return mg(this.indexPath_,0).join("/")}}const om=new class extends Rg{compare(e,t){var n=e.node.compareTo(t.node);return 0===n?kp(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ng.MIN}maxPost(){return Ng.MAX}makePost(e,t){e=im(e);return new Ng(t,e)}toString(){return".value"}},am="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",cm=function(){let s=0;const o=[];return function(e){var t=e===s;s=e;let n;const r=new Array(8);for(n=7;0<=n;n--)r[n]=am.charAt(e%64),e=Math.floor(e/64);is(0===e,"Cannot push at time == 0");let i=r.join("");if(t){for(n=11;0<=n&&63===o[n];n--)o[n]=0;o[n]++}else for(n=0;n<12;n++)o[n]=Math.floor(64*Math.random());for(n=0;n<12;n++)i+=am.charAt(o[n]);return is(20===i.length,"nextPushId: Length should be 20."),i}}(),lm=function(t){if(t===""+Lp)return"-";var e=Mp(t);if(null!=e)return""+(e+1);const n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t.charAt(e);if(n.length<786)return n.push("-"),n.join("");let r=n.length-1;for(;0<=r&&"z"===n[r];)r--;if(-1===r)return Sp;e=n[r],e=am.charAt(am.indexOf(e)+1);return n[r]=e,n.slice(0,r+1).join("")},um=function(t){if(t===""+Dp)return Ep;var e=Mp(t);if(null!=e)return""+(e-1);const n=new Array(t.length);for(let e=0;e<n.length;e++)n[e]=t.charAt(e);return"-"===n[n.length-1]?1===n.length?""+Lp:(delete n[n.length-1],n.join("")):(n[n.length-1]=am.charAt(am.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))};function hm(e){return{type:"value",snapshotNode:e}}function dm(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function fm(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function pm(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class gm{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){is(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(fm(t,o)):is(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(dm(t,n)):s.trackChildChange(pm(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild($g,(e,t)=>{n.hasChild(e)||i.trackChildChange(fm(e,t))}),n.isLeafNode()||n.forEachChild($g,(e,t)=>{if(r.hasChild(e)){const n=r.getImmediateChild(e);n.equals(t)||i.trackChildChange(pm(e,t,n))}else i.trackChildChange(dm(e,t))})),n.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?em.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class mm{constructor(e){this.indexedFilter_=new gm(e.getIndex()),this.index_=e.getIndex(),this.startPost_=mm.getStartPost_(e),this.endPost_=mm.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,n,r,i,s){return this.matches(new Ng(t,n))||(n=em.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){let r=(t=t.isLeafNode()?em.EMPTY_NODE:t).withIndex(this.index_);r=r.updatePriority(em.EMPTY_NODE);const i=this;return t.forEachChild($g,(e,t)=>{i.matches(new Ng(e,t))||(r=r.updateImmediateChild(e,em.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class ym{constructor(e){this.rangedFilter_=new mm(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new Ng(t,n))||(n=em.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,o,t){let a;if(o.isLeafNode()||o.isEmpty())a=em.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<o.numChildren()&&o.isIndexed(this.index_)){a=em.EMPTY_NODE.withIndex(this.index_);let t;t=this.reverse_?o.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;t.hasNext()&&n<this.limit_;){var r=t.getNext();let e;if(e=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),r)<=0:this.index_.compare(r,this.rangedFilter_.getEndPost())<=0,!e)break;a=a.updateImmediateChild(r.name,r.node),n++}}else{a=o.withIndex(this.index_),a=a.updatePriority(em.EMPTY_NODE);let e,t,n,r;if(this.reverse_){r=a.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),t=this.rangedFilter_.getStartPost();const l=this.index_.getCompare();n=(e,t)=>l(t,e)}else r=a.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),t=this.rangedFilter_.getEndPost(),n=this.index_.getCompare();let i=0,s=!1;for(;r.hasNext();){var c=r.getNext();!s&&n(e,c)<=0&&(s=!0),s&&i<this.limit_&&n(c,t)<=0?i++:a=a.updateImmediateChild(c.name,em.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,a,t)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const d=this.index_.getCompare();s=(e,t)=>d(t,e)}else s=this.index_.getCompare();const o=e;is(o.numChildren()===this.limit_,"");var a=new Ng(t,n),c=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),l=this.rangedFilter_.matches(a);if(o.hasChild(t)){var u=o.getImmediateChild(t);let e=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=e&&(e.name===t||o.hasChild(e.name));)e=r.getChildAfterChild(this.index_,e,this.reverse_);var h=null==e?1:s(e,a);if(l&&!n.isEmpty()&&0<=h)return null!=i&&i.trackChildChange(pm(t,n,u)),o.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(fm(t,u));const f=o.updateImmediateChild(t,em.EMPTY_NODE);return null!=e&&this.rangedFilter_.matches(e)?(null!=i&&i.trackChildChange(dm(e.name,e.node)),f.updateImmediateChild(e.name,e.node)):f}}return!n.isEmpty()&&l&&0<=s(c,a)?(null!=i&&(i.trackChildChange(fm(c.name,c.node)),i.trackChildChange(dm(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(c.name,em.EMPTY_NODE)):e}}class vm{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=$g}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return is(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return is(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ep}hasEnd(){return this.endSet_}getIndexEndValue(){return is(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return is(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Sp}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return is(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===$g}copy(){const e=new vm;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function _m(e,t,n){const r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function wm(e,t,n){const r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function bm(e,t){const n=e.copy();return n.index_=t,n}function Im(e){const t={};if(e.isDefault())return t;let n;return n=e.index_===$g?"$priority":e.index_===om?"$value":e.index_===xg?"$key":(is(e.index_ instanceof sm,"Unrecognized index type!"),e.index_.toString()),t.orderBy=Ps(n),e.startSet_&&(t.startAt=Ps(e.indexStartValue_),e.startNameSet_&&(t.startAt+=","+Ps(e.indexStartName_))),e.endSet_&&(t.endAt=Ps(e.indexEndValue_),e.endNameSet_&&(t.endAt+=","+Ps(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function Tm(t){const n={};if(t.startSet_&&(n.sp=t.indexStartValue_,t.startNameSet_&&(n.sn=t.indexStartName_)),t.endSet_&&(n.ep=t.indexEndValue_,t.endNameSet_&&(n.en=t.indexEndName_)),t.limitSet_){n.l=t.limit_;let e=t.viewFrom_;""===e&&(e=t.isViewFromLeft()?"l":"r"),n.vf=e}return t.index_!==$g&&(n.i=t.index_.toString()),n}class Em extends sg{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=_p("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(is(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=Em.getListenId_(e,r),a={};this.listens_[o]=a;e=Im(e._queryParams);this.restRequest_(s+".json",e,(t,e)=>{let n=e;if(null===(t=404===t?n=null:t)&&this.onDataUpdate_(s,n,!1,r),Ds(this.listens_,o)===a){let e;e=t?401===t?"permission_denied":"rest_error:"+t:"ok",i(e,null)}})}unlisten(e,t){t=Em.getListenId_(e,t);delete this.listens_[t]}get(e){var t=Im(e._queryParams);const r=e._path.toString(),i=new us;return this.restRequest_(r+".json",t,(e,t)=>{let n=t;null===(e=404===e?n=null:e)?(this.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))}),i.promise}refreshAuthToken(e){}restRequest_(i,s={},o){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([e,t])=>{e&&e.accessToken&&(s.auth=e.accessToken),t&&t.token&&(s.ac=t.token);const n=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+i+"?ns="+this.repoInfo_.namespace+js(s);this.log_("Sending REST request for "+n);const r=new XMLHttpRequest;r.onreadystatechange=()=>{if(o&&4===r.readyState){this.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);let e=null;if(200<=r.status&&r.status<300){try{e=Rs(r.responseText)}catch(e){Ip("Failed to parse JSON response for "+n+": "+r.responseText)}o(null,e)}else 401!==r.status&&404!==r.status&&Ip("Got unsuccessful REST response for "+n+" Status: "+r.status),o(r.status);o=null}},r.open("GET",n,!0),r.send()})}}class Sm{constructor(){this.rootNode_=em.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function km(){return{value:null,children:new Map}}function Cm(e,t,n){var r;_g(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=dg(t),e.children.has(r)||e.children.set(r,km()),Cm(e.children.get(r),t=pg(t),n))}function Am(e,n,r){var i;null!==e.value?r(n,e.value):(i=(e,t)=>{Am(t,new ug(n.toString()+"/"+e),r)},e.children.forEach((e,t)=>{i(t,e)}))}class Nm{constructor(e){this.collection_=e,this.last_=null}get(){var e=this.collection_.get();const n=Object.assign({},e);return this.last_&&Pp(this.last_,(e,t)=>{n[e]=n[e]-t}),this.last_=e,n}}class Rm{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Nm(e);e=1e4+2e4*Math.random();jp(this.reportStats_.bind(this),Math.floor(e))}reportStats_(){var e=this.statsListener_.get();const n={};let r=!1;Pp(e,(e,t)=>{0<t&&xs(this.statsToReport_,e)&&(n[e]=t,r=!0)}),r&&this.server_.reportStats(n),jp(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function Pm(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Om(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function xm(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(ur=sp=sp||{})[ur.OVERWRITE=0]="OVERWRITE",ur[ur.MERGE=1]="MERGE",ur[ur.ACK_USER_WRITE=2]="ACK_USER_WRITE",ur[ur.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class Dm{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=sp.ACK_USER_WRITE,this.source=Pm()}operationForChild(e){if(_g(this.path)){if(null!=this.affectedTree.value)return is(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new ug(e));return new Dm(hg(),t,this.revert)}return is(dg(this.path)===e,"operationForChild called for unrelated child."),new Dm(pg(this.path),this.affectedTree,this.revert)}}class Lm{constructor(e,t){this.source=e,this.path=t,this.type=sp.LISTEN_COMPLETE}operationForChild(e){return _g(this.path)?new Lm(this.source,hg()):new Lm(this.source,pg(this.path))}}class Mm{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=sp.OVERWRITE}operationForChild(e){return _g(this.path)?new Mm(this.source,hg(),this.snap.getImmediateChild(e)):new Mm(this.source,pg(this.path),this.snap)}}class Fm{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=sp.MERGE}operationForChild(e){if(_g(this.path)){const t=this.children.subtree(new ug(e));return t.isEmpty()?null:t.value?new Mm(this.source,hg(),t.value):new Fm(this.source,hg(),t)}return is(dg(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Fm(this.source,pg(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Um{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(_g(e))return this.isFullyInitialized()&&!this.filtered_;e=dg(e);return this.isCompleteForChild(e)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class jm{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function qm(n,e,t,r){var i=[];const s=[];return e.forEach(e=>{var t;"child_changed"===e.type&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&s.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),Vm(n,i,"child_removed",e,r,t),Vm(n,i,"child_added",e,r,t),Vm(n,i,"child_moved",s,r,t),Vm(n,i,"child_changed",e,r,t),Vm(n,i,"value",e,r,t),i}function Vm(s,o,t,e,a,c){const n=e.filter(e=>e.type===t);n.sort((e,t)=>function(e,t,n){if(null==t.childName||null==n.childName)throw ss("Should only compare child_ events.");t=new Ng(t.childName,t.snapshotNode),n=new Ng(n.childName,n.snapshotNode);return e.index_.compare(t,n)}(s,e,t)),n.forEach(t=>{const n=(e=s,i=c,"value"===(r=t).type||"child_removed"===r.type||(r.prevName=i.getPredecessorChildName(r.childName,r.snapshotNode,e.index_)),r);var e,r,i;a.forEach(e=>{e.respondsTo(t.type)&&o.push(e.createEvent(n,s.query_))})})}function Bm(e,t){return{eventCache:e,serverCache:t}}function Km(e,t,n,r){return Bm(new Um(t,n,r),e.serverCache)}function zm(e,t,n,r){return Bm(e.eventCache,new Um(t,n,r))}function Wm(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function $m(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Hm;class Gm{constructor(e,t=(Hm=Hm||new Mg(Cp),Hm)){this.value=e,this.children=t}static fromObject(e){let n=new Gm(null);return Pp(e,(e,t)=>{n=n.set(new ug(e),t)}),n}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:hg(),value:this.value};if(_g(e))return null;{var n=dg(e);const r=this.children.get(n);if(null===r)return null;t=r.findRootMostMatchingPathAndValue(pg(e),t);return null==t?null:{path:vg(new ug(n),t.path),value:t.value}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(_g(e))return this;{var t=dg(e);const n=this.children.get(t);return null!==n?n.subtree(pg(e)):new Gm(null)}}set(e,t){if(_g(e))return new Gm(t,this.children);{var n=dg(e);const r=this.children.get(n)||new Gm(null);t=r.set(pg(e),t),t=this.children.insert(n,t);return new Gm(this.value,t)}}remove(t){if(_g(t))return this.children.isEmpty()?new Gm(null):new Gm(null,this.children);{var n=dg(t);const r=this.children.get(n);if(r){const i=r.remove(pg(t));let e;return e=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&e.isEmpty()?new Gm(null):new Gm(this.value,e)}return this}}get(e){if(_g(e))return this.value;{var t=dg(e);const n=this.children.get(t);return n?n.get(pg(e)):null}}setTree(t,n){if(_g(t))return n;{var r=dg(t);const i=this.children.get(r)||new Gm(null),s=i.setTree(pg(t),n);let e;return e=s.isEmpty()?this.children.remove(r):this.children.insert(r,s),new Gm(this.value,e)}}fold(e){return this.fold_(hg(),e)}fold_(n,r){const i={};return this.children.inorderTraversal((e,t)=>{i[e]=t.fold_(vg(n,e),r)}),r(n,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,hg(),t)}findOnPath_(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(_g(e))return null;{r=dg(e);const i=this.children.get(r);return i?i.findOnPath_(pg(e),vg(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,hg(),t)}foreachOnPath_(e,t,n){if(_g(e))return this;{this.value&&n(t,this.value);var r=dg(e);const i=this.children.get(r);return i?i.foreachOnPath_(pg(e),vg(t,r),n):new Gm(null)}}foreach(e){this.foreach_(hg(),e)}foreach_(n,r){this.children.inorderTraversal((e,t)=>{t.foreach_(vg(n,e),r)}),this.value&&r(n,this.value)}foreachChild(n){this.children.inorderTraversal((e,t)=>{t.value&&n(e,t.value)})}}class Qm{constructor(e){this.writeTree_=e}static empty(){return new Qm(new Gm(null))}}function Ym(t,n,r){if(_g(n))return new Qm(new Gm(r));var i=t.writeTree_.findRootMostValueAndPath(n);if(null!=i){var s=i.path;let e=i.value;i=wg(s,n);return e=e.updateChild(i,r),new Qm(t.writeTree_.set(s,e))}r=new Gm(r),r=t.writeTree_.setTree(n,r);return new Qm(r)}function Jm(e,n,t){let r=e;return Pp(t,(e,t)=>{r=Ym(r,vg(n,e),t)}),r}function Xm(e,t){if(_g(t))return Qm.empty();t=e.writeTree_.setTree(t,new Gm(null));return new Qm(t)}function Zm(e,t){return null!=ey(e,t)}function ey(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(wg(n.path,t)):null}function ty(e){const n=[],t=e.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild($g,(e,t)=>{n.push(new Ng(e,t))}):e.writeTree_.children.inorderTraversal((e,t)=>{null!=t.value&&n.push(new Ng(e,t.value))}),n}function ny(e,t){if(_g(t))return e;var n=ey(e,t);return null!=n?new Qm(new Gm(n)):new Qm(e.writeTree_.subtree(t))}function ry(e){return e.writeTree_.isEmpty()}function iy(e,t){return function r(i,e,s){{if(null!=e.value)return s.updateChild(i,e.value);{let n=null;return e.children.inorderTraversal((e,t)=>{".priority"===e?(is(null!==t.value,"Priority writes must always be leaf nodes"),n=t.value):s=r(vg(i,e),t,s)}),s=!s.getChild(i).isEmpty()&&null!==n?s.updateChild(vg(i,".priority"),n):s}}}(hg(),e.writeTree_,t)}function sy(e,t){return yy(t,e)}function oy(t,n){var e,r=t.allWrites.findIndex(e=>e.writeId===n);is(0<=r,"removeWrite called with nonexistent writeId.");const i=t.allWrites[r];t.allWrites.splice(r,1);let s=i.visible,o=!1,a=t.allWrites.length-1;for(;s&&0<=a;){var c=t.allWrites[a];c.visible&&(a>=r&&function(e,t){{if(e.snap)return Tg(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Tg(vg(e.path,n),t))return!0;return!1}}(c,i.path)?s=!1:Tg(i.path,c.path)&&(o=!0)),a--}return!!s&&(o?((e=t).visibleWrites=cy(e.allWrites,ay,hg()),0<e.allWrites.length?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?t.visibleWrites=Xm(t.visibleWrites,i.path):Pp(i.children,e=>{t.visibleWrites=Xm(t.visibleWrites,vg(i.path,e))}),!0)}function ay(e){return e.visible}function cy(t,n,r){let i=Qm.empty();for(let e=0;e<t.length;++e){const o=t[e];if(n(o)){var s=o.path;let e;if(o.snap)Tg(r,s)?(e=wg(r,s),i=Ym(i,e,o.snap)):Tg(s,r)&&(e=wg(s,r),i=Ym(i,hg(),o.snap.getChild(e)));else{if(!o.children)throw ss("WriteRecord should have .snap or .children");if(Tg(r,s))e=wg(r,s),i=Jm(i,e,o.children);else if(Tg(s,r))if(e=wg(s,r),_g(e))i=Jm(i,hg(),o.children);else{const a=Ds(o.children,dg(e));a&&(s=a.getChild(pg(e)),i=Ym(i,hg(),s))}}}}return i}function ly(e,t,n,r,i){if(r||i){var s=ny(e.visibleWrites,t);if(!i&&ry(s))return n;if(i||null!=n||Zm(s,hg()))return iy(cy(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Tg(e.path,t)||Tg(t,e.path))},t),n||em.EMPTY_NODE);return null}s=ey(e.visibleWrites,t);if(null!=s)return s;e=ny(e.visibleWrites,t);return ry(e)?n:null!=n||Zm(e,hg())?iy(e,n||em.EMPTY_NODE):null}function uy(e,t,n,r){return ly(e.writeTree,e.treePath,t,n,r)}function hy(e,t){return function(e,t,n){let r=em.EMPTY_NODE;const i=ey(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild($g,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(n){const s=ny(e.visibleWrites,t);return n.forEachChild($g,(e,t)=>{t=iy(ny(s,new ug(e)),t);r=r.updateImmediateChild(e,t)}),ty(s).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}return ty(ny(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}(e.writeTree,e.treePath,t)}function dy(e,t,n,r){return i=e.writeTree,e=e.treePath,t=t,r=r,is(n||r,"Either existingEventSnap or existingServerSnap must exist"),e=vg(e,t),Zm(i.visibleWrites,e)?null:ry(e=ny(i.visibleWrites,e))?r.getChild(t):iy(e,r.getChild(t));var i}function fy(e,t){return n=e.writeTree,t=vg(e.treePath,t),ey(n.visibleWrites,t);var n}function py(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;if(e=ny(e.visibleWrites,t),null!=(t=ey(e,hg())))a=t;else{if(null==n)return[];a=iy(e,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const c=[],l=o.getCompare(),u=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let e=u.getNext();for(;e&&c.length<i;)0!==l(e,r)&&c.push(e),e=u.getNext();return c}}(e.writeTree,e.treePath,t,n,r,i,s)}function gy(e,t,n){return r=e.writeTree,i=e.treePath,e=n,t=vg(i,n=t),null!=(i=ey(r.visibleWrites,t))?i:e.isCompleteForChild(n)?iy(ny(r.visibleWrites,t),e.getNode().getImmediateChild(n)):null;var r,i}function my(e,t){return yy(vg(e.treePath,t),e.writeTree)}function yy(e,t){return{treePath:e,writeTree:t}}class vy{constructor(){this.changeMap=new Map}trackChildChange(e){var t=e.type,n=e.childName;is("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),is(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,pm(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,fm(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,dm(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw ss("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,pm(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const _y=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class wy{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new Um(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return gy(this.writes_,e,n)}getChildAfterChild(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:$m(this.viewCache_),e=py(this.writes_,r,t,1,n,e);return 0===e.length?null:e[0]}}function by(e,t,n,r,i){const s=new vy;let o,a;if(n.type===sp.OVERWRITE){var c=n;o=c.source.fromUser?Ey(e,t,c.path,c.snap,r,i,s):(is(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!_g(c.path),Ty(e,t,c.path,c.snap,r,i,a,s))}else if(n.type===sp.MERGE){var l=n;o=l.source.fromUser?function(n,r,i,e,s,o,a){let c=r;return e.foreach((e,t)=>{e=vg(i,e);Sy(r,dg(e))&&(c=Ey(n,c,e,t,s,o,a))}),e.foreach((e,t)=>{e=vg(i,e);Sy(r,dg(e))||(c=Ey(n,c,e,t,s,o,a))}),c}(e,t,l.path,l.children,r,i,s):(is(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),Cy(e,t,l.path,l.children,r,i,a,s))}else if(n.type===sp.ACK_USER_WRITE){l=n;o=l.revert?function(n,r,i,s,o,a){let c;{if(null!=fy(s,i))return r;{o=new wy(s,r,o);const u=r.eventCache.getNode();let t;if(_g(i)||".priority"===dg(i)){let e;e=r.serverCache.isFullyInitialized()?uy(s,$m(r)):(l=r.serverCache.getNode(),is(l instanceof em,"serverChildren would be complete if leaf node"),hy(s,l)),e,t=n.filter.updateFullNode(u,e,a)}else{var l=dg(i);let e=gy(s,l,r.serverCache);null==e&&r.serverCache.isCompleteForChild(l)&&(e=u.getImmediateChild(l)),t=null!=e?n.filter.updateChild(u,l,e,pg(i),o,a):r.eventCache.getNode().hasChild(l)?n.filter.updateChild(u,l,em.EMPTY_NODE,pg(i),o,a):u,t.isEmpty()&&r.serverCache.isFullyInitialized()&&(c=uy(s,$m(r)),c.isLeafNode()&&(t=n.filter.updateFullNode(t,c,a)))}return c=r.serverCache.isFullyInitialized()||null!=fy(s,hg()),Km(r,t,c,n.filter.filtersNodes())}}}(e,t,l.path,r,i,s):function(e,t,i,n,s,o,a){if(null!=fy(s,i))return t;const c=t.serverCache.isFiltered(),l=t.serverCache;{if(null!=n.value){if(_g(i)&&l.isFullyInitialized()||l.isCompleteForPath(i))return Ty(e,t,i,l.getNode().getChild(i),s,o,c,a);if(_g(i)){let n=new Gm(null);return l.getNode().forEachChild(xg,(e,t)=>{n=n.set(new ug(e),t)}),Cy(e,t,i,n,s,o,c,a)}return t}{let r=new Gm(null);return n.foreach((e,t)=>{var n=vg(i,e);l.isCompleteForPath(n)&&(r=r.set(e,l.getNode().getChild(n)))}),Cy(e,t,i,r,s,o,c,a)}}}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==sp.LISTEN_COMPLETE)throw ss("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache,o=zm(t,s.getNode(),s.isFullyInitialized()||_g(n),s.isFiltered());return Iy(e,o,n,r,_y,i)}(e,t,n.path,r,s)}r=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty();const s=Wm(e);(0<n.length||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(hm(Wm(t)))}}(t,o,r),{viewCache:o,changes:r}}function Iy(r,i,s,o,a,c){const l=i.eventCache;if(null!=fy(o,s))return i;{let t,n;if(_g(s)){var e;is(i.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t=i.serverCache.isFiltered()?(e=hy(o,(e=$m(i))instanceof em?e:em.EMPTY_NODE),r.filter.updateFullNode(i.eventCache.getNode(),e,c)):(u=uy(o,$m(i)),r.filter.updateFullNode(i.eventCache.getNode(),u,c))}else{var u=dg(s);if(".priority"===u){is(1===fg(s),"Can't have a priority with additional path components");var h=l.getNode();n=i.serverCache.getNode();var d=dy(o,s,h,n);t=null!=d?r.filter.updatePriority(h,d):l.getNode()}else{h=pg(s);let e;e=l.isCompleteForChild(u)?(n=i.serverCache.getNode(),null!=(d=dy(o,s,l.getNode(),n))?l.getNode().getImmediateChild(u).updateChild(h,d):l.getNode().getImmediateChild(u)):gy(o,u,i.serverCache),t=null!=e?r.filter.updateChild(l.getNode(),u,e,h,a,c):l.getNode()}}return Km(i,t,l.isFullyInitialized()||_g(s),r.filter.filtersNodes())}}function Ty(e,t,n,r,i,s,o,a){const c=t.serverCache;let l;const u=o?e.filter:e.filter.getIndexedFilter();if(_g(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),h,null)}else{o=dg(n);if(!c.isCompleteForPath(n)&&1<fg(n))return t;h=pg(n);const d=c.getNode().getImmediateChild(o);r=d.updateChild(h,r);l=".priority"===o?u.updatePriority(c.getNode(),r):u.updateChild(c.getNode(),o,r,h,_y,null)}t=zm(t,l,c.isFullyInitialized()||_g(n),u.filtersNodes());return Iy(e,t,n,i,new wy(i,t,s),a)}function Ey(t,n,r,i,e,s,o){const a=n.eventCache;let c,l;const u=new wy(e,n,s);if(_g(r))l=t.filter.updateFullNode(n.eventCache.getNode(),i,o),c=Km(n,l,!0,t.filter.filtersNodes());else{s=dg(r);if(".priority"===s)l=t.filter.updatePriority(n.eventCache.getNode(),i),c=Km(n,l,a.isFullyInitialized(),a.isFiltered());else{r=pg(r);const h=a.getNode().getImmediateChild(s);let e;if(_g(r))e=i;else{const d=u.getCompleteChild(s);e=null!=d?".priority"===gg(r)&&d.getChild(yg(r)).isEmpty()?d:d.updateChild(r,i):em.EMPTY_NODE}c=h.equals(e)?n:Km(n,t.filter.updateChild(a.getNode(),s,e,r,u,o),a.isFullyInitialized(),t.filter.filtersNodes())}}return c}function Sy(e,t){return e.eventCache.isCompleteForChild(t)}function ky(e,n,t){return t.foreach((e,t)=>{n=n.updateChild(e,t)}),n}function Cy(r,i,e,t,s,o,a,c){if(i.serverCache.getNode().isEmpty()&&!i.serverCache.isFullyInitialized())return i;let l=i,n;n=_g(e)?t:new Gm(null).setTree(e,t);const u=i.serverCache.getNode();return n.children.inorderTraversal((e,t)=>{u.hasChild(e)&&(t=ky(0,i.serverCache.getNode().getImmediateChild(e),t),l=Ty(r,l,new ug(e),t,s,o,a,c))}),n.children.inorderTraversal((e,t)=>{var n=!i.serverCache.isCompleteForChild(e)&&void 0===t.value;u.hasChild(e)||n||(t=ky(0,i.serverCache.getNode().getImmediateChild(e),t),l=Ty(r,l,new ug(e),t,s,o,a,c))}),l}class Ay{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new gm(n.getIndex()),i=(e=n).loadsAllData()?new gm(e.getIndex()):new(e.hasLimit()?ym:mm)(e);this.processor_={filter:i};const s=t.serverCache,o=t.eventCache;e=r.updateFullNode(em.EMPTY_NODE,s.getNode(),null),t=i.updateFullNode(em.EMPTY_NODE,o.getNode(),null),e=new Um(e,s.isFullyInitialized(),r.filtersNodes()),t=new Um(t,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=Bm(t,e),this.eventGenerator_=new jm(this.query_)}get query(){return this.query_}}function Ny(e){return 0===e.eventRegistrations_.length}function Ry(n,r,t){const i=[];if(t){is(null==r,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(e=>{e=e.createCancelEvent(t,s);e&&i.push(e)})}if(r){let t=[];for(let e=0;e<n.eventRegistrations_.length;++e){const o=n.eventRegistrations_[e];if(o.matches(r)){if(r.hasAnyCallback()){t=t.concat(n.eventRegistrations_.slice(e+1));break}}else t.push(o)}n.eventRegistrations_=t}else n.eventRegistrations_=[];return i}function Py(e,t,n,r){t.type===sp.MERGE&&null!==t.source.queryId&&(is($m(e.viewCache_),"We should always have a full cache before handling merges"),is(Wm(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=by(e.processor_,i,t,n,r);return n=e.processor_,r=s.viewCache,is(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),is(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),is(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,Oy(e,s.changes,s.viewCache.eventCache.getNode(),null)}function Oy(e,t,n,r){r=r?[r]:e.eventRegistrations_;return qm(e.eventGenerator_,t,n,r)}let xy;class Dy{constructor(){this.views=new Map}}function Ly(t,n,r,i){var e=n.source.queryId;if(null!==e){e=t.views.get(e);return is(null!=e,"SyncTree gave us an op for an invalid query."),Py(e,n,r,i)}{let e=[];for(const s of t.views.values())e=e.concat(Py(s,n,r,i));return e}}function My(e,n,r,i,s){var t=n._queryIdentifier,t=e.views.get(t);if(t)return t;{let e=uy(r,s?i:null),t=!1;t=!!e||(e=i instanceof em?hy(r,i):em.EMPTY_NODE,!1);s=Bm(new Um(e,t,!1),new Um(i,s,!1));return new Ay(n,s)}}function Fy(e,t,n,r,i,s){s=My(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,s),s.eventRegistrations_.push(n),function(e,t){const n=e.viewCache_.eventCache,r=[];if(!n.getNode().isLeafNode()){const i=n.getNode();i.forEachChild($g,(e,t)=>{r.push(dm(e,t))})}return n.isFullyInitialized()&&r.push(hm(n.getNode())),Oy(e,r,n.getNode(),t)}(s,n)}function Uy(e,t,n,r){var i=t._queryIdentifier;const s=[];let o=[];var a=Ky(e);if("default"===i)for(var[c,l]of e.views.entries())o=o.concat(Ry(l,n,r)),Ny(l)&&(e.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{const u=e.views.get(i);u&&(o=o.concat(Ry(u,n,r)),Ny(u)&&(e.views.delete(i),u.query._queryParams.loadsAllData()||s.push(u.query)))}return a&&!Ky(e)&&s.push((is(xy,"Reference.ts has not been loaded"),new xy(t._repo,t._path))),{removed:s,events:o}}function jy(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function qy(e,t){let n=null;for(const r of e.views.values())n=n||function(e,t){const n=$m(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!_g(t)&&!n.getImmediateChild(dg(t)).isEmpty())?n.getChild(t):null}(r,t);return n}function Vy(e,t){const n=t._queryParams;if(n.loadsAllData())return zy(e);t=t._queryIdentifier;return e.views.get(t)}function By(e,t){return null!=Vy(e,t)}function Ky(e){return null!=zy(e)}function zy(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Wy;let $y=1;class Hy{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Gm(null),this.pendingWriteTree_={visibleWrites:Qm.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Gy(e,t,n,r,i){var s,o,a,c;return s=e.pendingWriteTree_,o=t,a=n,c=i,is((r=r)>s.lastWriteId,"Stacking an older write on top of newer ones"),s.allWrites.push({path:o,snap:a,writeId:r,visible:c=void 0===c?!0:c}),c&&(s.visibleWrites=Ym(s.visibleWrites,o,a)),s.lastWriteId=r,i?nv(e,new Mm(Pm(),t,n)):[]}function Qy(e,t,n,r){var i,s,o;i=e.pendingWriteTree_,s=t,o=n,is((r=r)>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:s,children:o,writeId:r,visible:!0}),i.visibleWrites=Jm(i.visibleWrites,s,o),i.lastWriteId=r;n=Gm.fromObject(n);return nv(e,new Fm(Pm(),t,n))}function Yy(e,t,n=!1){var r=function(t,n){for(let e=0;e<t.allWrites.length;e++){var r=t.allWrites[e];if(r.writeId===n)return r}return null}(e.pendingWriteTree_,t);if(oy(e.pendingWriteTree_,t)){let t=new Gm(null);return null!=r.snap?t=t.set(hg(),!0):Pp(r.children,e=>{t=t.set(new ug(e),!0)}),nv(e,new Dm(r.path,t,n))}return[]}function Jy(e,t,n){return nv(e,new Mm(Om(),t,n))}function Xy(n,e,t,r){var i=e._path,s=n.syncPointTree_.get(i);let o=[];if(s&&("default"===e._queryIdentifier||By(s,e))){t=Uy(s,e,t,r);0===s.views.size&&(n.syncPointTree_=n.syncPointTree_.remove(i));const u=t.removed;o=t.events;s=-1!==u.findIndex(e=>e._queryParams.loadsAllData()),t=n.syncPointTree_.findOnPath(i,(e,t)=>Ky(t));if(s&&!t){const h=n.syncPointTree_.subtree(i);if(!h.isEmpty()){var a=h.fold((e,t,r)=>{if(t&&Ky(t))return[zy(t)];{let n=[];return t&&(n=jy(t)),Pp(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<a.length;++e){var c=a[e],l=c.query,c=iv(n,c);n.listenProvider_.startListening(uv(l),sv(n,l),c.hashFn,c.onComplete)}}}!t&&0<u.length&&!r&&(s?(s=null,n.listenProvider_.stopListening(uv(e),s)):u.forEach(e=>{var t=n.queryToTagMap.get(ov(e));n.listenProvider_.stopListening(uv(e),t)})),function(t,n){for(let e=0;e<n.length;++e){const s=n[e];var r,i;s._queryParams.loadsAllData()||(r=ov(s),i=t.queryToTagMap.get(r),t.queryToTagMap.delete(r),t.tagToQueryMap.delete(i))}}(n,u)}return o}function Zy(e,t,n){const r=t._path;let i=null,s=!1;e.syncPointTree_.foreachOnPath(r,(e,t)=>{e=wg(e,r);i=i||qy(t,e),s=s||Ky(t)});let o=e.syncPointTree_.get(r);o?(s=s||Ky(o),i=i||qy(o,hg())):(o=new Dy,e.syncPointTree_=e.syncPointTree_.set(r,o));let a;if(null!=i)a=!0;else{a=!1,i=em.EMPTY_NODE;const d=e.syncPointTree_.subtree(r);d.foreachChild((e,t)=>{t=qy(t,hg());t&&(i=i.updateImmediateChild(e,t))})}var c,l=By(o,t);l||t._queryParams.loadsAllData()||(u=ov(t),is(!e.queryToTagMap.has(u),"View does not exist, but we have a tag"),c=$y++,e.queryToTagMap.set(u,c),e.tagToQueryMap.set(c,u));var u=sy(e.pendingWriteTree_,r);let h=Fy(o,t,n,u,i,a);return l||s||(l=Vy(o,t),h=h.concat(function(t,e,n){const r=e._path,i=sv(t,e),s=iv(t,n),o=t.listenProvider_.startListening(uv(e),i,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(r);if(i)is(!Ky(a.value),"If we're adding a query, it shouldn't be shadowed");else{var c=a.fold((e,t,r)=>{if(!_g(e)&&t&&Ky(t))return[zy(t).query];{let n=[];return t&&(n=n.concat(jy(t).map(e=>e.query))),Pp(r,(e,t)=>{n=n.concat(t)}),n}});for(let e=0;e<c.length;++e){var l=c[e];t.listenProvider_.stopListening(uv(l),sv(t,l))}}return o}(e,t,l))),h}function ev(e,n,t){var r=e.pendingWriteTree_,e=e.syncPointTree_.findOnPath(n,(e,t)=>{e=qy(t,wg(e,n));if(e)return e});return ly(r,n,e,t,!0)}function tv(e,t){const n=t._path;let r=null;e.syncPointTree_.foreachOnPath(n,(e,t)=>{e=wg(e,n);r=r||qy(t,e)});let i=e.syncPointTree_.get(n);i?r=r||qy(i,hg()):(i=new Dy,e.syncPointTree_=e.syncPointTree_.set(n,i));var s=null!=r;const o=s?new Um(r,!0,!1):null;e=sy(e.pendingWriteTree_,t._path);return Wm(My(i,t,e,s?o.getNode():em.EMPTY_NODE,s).viewCache_)}function nv(e,t){return function t(n,r,i,s){{if(_g(n.path))return rv(n,r,i,s);{const o=r.get(hg());null==i&&null!=o&&(i=qy(o,hg()));let e=[];const a=dg(n.path),c=n.operationForChild(a),l=r.children.get(a);if(l&&c){const u=i?i.getImmediateChild(a):null,h=my(s,a);e=e.concat(t(c,l,u,h))}return o&&(e=e.concat(Ly(o,n,s,i))),e}}}(t,e.syncPointTree_,null,sy(e.pendingWriteTree_,hg()))}function rv(i,e,s,o){var t=e.get(hg());null==s&&null!=t&&(s=qy(t,hg()));let a=[];return e.children.inorderTraversal((e,t)=>{var n=s?s.getImmediateChild(e):null,r=my(o,e),e=i.operationForChild(e);e&&(a=a.concat(rv(e,t,n,r)))}),t&&(a=a.concat(Ly(t,i,o,s))),a}function iv(r,t){const i=t.query,s=sv(r,i);return{hashFn:()=>{const e=t.viewCache_.serverCache.getNode()||em.EMPTY_NODE;return e.hash()},onComplete:e=>{if("ok"===e)return s?function(e,t,n){var r=av(e,n);if(r){n=cv(r),r=n.path,n=n.queryId,t=wg(r,t);return lv(e,r,new Lm(xm(n),t))}return[]}(r,i._path,s):(t=r,n=i._path,nv(t,new Lm(Om(),n)));var t,n,e=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,i);return Xy(r,i,null,e)}}}function sv(e,t){t=ov(t);return e.queryToTagMap.get(t)}function ov(e){return e._path.toString()+"$"+e._queryIdentifier}function av(e,t){return e.tagToQueryMap.get(t)}function cv(e){var t=e.indexOf("$");return is(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new ug(e.substr(0,t))}}function lv(e,t,n){var r=e.syncPointTree_.get(t);return is(r,"Missing sync point for query tag that we're tracking"),Ly(r,n,sy(e.pendingWriteTree_,t),null)}function uv(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(is(Wy,"Reference.ts has not been loaded"),new Wy(e._repo,e._path)):e}class hv{constructor(e){this.node_=e}getImmediateChild(e){e=this.node_.getImmediateChild(e);return new hv(e)}node(){return this.node_}}class dv{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){e=vg(this.path_,e);return new dv(this.syncTree_,e)}node(){return ev(this.syncTree_,this.path_)}}const fv=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},pv=function(e,t,n){return e&&"object"==typeof e?(is(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?gv(e[".sv"],t,n):"object"==typeof e[".sv"]?mv(e[".sv"],t):void is(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},gv=function(e,t,n){if("timestamp"===e)return n.timestamp;is(!1,"Unexpected server value: "+e)},mv=function(e,t,n){e.hasOwnProperty("increment")||is(!1,"Unexpected server value: "+JSON.stringify(e,null,2));e=e.increment;"number"!=typeof e&&is(!1,"Unexpected increment value: "+e);const r=t.node();if(is(null!==r&&void 0!==r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return e;const i=r;t=i.getValue();return"number"!=typeof t?e:t+e},yv=function(e,t,n,r){return _v(t,new dv(n,e),r)},vv=function(e,t,n){return _v(e,new hv(t),n)};function _v(e,r,i){var t=e.getPriority().val(),n=pv(t,r.getImmediateChild(".priority"),i);let s;if(e.isLeafNode()){const o=e;t=pv(o.getValue(),r,i);return t!==o.getValue()||n!==o.getPriority().val()?new Kg(t,im(n)):e}{const a=e;return s=a,n!==a.getPriority().val()&&(s=s.updatePriority(new Kg(n))),a.forEachChild($g,(e,t)=>{var n=_v(t,r.getImmediateChild(e),i);n!==t&&(s=s.updateImmediateChild(e,n))}),s}}class wv{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function bv(e,t){let n=t instanceof ug?t:new ug(t),r=e,i=dg(n);for(;null!==i;){var s=Ds(r.node.children,i)||{children:{},childCount:0};r=new wv(i,r,s),n=pg(n),i=dg(n)}return r}function Iv(e){return e.node.value}function Tv(e,t){e.node.value=t,Cv(e)}function Ev(e){return 0<e.node.childCount}function Sv(n,r){Pp(n.node.children,(e,t)=>{r(new wv(e,n,t))})}function kv(e){return new ug(null===e.parent?e.name:kv(e.parent)+"/"+e.name)}function Cv(e){var t,n,r,i;null!==e.parent&&(t=e.parent,n=e.name,i=function(e){return void 0===Iv(e)&&!Ev(e)}(r=e),e=xs(t.node.children,n),i&&e?(delete t.node.children[n],t.node.childCount--,Cv(t)):i||e||(t.node.children[n]=r.node,t.node.childCount++,Cv(t)))}const Av=/[\[\].#$\/\u0000-\u001F\u007F]/,Nv=/[\[\].#$\u0000-\u001F\u007F]/,Rv=10485760,Pv=function(e){return"string"==typeof e&&0!==e.length&&!Av.test(e)},Ov=function(e){return"string"==typeof e&&0!==e.length&&!Nv.test(e)},xv=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!Tp(e)||e&&"object"==typeof e&&xs(e,".sv")},Dv=function(e,t,n,r){r&&void 0===t||Lv(Qs(e,"value"),t,n)},Lv=function(s,e,t){const o=t instanceof ug?new Eg(t,s):t;if(void 0===e)throw new Error(s+"contains undefined "+kg(o));if("function"==typeof e)throw new Error(s+"contains a function "+kg(o)+" with contents = "+e.toString());if(Tp(e))throw new Error(s+"contains "+e.toString()+" "+kg(o));if("string"==typeof e&&e.length>Rv/3&&Xs(e)>Rv)throw new Error(s+"contains a string greater than "+Rv+" utf8 bytes "+kg(o)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let r=!1,i=!1;if(Pp(e,(e,t)=>{if(".value"===e)r=!0;else if(".priority"!==e&&".sv"!==e&&(i=!0,!Pv(e)))throw new Error(s+" contains an invalid key ("+e+") "+kg(o)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var n;n=o,e=e,0<n.parts_.length&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Xs(e),Sg(n),Lv(s,t,o),n=o,t=n.parts_.pop(),n.byteLength_-=Xs(t),0<n.parts_.length&&--n.byteLength_}),r&&i)throw new Error(s+' contains ".value" child '+kg(o)+" in addition to actual children.")}},Mv=function(e,t,r,n){if(!n||void 0!==t){const i=Qs(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];Pp(t,(e,t)=>{const n=new ug(e);if(Lv(i,t,vg(r,n)),".priority"===gg(n)&&!xv(t))throw new Error(i+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)}),function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];var i=mg(r);for(let e=0;e<i.length;e++)if((".priority"!==i[e]||e!==i.length-1)&&!Pv(i[e]))throw new Error(t+"contains an invalid key ("+i[e]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}e.sort(bg);let s=null;for(n=0;n<e.length;n++){if(r=e[n],null!==s&&Tg(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(i,s)}},Fv=function(e,t,n){if(!n||void 0!==t){if(Tp(t))throw new Error(Qs(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!xv(t))throw new Error(Qs(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Uv=function(e,t,n,r){if(!(r&&void 0===n||Pv(n)))throw new Error(Qs(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},jv=function(e,t,n,r){if(!(r&&void 0===n||Ov(n)))throw new Error(Qs(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},qv=function(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),jv(e,t,n,r)},Vv=function(e,t){if(".info"===dg(t))throw new Error(e+" failed = Can't modify data under /.info/")},Bv=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Pv(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&(n=(n=n)&&n.replace(/^\/*\.info(\/|$)/,"/"),!Ov(n)))throw new Error(Qs(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Kv{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function zv(t,n){let r=null;for(let e=0;e<n.length;e++){const s=n[e];var i=s.getPath();null===r||Ig(i,r.path)||(t.eventLists_.push(r),r=null),null===r&&(r={events:[],path:i}),r.events.push(s)}r&&t.eventLists_.push(r)}function Wv(e,t,n){zv(e,n),Hv(e,e=>Ig(e,t))}function $v(e,t,n){zv(e,n),Hv(e,e=>Tg(e,t)||Tg(t,e))}function Hv(t,n){t.recursionDepth_++;let r=!0;for(let e=0;e<t.eventLists_.length;e++){var i=t.eventLists_[e];i&&(n(i.path)?(function(t){for(let e=0;e<t.events.length;e++){const r=t.events[e];var n;null!==r&&(t.events[e]=null,n=r.getEventRunner(),gp&&vp("event: "+r.toString()),Fp(n))}}(t.eventLists_[e]),t.eventLists_[e]=null):r=!1)}r&&(t.eventLists_=[]),t.recursionDepth_--}const Gv="repo_interrupt",Qv=25;class Yv{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Kv,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=km(),this.transactionQueueTree_=new wv,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Jv(o,e,t){if(o.stats_=Jp(o.repoInfo_),o.forceRestClient_||Up())o.server_=new Em(o.repoInfo_,(e,t,n,r)=>{e_(o,e,t,n,r)},o.authTokenProvider_,o.appCheckProvider_),setTimeout(()=>t_(o,!0),0);else{if(null!=t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ps(t)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}o.persistentConnection_=new Ag(o.repoInfo_,e,(e,t,n,r)=>{e_(o,e,t,n,r)},e=>{t_(o,e)},e=>{var n;n=o,Pp(e,(e,t)=>{n_(n,e,t)})},o.authTokenProvider_,o.appCheckProvider_,t),o.server_=o.persistentConnection_}o.authTokenProvider_.addTokenChangeListener(e=>{o.server_.refreshAuthToken(e)}),o.appCheckProvider_.addTokenChangeListener(e=>{o.server_.refreshAppCheckToken(e.token)}),o.statsReporter_=(e=o.repoInfo_,t=()=>new Rm(o.stats_,o.server_),e=e.toString(),Yp[e]||(Yp[e]=t()),Yp[e]),o.infoData_=new Sm,o.infoSyncTree_=new Hy({startListening:(e,t,n,r)=>{let i=[];const s=o.infoData_.getNode(e._path);return s.isEmpty()||(i=Jy(o.infoSyncTree_,e._path,s),setTimeout(()=>{r("ok")},0)),i},stopListening:()=>{}}),n_(o,"connected",!1),o.serverSyncTree_=new Hy({startListening:(n,e,t,r)=>(o.server_.listen(n,t,e,(e,t)=>{t=r(e,t);$v(o.eventQueue_,n._path,t)}),[]),stopListening:(e,t)=>{o.server_.unlisten(e,t)}})}function Xv(e){const t=e.infoData_.getNode(new ug(".info/serverTimeOffset"));e=t.val()||0;return(new Date).getTime()+e}function Zv(e){return fv({timestamp:Xv(e)})}function e_(e,t,n,r,i){e.dataUpdateCount++;var s,o,a,c=new ug(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let l=[];l=i?r?(s=Ms(n,e=>im(e)),function(e,t,n,r){var i=av(e,r);if(i){r=cv(i),i=r.path,r=r.queryId,t=wg(i,t),n=Gm.fromObject(n);return lv(e,i,new Fm(xm(r),t,n))}return[]}(e.serverSyncTree_,c,s,i)):(t=im(n),s=e.serverSyncTree_,o=c,a=t,null==(i=av(s,t=i))?[]:(t=cv(i),i=t.path,t=t.queryId,o=wg(i,o),lv(s,i,new Mm(xm(t),o,a)))):r?(o=Ms(n,e=>im(e)),a=e.serverSyncTree_,r=c,o=o,o=Gm.fromObject(o),nv(a,new Fm(Om(),r,o))):(n=im(n),Jy(e.serverSyncTree_,c,n));let u=c;0<l.length&&(u=f_(e,c)),$v(e.eventQueue_,u,l)}function t_(e,t){n_(e,"connected",t),!1===t&&function(n){l_(n,"onDisconnectEvents");const r=Zv(n),i=km();Am(n.onDisconnect_,hg(),(e,t)=>{t=yv(e,t,n.serverSyncTree_,r);Cm(i,e,t)});let s=[];Am(i,hg(),(e,t)=>{s=s.concat(Jy(n.serverSyncTree_,e,t));e=y_(n,e);f_(n,e)}),n.onDisconnect_=km(),$v(n.eventQueue_,hg(),s)}(e)}function n_(e,t,n){t=new ug("/.info/"+t),n=im(n);e.infoData_.updateSnapshot(t,n);n=Jy(e.infoSyncTree_,t,n);$v(e.eventQueue_,t,n)}function r_(e){return e.nextWriteId_++}function i_(r,i,e,t,s){l_(r,"set",{path:i.toString(),value:e,priority:t});var n=Zv(r);const o=im(e,t);t=ev(r.serverSyncTree_,i),n=vv(o,t,n);const a=r_(r);n=Gy(r.serverSyncTree_,i,n,a,!0);zv(r.eventQueue_,n),r.server_.put(i.toString(),o.val(!0),(e,t)=>{var n="ok"===e;n||Ip("set at "+i+" failed: "+e);n=Yy(r.serverSyncTree_,a,!n);$v(r.eventQueue_,i,n),u_(0,s,e,t)});n=y_(r,i);f_(r,n),$v(r.eventQueue_,n,[])}function s_(n,r,i){n.server_.onDisconnectCancel(r.toString(),(e,t)=>{"ok"===e&&!function e(n,t){if(_g(t))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const i=n.value;return n.value=null,i.forEachChild($g,(e,t)=>{Cm(n,new ug(e),t)}),e(n,t)}}if(0<n.children.size){var r=dg(t);return t=pg(t),n.children.has(r)&&e(n.children.get(r),t)&&n.children.delete(r),0===n.children.size}return!0}(n.onDisconnect_,r),u_(0,i,e,t)})}function o_(n,r,e,i){const s=im(e);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&Cm(n.onDisconnect_,r,s),u_(0,i,e,t)})}function a_(e,t,n){let r;r=".info"===dg(t._path)?Xy(e.infoSyncTree_,t,n):Xy(e.serverSyncTree_,t,n),Wv(e.eventQueue_,t._path,r)}function c_(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Gv)}function l_(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),vp(n,...t)}function u_(e,r,i,s){r&&Fp(()=>{if("ok"===i)r(null);else{var t=(i||"error").toUpperCase();let e=t;s&&(e+=": "+s);const n=new Error(e);n.code=t,r(n)}})}function h_(e,t,n){return ev(e.serverSyncTree_,t,n)||em.EMPTY_NODE}function d_(t,e=t.transactionQueueTree_){if(e||m_(t,e),Iv(e)){const n=g_(t,e);is(0<n.length,"Sending zero length transaction queue"),n.every(e=>0===e.status)&&function(i,s,o){const e=o.map(e=>e.currentWriteId),t=h_(i,s,e);let n=t;var r=t.hash();for(let e=0;e<o.length;e++){const u=o[e];is(0===u.status,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;var a=wg(s,u.path);n=n.updateChild(a,u.currentOutputSnapshotRaw)}const c=n.val(!0),l=s;i.server_.put(l.toString(),c,t=>{l_(i,"transaction put response",{path:l.toString(),status:t});let n=[];if("ok"===t){const r=[];for(let e=0;e<o.length;e++)o[e].status=2,n=n.concat(Yy(i.serverSyncTree_,o[e].currentWriteId)),o[e].onComplete&&r.push(()=>o[e].onComplete(null,!0,o[e].currentOutputSnapshotResolved)),o[e].unwatcher();m_(i,bv(i.transactionQueueTree_,s)),d_(i,i.transactionQueueTree_),$v(i.eventQueue_,s,n);for(let e=0;e<r.length;e++)Fp(r[e])}else{if("datastale"===t)for(let e=0;e<o.length;e++)3===o[e].status?o[e].status=4:o[e].status=0;else{Ip("transaction at "+l.toString()+" failed: "+t);for(let e=0;e<o.length;e++)o[e].status=4,o[e].abortReason=t}f_(i,s)}},r)}(t,kv(e),n)}else Ev(e)&&Sv(e,e=>{d_(t,e)})}function f_(e,t){var n=p_(e,t),t=kv(n);return function(i,s,o){if(0!==s.length){const l=[];let r=[];const e=s.filter(e=>0===e.status),u=e.map(e=>e.currentWriteId);for(let n=0;n<s.length;n++){const h=s[n];var a=wg(o,h.path);let e=!1,t;if(is(null!==a,"rerunTransactionsUnderNode_: relativePath should not be null."),4===h.status)e=!0,t=h.abortReason,r=r.concat(Yy(i.serverSyncTree_,h.currentWriteId,!0));else if(0===h.status)if(h.retryCount>=Qv)e=!0,t="maxretry",r=r.concat(Yy(i.serverSyncTree_,h.currentWriteId,!0));else{const d=h_(i,h.path,u);h.currentInputSnapshot=d;var c=s[n].update(d.val());if(void 0!==c){Lv("transaction failed: Data returned ",c,h.path);let e=im(c);"object"==typeof c&&null!=c&&xs(c,".priority")||(e=e.updatePriority(d.getPriority()));a=h.currentWriteId,c=Zv(i),c=vv(e,d,c);h.currentOutputSnapshotRaw=e,h.currentOutputSnapshotResolved=c,h.currentWriteId=r_(i),u.splice(u.indexOf(a),1),r=r.concat(Gy(i.serverSyncTree_,h.path,c,h.currentWriteId,h.applyLocally)),r=r.concat(Yy(i.serverSyncTree_,a,!0))}else e=!0,t="nodata",r=r.concat(Yy(i.serverSyncTree_,h.currentWriteId,!0))}$v(i.eventQueue_,o,r),r=[],e&&(s[n].status=2,function(e){setTimeout(e,Math.floor(0))}(s[n].unwatcher),s[n].onComplete&&("nodata"===t?l.push(()=>s[n].onComplete(null,!1,s[n].currentInputSnapshot)):l.push(()=>s[n].onComplete(new Error(t),!1,null))))}m_(i,i.transactionQueueTree_);for(let e=0;e<l.length;e++)Fp(l[e]);d_(i,i.transactionQueueTree_)}}(e,g_(e,n),t),t}function p_(e,t){let n,r=e.transactionQueueTree_;for(n=dg(t);null!==n&&void 0===Iv(r);)r=bv(r,n),t=pg(t),n=dg(t);return r}function g_(e,t){const n=[];return function t(n,e,r){const i=Iv(e);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);Sv(e,e=>{t(n,e,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function m_(t,e){const n=Iv(e);if(n){let t=0;for(let e=0;e<n.length;e++)2!==n[e].status&&(n[t]=n[e],t++);n.length=t,Tv(e,0<n.length?n:void 0)}Sv(e,e=>{m_(t,e)})}function y_(t,e){var n=kv(p_(t,e)),e=bv(t.transactionQueueTree_,e);return function(e,t,n){let r=n?e:e.parent;for(;null!==r;){if(t(r))return;r=r.parent}}(e,e=>{v_(t,e)}),v_(t,e),function t(e,n,r,i){r&&!i&&n(e),Sv(e,e=>{t(e,n,!0,i)}),r&&i&&n(e)}(e,e=>{v_(t,e)}),n}function v_(r,e){const i=Iv(e);if(i){const s=[];let t=[],n=-1;for(let e=0;e<i.length;e++)3===i[e].status||(1===i[e].status?(is(n===e-1,"All SENT items should be at beginning of queue."),n=e,i[e].status=3,i[e].abortReason="set"):(is(0===i[e].status,"Unexpected transaction status in abort"),i[e].unwatcher(),t=t.concat(Yy(r.serverSyncTree_,i[e].currentWriteId,!0)),i[e].onComplete&&s.push(i[e].onComplete.bind(null,new Error("set"),!1,null))));-1===n?Tv(e,void 0):i.length=n+1,$v(r.eventQueue_,kv(e),t);for(let e=0;e<s.length;e++)Fp(s[e])}}const __=function(e,t){var n=w_(e),r=n.namespace;"firebase.com"===n.domain&&bp(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||bp("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Ip("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");e="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new $p(n.host,n.secure,r,t,e,"",r!==n.subdomain),path:new ug(n.pathString)}},w_=function(r){let i="",s="",o="",a="",c="",l=!0,u="https",h=443;if("string"==typeof r){let e=r.indexOf("//");0<=e&&(u=r.substring(0,e-1),r=r.substring(e+2));let t=r.indexOf("/");-1===t&&(t=r.length);let n=r.indexOf("?");-1===n&&(n=r.length),i=r.substring(0,Math.min(t,n)),t<n&&(a=function(e){let n="";var r=e.split("/");for(let t=0;t<r.length;t++)if(0<r[t].length){let e=r[t];try{e=decodeURIComponent(e.replace(/\+/g," "))}catch(e){}n+="/"+e}return n}(r.substring(t,n)));var d=function(e){const t={};for(const r of(e="?"===e.charAt(0)?e.substring(1):e).split("&")){var n;0!==r.length&&(2===(n=r.split("=")).length?t[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Ip(`Invalid query segment '${r}' in query '${e}'`))}return t}(r.substring(Math.min(r.length,n)));e=i.indexOf(":"),0<=e?(l="https"===u||"wss"===u,h=parseInt(i.substring(e+1),10)):e=i.length;const f=i.slice(0,e);"localhost"===f.toLowerCase()?s="localhost":f.split(".").length<=2?s=f:(r=i.indexOf("."),o=i.substring(0,r).toLowerCase(),s=i.substring(r+1),c=o),"ns"in d&&(c=d.ns)}return{host:i,port:h,domain:s,subdomain:o,secure:l,scheme:u,pathString:a,namespace:c}};class b_{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ps(this.snapshot.exportVal())}}class I_{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class T_{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return is(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class E_{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new us;return s_(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Vv("OnDisconnect.remove",this._path);const e=new us;return o_(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Vv("OnDisconnect.set",this._path),Dv("OnDisconnect.set",e,this._path,!1);const t=new us;return o_(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Vv("OnDisconnect.setWithPriority",this._path),Dv("OnDisconnect.setWithPriority",e,this._path,!1),Fv("OnDisconnect.setWithPriority",t,!1);const n=new us;return function(n,r,e,t,i){const s=im(e,t);n.server_.onDisconnectPut(r.toString(),s.val(!0),(e,t)=>{"ok"===e&&Cm(n.onDisconnect_,r,s),u_(0,i,e,t)})}(this._repo,this._path,e,t,n.wrapCallback(()=>{})),n.promise}update(e){Vv("OnDisconnect.update",this._path),Mv("OnDisconnect.update",e,this._path,!1);const t=new us;return function(n,r,i,s){if(Ls(i))return vp("onDisconnect().update() called with empty data.  Don't do anything."),u_(0,s,"ok",void 0);n.server_.onDisconnectMerge(r.toString(),i,(e,t)=>{"ok"===e&&Pp(i,(e,t)=>{t=im(t);Cm(n.onDisconnect_,vg(r,e),t)}),u_(0,s,e,t)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class S_{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return _g(this._path)?null:gg(this._path)}get ref(){return new N_(this._repo,this._path)}get _queryIdentifier(){var e=Tm(this._queryParams),e=Np(e);return"{}"===e?"default":e}get _queryObject(){return Tm(this._queryParams)}isEqual(e){if(!((e=io(e))instanceof S_))return!1;var t=this._repo===e._repo,n=Ig(this._path,e._path),e=this._queryIdentifier===e._queryIdentifier;return t&&n&&e}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(t){let n="";for(let e=t.pieceNum_;e<t.pieces_.length;e++)""!==t.pieces_[e]&&(n+="/"+encodeURIComponent(String(t.pieces_[e])));return n||"/"}(this._path)}}function k_(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function C_(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===xg){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==Ep)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==Sp)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===$g){if(null!=t&&!xv(t)||null!=n&&!xv(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(is(e.getIndex()instanceof sm||e.getIndex()===om,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function A_(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class N_ extends S_{constructor(e,t){super(e,t,new vm,!1)}get parent(){var e=yg(this._path);return null===e?null:new N_(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class R_{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){var t=new ug(e),e=x_(this.ref,e);return new R_(this._node.getChild(t),e,$g)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(n){if(this._node.isLeafNode())return!1;const e=this._node;return!!e.forEachChild(this._index,(e,t)=>n(new R_(t,x_(this.ref,e),$g)))}hasChild(e){e=new ug(e);return!this._node.getChild(e).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function P_(e,t){return(e=io(e))._checkNotDeleted("ref"),void 0!==t?x_(e._root,t):e._root}function O_(e,t){(e=io(e))._checkNotDeleted("refFromURL");const n=__(t,e._repo.repoInfo_.nodeAdmin);Bv("refFromURL",n);t=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||t.host===e._repo.repoInfo_.host||bp("refFromURL: Host name does not match the current database: (found "+t.host+" but expected "+e._repo.repoInfo_.host+")"),P_(e,n.path.toString())}function x_(e,t){return(null===dg((e=io(e))._path)?qv:jv)("child","path",t,!1),new N_(e._repo,vg(e._path,t))}function D_(e,t){e=io(e),Vv("set",e._path),Dv("set",t,e._path,!1);const n=new us;return i_(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}function L_(e,t){Mv("update",t,e._path,!1);const n=new us;return function(i,s,e,o){l_(i,"update",{path:s.toString(),value:e});let n=!0;const r=Zv(i),a={};if(Pp(e,(e,t)=>{n=!1,a[e]=yv(vg(s,e),im(t),i.serverSyncTree_,r)}),n)vp("update() called with empty data.  Don't do anything."),u_(0,o,"ok",void 0);else{const c=r_(i);var t=Qy(i.serverSyncTree_,s,a,c);zv(i.eventQueue_,t),i.server_.merge(s.toString(),e,(e,t)=>{var n="ok"===e;n||Ip("update at "+s+" failed: "+e);var r=Yy(i.serverSyncTree_,c,!n),n=0<r.length?f_(i,s):s;$v(i.eventQueue_,n,r),u_(0,o,e,t)}),Pp(e,e=>{e=y_(i,vg(s,e));f_(i,e)}),$v(i.eventQueue_,s,[])}}(e._repo,e._path,t,n.wrapCallback(()=>{})),n.promise}function M_(t){return t=io(t),n=t._repo,r=t,(null!=(e=tv(n.serverSyncTree_,r))?Promise.resolve(e):n.server_.get(r).then(e=>{var t=im(e).withIndex(r._queryParams.getIndex()),e=Jy(n.serverSyncTree_,r._path,t);return Wv(n.eventQueue_,r._path,e),Promise.resolve(t)},e=>(l_(n,"get for query "+Ps(r)+" failed: "+e),Promise.reject(new Error(e))))).then(e=>new R_(e,new N_(t._repo,t._path),t._queryParams.getIndex()));var n,r,e}class F_{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){var n=t._queryParams.getIndex();return new b_("value",this,new R_(e.snapshotNode,new N_(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new I_(this,e,t):null}matches(e){return e instanceof F_&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class U_{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new I_(this,e,t):null}createEvent(e,t){is(null!=e.childName,"Child events should have a childName.");var n=x_(new N_(t._repo,t._path),e.childName),t=t._queryParams.getIndex();return new b_(e.type,this,new R_(e.snapshotNode,n,t),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof U_&&(this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)))}hasAnyCallback(){return!!this.callbackContext}}function j_(n,e,t,r,i){let s;if("object"==typeof r&&(s=void 0,i=r),"function"==typeof r&&(s=r),i&&i.onlyOnce){const a=t;i=(e,t)=>{a_(n._repo,n,o),a(e,t)};i.userCallback=t.userCallback,i.context=t.context,t=i}t=new T_(t,s||void 0);const o="value"===e?new F_(t):new U_(e,t);return function(e,t,n){let r;r=".info"===dg(t._path)?Zy(e.infoSyncTree_,t,n):Zy(e.serverSyncTree_,t,n),Wv(e.eventQueue_,t._path,r)}(n._repo,n,o),()=>a_(n._repo,n,o)}function q_(e,t,n,r){return j_(e,"value",t,n,r)}function V_(e,t,n,r){return j_(e,"child_added",t,n,r)}function B_(e,t,n,r){return j_(e,"child_changed",t,n,r)}function K_(e,t,n,r){return j_(e,"child_moved",t,n,r)}function z_(e,t,n,r){return j_(e,"child_removed",t,n,r)}function W_(e,t,n){let r=null;n=n?new T_(n):null;"value"===t?r=new F_(n):t&&(r=new U_(t,n)),a_(e._repo,e,r)}class $_{}class H_ extends $_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Dv("endAt",this._value,e._path,!0);var t=wm(e._queryParams,this._value,this._key);if(A_(t),C_(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new S_(e._repo,e._path,t,e._orderByCalled)}}class G_ extends $_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Dv("endBefore",this._value,e._path,!1);var t=function(e,t,n){let r,i;return i=e.index_===xg?wm(e,t="string"==typeof t?um(t):t,n):(r=null==n?Ep:um(n),wm(e,t,r)),i.endBeforeSet_=!0,i}(e._queryParams,this._value,this._key);if(A_(t),C_(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new S_(e._repo,e._path,t,e._orderByCalled)}}class Q_ extends $_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Dv("startAt",this._value,e._path,!0);var t=_m(e._queryParams,this._value,this._key);if(A_(t),C_(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new S_(e._repo,e._path,t,e._orderByCalled)}}class Y_ extends $_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Dv("startAfter",this._value,e._path,!1);var t=function(t,n,r){let i;if(t.index_===xg)"string"==typeof n&&(n=lm(n)),i=_m(t,n,r);else{let e;e=null==r?Sp:lm(r),i=_m(t,n,e)}return i.startAfterSet_=!0,i}(e._queryParams,this._value,this._key);if(A_(t),C_(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new S_(e._repo,e._path,t,e._orderByCalled)}}class J_ extends $_{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new S_(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="l",n}(e._queryParams,this._limit),e._orderByCalled)}}class X_ extends $_{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new S_(e._repo,e._path,function(e,t){const n=e.copy();return n.limitSet_=!0,n.limit_=t,n.viewFrom_="r",n}(e._queryParams,this._limit),e._orderByCalled)}}class Z_ extends $_{constructor(e){super(),this._path=e}_apply(e){k_(e,"orderByChild");var t=new ug(this._path);if(_g(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");t=new sm(t),t=bm(e._queryParams,t);return C_(t),new S_(e._repo,e._path,t,!0)}}class ew extends $_{_apply(e){k_(e,"orderByKey");var t=bm(e._queryParams,xg);return C_(t),new S_(e._repo,e._path,t,!0)}}class tw extends $_{_apply(e){k_(e,"orderByPriority");var t=bm(e._queryParams,$g);return C_(t),new S_(e._repo,e._path,t,!0)}}class nw extends $_{_apply(e){k_(e,"orderByValue");var t=bm(e._queryParams,om);return C_(t),new S_(e._repo,e._path,t,!0)}}class rw extends $_{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(Dv("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new H_(this._value,this._key)._apply(new Q_(this._value,this._key)._apply(e))}}function iw(e,...t){let n=io(e);for(const r of t)n=r._apply(n);return n}op=N_,is(!xy,"__referenceConstructor has already been defined"),xy=op,ap=N_,is(!Wy,"__referenceConstructor has already been defined"),Wy=ap;const sw="FIREBASE_DATABASE_EMULATOR_HOST",ow={};let aw=!1;function cw(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||bp("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),vp("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o=__(s,i),a=o.repoInfo,c,l=void 0;"undefined"!=typeof process&&(l=process.env[sw]),l?(c=!0,s=`http://${l}?ns=${a.namespace}`,o=__(s,i),a=o.repoInfo):c=!o.repoInfo.secure;t=i&&c?new Bp(Bp.OWNER):new Vp(e.name,e.options,t);Bv("Invalid Firebase Database URL",o),_g(o.path)||bp("Database URL must point to the root of a Firebase Database (not including a child path).");n=function(e,t,n,r){let i=ow[t.name];i||(i={},ow[t.name]=i);t=i[e.toURLString()];t&&bp("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return t=new Yv(e,aw,n,r),i[e.toURLString()]=t}(a,e,t,new qp(e.name,n));return new lw(n,e)}class lw{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Jv(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new N_(this._repo,hg())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=ow[t];n&&n[e.key]===e||bp(`Database ${t}(${e.repoInfo_}) has already been deleted.`),c_(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&bp("Cannot call "+e+" on a deleted database.")}}function uw(e,t,n,r={}){(e=io(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&bp("Cannot call useEmulator() after instance has already been initialized.");var i,s=e._repoInternal;let o=void 0;s.repoInfo_.nodeAdmin?(r.mockUserToken&&bp('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Bp(Bp.OWNER)):r.mockUserToken&&(i="string"==typeof r.mockUserToken?r.mockUserToken:ds(r.mockUserToken,e.app.options.projectId),o=new Bp(i)),i=s,s=t,t=n,n=o,i.repoInfo_=new $p(`${s}:${t}`,!1,i.repoInfo_.namespace,i.repoInfo_.webSocketOnly,i.repoInfo_.nodeAdmin,i.repoInfo_.persistenceKey,i.repoInfo_.includeNamespaceInQueryParams),n&&(i.authTokenProvider_=n)}function hw(e){(e=io(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(Gv)}function dw(e,t){yp(e,t)}const fw={".sv":"timestamp"};class pw{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function gw(i,e,t){if(i=io(i),Vv("Reference.transaction",i._path),".length"===i.key||".keys"===i.key)throw"Reference.transaction failed: "+i.key+" is a read-only object.";t=null===(n=null==t?void 0:t.applyLocally)||void 0===n||n;const s=new us;var n=q_(i,()=>{});return function(t,n,e,r,i,s){l_(t,"transaction on "+n);const o={path:n,update:e,onComplete:r,status:null,order:dp(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=h_(t,n,void 0);if(o.currentInputSnapshot=a,void 0===(s=o.update(a.val())))o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{Lv("transaction failed: Data returned ",s,o.path),o.status=0;i=bv(t.transactionQueueTree_,n);const c=Iv(i)||[];c.push(o),Tv(i,c);let e;if("object"==typeof s&&null!==s&&xs(s,".priority"))e=Ds(s,".priority"),is(xv(e),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{const l=ev(t.serverSyncTree_,n)||em.EMPTY_NODE;e=l.getPriority().val()}i=Zv(t),s=im(s,e),i=vv(s,a,i);o.currentOutputSnapshotRaw=s,o.currentOutputSnapshotResolved=i,o.currentWriteId=r_(t);i=Gy(t.serverSyncTree_,n,i,o.currentWriteId,o.applyLocally);$v(t.eventQueue_,n,i),d_(t,t.transactionQueueTree_)}}(i._repo,i._path,e,(e,t,n)=>{var r;e?s.reject(e):(r=new R_(n,new N_(i._repo,i._path),$g),s.resolve(new pw(t,r)))},n,t),s.promise}Ag.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Ag.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},ep(Mo),Oo(new so("database",(e,{instanceIdentifier:t})=>{return cw(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)},"PUBLIC").setMultipleInstances(!0)),qo("@firebase/database","0.12.0",cp);const mw=new _o("@firebase/database-compat"),yw=function(e){e="FIREBASE WARNING: "+e;mw.warn(e)};class vw{constructor(e){this._delegate=e}cancel(t){Gs("OnDisconnect.cancel",0,1,arguments.length),Ys("OnDisconnect.cancel","onComplete",t,!0);const e=this._delegate.cancel();return t&&e.then(()=>t(null),e=>t(e)),e}remove(t){Gs("OnDisconnect.remove",0,1,arguments.length),Ys("OnDisconnect.remove","onComplete",t,!0);const e=this._delegate.remove();return t&&e.then(()=>t(null),e=>t(e)),e}set(e,t){Gs("OnDisconnect.set",1,2,arguments.length),Ys("OnDisconnect.set","onComplete",t,!0);const n=this._delegate.set(e);return t&&n.then(()=>t(null),e=>t(e)),n}setWithPriority(e,t,n){Gs("OnDisconnect.setWithPriority",2,3,arguments.length),Ys("OnDisconnect.setWithPriority","onComplete",n,!0);const r=this._delegate.setWithPriority(e,t);return n&&r.then(()=>n(null),e=>n(e)),r}update(t,n){if(Gs("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,yw("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ys("OnDisconnect.update","onComplete",n,!0);const e=this._delegate.update(t);return n&&e.then(()=>n(null),e=>n(e)),e}}class _w{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return Gs("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class ww{constructor(e,t){this._database=e,this._delegate=t}val(){return Gs("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return Gs("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return Gs("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return Gs("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return Gs("DataSnapshot.child",0,1,arguments.length),e=String(e),jv("DataSnapshot.child","path",e,!1),new ww(this._database,this._delegate.child(e))}hasChild(e){return Gs("DataSnapshot.hasChild",1,1,arguments.length),jv("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return Gs("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(t){return Gs("DataSnapshot.forEach",1,1,arguments.length),Ys("DataSnapshot.forEach","action",t,!1),this._delegate.forEach(e=>t(new ww(this._database,e)))}hasChildren(){return Gs("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return Gs("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return Gs("DataSnapshot.ref",0,0,arguments.length),new Iw(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class bw{constructor(e,t){this.database=e,this._delegate=t}on(e,n,t,r){Gs("Query.on",2,4,arguments.length),Ys("Query.on","callback",n,!1);const i=bw.getCancelAndContextArgs_("Query.on",t,r);var s=(e,t)=>{n.call(i.context,new ww(this.database,e),t)};s.userCallback=n,s.context=i.context;var o=null===(r=i.cancel)||void 0===r?void 0:r.bind(i.context);switch(e){case"value":return q_(this._delegate,s,o),n;case"child_added":return V_(this._delegate,s,o),n;case"child_removed":return z_(this._delegate,s,o),n;case"child_changed":return B_(this._delegate,s,o),n;case"child_moved":return K_(this._delegate,s,o),n;default:throw new Error(Qs("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,n){var r;Gs("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Qs(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),Ys("Query.off","callback",t,!0),Js("Query.off","context",n,!0),t?((r=()=>{}).userCallback=t,r.context=n,W_(this._delegate,e,r)):W_(this._delegate,e)}get(){return M_(this._delegate).then(e=>new ww(this.database,e))}once(e,n,t,r){Gs("Query.once",1,4,arguments.length),Ys("Query.once","callback",n,!0);const i=bw.getCancelAndContextArgs_("Query.once",t,r),s=new us;var o=(e,t)=>{e=new ww(this.database,e);n&&n.call(i.context,e,t),s.resolve(e)};o.userCallback=n,o.context=i.context;var a=e=>{i.cancel&&i.cancel.call(i.context,e),s.reject(e)};switch(e){case"value":q_(this._delegate,o,a,{onlyOnce:!0});break;case"child_added":V_(this._delegate,o,a,{onlyOnce:!0});break;case"child_removed":z_(this._delegate,o,a,{onlyOnce:!0});break;case"child_changed":B_(this._delegate,o,a,{onlyOnce:!0});break;case"child_moved":K_(this._delegate,o,a,{onlyOnce:!0});break;default:throw new Error(Qs("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise}limitToFirst(e){return Gs("Query.limitToFirst",1,1,arguments.length),new bw(this.database,iw(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new J_(e)}(e)))}limitToLast(e){return Gs("Query.limitToLast",1,1,arguments.length),new bw(this.database,iw(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new X_(e)}(e)))}orderByChild(e){return Gs("Query.orderByChild",1,1,arguments.length),new bw(this.database,iw(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return jv("orderByChild","path",e,!1),new Z_(e)}(e)))}orderByKey(){return Gs("Query.orderByKey",0,0,arguments.length),new bw(this.database,iw(this._delegate,new ew))}orderByPriority(){return Gs("Query.orderByPriority",0,0,arguments.length),new bw(this.database,iw(this._delegate,new tw))}orderByValue(){return Gs("Query.orderByValue",0,0,arguments.length),new bw(this.database,iw(this._delegate,new nw))}startAt(e=null,t){return Gs("Query.startAt",0,2,arguments.length),new bw(this.database,iw(this._delegate,([e=null,t]=[e,t],Uv("startAt","key",t,!0),new Q_(e,t))))}startAfter(e=null,t){return Gs("Query.startAfter",0,2,arguments.length),new bw(this.database,iw(this._delegate,(e=e,t=t,Uv("startAfter","key",t,!0),new Y_(e,t))))}endAt(e=null,t){return Gs("Query.endAt",0,2,arguments.length),new bw(this.database,iw(this._delegate,(e=e,t=t,Uv("endAt","key",t,!0),new H_(e,t))))}endBefore(e=null,t){return Gs("Query.endBefore",0,2,arguments.length),new bw(this.database,iw(this._delegate,(e=e,t=t,Uv("endBefore","key",t,!0),new G_(e,t))))}equalTo(e,t){return Gs("Query.equalTo",1,2,arguments.length),new bw(this.database,iw(this._delegate,(e=e,t=t,Uv("equalTo","key",t,!0),new rw(e,t))))}toString(){return Gs("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return Gs("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(Gs("Query.isEqual",1,1,arguments.length),e instanceof bw)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}static getCancelAndContextArgs_(e,t,n){const r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,Ys(e,"cancel",r.cancel,!0),r.context=n,Js(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Qs(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r}get ref(){return new Iw(this.database,new N_(this._delegate._repo,this._delegate._path))}}class Iw extends bw{constructor(e,t){super(e,new S_(t._repo,t._path,new vm,!1)),this.database=e,this._delegate=t}getKey(){return Gs("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return Gs("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new Iw(this.database,x_(this._delegate,e))}getParent(){Gs("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new Iw(this.database,e):null}getRoot(){return Gs("Reference.root",0,0,arguments.length),new Iw(this.database,this._delegate.root)}set(e,t){Gs("Reference.set",1,2,arguments.length),Ys("Reference.set","onComplete",t,!0);const n=D_(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}update(t,n){if(Gs("Reference.update",1,2,arguments.length),Array.isArray(t)){const r={};for(let e=0;e<t.length;++e)r[""+e]=t[e];t=r,yw("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Vv("Reference.update",this._delegate._path),Ys("Reference.update","onComplete",n,!0);const e=L_(this._delegate,t);return n&&e.then(()=>n(null),e=>n(e)),e}setWithPriority(e,t,n){Gs("Reference.setWithPriority",2,3,arguments.length),Ys("Reference.setWithPriority","onComplete",n,!0);const r=function(e,t,n){if(Vv("setWithPriority",e._path),Dv("setWithPriority",t,e._path,!1),Fv("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";const r=new us;return i_(e._repo,e._path,t,n,r.wrapCallback(()=>{})),r.promise}(this._delegate,e,t);return n&&r.then(()=>n(null),e=>n(e)),r}remove(t){Gs("Reference.remove",0,1,arguments.length),Ys("Reference.remove","onComplete",t,!0);const e=(n=this._delegate,Vv("remove",n._path),D_(n,null));var n;return t&&e.then(()=>t(null),e=>t(e)),e}transaction(e,t,n){Gs("Reference.transaction",1,3,arguments.length),Ys("Reference.transaction","transactionUpdate",e,!1),Ys("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Qs(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);const r=gw(this._delegate,e,{applyLocally:n}).then(e=>new _w(e.committed,new ww(this.database,e.snapshot)));return t&&r.then(e=>t(null,e.committed,e.snapshot),e=>t(e,!1,null)),r}setPriority(e,t){Gs("Reference.setPriority",1,2,arguments.length),Ys("Reference.setPriority","onComplete",t,!0);const n=function(e,t){e=io(e),Vv("setPriority",e._path),Fv("setPriority",t,!1);const n=new us;return i_(e._repo,vg(e._path,".priority"),t,null,n.wrapCallback(()=>{})),n.promise}(this._delegate,e);return t&&n.then(()=>t(null),e=>t(e)),n}push(e,t){Gs("Reference.push",0,2,arguments.length),Ys("Reference.push","onComplete",t,!0);const n=function(e,t){e=io(e),Vv("push",e._path),Dv("push",t,e._path,!0);var n=Xv(e._repo),n=cm(n);const r=x_(e,n),i=x_(e,n);let s;return s=null!=t?D_(i,t).then(()=>i):Promise.resolve(i),r.then=s.then.bind(s),r.catch=s.then.bind(s,void 0),r}(this._delegate,e),r=n.then(e=>new Iw(this.database,e));t&&r.then(()=>t(null),e=>t(e));const i=new Iw(this.database,n);return i.then=r.then.bind(r),i.catch=r.catch.bind(r,void 0),i}onDisconnect(){return Vv("Reference.onDisconnect",this._delegate._path),new vw(new E_(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class Tw{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete()}}useEmulator(e,t,n={}){uw(this._delegate,e,t,n)}ref(e){if(Gs("database.ref",0,1,arguments.length),e instanceof Iw){var t=O_(this._delegate,e.toString());return new Iw(this,t)}e=P_(this._delegate,e);return new Iw(this,e)}refFromURL(e){Gs("database.refFromURL",1,1,arguments.length);e=O_(this._delegate,e);return new Iw(this,e)}goOffline(){var e;Gs("database.goOffline",0,0,arguments.length),(e=io(e=this._delegate))._checkNotDeleted("goOffline"),c_(e._repo)}goOnline(){return Gs("database.goOnline",0,0,arguments.length),hw(this._delegate)}}Tw.ServerValue={TIMESTAMP:fw,increment:e=>({".sv":{increment:e}})};var Ew,Sw=Object.freeze({__proto__:null,initStandalone:function({app:e,url:t,version:n,customAuthImpl:r,namespace:i,nodeAdmin:s=!1}){ep(n);const o=new co("auth-internal",new uo("database-standalone"));return o.setComponent(new so("auth-internal",()=>r,"PRIVATE")),{instance:new Tw(cw(e,o,void 0,t,s),e),namespace:i}}});const kw=Tw.ServerValue;(Ew=Go).INTERNAL.registerComponent(new so("database-compat",(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("database").getImmediate({identifier:t});return new Tw(t,n)},"PUBLIC").setServiceProps({Reference:Iw,Query:bw,Database:Tw,DataSnapshot:ww,enableLogging:dw,INTERNAL:Sw,ServerValue:kw}).setMultipleInstances(!0)),Ew.registerVersion("@firebase/database-compat","0.1.0");var Cw=function(e,t){return(Cw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function Aw(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Nw={},Rw=E||self;function Pw(){}function Ow(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function xw(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Dw="closure_uid_"+(1e9*Math.random()>>>0),Lw=0;function Mw(e,t,n){return e.call.apply(e.bind,arguments)}function Fw(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function Uw(e,t,n){return(Uw=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Mw:Fw).apply(null,arguments)}function jw(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function qw(e,s){function t(){}t.prototype=s.prototype,e.Z=s.prototype,e.prototype=new t,(e.prototype.constructor=e).Vb=function(e,t,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return s.prototype[t].apply(e,r)}}function Vw(){this.s=this.s,this.o=this.o}var Bw={};Vw.prototype.s=!1,Vw.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=this,e=Object.prototype.hasOwnProperty.call(e,Dw)&&e[Dw]||(e[Dw]=++Lw),delete Bw[e])},Vw.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Kw=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},zw=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"==typeof e?e.split(""):e,s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function Ww(){return Array.prototype.concat.apply([],arguments)}function $w(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function Hw(e){return/^[\s\xa0]*$/.test(e)}var Gw,Qw=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Yw(e,t){return-1!=e.indexOf(t)}function Jw(e,t){return e<t?-1:t<e?1:0}e:{var Xw=Rw.navigator;if(Xw){Xw=Xw.userAgent;if(Xw){Gw=Xw;break e}}Gw=""}function Zw(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function eb(e){var t,n={};for(t in e)n[t]=e[t];return n}var tb="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function nb(e){for(var t,n,r=1;r<arguments.length;r++){for(t in n=arguments[r])e[t]=n[t];for(var i=0;i<tb.length;i++)t=tb[i],Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}}function rb(e){return rb[" "](e),e}rb[" "]=Pw;var ib,sb=Yw(Gw,"Opera"),ob=Yw(Gw,"Trident")||Yw(Gw,"MSIE"),ab=Yw(Gw,"Edge"),cb=ab||ob,lb=Yw(Gw,"Gecko")&&!(Yw(Gw.toLowerCase(),"webkit")&&!Yw(Gw,"Edge"))&&!(Yw(Gw,"Trident")||Yw(Gw,"MSIE"))&&!Yw(Gw,"Edge"),ub=Yw(Gw.toLowerCase(),"webkit")&&!Yw(Gw,"Edge");function hb(){var e=Rw.document;return e?e.documentMode:void 0}e:{var db="",fb=(fb=Gw,lb?/rv:([^\);]+)(\)|;)/.exec(fb):ab?/Edge\/([\d\.]+)/.exec(fb):ob?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(fb):ub?/WebKit\/(\S+)/.exec(fb):sb?/(?:Version)[ \/]?(\S+)/.exec(fb):void 0);if(fb&&(db=fb?fb[1]:""),ob){fb=hb();if(null!=fb&&fb>parseFloat(db)){ib=String(fb);break e}}ib=db}var pb={};function gb(){return e=function(){for(var e=0,t=Qw(String(ib)).split("."),n=Qw("9").split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++)for(var s=t[i]||"",o=n[i]||"";s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],(0!=s[0].length||0!=o[0].length)&&(e=Jw(0==s[1].length?0:parseInt(s[1],10),0==o[1].length?0:parseInt(o[1],10))||Jw(0==s[2].length,0==o[2].length)||Jw(s[2],o[2]),s=s[3],o=o[3],0==e););return 0<=e},t=pb,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9);var e,t}var mb=Rw.document&&ob&&(hb()||parseInt(ib,10))||void 0,yb=function(){if(!Rw.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Rw.addEventListener("test",Pw,t),Rw.removeEventListener("test",Pw,t)}catch(e){}return e}();function vb(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function _b(e,t){if(vb.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(lb){e:{try{rb(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:wb[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&_b.Z.h.call(this)}}vb.prototype.h=function(){this.defaultPrevented=!0},qw(_b,vb);var wb={2:"touch",3:"pen",4:"mouse"};_b.prototype.h=function(){_b.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var bb="closure_listenable_"+(1e6*Math.random()|0),Ib=0;function Tb(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++Ib,this.ca=this.fa=!1}function Eb(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function Sb(e){this.src=e,this.g={},this.h=0}function kb(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=Kw(n,t)))&&Array.prototype.splice.call(n,r,1),i&&(Eb(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function Cb(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}Sb.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Cb(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new Tb(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var Ab="closure_lm_"+(1e6*Math.random()|0),Nb={};function Rb(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}r=Fb(r);return t&&t[bb]?t.O(n,r,xw(i)?!!i.capture:!!i,s):Pb(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)Rb(e,t[s],n,r,i);return null}return n=Fb(n),e&&e[bb]?e.N(t,n,xw(r)?!!r.capture:!!r,i):Pb(e,t,n,!1,r,i)}function Pb(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o,a=xw(i)?!!i.capture:!!i,c=Lb(e);if(c||(e[Ab]=c=new Sb(e)),(n=c.add(t,n,r,a,s)).proxy)return n;if(o=Db,(n.proxy=r=function e(t){return o.call(e.src,e.listener,t)}).src=e,r.listener=n,e.addEventListener)void 0===(i=!yb?a:i)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(xb(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ob(e){var t,n,r;"number"!=typeof e&&e&&!e.ca&&((t=e.src)&&t[bb]?kb(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(xb(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Lb(t))?(kb(n,e),0==n.h&&(n.src=null,t[Ab]=null)):Eb(e)))}function xb(e){return e in Nb?Nb[e]:Nb[e]="on"+e}function Db(e,t){var n,r;return e=!!e.ca||(t=new _b(t,this),n=e.listener,r=e.ia||e.src,e.fa&&Ob(e),n.call(r,t))}function Lb(e){return(e=e[Ab])instanceof Sb?e:null}var Mb="__closure_events_fn_"+(1e9*Math.random()>>>0);function Fb(t){return"function"==typeof t?t:(t[Mb]||(t[Mb]=function(e){return t.handleEvent(e)}),t[Mb])}function Ub(){Vw.call(this),this.i=new Sb(this),(this.P=this).I=null}function jb(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new vb(t,e):t instanceof vb?t.target=t.target||e:(o=t,nb(t=new vb(r,e),o)),o=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],o=qb(s,r,!0,t)&&o;if(o=qb(s=t.g=e,r,!0,t)&&o,o=qb(s,r,!1,t)&&o,n)for(i=0;i<n.length;i++)o=qb(s=t.g=n[i],r,!1,t)&&o}function qb(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o,a,c=t[s];c&&!c.ca&&c.capture==n&&(o=c.listener,a=c.ia||c.src,c.fa&&kb(e.i,c),i=!1!==o.call(a,r)&&i)}return i&&!r.defaultPrevented}qw(Ub,Vw),Ub.prototype[bb]=!0,Ub.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else i=xw(i)?!!i.capture:!!i,r=Fb(r),t&&t[bb]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=Cb(o=t.g[n],r,i,s))&&(Eb(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete t.g[n],t.h--))):(t=t&&Lb(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?Cb(n,r,i,s):t)?n[t]:null)&&Ob(r))}(this,e,t,n,r)},Ub.prototype.M=function(){if(Ub.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Eb(n[r]);delete t.g[e],t.h--}}this.I=null},Ub.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Ub.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Vb=Rw.JSON.stringify;Bb.prototype.add=function(e,t){var n=Kb.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n},o=Bb;function Bb(){this.h=this.g=null}var Kb=(zb.prototype.get=function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e},new zb(function(){return new $b},function(e){return e.reset()}));function zb(e,t){this.i=e,this.j=t,this.h=0,this.g=null}var Wb,$b=(Hb.prototype.set=function(e,t){this.h=e,this.g=t,this.next=null},Hb.prototype.reset=function(){this.next=this.g=this.h=null},Hb);function Hb(){this.next=this.g=this.h=null}function Gb(e,t){var n;Wb||(n=Rw.Promise.resolve(void 0),Wb=function(){n.then(Jb)}),Qb||(Wb(),Qb=!0),Yb.add(e,t)}var Qb=!1,Yb=new o;function Jb(){for(var e;t=e=void 0,t=null,(e=Yb).g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),e=t;){try{e.h.call(e.g)}catch(e){!function(e){Rw.setTimeout(function(){throw e},0)}(e)}var t=Kb;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Qb=!1}function Xb(e,t){Ub.call(this),this.h=e||1,this.g=t||Rw,this.j=Uw(this.kb,this),this.l=Date.now()}function Zb(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function eI(e,t,n){if("function"==typeof e)n&&(e=Uw(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Uw(e.handleEvent,e)}return 2147483647<Number(t)?-1:Rw.setTimeout(e,t||0)}qw(Xb,Ub),(qi=Xb.prototype).da=!1,qi.S=null,qi.kb=function(){var e;this.da&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),jb(this,"tick"),this.da&&(Zb(this),this.start())))},qi.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},qi.M=function(){Xb.Z.M.call(this),Zb(this),delete this.g};var tI,nI=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Cw(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(rI,tI=Vw),rI.prototype.l=function(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eI(function(){t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)},rI.prototype.M=function(){tI.prototype.M.call(this),this.g&&(Rw.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},rI);function rI(e,t){var n=tI.call(this)||this;return n.m=e,n.j=t,n.h=null,n.i=!1,n.g=null,n}function iI(e){Vw.call(this),this.h=e,this.g={}}qw(iI,Vw);var sI=[];function oI(e,t,n,r){Array.isArray(n)||(n&&(sI[0]=n.toString()),n=sI);for(var i=0;i<n.length;i++){var s=Rb(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function aI(e){Zw(e.g,function(e,t){this.g.hasOwnProperty(t)&&Ob(e)},e),e.g={}}function cI(){this.g=!0}function lI(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Vb(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}iI.prototype.M=function(){iI.Z.M.call(this),aI(this)},iI.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},cI.prototype.Aa=function(){this.g=!1},cI.prototype.info=function(){};var uI={},hI=null;function dI(){return hI=hI||new Ub}function fI(e){vb.call(this,uI.Ma,e)}function pI(){var e=dI();jb(e,new fI(e))}function gI(e,t){vb.call(this,uI.STAT_EVENT,e),this.stat=t}function mI(e){var t=dI();jb(t,new gI(t,e))}function yI(e,t){vb.call(this,uI.Na,e),this.size=t}function vI(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Rw.setTimeout(function(){e()},t)}uI.Ma="serverreachability",qw(fI,vb),uI.STAT_EVENT="statevent",qw(gI,vb),uI.Na="timingevent",qw(yI,vb);ur={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},E={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function _I(){}function wI(e){return e.h||(e.h=e.i())}function bI(){}_I.prototype.h=null;o={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function II(){vb.call(this,"d")}function TI(){vb.call(this,"c")}function EI(){}function SI(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new iI(this),this.P=AI,this.W=new Xb(e=cb?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new kI}function kI(){this.i=null,this.g="",this.h=!1}qw(II,vb),qw(TI,vb),qw(EI,_I),EI.prototype.g=function(){return new XMLHttpRequest},EI.prototype.i=function(){return{}};var CI=new EI,AI=45e3,NI={},RI={};function PI(e,t,n){e.K=1,e.v=ZI(HI(t)),e.s=n,e.U=!0,OI(e,null)}function OI(e,t){e.F=Date.now(),LI(e),e.A=HI(e.v);var o,a,c,l,u,h,n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),dT(n.h,"t",r),e.C=0,n=e.l.H,e.h=new kI,e.g=f0(e.l,n?t:null,!e.s),0<e.O&&(e.L=new nI(Uw(e.Ia,e,e.g),e.O)),oI(e.V,e.g,"readystatechange",e.gb),t=e.H?eb(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),pI(),o=e.j,a=e.u,c=e.A,l=e.m,u=e.X,h=e.s,o.info(function(){if(o.g)if(h)for(var e="",t=h.split("&"),n=0;n<t.length;n++){var r,i,s=t[n].split("=");1<s.length&&(r=s[0],s=s[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+s+"&":e+(r+"=redacted&"))}else e=null;else e=h;return"XMLHTTP REQ ("+l+") [attempt "+u+"]: "+a+"\n"+c+"\n"+e})}function xI(e){return e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function DI(e,t,n){for(var r,i,s,o,a,c=!0;!e.I&&e.C<n.length;){if(s=n,a=o=void 0,o=(i=e).C,(r=-1==(a=s.indexOf("\n",o))?RI:(o=Number(s.substring(o,a)),isNaN(o)?NI:(a+=1)+o>s.length?RI:(s=s.substr(a,o),i.C=a+o,s)))==RI){4==t&&(e.o=4,mI(14),c=!1),lI(e.j,e.m,null,"[Incomplete Response]");break}if(r==NI){e.o=4,mI(15),lI(e.j,e.m,n,"[Invalid Chunk]"),c=!1;break}lI(e.j,e.m,r,null),qI(e,r)}xI(e)&&r!=RI&&r!=NI&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,mI(16),c=!1),e.i=e.i&&c,c?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),s0(t),t.L=!0,mI(11))):(lI(e.j,e.m,n,"[Invalid Chunked Response]"),jI(e),UI(e))}function LI(e){e.Y=Date.now()+e.P,MI(e,e.P)}function MI(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=vI(Uw(e.eb,e),t)}function FI(e){e.B&&(Rw.clearTimeout(e.B),e.B=null)}function UI(e){0==e.l.G||e.I||c0(e.l,e)}function jI(e){FI(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Zb(e.W),aI(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function qI(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||wT(n.i,e)))if(n.I=e.N,!e.J&&wT(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(g){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;a0(n),YT(n)}i0(n),mI(18)}}else n.ta=i[1],0<n.ta-n.U&&i[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=vI(Uw(n.ab,n),6e3));if(_T(n.i)<=1&&n.ka){try{n.ka()}catch(g){}n.ka=void 0}}else u0(n,11)}else if(!e.J&&n.g!=e||a0(n),!Hw(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var s,o,a,c,l,u,h,d,f,p,g=i[t];n.U=g[0],g=g[1],2==n.G?"c"==g[0]?(n.J=g[1],n.la=g[2],null!=(s=g[3])&&(n.ma=s,n.h.info("VER="+n.ma)),null!=(o=g[4])&&(n.za=o,n.h.info("SVER="+n.za)),null!=(a=g[5])&&"number"==typeof a&&0<a&&(r=1.5*a,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n,(c=e.g)&&(!(l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(u=r.i).g&&(Yw(l,"spdy")||Yw(l,"quic")||Yw(l,"h2"))&&(u.j=u.l,u.g=new Set,u.h&&(bT(u,u.h),u.h=null)),!r.D||(h=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=h,XI(r.F,r.D,h))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms")),d=e,(r=n).oa=d0(r,r.H?r.la:null,r.W),d.J?(IT(r.i,d),f=d,(p=r.K)&&f.setTimeout(p),f.B&&(FI(f),LI(f)),r.g=d):r0(r),0<n.l.length&&ZT(n)):"stop"!=g[0]&&"close"!=g[0]||u0(n,7):3==n.G&&("stop"==g[0]||"close"==g[0]?"stop"==g[0]?u0(n,7):QT(n):"noop"!=g[0]&&n.j&&n.j.wa(g),n.A=0)}pI()}catch(g){}}function VI(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Ow(e)||"string"==typeof e)zw(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(Ow(e)||"string"==typeof e)for(var n=[],r=e.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,e)n[r++]=i;for(var i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(Ow(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function BI(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof BI)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function KI(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];zI(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){for(var i={},n=t=0;t<e.g.length;)zI(i,r=e.g[t])||(i[e.g[n++]=r]=1),t++;e.g.length=n}}function zI(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(qi=SI.prototype).setTimeout=function(e){this.P=e},qi.gb=function(e){e=e.target;var t=this.L;t&&3==zT(e)?t.l():this.Ia(e)},qi.Ia=function(e){try{if(e==this.g)e:{var t=zT(this.g),n=this.g.Da();this.g.ba();if(!(t<3)&&(3!=t||cb||this.g&&(this.h.h||this.g.ga()||WT(this.g)))){this.I||4!=t||7==n||pI(),FI(this);var r=this.g.ba();this.N=r;t:if(xI(this)){var i=WT(this.g);e="";var s=i.length,o=4==zT(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){jI(this),UI(this);var a="";break t}this.h.i=new Rw.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:o&&n==s-1});i.splice(0,s),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,h=this.j,d=this.u,f=this.A,p=this.m,g=this.X,m=t,y=r,h.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+g+"]: "+d+"\n"+f+"\n"+m+" "+y}),this.i){if(this.$&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Hw(c)){var u=c;break t}}u=null}if(!(r=u)){this.i=!1,this.o=3,mI(12),jI(this),UI(this);break e}lI(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,qI(this,r)}this.U?(DI(this,t,a),cb&&this.i&&3==t&&(oI(this.V,this.W,"tick",this.fb),this.W.start())):(lI(this.j,this.m,a,null),qI(this,a)),4==t&&jI(this),this.i&&!this.I&&(4==t?c0(this.l,this):(this.i=!1,LI(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,mI(12)):(this.o=0,mI(13)),jI(this),UI(this)}}}catch(t){}var h,d,f,p,g,m,y},qi.fb=function(){var e,t;this.g&&(e=zT(this.g),t=this.g.ga(),this.C<t.length&&(FI(this),DI(this,e,t),this.i&&4!=e&&LI(this)))},qi.cancel=function(){this.I=!0,jI(this)},qi.eb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(pI(),mI(17)),jI(this),this.o=2,UI(this)):MI(this,this.Y-n)},(qi=BI.prototype).R=function(){KI(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},qi.T=function(){return KI(this),this.g.concat()},qi.get=function(e,t){return zI(this.h,e)?this.h[e]:t},qi.set=function(e,t){zI(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},qi.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var WI=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function $I(e,t){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof $I?(this.g=void 0!==t?t:e.g,GI(this,e.j),this.s=e.s,QI(this,e.i),YI(this,e.m),this.l=e.l,t=e.h,(n=new cT).i=t.i,t.g&&(n.g=new BI(t.g),n.h=t.h),JI(this,n),this.o=e.o):e&&(n=String(e).match(WI))?(this.g=!!t,GI(this,n[1]||"",!0),this.s=eT(n[2]||""),QI(this,n[3]||"",!0),YI(this,n[4]),this.l=eT(n[5]||"",!0),JI(this,n[6]||"",!0),this.o=eT(n[7]||"")):(this.g=!!t,this.h=new cT(null,this.g))}function HI(e){return new $I(e)}function GI(e,t,n){e.j=n?eT(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function QI(e,t,n){e.i=n?eT(t,!0):t}function YI(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function JI(e,t,n){var r,i;t instanceof cT?(e.h=t,r=e.h,(i=e.g)&&!r.j&&(lT(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(uT(this,t),dT(this,n,e))},r)),r.j=i):(n||(t=tT(t,oT)),e.h=new cT(t,e.g))}function XI(e,t,n){e.h.set(t,n)}function ZI(e){return XI(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function eT(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tT(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,nT),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function nT(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}$I.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tT(t,rT,!0),":");var n=this.i;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(tT(t,rT,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(tT(n,"/"==n.charAt(0)?sT:iT,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",tT(n,aT)),e.join("")};var rT=/[#\/\?@]/g,iT=/[#\?:]/g,sT=/[#\?]/g,oT=/[#\?@]/g,aT=/#/g;function cT(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function lT(n){n.g||(n.g=new BI,n.h=0,n.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),s=null;0<=i?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function uT(e,t){lT(e),t=fT(e,t),zI(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,zI((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&KI(e)))}function hT(e,t){return lT(e),t=fT(e,t),zI(e.g.h,t)}function dT(e,t,n){uT(e,t),0<n.length&&(e.i=null,e.g.set(fT(e,t),$w(n)),e.h+=n.length)}function fT(e,t){return t=String(t),t=e.j?t.toLowerCase():t}(qi=cT.prototype).add=function(e,t){lT(this),this.i=null,e=fT(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},qi.forEach=function(n,r){lT(this),this.g.forEach(function(e,t){zw(e,function(e){n.call(r,e,t,this)},this)},this)},qi.T=function(){lT(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},qi.R=function(e){lT(this);var t=[];if("string"==typeof e)hT(this,e)&&(t=Ww(t,this.g.get(fT(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=Ww(t,e[n])}return t},qi.set=function(e,t){return lT(this),this.i=null,hT(this,e=fT(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},qi.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},qi.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++)for(var r=t[n],i=encodeURIComponent(String(r)),r=this.R(r),s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}return this.i=e.join("&")};var pT=function(e,t){this.h=e,this.g=t};function gT(e){this.l=e||yT,e=Rw.PerformanceNavigationTiming?0<(e=Rw.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Rw.g&&Rw.g.Ea&&Rw.g.Ea()&&Rw.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var mT,yT=10;function vT(e){return e.h||e.g&&e.g.size>=e.j}function _T(e){return e.h?1:e.g?e.g.size:0}function wT(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function bT(e,t){e.g?e.g.add(t):e.h=t}function IT(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function TT(e){var t,n;if(null!=e.h)return e.i.concat(e.h.D);if(null==e.g||0===e.g.size)return $w(e.i);var r=e.i;try{for(var i=Aw(e.g.values()),s=i.next();!s.done;s=i.next())var o=s.value,r=r.concat(o.D)}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function ET(){}function ST(){this.g=new ET}function kT(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function CT(e){this.l=e.$b||null,this.j=e.ib||!1}function AT(e,t){Ub.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=NT,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}gT.prototype.cancel=function(){var t,e;if(this.i=TT(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=Aw(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},ET.prototype.stringify=function(e){return Rw.JSON.stringify(e,void 0)},ET.prototype.parse=function(e){return Rw.JSON.parse(e,void 0)},qw(CT,_I),CT.prototype.g=function(){return new AT(this.l,this.j)},CT.prototype.i=(mT={},function(){return mT}),qw(AT,Ub);var NT=0;function RT(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function PT(e){e.readyState=4,e.l=null,e.j=null,e.A=null,OT(e)}function OT(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(qi=AT.prototype).open=function(e,t){if(this.readyState!=NT)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,OT(this)},qi.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||Rw).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},qi.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,PT(this)),this.readyState=NT},qi.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,OT(this)),this.g&&(this.readyState=3,OT(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==Rw.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;RT(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},qi.Sa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?PT:OT)(this),3==this.readyState&&RT(this))},qi.Ua=function(e){this.g&&(this.response=this.responseText=e,PT(this))},qi.Ta=function(e){this.g&&(this.response=e,PT(this))},qi.ha=function(){this.g&&PT(this)},qi.setRequestHeader=function(e,t){this.v.append(e,t)},qi.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},qi.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(AT.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var xT=Rw.JSON.parse;function DT(e){Ub.call(this),this.headers=new BI,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=LT,this.K=this.L=!1}qw(DT,Ub);var LT="",MT=/^https?$/i,FT=["POST","PUT"];function UT(e){return"content-type"==e.toLowerCase()}function jT(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,qT(e),BT(e)}function qT(e){e.D||(e.D=!0,jb(e,"complete"),jb(e,"error"))}function VT(e){if(e.h&&void 0!==Nw&&(!e.C[1]||4!=zT(e)||2!=e.ba()))if(e.v&&4==zT(e))eI(e.Fa,0,e);else if(jb(e,"readystatechange"),4==zT(e)){e.h=!1;try{var t,n,r,i,s=e.ba();e:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break e;default:o=!1}if((t=o)||((n=0===s)&&(!(i=String(e.H).match(WI)[1]||null)&&Rw.self&&Rw.self.location&&(i=(r=Rw.self.location.protocol).substr(0,r.length-1)),n=!MT.test(i?i.toLowerCase():"")),t=n),t)jb(e,"complete"),jb(e,"success");else{e.m=6;try{var a=2<zT(e)?e.g.statusText:""}catch(e){a=""}e.j=a+" ["+e.ba()+"]",qT(e)}}finally{BT(e)}}}function BT(e,t){if(e.g){KT(e);var n=e.g,r=e.C[0]?Pw:null;e.g=null,e.C=null,t||jb(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function KT(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(Rw.clearTimeout(e.A),e.A=null)}function zT(e){return e.g?e.g.readyState:0}function WT(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case LT:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function $T(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}var i;r||(i="",Zw(n,function(e,t){i+=t,i+=":",i+=e,i+="\r\n"}),n=i,"string"==typeof e?null!=n&&encodeURIComponent(String(n)):XI(e,t,n))}function HT(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function GT(e){this.za=0,this.l=[],this.h=new cI,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=HT("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=HT("baseRetryDelayMs",5e3,e),this.$a=HT("retryDelaySeedMs",1e4,e),this.Ya=HT("forwardChannelMaxRetries",2,e),this.ra=HT("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new gT(e&&e.concurrentRequestLimit),this.Ca=new ST,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function QT(e){var t,n;JT(e),3==e.G&&(t=e.V++,XI(n=HI(e.F),"SID",e.J),XI(n,"RID",t),XI(n,"TYPE","terminate"),t0(e,n),(t=new SI(e,e.h,t,void 0)).K=2,t.v=ZI(HI(n)),n=!1,!(n=Rw.navigator&&Rw.navigator.sendBeacon?Rw.navigator.sendBeacon(t.v.toString(),""):n)&&Rw.Image&&((new Image).src=t.v,n=!0),n||(t.g=f0(t.l,null),t.g.ea(t.v)),t.F=Date.now(),LI(t)),h0(e)}function YT(e){e.g&&(s0(e),e.g.cancel(),e.g=null)}function JT(e){YT(e),e.u&&(Rw.clearTimeout(e.u),e.u=null),a0(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Rw.clearTimeout(e.m),e.m=null)}function XT(e,t){e.l.push(new pT(e.Za++,t)),3==e.G&&ZT(e)}function ZT(e){vT(e.i)||e.m||(e.m=!0,Gb(e.Ha,e),e.C=0)}function e0(e,t){var n=t?t.m:e.V++,r=HI(e.F);XI(r,"SID",e.J),XI(r,"RID",n),XI(r,"AID",e.U),t0(e,r),e.o&&e.s&&$T(r,e.o,e.s),n=new SI(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=n0(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),bT(e.i,n),PI(n,r,t)}function t0(e,n){e.j&&VI({},function(e,t){XI(n,t,e)})}function n0(e,t,n){n=Math.min(e.l.length,n);var r=e.j?Uw(e.j.Oa,e.j,e):null;e:for(var i=e.l,s=-1;;){var o=["count="+n];-1==s?0<n?(s=i[0].h,o.push("ofs="+s)):s=0:o.push("ofs="+s);for(var a=!0,c=0;c<n;c++){var l=i[c].h,u=i[c].g;if((l-=s)<0)s=Math.max(0,i[c].h-100),a=!1;else try{!function(e,r,t){var i=t||"";try{VI(e,function(e,t){var n=e;xw(e)&&(n=Vb(e)),r.push(i+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(i+"type="+encodeURIComponent("_badmap")),e}}(u,o,"req"+l+"_")}catch(e){r&&r(u)}}if(a){r=o.join("&");break e}}return e=e.l.splice(0,n),t.D=e,r}function r0(e){e.g||e.u||(e.Y=1,Gb(e.Ga,e),e.A=0)}function i0(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=vI(Uw(e.Ga,e),l0(e,e.A)),e.A++,1)}function s0(e){null!=e.B&&(Rw.clearTimeout(e.B),e.B=null)}function o0(e){e.g=new SI(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=HI(e.oa);XI(t,"RID","rpc"),XI(t,"SID",e.J),XI(t,"CI",e.N?"0":"1"),XI(t,"AID",e.U),t0(e,t),XI(t,"TYPE","xmlhttp"),e.o&&e.s&&$T(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=ZI(HI(t)),n.s=null,n.U=!0,OI(n,e)}function a0(e){null!=e.v&&(Rw.clearTimeout(e.v),e.v=null)}function c0(e,t){var n,r,i,s=null;if(e.g==t){a0(e),s0(e),e.g=null;var o=2}else{if(!wT(e.i,t))return;s=t.D,IT(e.i,t),o=1}if(e.I=t.N,0!=e.G)if(t.i)1==o?(s=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,jb(o=dI(),new yI(o,s)),ZT(e)):r0(e);else if(3==(n=t.o)||0==n&&0<e.I||(1!=o||(i=t,_T((r=e).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=i.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=vI(Uw(r.Ha,r,i),l0(r,r.C)),r.C++,0))))&&(2!=o||!i0(e)))switch(s&&0<s.length&&(t=e.i,t.i=t.i.concat(s)),n){case 1:u0(e,5);break;case 4:u0(e,10);break;case 3:u0(e,6);break;default:u0(e,2)}}function l0(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function u0(e,t){var n,r,i,s;e.h.info("Error code "+t),2==t?(r=null,e.j&&(r=null),s=Uw(e.jb,e),r||(r=new $I("//www.google.com/images/cleardot.gif"),Rw.location&&"http"==Rw.location.protocol||GI(r,"https"),ZI(r)),n=r.toString(),r=s,s=new cI,Rw.Image?((i=new Image).onload=jw(kT,s,i,"TestLoadImage: loaded",!0,r),i.onerror=jw(kT,s,i,"TestLoadImage: error",!1,r),i.onabort=jw(kT,s,i,"TestLoadImage: abort",!1,r),i.ontimeout=jw(kT,s,i,"TestLoadImage: timeout",!1,r),Rw.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):mI(2),e.G=0,e.j&&e.j.va(t),h0(e),JT(e)}function h0(e){e.G=0,e.I=-1,e.j&&(0==TT(e.i).length&&0==e.l.length||(e.i.i.length=0,$w(e.l),e.l.length=0),e.j.ua())}function d0(e,t,n){var r,i,s,o,a,c=(o=n)instanceof $I?HI(o):new $I(o,void 0);return""!=c.i?(t&&QI(c,t+"."+c.i),YI(c,c.m)):(a=Rw.location,r=a.protocol,i=t?t+"."+a.hostname:a.hostname,s=+a.port,o=n,a=new $I(null,void 0),r&&GI(a,r),i&&QI(a,i),s&&YI(a,s),o&&(a.l=o),c=a),e.aa&&Zw(e.aa,function(e,t){XI(c,t,e)}),t=e.D,n=e.sa,t&&n&&XI(c,t,n),XI(c,"VER",e.ma),t0(e,c),c}function f0(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new DT(new CT({ib:!0})):new DT(e.qa)).L=e.H,t}function p0(){}function g0(){if(ob&&!(10<=Number(mb)))throw Error("Environmental error: no available transport.")}function m0(e,t){Ub.call(this),this.g=new GT(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!Hw(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Hw(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new _0(this)}function y0(e){II.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function v0(){TI.call(this),this.status=1}function _0(e){this.g=e}(qi=DT.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||CI).g(),this.C=this.u?wI(this.u):wI(CI),this.g.onreadystatechange=Uw(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void jT(this,e)}e=n||"";var i,s=new BI(this.headers);r&&VI(r,function(e,t){s.set(t,e)}),r=function(e){e:{for(var t=UT,n=e.length,r="string"==typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return t<0?null:"string"==typeof e?e.charAt(t):e[t]}(s.T()),n=Rw.FormData&&e instanceof Rw.FormData,0<=Kw(FT,t)&&!r&&!n&&s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{KT(this),0<this.B&&((this.K=(i=this.g,ob&&gb()&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=Uw(this.pa,this)):this.A=eI(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){jT(this,e)}},qi.pa=function(){void 0!==Nw&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,jb(this,"timeout"),this.abort(8))},qi.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,jb(this,"complete"),jb(this,"abort"),BT(this))},qi.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),BT(this,!0)),DT.Z.M.call(this)},qi.Fa=function(){this.s||(this.F||this.v||this.l?VT(this):this.cb())},qi.cb=function(){VT(this)},qi.ba=function(){try{return 2<zT(this)?this.g.status:-1}catch(e){return-1}},qi.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},qi.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),xT(t)}},qi.Da=function(){return this.m},qi.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(qi=GT.prototype).ma=8,qi.G=1,qi.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},qi.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new SI(this,this.h,e,void 0),n=this.s;if(this.P&&(n?nb(n=eb(n),this.P):n=this.P),null===this.o&&(t.H=n),this.ja)e:{for(var r=0,i=0;i<this.l.length;i++){var s=this.l[i];if("__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s=s.length:s=void 0,void 0===s)break;if(4096<(r+=s)){r=i;break e}if(4096===r||i===this.l.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=n0(this,t,r),XI(i=HI(this.F),"RID",e),XI(i,"CVER",22),this.D&&XI(i,"X-HTTP-Session-Id",this.D),t0(this,i),this.o&&n&&$T(i,this.o,n),bT(this.i,t),this.Ra&&XI(i,"TYPE","init"),this.ja?(XI(i,"$req",r),XI(i,"SID","null"),t.$=!0,PI(t,i,null)):PI(t,i,r),this.G=2}}else 3==this.G&&(e?e0(this,e):0==this.l.length||vT(this.i)||e0(this))},qi.Ga=function(){var e;this.u=null,o0(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(e=2*this.O,this.h.info("BP detection timer enabled: "+e),this.B=vI(Uw(this.bb,this),e))},qi.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,mI(10),YT(this),o0(this))},qi.ab=function(){null!=this.v&&(this.v=null,YT(this),i0(this),mI(19))},qi.jb=function(e){e?(this.h.info("Successfully pinged google.com"),mI(2)):(this.h.info("Failed to ping google.com"),mI(1))},(qi=p0.prototype).xa=function(){},qi.wa=function(){},qi.va=function(){},qi.ua=function(){},qi.Oa=function(){},g0.prototype.g=function(e,t){return new m0(e,t)},qw(m0,Ub),m0.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Gb(Uw(e.hb,e,t))),mI(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=d0(e,null,e.W),ZT(e)},m0.prototype.close=function(){QT(this.g)},m0.prototype.u=function(e){var t;"string"==typeof e?((t={}).__data__=e,XT(this.g,t)):this.v?((t={}).__data__=Vb(e),XT(this.g,t)):XT(this.g,e)},m0.prototype.M=function(){this.g.j=null,delete this.j,QT(this.g),delete this.g,m0.Z.M.call(this)},qw(y0,II),qw(v0,TI),qw(_0,p0),_0.prototype.xa=function(){jb(this.g,"a")},_0.prototype.wa=function(e){jb(this.g,new y0(e))},_0.prototype.va=function(e){jb(this.g,new v0)},_0.prototype.ua=function(){jb(this.g,"b")},g0.prototype.createWebChannel=g0.prototype.g,m0.prototype.send=m0.prototype.u,m0.prototype.open=m0.prototype.m,ur.NO_ERROR=0,ur.TIMEOUT=8,ur.HTTP_ERROR=6,E.COMPLETE="complete",(bI.EventType=o).OPEN="a",o.CLOSE="b",o.ERROR="c",o.MESSAGE="d",Ub.prototype.listen=Ub.prototype.N,DT.prototype.listenOnce=DT.prototype.O,DT.prototype.getLastError=DT.prototype.La,DT.prototype.getLastErrorCode=DT.prototype.Da,DT.prototype.getStatus=DT.prototype.ba,DT.prototype.getResponseJson=DT.prototype.Qa,DT.prototype.getResponseText=DT.prototype.ga,DT.prototype.send=DT.prototype.ea;var w0,b0=dI,I0=ur,T0=E,E0=uI,S0=10,k0=11,C0=CT,A0=bI,N0=DT;class R0{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}R0.UNAUTHENTICATED=new R0(null),R0.GOOGLE_CREDENTIALS=new R0("google-credentials-uid"),R0.FIRST_PARTY=new R0("first-party-uid"),R0.MOCK_USER=new R0("mock-user");let P0="9.0.2";const O0=new _o("@firebase/firestore");function x0(){return O0.logLevel}function D0(e,...t){O0.logLevel<=fo.DEBUG&&(t=t.map(F0),O0.debug(`Firestore (${P0}): ${e}`,...t))}function L0(e,...t){O0.logLevel<=fo.ERROR&&(t=t.map(F0),O0.error(`Firestore (${P0}): ${e}`,...t))}function M0(e,...t){O0.logLevel<=fo.WARN&&(t=t.map(F0),O0.warn(`Firestore (${P0}): ${e}`,...t))}function F0(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function U0(e="Unexpected state"){e=`FIRESTORE (${P0}) INTERNAL ASSERTION FAILED: `+e;throw L0(e),new Error(e)}function j0(e){e||U0()}const q0={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class V0 extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class B0{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class K0{constructor(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${e}`}}class z0{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(R0.UNAUTHENTICATED))}shutdown(){}}class W0{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class $0{constructor(e){this.t=e,this.currentUser=R0.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const i=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let s=new B0;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new B0,t.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const e=s;t.enqueueRetryable(async()=>{await e.promise,await i(this.currentUser)})},a=e=>{D0("FirebaseCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(e=>a(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?a(e):(D0("FirebaseCredentialsProvider","Auth not yet detected"),s.resolve(),s=new B0))},0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(D0("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(j0("string"==typeof e.accessToken),new K0(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return j0(null===e||"string"==typeof e),new R0(e)}}class H0{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=R0.FIRST_PARTY}get authHeaders(){const e={"X-Goog-AuthUser":this.l},t=this.h.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),this.m&&(e["X-Goog-Iam-Authorization-Token"]=this.m),e}}class G0{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new H0(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(R0.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Q0{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.g(e),this.p=e=>t.writeSequenceNumber(e))}g(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.p&&this.p(e),e}}Q0.T=-1;class Y0{static I(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var i=function(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}(40);for(let e=0;e<i.length;++e)r.length<20&&i[e]<n&&(r+=t.charAt(i[e]%t.length))}return r}}function J0(e,t){return e<t?-1:t<e?1:0}function X0(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function Z0(e){return e+"\0"}class eE{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new V0(q0.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new V0(q0.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new V0(q0.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new V0(q0.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return eE.fromMillis(Date.now())}static fromDate(e){return eE.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),e=Math.floor(1e6*(e-1e3*t));return new eE(t,e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?J0(this.nanoseconds,e.nanoseconds):J0(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class tE{constructor(e){this.timestamp=e}static fromTimestamp(e){return new tE(e)}static min(){return new tE(new eE(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function nE(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function rE(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function iE(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class sE{constructor(e,t,n){void 0===t?t=0:t>e.length&&U0(),void 0===n?n=e.length-t:n>e.length-t&&U0(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===sE.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof sE?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(n){for(let e=this.offset,t=this.limit();e<t;e++)n(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){const r=Math.min(t.length,n.length);for(let e=0;e<r;e++){const r=t.get(e),i=n.get(e);if(r<i)return-1;if(r>i)return 1}return t.length<n.length?-1:t.length>n.length?1:0}}class oE extends sE{construct(e,t,n){return new oE(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new V0(q0.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new oE(t)}static emptyPath(){return new oE([])}}const aE=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class cE extends sE{construct(e,t,n){return new cE(e,t,n)}static isValidIdentifier(e){return aE.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=!cE.isValidIdentifier(e)?"`"+e+"`":e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new cE(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new V0(q0.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new V0(q0.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new V0(q0.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new V0(q0.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new cE(t)}static emptyPath(){return new cE([])}}class lE{constructor(e){(this.fields=e).sort(cE.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return X0(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class uE{constructor(e){this.binaryString=e}static fromBase64String(e){e=atob(e);return new uE(e)}static fromUint8Array(e){e=function(t){let n="";for(let e=0;e<t.length;++e)n+=String.fromCharCode(t[e]);return n}(e);return new uE(e)}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J0(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}uE.EMPTY_BYTE_STRING=new uE("");const hE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function dE(t){if(j0(!!t),"string"!=typeof t)return{seconds:fE(t.seconds),nanos:fE(t.nanos)};{let e=0;var n=hE.exec(t);j0(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function fE(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function pE(e){return"string"==typeof e?uE.fromBase64String(e):uE.fromUint8Array(e)}function gE(e){return"server_timestamp"===(null===(e=((null===(e=null==e?void 0:e.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===e?void 0:e.stringValue)}function mE(e){e=dE(e.mapValue.fields.__local_write_time__.timestampValue);return new eE(e.seconds,e.nanos)}function yE(e){return null==e}function vE(e){return 0===e&&1/e==-1/0}function _E(e){return"number"==typeof e&&Number.isInteger(e)&&!vE(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class wE{constructor(e){this.path=e}static fromPath(e){return new wE(oE.fromString(e))}static fromName(e){return new wE(oE.fromString(e).popFirst(5))}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===oE.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return oE.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new wE(new oE(e.slice()))}}function bE(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?gE(e)?4:10:U0()}function IE(n,r){var e,t,i=bE(n);if(i!==bE(r))return!1;switch(i){case 0:return!0;case 1:return n.booleanValue===r.booleanValue;case 4:return mE(n).isEqual(mE(r));case 3:return function(e){if("string"==typeof n.timestampValue&&"string"==typeof e.timestampValue&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;var t=dE(n.timestampValue),e=dE(e.timestampValue);return t.seconds===e.seconds&&t.nanos===e.nanos}(r);case 5:return n.stringValue===r.stringValue;case 6:return t=r,pE(n.bytesValue).isEqual(pE(t.bytesValue));case 7:return n.referenceValue===r.referenceValue;case 8:return e=r,fE((t=n).geoPointValue.latitude)===fE(e.geoPointValue.latitude)&&fE(t.geoPointValue.longitude)===fE(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return fE(e.integerValue)===fE(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){e=fE(e.doubleValue),t=fE(t.doubleValue);return e===t?vE(e)===vE(t):isNaN(e)&&isNaN(t)}return!1}(n,r);case 9:return X0(n.arrayValue.values||[],r.arrayValue.values||[],IE);case 10:return function(e){const t=e.mapValue.fields||{},n=r.mapValue.fields||{};if(nE(t)!==nE(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!IE(t[e],n[e])))return!1;return!0}(n);default:return U0()}}function TE(e,t){return void 0!==(e.values||[]).find(e=>IE(e,t))}function EE(e,t){var n,r,i,s=bE(e),o=bE(t);if(s!==o)return J0(s,o);switch(s){case 0:return 0;case 1:return J0(e.booleanValue,t.booleanValue);case 2:return r=t,i=fE(e.integerValue||e.doubleValue),r=fE(r.integerValue||r.doubleValue),i<r?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return SE(e.timestampValue,t.timestampValue);case 4:return SE(mE(e),mE(t));case 5:return J0(e.stringValue,t.stringValue);case 6:return function(e,t){const n=pE(e),r=pE(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=J0(n[e],r[e]);if(0!==t)return t}return J0(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,i=t.geoPointValue,0!==(r=J0(fE(n.latitude),fE(i.latitude)))?r:J0(fE(n.longitude),fE(i.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=EE(n[e],r[e]);if(t)return t}return J0(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=J0(r[e],s[e]);if(0!==t)return t;var o=EE(n[r[e]],i[s[e]]);if(0!==o)return o}return J0(r.length,s.length)}(e.mapValue,t.mapValue);default:throw U0()}}function SE(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return J0(e,t);var n=dE(e),e=dE(t),t=J0(n.seconds,e.seconds);return 0!==t?t:J0(n.nanos,e.nanos)}function kE(e){return function s(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=dE(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?pE(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,wE.fromName(t).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=s(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${s(e.fields[i])}`;return n+"}"}(e.mapValue):U0();var t}(e)}function CE(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function AE(e){return e&&"integerValue"in e}function NE(e){return!!e&&"arrayValue"in e}function RE(e){return e&&"nullValue"in e}function PE(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function OE(e){return e&&"mapValue"in e}function xE(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return rE(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=xE(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=xE(t.arrayValue.values[e]);return r}return Object.assign({},t)}class DE{constructor(e){this.value=e}static empty(){return new DE({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let t=this.value;for(let e=0;e<n.length-1;++e)if(t=(t.mapValue.fields||{})[n.get(e)],!OE(t))return null;return t=(t.mapValue.fields||{})[n.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=xE(t)}setAll(e){let n=cE.emptyPath(),r={},i=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,i),r={},i=[],n=t.popLast()}e?r[t.lastSegment()]=xE(e):i.push(t.lastSegment())});e=this.getFieldsMap(n);this.applyChanges(e,r,i)}delete(e){const t=this.field(e.popLast());OE(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return IE(this.value,e.value)}getFieldsMap(n){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let t=0;t<n.length;++t){let e=r.mapValue.fields[n.get(t)];OE(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},r.mapValue.fields[n.get(t)]=e),r=e}return r.mapValue.fields}applyChanges(n,e,t){rE(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new DE(xE(this.value))}}class LE{constructor(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(e){return new LE(e,0,tE.min(),DE.empty(),0)}static newFoundDocument(e,t,n){return new LE(e,1,t,n,0)}static newNoDocument(e,t){return new LE(e,2,t,DE.empty(),0)}static newUnknownDocument(e,t){return new LE(e,3,t,DE.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=DE.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=DE.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof LE&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}clone(){return new LE(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ME{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.A=null}}function FE(e,t=null,n=[],r=[],i=null,s=null,o=null){return new ME(e,t,n,r,i,s,o)}function UE(e){const t=e;if(null===t.A){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>function(e){return e.field.canonicalString()+e.op.toString()+kE(e.value)}(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),yE(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=JE(t.startAt)),t.endAt&&(e+="|ub:",e+=JE(t.endAt)),t.A=e}return t.A}function jE(t,n){if(t.limit!==n.limit)return!1;if(t.orderBy.length!==n.orderBy.length)return!1;for(let e=0;e<t.orderBy.length;e++)if(r=t.orderBy[e],i=n.orderBy[e],r.dir!==i.dir||!r.field.isEqual(i.field))return!1;var r,i,s,o;if(t.filters.length!==n.filters.length)return!1;for(let e=0;e<t.filters.length;e++)if(s=t.filters[e],o=n.filters[e],s.op!==o.op||!s.field.isEqual(o.field)||!IE(s.value,o.value))return!1;return t.collectionGroup===n.collectionGroup&&!!t.path.isEqual(n.path)&&!!eS(t.startAt,n.startAt)&&eS(t.endAt,n.endAt)}function qE(e){return wE.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class VE extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.R(e,t,n):new BE(e,t,n):"array-contains"===t?new $E(e,n):"in"===t?new HE(e,n):"not-in"===t?new GE(e,n):"array-contains-any"===t?new QE(e,n):new VE(e,t,n)}static R(e,t,n){return new("in"===t?KE:zE)(e,n)}matches(e){e=e.data.field(this.field);return"!="===this.op?null!==e&&this.P(EE(e,this.value)):null!==e&&bE(this.value)===bE(e)&&this.P(EE(e,this.value))}P(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return U0()}}v(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class BE extends VE{constructor(e,t,n){super(e,t,n),this.key=wE.fromName(n.referenceValue)}matches(e){e=wE.comparator(e.key,this.key);return this.P(e)}}class KE extends VE{constructor(e,t){super(e,"in",t),this.keys=WE(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class zE extends VE{constructor(e,t){super(e,"not-in",t),this.keys=WE(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function WE(e,t){return((null===(t=t.arrayValue)||void 0===t?void 0:t.values)||[]).map(e=>wE.fromName(e.referenceValue))}class $E extends VE{constructor(e,t){super(e,"array-contains",t)}matches(e){e=e.data.field(this.field);return NE(e)&&TE(e.arrayValue,this.value)}}class HE extends VE{constructor(e,t){super(e,"in",t)}matches(e){e=e.data.field(this.field);return null!==e&&TE(this.value.arrayValue,e)}}class GE extends VE{constructor(e,t){super(e,"not-in",t)}matches(e){if(TE(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;e=e.data.field(this.field);return null!==e&&!TE(this.value.arrayValue,e)}}class QE extends VE{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!NE(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>TE(this.value.arrayValue,e))}}class YE{constructor(e,t){this.position=e,this.before=t}}function JE(e){return`${e.before?"b":"a"}:${e.position.map(e=>kE(e)).join(",")}`}class XE{constructor(e,t="asc"){this.field=e,this.dir=t}}function ZE(t,n,r){let i=0;for(let e=0;e<t.position.length;e++){const s=n[e],o=t.position[e];if(i=s.field.isKeyField()?wE.comparator(wE.fromName(o.referenceValue),r.key):EE(o,r.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return t.before?i<=0:i<0}function eS(t,n){if(null===t)return null===n;if(null===n)return!1;if(t.before!==n.before||t.position.length!==n.position.length)return!1;for(let e=0;e<t.position.length;e++)if(!IE(t.position[e],n.position[e]))return!1;return!0}class tS{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.V=null,this.S=null,this.startAt,this.endAt}}function nS(e,t,n,r,i,s,o,a){return new tS(e,t,n,r,i,s,o,a)}function rS(e){return new tS(e)}function iS(e){return!yE(e.limit)&&"F"===e.limitType}function sS(e){return!yE(e.limit)&&"L"===e.limitType}function oS(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function aS(e){for(const t of e.filters)if(t.v())return t.field;return null}function cS(e){return null!==e.collectionGroup}function lS(t){const n=t;if(null===n.V){n.V=[];const t=aS(n),e=oS(n);if(null!==t&&null===e)t.isKeyField()||n.V.push(new XE(t)),n.V.push(new XE(cE.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.V.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.V.push(new XE(cE.keyField(),t))}}}return n.V}function uS(e){const t=e;if(!t.S)if("F"===t.limitType)t.S=FE(t.path,t.collectionGroup,lS(t),t.filters,t.limit,t.startAt,t.endAt);else{const r=[];for(const i of lS(t)){const t="desc"===i.dir?"asc":"desc";r.push(new XE(i.field,t))}var n=t.endAt?new YE(t.endAt.position,!t.endAt.before):null,e=t.startAt?new YE(t.startAt.position,!t.startAt.before):null;t.S=FE(t.path,t.collectionGroup,r,t.filters,t.limit,n,e)}return t.S}function hS(e,t,n){return new tS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function dS(e,t){return jE(uS(e),uS(t))&&e.limitType===t.limitType}function fS(e){return`${UE(uS(e))}|lt:${e.limitType}`}function pS(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>{return`${(e=e).field.canonicalString()} ${e.op} ${kE(e.value)}`}).join(", ")}]`),yE(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+JE(e.startAt)),e.endAt&&(t+=", endAt: "+JE(e.endAt)),`Target(${t})`}(uS(e))}; limitType=${e.limitType})`}function gS(n,e){return e.isFoundDocument()&&(t=n,r=e.key.path,null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(r):wE.isDocumentKey(t.path)?t.path.isEqual(r):t.path.isImmediateParentOf(r))&&function(e){for(const t of n.explicitOrderBy)if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(r=e,(!(e=n).startAt||ZE(e.startAt,lS(e),r))&&(!e.endAt||!ZE(e.endAt,lS(e),r)));var t,r}function mS(i){return(e,t)=>{let n=!1;for(const r of lS(i)){const i=function(e,r,t){var n=e.field.isKeyField()?wE.comparator(r.key,t.key):function(e,t){var n=r.data.field(e),e=t.data.field(e);return null!==n&&null!==e?EE(n,e):U0()}(e.field,t);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return U0()}}(r,e,t);if(0!==i)return i;n=n||r.field.isKeyField()}return 0}}function yS(e,t){if(e.D){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vE(t)?"-0":t}}function vS(e){return{integerValue:""+e}}function _S(e,t){return _E(t)?vS(t):yS(e,t)}class wS{constructor(){this._=void 0}}function bS(e,t){return e instanceof CS?AE(e=t)||e&&"doubleValue"in e?t:{integerValue:0}:null}class IS extends wS{}class TS extends wS{constructor(e){super(),this.elements=e}}function ES(e,t){const n=NS(t);for(const t of e.elements)n.some(e=>IE(e,t))||n.push(t);return{arrayValue:{values:n}}}class SS extends wS{constructor(e){super(),this.elements=e}}function kS(e,t){let n=NS(t);for(const t of e.elements)n=n.filter(e=>!IE(e,t));return{arrayValue:{values:n}}}class CS extends wS{constructor(e,t){super(),this.N=e,this.C=t}}function AS(e){return fE(e.integerValue||e.doubleValue)}function NS(e){return NE(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class RS{constructor(e,t){this.field=e,this.transform=t}}class PS{constructor(e,t){this.version=e,this.transformResults=t}}class OS{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new OS}static exists(e){return new OS(void 0,e)}static updateTime(e){return new OS(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function xS(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class DS{}function LS(e,t,n){e instanceof jS?function(e,t,n){const r=e.value.clone(),i=BS(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof qS?function(e,t,n){if(!xS(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=BS(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(VS(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function MS(e,t,n){e instanceof jS?function(e,t,n){if(xS(e.precondition,t)){const r=e.value.clone(),i=KS(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(US(t),r).setHasLocalMutations()}}(e,t,n):e instanceof qS?function(e,t,n){if(xS(e.precondition,t)){const r=KS(e.fieldTransforms,n,t),i=t.data;i.setAll(VS(e)),i.setAll(r),t.convertToFoundDocument(US(t),i).setHasLocalMutations()}}(e,t,n):(t=t,xS(e.precondition,t)&&t.convertToNoDocument(tE.min()))}function FS(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&X0(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof TS&&t instanceof TS||e instanceof SS&&t instanceof SS?X0(e.elements,t.elements,IE):e instanceof CS&&t instanceof CS?IE(e.C,t.C):e instanceof IS&&t instanceof IS)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}function US(e){return e.isFoundDocument()?e.version:tE.min()}class jS extends DS{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class qS extends DS{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function VS(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function BS(t,n,r){const i=new Map;j0(t.length===r.length);for(let e=0;e<r.length;e++){var s=t[e],o=s.transform,a=n.data.field(s.field);i.set(s.field,(s=o,o=a,a=r[e],s instanceof TS?ES(s,o):s instanceof SS?kS(s,o):a))}return i}function KS(e,t,n){const r=new Map;for(const l of e){const e=l.transform,u=n.data.field(l.field);r.set(l.field,(i=e,s=u,o=t,c=a=void 0,i instanceof IS?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return s&&(e.fields.__previous_value__=s),{mapValue:e}}():i instanceof TS?ES(i,s):i instanceof SS?kS(i,s):(c=bS(a=i,s),i=AS(c)+AS(a.C),AE(c)&&AE(a.C)?vS(i):yS(a.N,i))))}var i,s,o,a,c;return r}class zS extends DS{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class WS extends DS{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class $S{constructor(e){this.count=e}}function HS(e){switch(e){case q0.OK:return U0(),0;case q0.CANCELLED:case q0.UNKNOWN:case q0.DEADLINE_EXCEEDED:case q0.RESOURCE_EXHAUSTED:case q0.INTERNAL:case q0.UNAVAILABLE:case q0.UNAUTHENTICATED:return;case q0.INVALID_ARGUMENT:case q0.NOT_FOUND:case q0.ALREADY_EXISTS:case q0.PERMISSION_DENIED:case q0.FAILED_PRECONDITION:case q0.ABORTED:case q0.OUT_OF_RANGE:case q0.UNIMPLEMENTED:case q0.DATA_LOSS:return 1;default:return U0(),0}}function GS(e){if(void 0===e)return L0("GRPC error has no .code"),q0.UNKNOWN;switch(e){case w0.OK:return q0.OK;case w0.CANCELLED:return q0.CANCELLED;case w0.UNKNOWN:return q0.UNKNOWN;case w0.DEADLINE_EXCEEDED:return q0.DEADLINE_EXCEEDED;case w0.RESOURCE_EXHAUSTED:return q0.RESOURCE_EXHAUSTED;case w0.INTERNAL:return q0.INTERNAL;case w0.UNAVAILABLE:return q0.UNAVAILABLE;case w0.UNAUTHENTICATED:return q0.UNAUTHENTICATED;case w0.INVALID_ARGUMENT:return q0.INVALID_ARGUMENT;case w0.NOT_FOUND:return q0.NOT_FOUND;case w0.ALREADY_EXISTS:return q0.ALREADY_EXISTS;case w0.PERMISSION_DENIED:return q0.PERMISSION_DENIED;case w0.FAILED_PRECONDITION:return q0.FAILED_PRECONDITION;case w0.ABORTED:return q0.ABORTED;case w0.OUT_OF_RANGE:return q0.OUT_OF_RANGE;case w0.UNIMPLEMENTED:return q0.UNIMPLEMENTED;case w0.DATA_LOSS:return q0.DATA_LOSS;default:return U0()}}(E=w0=w0||{})[E.OK=0]="OK",E[E.CANCELLED=1]="CANCELLED",E[E.UNKNOWN=2]="UNKNOWN",E[E.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",E[E.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",E[E.NOT_FOUND=5]="NOT_FOUND",E[E.ALREADY_EXISTS=6]="ALREADY_EXISTS",E[E.PERMISSION_DENIED=7]="PERMISSION_DENIED",E[E.UNAUTHENTICATED=16]="UNAUTHENTICATED",E[E.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",E[E.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",E[E.ABORTED=10]="ABORTED",E[E.OUT_OF_RANGE=11]="OUT_OF_RANGE",E[E.UNIMPLEMENTED=12]="UNIMPLEMENTED",E[E.INTERNAL=13]="INTERNAL",E[E.UNAVAILABLE=14]="UNAVAILABLE",E[E.DATA_LOSS=15]="DATA_LOSS";class QS{constructor(e,t){this.comparator=e,this.root=t||JS.EMPTY}insert(e,t){return new QS(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,JS.BLACK,null,null))}remove(e){return new QS(this.comparator,this.root.remove(e,this.comparator).copy(null,null,JS.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new YS(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new YS(this.root,e,this.comparator,!1)}getReverseIterator(){return new YS(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new YS(this.root,e,this.comparator,!0)}}class YS{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class JS{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:JS.RED,this.left=null!=r?r:JS.EMPTY,this.right=null!=i?i:JS.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new JS(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return JS.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return JS.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,JS.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,JS.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw U0();if(this.right.isRed())throw U0();var e=this.left.check();if(e!==this.right.check())throw U0();return e+(this.isRed()?0:1)}}JS.EMPTY=null,JS.RED=!0,JS.BLACK=!1,JS.EMPTY=new class{constructor(){this.size=0}get key(){throw U0()}get value(){throw U0()}get color(){throw U0()}get left(){throw U0()}get right(){throw U0()}copy(e,t,n,r,i){return this}insert(e,t,n){return new JS(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class XS{constructor(e){this.comparator=e,this.data=new QS(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ZS(this.data.getIterator())}getIteratorFrom(e){return new ZS(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof XS))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new XS(this.comparator);return t.data=e,t}}class ZS{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const ek=new QS(wE.comparator);const tk=new QS(wE.comparator);const nk=new QS(wE.comparator);const rk=new XS(wE.comparator);function ik(...e){let t=rk;for(const n of e)t=t.add(n);return t}const sk=new XS(J0);class ok{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,ak.createSynthesizedTargetChangeForCurrentChange(e,t)),new ok(tE.min(),n,sk,ek,ik())}}class ak{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new ak(uE.EMPTY_BYTE_STRING,t,ik(),ik(),ik())}}class ck{constructor(e,t,n,r){this.k=e,this.removedTargetIds=t,this.key=n,this.$=r}}class lk{constructor(e,t){this.targetId=e,this.O=t}}class uk{constructor(e,t,n=uE.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class hk{constructor(){this.F=0,this.M=pk(),this.L=uE.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return 0!==this.F}get K(){return this.U}j(e){0<e.approximateByteSize()&&(this.U=!0,this.L=e)}W(){let n=ik(),r=ik(),i=ik();return this.M.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:i=i.add(e);break;default:U0()}}),new ak(this.L,this.B,n,r,i)}G(){this.U=!1,this.M=pk()}H(e,t){this.U=!0,this.M=this.M.insert(e,t)}J(e){this.U=!0,this.M=this.M.remove(e)}Y(){this.F+=1}X(){--this.F}Z(){this.U=!0,this.B=!0}}class dk{constructor(e){this.tt=e,this.et=new Map,this.nt=ek,this.st=fk(),this.it=new XS(J0)}rt(e){for(const t of e.k)e.$&&e.$.isFoundDocument()?this.ot(t,e.$):this.at(t,e.key,e.$);for(const n of e.removedTargetIds)this.at(n,e.key,e.$)}ct(n){this.forEachTarget(n,e=>{const t=this.ut(e);switch(n.state){case 0:this.ht(e)&&t.j(n.resumeToken);break;case 1:t.X(),t.q||t.G(),t.j(n.resumeToken);break;case 2:t.X(),t.q||this.removeTarget(e);break;case 3:this.ht(e)&&(t.Z(),t.j(n.resumeToken));break;case 4:this.ht(e)&&(this.lt(e),t.j(n.resumeToken));break;default:U0()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.et.forEach((e,t)=>{this.ht(t)&&n(t)})}ft(e){const t=e.targetId,n=e.O.count,r=this.dt(t);if(r){const e=r.target;if(qE(e))if(0===n){const n=new wE(e.path);this.at(t,n,LE.newNoDocument(n,tE.min()))}else j0(1===n);else this.wt(t)!==n&&(this.lt(t),this.it=this.it.add(t))}}_t(r){const i=new Map;this.et.forEach((e,t)=>{var n=this.dt(t);if(n){if(e.current&&qE(n.target)){const i=new wE(n.target.path);null!==this.nt.get(i)||this.gt(t,i)||this.at(t,i,LE.newNoDocument(i,r))}e.K&&(i.set(t,e.W()),e.G())}});let s=ik();this.st.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{e=this.dt(e);return!e||2===e.purpose||(n=!1)}),n&&(s=s.add(e))});var e=new ok(r,i,this.it,this.nt,s);return this.nt=ek,this.st=fk(),this.it=new XS(J0),e}ot(e,t){var n;this.ht(e)&&(n=this.gt(e,t.key)?2:0,this.ut(e).H(t.key,n),this.nt=this.nt.insert(t.key,t),this.st=this.st.insert(t.key,this.yt(t.key).add(e)))}at(e,t,n){if(this.ht(e)){const r=this.ut(e);this.gt(e,t)?r.H(t,1):r.J(t),this.st=this.st.insert(t,this.yt(t).delete(e)),n&&(this.nt=this.nt.insert(t,n))}}removeTarget(e){this.et.delete(e)}wt(e){var t=this.ut(e).W();return this.tt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Y(e){this.ut(e).Y()}ut(e){let t=this.et.get(e);return t||(t=new hk,this.et.set(e,t)),t}yt(e){let t=this.st.get(e);return t||(t=new XS(J0),this.st=this.st.insert(e,t)),t}ht(e){var t=null!==this.dt(e);return t||D0("WatchChangeAggregator","Detected inactive target",e),t}dt(e){var t=this.et.get(e);return t&&t.q?null:this.tt.Et(e)}lt(t){this.et.set(t,new hk),this.tt.getRemoteKeysForTarget(t).forEach(e=>{this.at(t,e,null)})}gt(e,t){return this.tt.getRemoteKeysForTarget(e).has(t)}}function fk(){return new QS(wE.comparator)}function pk(){return new QS(wE.comparator)}const gk={asc:"ASCENDING",desc:"DESCENDING"},mk={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class yk{constructor(e,t){this.databaseId=e,this.D=t}}function vk(e,t){return e.D?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function _k(e,t){return e.D?t.toBase64():t.toUint8Array()}function wk(e){return j0(!!e),tE.fromTimestamp((e=dE(e),new eE(e.seconds,e.nanos)))}function bk(e,t){return e=e,new oE(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function Ik(e){e=oE.fromString(e);return j0(Bk(e)),e}function Tk(e,t){return bk(e.databaseId,t.path)}function Ek(e,t){const n=Ik(t);if(n.get(1)!==e.databaseId.projectId)throw new V0(q0.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new V0(q0.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new wE(Ak(n))}function Sk(e,t){return bk(e.databaseId,t)}function kk(e){e=Ik(e);return 4===e.length?oE.emptyPath():Ak(e)}function Ck(e){return new oE(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ak(e){return j0(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function Nk(e,t,n){return{name:Tk(e,t),fields:n.value.mapValue.fields}}function Rk(e,t,n){const r=Ek(e,t.name),i=wk(t.updateTime),s=new DE({mapValue:{fields:t.fields}}),o=LE.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Pk(e,t){let n;if(t instanceof jS)n={update:Nk(e,t.key,t.value)};else if(t instanceof zS)n={delete:Tk(e,t.key)};else if(t instanceof qS)n={update:Nk(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof WS))return U0();n={verify:Tk(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof IS)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof TS)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof SS)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof CS)return{fieldPath:e.field.canonicalString(),increment:t.C};throw U0()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(t=t.precondition).updateTime?{updateTime:vk(e,t.updateTime.toTimestamp())}:void 0!==t.exists?{exists:t.exists}:U0()),n}function Ok(t,n){const e=n.currentDocument?void 0!==(s=n.currentDocument).updateTime?OS.updateTime(wk(s.updateTime)):void 0!==s.exists?OS.exists(s.exists):OS.none():OS.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)j0("REQUEST_TIME"===t.setToServerValue),n=new IS;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new TS(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new SS(e)}else"increment"in t?n=new CS(e,t.increment):U0();t=cE.fromServerFormat(t.fieldPath);return new RS(t,n)}(t,e)):[];if(n.update){n.update.name;var i=Ek(t,n.update.name),s=new DE({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new lE(e.map(e=>cE.fromServerFormat(e)))}();return new qS(i,s,t,e,r)}return new jS(i,s,e,r)}if(n.delete){const r=Ek(t,n.delete);return new zS(r,e)}if(n.verify){const r=Ek(t,n.verify);return new WS(r,e)}return U0()}function xk(e,t){return{documents:[Sk(e,t.path)]}}function Dk(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Sk(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Sk(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){e=e.map(e=>function(e){if("=="===e.op){if(PE(e.value))return{unaryFilter:{field:Uk(e.field),op:"IS_NAN"}};if(RE(e.value))return{unaryFilter:{field:Uk(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(PE(e.value))return{unaryFilter:{field:Uk(e.field),op:"IS_NOT_NAN"}};if(RE(e.value))return{unaryFilter:{field:Uk(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Uk(e.field),op:(t=e.op,mk[t]),value:e.value}};var t}(e));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(t.filters);i&&(n.structuredQuery.where=i);i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Uk(e.field),direction:(e=e.dir,gk[e])}}(e))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);i=t.limit,i=e.D||yE(i)?i:{value:i};return null!==i&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt=Mk(t.startAt)),t.endAt&&(n.structuredQuery.endAt=Mk(t.endAt)),n}function Lk(e){let t=kk(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(0<r){j0(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[Vk(e)]:void 0!==e.fieldFilter?[qk(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((e,t)=>e.concat(t)):U0():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(e=>function(e){return new XE(jk(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let a=null;n.limit&&(a=function(e){e="object"==typeof e?e.value:e;return yE(e)?null:e}(n.limit));let c=null;n.startAt&&(c=Fk(n.startAt));let l=null;return n.endAt&&(l=Fk(n.endAt)),nS(t,i,o,s,a,"F",c,l)}function Mk(e){return{before:e.before,values:e.position}}function Fk(e){var t=!!e.before,e=e.values||[];return new YE(e,t)}function Uk(e){return{fieldPath:e.canonicalString()}}function jk(e){return cE.fromServerFormat(e.fieldPath)}function qk(e){return VE.create(jk(e.fieldFilter.field),function(){switch(e.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return U0()}}(),e.fieldFilter.value)}function Vk(e){switch(e.unaryFilter.op){case"IS_NAN":var t=jk(e.unaryFilter.field);return VE.create(t,"==",{doubleValue:NaN});case"IS_NULL":t=jk(e.unaryFilter.field);return VE.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=jk(e.unaryFilter.field);return VE.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=jk(e.unaryFilter.field);return VE.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return U0()}}function Bk(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function Kk(t){let n="";for(let e=0;e<t.length;e++)0<n.length&&(n=zk(n)),n=function(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(t.get(e),n);return zk(n)}function zk(e){return e+""}function Wk(n){const r=n.length;if(j0(2<=r),2===r)return j0(""===n.charAt(0)&&""===n.charAt(1)),oE.emptyPath();const i=r-2,s=[];let o="";for(let t=0;t<r;){const r=n.indexOf("",t);switch((r<0||r>i)&&U0(),n.charAt(r+1)){case"":const i=n.substring(t,r);let e;0===o.length?e=i:(o+=i,e=o,o=""),s.push(e);break;case"":o+=n.substring(t,r),o+="\0";break;case"":o+=n.substring(t,r+1);break;default:U0()}t=r+2}return new oE(s)}class $k{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class Hk{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}Hk.store="owner",Hk.key="owner";class Gk{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}Gk.store="mutationQueues",Gk.keyPath="userId";class Qk{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}Qk.store="mutations",Qk.keyPath="batchId",Qk.userMutationsIndex="userMutationsIndex",Qk.userMutationsKeyPath=["userId","batchId"];class Yk{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,Kk(t)]}static key(e,t,n){return[e,Kk(t),n]}}Yk.store="documentMutations",Yk.PLACEHOLDER=new Yk;class Jk{constructor(e,t){this.path=e,this.readTime=t}}class Xk{constructor(e,t){this.path=e,this.version=t}}class Zk{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}Zk.store="remoteDocuments",Zk.readTimeIndex="readTimeIndex",Zk.readTimeIndexPath="readTime",Zk.collectionReadTimeIndex="collectionReadTimeIndex",Zk.collectionReadTimeIndexPath=["parentPath","readTime"];class eC{constructor(e){this.byteSize=e}}eC.store="remoteDocumentGlobal",eC.key="remoteDocumentGlobalKey";class tC{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}tC.store="targets",tC.keyPath="targetId",tC.queryTargetsIndexName="queryTargetsIndex",tC.queryTargetsKeyPath=["canonicalId","targetId"];class nC{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}nC.store="targetDocuments",nC.keyPath=["targetId","path"],nC.documentTargetsIndex="documentTargetsIndex",nC.documentTargetsKeyPath=["path","targetId"];class rC{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}rC.key="targetGlobalKey",rC.store="targetGlobal";class iC{constructor(e,t){this.collectionId=e,this.parent=t}}iC.store="collectionParents",iC.keyPath=["collectionId","parent"];class sC{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}sC.store="clientMetadata",sC.keyPath="clientId";class oC{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}oC.store="bundles",oC.keyPath="bundleId";class aC{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}aC.store="namedQueries",aC.keyPath="name";const cC=[Gk.store,Qk.store,Yk.store,Zk.store,tC.store,Hk.store,rC.store,nC.store,sC.store,eC.store,iC.store,oC.store,aC.store],lC="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class uC{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class hC{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,i){return this.callbackAttached&&U0(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new hC((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(i,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof hC?t:hC.resolve(t)}catch(e){return hC.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):hC.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):hC.reject(t)}static resolve(n){return new hC((e,t)=>{e(n)})}static reject(n){return new hC((e,t)=>{t(n)})}static waitFor(e){return new hC((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=hC.resolve(!1);for(const n of e)t=t.next(e=>e?hC.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}}class dC{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.Tt=new B0,this.transaction.oncomplete=()=>{this.Tt.resolve()},this.transaction.onabort=()=>{e.error?this.Tt.reject(new gC(t,e.error)):this.Tt.resolve()},this.transaction.onerror=e=>{e=wC(e.target.error);this.Tt.reject(new gC(t,e))}}static open(e,t,n,r){try{return new dC(t,e.transaction(r,n))}catch(e){throw new gC(t,e)}}get It(){return this.Tt.promise}abort(e){e&&this.Tt.reject(e),this.aborted||(D0("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){e=this.transaction.objectStore(e);return new yC(e)}}class fC{constructor(e,t,n){this.name=e,this.version=t,this.At=n,12.2===fC.Rt(fs())&&L0("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return D0("SimpleDb","Removing database:",e),vC(window.indexedDB.deleteDatabase(e)).toPromise()}static bt(){if("undefined"==typeof indexedDB)return!1;if(fC.Pt())return!0;const e=fs(),t=fC.Rt(e),n=0<t&&t<10,r=fC.vt(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static Pt(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Vt)}static St(e,t){return e.store(t)}static Rt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static vt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Dt(i){return this.db||(D0("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{e=e.target.result;t(e)},r.onblocked=()=>{n(new gC(i,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{e=e.target.error;"VersionError"===e.name?n(new V0(q0.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===e.name?n(new V0(q0.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+e)):n(new gC(i,e))},r.onupgradeneeded=e=>{D0("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.At.Ct(t,r.transaction,e.oldVersion,this.version).next(()=>{D0("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.Nt&&(this.db.onversionchange=e=>this.Nt(e)),this.db}xt(t){this.Nt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.Dt(e);const t=dC.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).catch(e=>(t.abort(e),hC.reject(e))).toPromise();return s.catch(()=>{}),await t.It,s}catch(e){const t="FirebaseError"!==e.name&&s<3;if(D0("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class pC{constructor(e){this.kt=e,this.$t=!1,this.Ot=null}get isDone(){return this.$t}get Ft(){return this.Ot}set cursor(e){this.kt=e}done(){this.$t=!0}Mt(e){this.Ot=e}delete(){return vC(this.kt.delete())}}class gC extends V0{constructor(e,t){super(q0.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function mC(e){return"IndexedDbTransactionError"===e.name}class yC{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(D0("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(D0("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),vC(n)}add(e){return D0("SimpleDb","ADD",this.store.name,e,e),vC(this.store.add(e))}get(t){return vC(this.store.get(t)).next(e=>(D0("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return D0("SimpleDb","DELETE",this.store.name,e),vC(this.store.delete(e))}count(){return D0("SimpleDb","COUNT",this.store.name),vC(this.store.count())}Lt(e,t){const n=this.cursor(this.options(e,t)),r=[];return this.Bt(n,(e,t)=>{r.push(t)}).next(()=>r)}Ut(e,t){D0("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.qt=!1;t=this.cursor(n);return this.Bt(t,(e,t,n)=>n.delete())}Kt(e,t){let n;t?n=e:(n={},t=e);e=this.cursor(n);return this.Bt(e,t)}jt(r){const e=this.cursor({});return new hC((n,t)=>{e.onerror=e=>{e=wC(e.target.error);t(e)},e.onsuccess=e=>{const t=e.target.result;t?r(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}Bt(e,s){const o=[];return new hC((i,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new pC(t),r=s(t.primaryKey,t.value,n);if(r instanceof hC){const e=r.catch(e=>(n.done(),hC.reject(e)));o.push(e)}n.isDone?i():null===n.Ft?t.continue():t.continue(n.Ft)}else i()}}).next(()=>hC.waitFor(o))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.qt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function vC(e){return new hC((t,n)=>{e.onsuccess=e=>{e=e.target.result;t(e)},e.onerror=e=>{e=wC(e.target.error);n(e)}})}let _C=!1;function wC(e){const t=fC.Rt(fs());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new V0("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return _C||(_C=!0,setTimeout(()=>{throw e},0)),e}}return e}class bC extends uC{constructor(e,t){super(),this.Qt=e,this.currentSequenceNumber=t}}function IC(e,t){return fC.St(e.Qt,t)}class TC{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){var n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&LS(r,t,n[e])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&MS(t,e,this.localWriteTime);for(const n of this.mutations)n.key.isEqual(e.key)&&MS(n,e,this.localWriteTime)}applyToLocalDocumentSet(r){this.mutations.forEach(e=>{const t=r.get(e.key),n=t;this.applyToLocalView(n),t.isValidDocument()||n.convertToNoDocument(tE.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ik())}isEqual(e){return this.batchId===e.batchId&&X0(this.mutations,e.mutations,(e,t)=>FS(e,t))&&X0(this.baseMutations,e.baseMutations,(e,t)=>FS(e,t))}}class EC{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){j0(e.mutations.length===n.length);let r=nk;var i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new EC(e,t,n,r)}}class SC{constructor(e,t,n,r,i=tE.min(),s=tE.min(),o=uE.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new SC(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new SC(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new SC(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class kC{constructor(e){this.Wt=e}}function CC(e,t){if(t.document)return Rk(e.Wt,t.document,!!t.hasCommittedMutations);if(t.noDocument){const e=wE.fromSegments(t.noDocument.path),n=OC(t.noDocument.readTime),r=LE.newNoDocument(e,n);return t.hasCommittedMutations?r.setHasCommittedMutations():r}if(t.unknownDocument){const e=wE.fromSegments(t.unknownDocument.path),i=OC(t.unknownDocument.version);return LE.newUnknownDocument(e,i)}return U0()}function AC(e,t,n){var r=NC(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){const s={name:Tk(n=e.Wt,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:vk(n,e.version.toTimestamp())},o=t.hasCommittedMutations;return new Zk(null,null,s,o,r,i)}if(t.isNoDocument()){const a=t.key.path.toArray(),s=PC(t.version),c=t.hasCommittedMutations;return new Zk(null,new Jk(a,s),null,c,r,i)}if(t.isUnknownDocument()){const a=t.key.path.toArray(),s=PC(t.version);return new Zk(new Xk(a,s),null,null,!0,r,i)}return U0()}function NC(e){e=e.toTimestamp();return[e.seconds,e.nanoseconds]}function RC(e){e=new eE(e[0],e[1]);return tE.fromTimestamp(e)}function PC(e){e=e.toTimestamp();return new $k(e.seconds,e.nanoseconds)}function OC(e){e=new eE(e.seconds,e.nanoseconds);return tE.fromTimestamp(e)}function xC(t,n){const r=(n.baseMutations||[]).map(e=>Ok(t.Wt,e));for(let e=0;e<n.mutations.length-1;++e){const r=n.mutations[e];if(e+1<n.mutations.length&&void 0!==n.mutations[e+1].transform){const i=n.mutations[e+1];r.updateTransforms=i.transform.fieldTransforms,n.mutations.splice(e+1,1),++e}}const i=n.mutations.map(e=>Ok(t.Wt,e)),e=eE.fromMillis(n.localWriteTimeMs);return new TC(n.batchId,e,r,i)}function DC(e){var t,n=OC(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?OC(e.lastLimboFreeSnapshotVersion):tE.min();let i;return i=void 0!==e.query.documents?(j0(1===(t=e.query).documents.length),uS(rS(kk(t.documents[0])))):uS(Lk(e.query)),new SC(i,e.targetId,0,e.lastListenSequenceNumber,n,r,uE.fromBase64String(e.resumeToken))}function LC(e,t){var n=PC(t.snapshotVersion),r=PC(t.lastLimboFreeSnapshotVersion),i=(qE(t.target)?xk:Dk)(e.Wt,t.target),e=t.resumeToken.toBase64();return new tC(t.targetId,UE(t.target),n,e,t.sequenceNumber,r,i)}function MC(e){var t=Lk({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?hS(t,t.limit,"L"):t}class FC{getBundleMetadata(e,t){return UC(e).get(t).next(e=>{if(e)return{id:(e=e).bundleId,createTime:OC(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return UC(e).put({bundleId:(t=t).id,createTime:PC(wk(t.createTime)),version:t.version})}getNamedQuery(e,t){return jC(e).get(t).next(e=>{if(e)return{name:(e=e).name,query:MC(e.bundledQuery),readTime:OC(e.readTime)}})}saveNamedQuery(e,t){return jC(e).put({name:(t=t).name,readTime:PC(wk(t.readTime)),bundledQuery:t.bundledQuery})}}function UC(e){return IC(e,oC.store)}function jC(e){return IC(e,aC.store)}class qC{constructor(){this.Gt=new VC}addToCollectionParentIndex(e,t){return this.Gt.add(t),hC.resolve()}getCollectionParents(e,t){return hC.resolve(this.Gt.getEntries(t))}}class VC{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new XS(oE.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new XS(oE.comparator)).toArray()}}class BC{constructor(){this.zt=new VC}addToCollectionParentIndex(e,t){if(this.zt.has(t))return hC.resolve();var n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.zt.add(t)});r={collectionId:n,parent:Kk(r)};return KC(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[Z0(n),""],!1,!0);return KC(e).Lt(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(Wk(t.parent))}return r})}}function KC(e){return IC(e,iC.store)}const zC={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class WC{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new WC(e,WC.DEFAULT_COLLECTION_PERCENTILE,WC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function $C(e,t,n){const r=e.store(Qk.store),i=e.store(Yk.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Kt({range:o},(e,t,n)=>(a++,n.delete()));s.push(c.next(()=>{j0(1===a)}));const l=[];for(const e of n.mutations){const r=Yk.key(t,e.key.path,n.batchId);s.push(i.delete(r)),l.push(e.key)}return hC.waitFor(s).next(()=>l)}function HC(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw U0();t=e.noDocument}return JSON.stringify(t).length}WC.DEFAULT_COLLECTION_PERCENTILE=10,WC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,WC.DEFAULT=new WC(41943040,WC.DEFAULT_COLLECTION_PERCENTILE,WC.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),WC.DISABLED=new WC(-1,0,0);class GC{constructor(e,t,n,r){this.userId=e,this.N=t,this.Ht=n,this.referenceDelegate=r,this.Jt={}}static Yt(e,t,n,r){j0(""!==e.uid);e=e.isAuthenticated()?e.uid:"";return new GC(e,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return YC(e).Kt({index:Qk.userMutationsIndex,range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(u,h,d,f){const p=JC(u),g=YC(u);return g.add({}).next(e=>{j0("number"==typeof e);const t=new TC(e,h,d,f),n=(i=this.N,s=this.userId,o=t,a=o.baseMutations.map(e=>Pk(i.Wt,e)),c=o.mutations.map(e=>Pk(i.Wt,e)),new Qk(s,o.batchId,o.localWriteTime.toMillis(),a,c)),r=[];var i,s,o,a,c;let l=new XS((e,t)=>J0(e.canonicalString(),t.canonicalString()));for(const u of f){const h=Yk.key(this.userId,u.key.path,e);l=l.add(u.key.path.popLast()),r.push(g.put(n)),r.push(p.put(h,Yk.PLACEHOLDER))}return l.forEach(e=>{r.push(this.Ht.addToCollectionParentIndex(u,e))}),u.addOnCommittedListener(()=>{this.Jt[e]=t.keys()}),hC.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return YC(e).get(t).next(e=>e?(j0(e.userId===this.userId),xC(this.N,e)):null)}Xt(e,t){return this.Jt[t]?hC.resolve(this.Jt[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){e=e.keys();return this.Jt[t]=e}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return YC(e).Kt({index:Qk.userMutationsIndex,range:n},(e,t,n)=>{t.userId===this.userId&&(j0(t.batchId>=r),i=xC(this.N,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return YC(e).Kt({index:Qk.userMutationsIndex,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return YC(e).Lt(Qk.userMutationsIndex,t).next(e=>e.map(e=>xC(this.N,e)))}getAllMutationBatchesAffectingDocumentKey(s,o){const e=Yk.prefixForPath(this.userId,o.path),t=IDBKeyRange.lowerBound(e),a=[];return JC(s).Kt({range:t},(e,t,n)=>{var[r,i,e]=e,i=Wk(i);if(r===this.userId&&o.path.isEqual(i))return YC(s).get(e).next(e=>{if(!e)throw U0();j0(e.userId===this.userId),a.push(xC(this.N,e))});n.done()}).next(()=>a)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new XS(J0);const n=[];return e.forEach(s=>{var e=Yk.prefixForPath(this.userId,s.path),e=IDBKeyRange.lowerBound(e),e=JC(t).Kt({range:e},(e,t,n)=>{var[r,i,e]=e,i=Wk(i);r===this.userId&&s.path.isEqual(i)?o=o.add(e):n.done()});n.push(e)}),hC.waitFor(n).next(()=>this.Zt(t,o))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,o=s.length+1,n=Yk.prefixForPath(this.userId,s),r=IDBKeyRange.lowerBound(n);let a=new XS(J0);return JC(e).Kt({range:r},(e,t,n)=>{var[r,i,e]=e,i=Wk(i);r===this.userId&&s.isPrefixOf(i)?i.length===o&&(a=a.add(e)):n.done()}).next(()=>this.Zt(e,a))}Zt(t,e){const n=[],r=[];return e.forEach(e=>{r.push(YC(t).get(e).next(e=>{if(null===e)throw U0();j0(e.userId===this.userId),n.push(xC(this.N,e))}))}),hC.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return $C(t.Qt,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.te(n.batchId)}),hC.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}te(e){delete this.Jt[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return hC.resolve();const t=IDBKeyRange.lowerBound(Yk.prefixForUser(this.userId)),r=[];return JC(n).Kt({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=Wk(e[1]);r.push(t)}else n.done()}).next(()=>{j0(0===r.length)})})}containsKey(e,t){return QC(e,this.userId,t)}ee(e){return XC(e).get(this.userId).next(e=>e||new Gk(this.userId,-1,""))}}function QC(e,i,t){const n=Yk.prefixForPath(i,t.path),s=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return JC(e).Kt({range:r,qt:!0},(e,t,n)=>{var[r,e]=e;r===i&&e===s&&(o=!0),n.done()}).next(()=>o)}function YC(e){return IC(e,Qk.store)}function JC(e){return IC(e,Yk.store)}function XC(e){return IC(e,Gk.store)}class ZC{constructor(e){this.ne=e}next(){return this.ne+=2,this.ne}static se(){return new ZC(0)}static ie(){return new ZC(-1)}}class eA{constructor(e,t){this.referenceDelegate=e,this.N=t}allocateTargetId(n){return this.re(n).next(e=>{const t=new ZC(e.highestTargetId);return e.highestTargetId=t.next(),this.oe(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.re(e).next(e=>tE.fromTimestamp(new eE(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.re(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.re(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.oe(t,e)))}addTargetData(t,n){return this.ae(t,n).next(()=>this.re(t).next(e=>(e.targetCount+=1,this.ce(n,e),this.oe(t,e))))}updateTargetData(e,t){return this.ae(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>tA(t).delete(e.targetId)).next(()=>this.re(t)).next(e=>(j0(0<e.targetCount),--e.targetCount,this.oe(t,e)))}removeTargets(n,r,i){let s=0;const o=[];return tA(n).Kt((e,t)=>{t=DC(t);t.sequenceNumber<=r&&null===i.get(t.targetId)&&(s++,o.push(this.removeTargetData(n,t)))}).next(()=>hC.waitFor(o)).next(()=>s)}forEachTarget(e,n){return tA(e).Kt((e,t)=>{t=DC(t);n(t)})}re(e){return nA(e).get(rC.key).next(e=>(j0(null!==e),e))}oe(e,t){return nA(e).put(rC.key,t)}ae(e,t){return tA(e).put(LC(this.N,t))}ce(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.re(e).next(e=>e.targetCount)}getTargetData(e,r){var t=UE(r),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let i=null;return tA(e).Kt({range:t,index:tC.queryTargetsIndexName},(e,t,n)=>{t=DC(t);jE(r,t.target)&&(i=t,n.done())}).next(()=>i)}addMatchingKeys(n,e,r){const i=[],s=rA(n);return e.forEach(e=>{var t=Kk(e.path);i.push(s.put(new nC(r,t))),i.push(this.referenceDelegate.addReference(n,r,e))}),hC.waitFor(i)}removeMatchingKeys(n,e,r){const i=rA(n);return hC.forEach(e,e=>{var t=Kk(e.path);return hC.waitFor([i.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=rA(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=rA(e);let i=ik();return r.Kt({range:n,qt:!0},(e,t,n)=>{e=Wk(e[1]),e=new wE(e);i=i.add(e)}).next(()=>i)}containsKey(e,t){t=Kk(t.path),t=IDBKeyRange.bound([t],[Z0(t)],!1,!0);let r=0;return rA(e).Kt({index:nC.documentTargetsIndex,qt:!0,range:t},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}Et(e,t){return tA(e).get(t).next(e=>e?DC(e):null)}}function tA(e){return IC(e,tC.store)}function nA(e){return IC(e,rC.store)}function rA(e){return IC(e,nC.store)}async function iA(e){if(e.code!==q0.FAILED_PRECONDITION||e.message!==lC)throw e;D0("LocalStore","Unexpectedly lost primary lease")}function sA([e,t],[n,r]){n=J0(e,n);return 0===n?J0(t,r):n}class oA{constructor(e){this.ue=e,this.buffer=new XS(sA),this.he=0}le(){return++this.he}fe(e){e=[e,this.le()];if(this.buffer.size<this.ue)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();sA(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class aA{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.de=!1,this.we=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(e)}stop(){this.we&&(this.we.cancel(),this.we=null)}get started(){return null!==this.we}_e(e){var t=this.de?3e5:6e4;D0("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.we=null,this.de=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){mC(e)?D0("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await iA(e)}await this._e(e)})}}class cA{constructor(e,t){this.me=e,this.params=t}calculateTargetCount(e,t){return this.me.ge(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return hC.resolve(Q0.T);const n=new oA(t);return this.me.forEachTarget(e,e=>n.fe(e.sequenceNumber)).next(()=>this.me.ye(e,e=>n.fe(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.me.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.me.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(D0("LruGarbageCollector","Garbage collection skipped; disabled"),hC.resolve(zC)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(D0("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),zC):this.pe(t,n))}getCacheSize(e){return this.me.getCacheSize(e)}pe(t,n){let r,i,s,o,a,c,l;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(i=e>this.params.maximumSequenceNumbersToCollect?(D0("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,o=Date.now(),this.nthSequenceNumber(t,i))).next(e=>(r=e,a=Date.now(),this.removeTargets(t,r,n))).next(e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(l=Date.now(),x0()<=fo.DEBUG&&D0("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-u}ms\n\tDetermined least recently used ${i} in `+(a-o)+"ms\n"+`\tRemoved ${s} targets in `+(c-a)+"ms\n"+`\tRemoved ${e} documents in `+(l-c)+"ms\n"+`Total Duration: ${l-u}ms`),hC.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e})))}}class lA{constructor(e,t){this.db=e,this.garbageCollector=(e=this,t=t,new cA(e,t))}ge(e){const n=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}Ee(e){let t=0;return this.ye(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}ye(e,n){return this.Te(e,(e,t)=>n(t))}addReference(e,t,n){return uA(e,n)}removeReference(e,t,n){return uA(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return uA(e,t)}Ie(t,n){let r=!1;return XC(t).jt(e=>QC(t,e,n).next(e=>(e&&(r=!0),hC.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let o=0;return this.Te(n,(t,e)=>{if(e<=r){const r=this.Ie(n,t).next(e=>{if(!e)return o++,i.getEntry(n,t).next(()=>(i.removeEntry(t),rA(n).delete([0,Kk(t.path)])))});s.push(r)}}).next(()=>hC.waitFor(s)).next(()=>i.apply(n)).next(()=>o)}removeTarget(e,t){t=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,t)}updateLimboDocument(e,t){return uA(e,t)}Te(e,r){const t=rA(e);let i,s=Q0.T;return t.Kt({index:nC.documentTargetsIndex},([e],{path:t,sequenceNumber:n})=>{0===e?(s!==Q0.T&&r(new wE(Wk(i)),s),s=n,i=t):s=Q0.T}).next(()=>{s!==Q0.T&&r(new wE(Wk(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function uA(e,t){return rA(e).put((t=t,e=e.currentSequenceNumber,new nC(0,Kk(t.path),e)))}class hA{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(t,n){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0!==r){for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return void(r[e]=[t,n]);r.push([t,n])}else this.inner[e]=[[t,n]]}delete(t){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return!1;for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return 1===r.length?delete this.inner[n]:r.splice(e,1),!0;return!1}forEach(r){rE(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return iE(this.inner)}}class dA{constructor(){this.changes=new hA(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}getReadTime(e){e=this.changes.get(e);return e?e.readTime:tE.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:LE.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?hC.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class fA{constructor(e,t){this.N=e,this.Ht=t}addEntry(e,t,n){return mA(e).put(yA(t),n)}removeEntry(e,t){const n=mA(e),r=yA(t);return n.delete(r)}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.Ae(t,e)))}getEntry(e,t){return mA(e).get(yA(t)).next(e=>this.Re(t,e))}be(e,t){return mA(e).get(yA(t)).next(e=>({document:this.Re(t,e),size:HC(e)}))}getEntries(e,t){let n=ek;return this.Pe(e,t,(e,t)=>{t=this.Re(e,t);n=n.insert(e,t)}).next(()=>n)}ve(e,t){let r=ek,i=new QS(wE.comparator);return this.Pe(e,t,(e,t)=>{var n=this.Re(e,t);r=r.insert(e,n),i=i.insert(e,HC(t))}).next(()=>({documents:r,Ve:i}))}Pe(e,t,i){if(t.isEmpty())return hC.resolve();const n=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),s=t.getIterator();let o=s.getNext();return mA(e).Kt({range:n},(e,t,n)=>{for(var r=wE.fromSegments(e);o&&wE.comparator(o,r)<0;)i(o,null),o=s.getNext();o&&o.isEqual(r)&&(i(o,t),o=s.hasNext()?s.getNext():null),o?n.Mt(o.path.toArray()):n.done()}).next(()=>{for(;o;)i(o,null),o=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,r,t){let i=ek;const s=r.path.length+1,n={};if(t.isEqual(tE.min())){const e=r.path.toArray();n.range=IDBKeyRange.lowerBound(e)}else{const e=r.path.toArray(),i=NC(t);n.range=IDBKeyRange.lowerBound([e,i],!0),n.index=Zk.collectionReadTimeIndex}return mA(e).Kt(n,(e,t,n)=>{e.length===s&&(t=CC(this.N,t),r.path.isPrefixOf(t.key.path)?gS(r,t)&&(i=i.insert(t.key,t)):n.done())}).next(()=>i)}newChangeBuffer(e){return new pA(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return gA(e).get(eC.key).next(e=>(j0(!!e),e))}Ae(e,t){return gA(e).put(eC.key,t)}Re(e,t){if(t){const e=CC(this.N,t);if(!e.isNoDocument()||!e.version.isEqual(tE.min()))return e}return LE.newInvalidDocument(e)}}class pA extends dA{constructor(e,t){super(),this.Se=e,this.trackRemovals=t,this.De=new hA(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(i){const s=[];let o=0,a=new XS((e,t)=>J0(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.De.get(e);if(t.document.isValidDocument()){var r=AC(this.Se.N,t.document,this.getReadTime(e));a=a.add(e.path.popLast());t=HC(r);o+=t-n,s.push(this.Se.addEntry(i,e,r))}else if(o-=n,this.trackRemovals){const o=AC(this.Se.N,LE.newNoDocument(e,tE.min()),this.getReadTime(e));s.push(this.Se.addEntry(i,e,o))}else s.push(this.Se.removeEntry(i,e))}),a.forEach(e=>{s.push(this.Se.Ht.addToCollectionParentIndex(i,e))}),s.push(this.Se.updateMetadata(i,o)),hC.waitFor(s)}getFromCache(e,t){return this.Se.be(e,t).next(e=>(this.De.set(t,e.size),e.document))}getAllFromCache(e,t){return this.Se.ve(e,t).next(({documents:e,Ve:t})=>(t.forEach((e,t)=>{this.De.set(e,t)}),e))}}function gA(e){return IC(e,eC.store)}function mA(e){return IC(e,Zk.store)}function yA(e){return e.path.toArray()}class vA{constructor(e){this.N=e}Ct(t,n,e,r){j0(e<r&&0<=e&&r<=11);const i=new dC("createOrUpgrade",n);var s;e<1&&1<=r&&(t.createObjectStore(Hk.store),(s=t).createObjectStore(Gk.store,{keyPath:Gk.keyPath}),s.createObjectStore(Qk.store,{keyPath:Qk.keyPath,autoIncrement:!0}).createIndex(Qk.userMutationsIndex,Qk.userMutationsKeyPath,{unique:!0}),s.createObjectStore(Yk.store),_A(t),t.createObjectStore(Zk.store));let o=hC.resolve();return e<3&&3<=r&&(0!==e&&((s=t).deleteObjectStore(nC.store),s.deleteObjectStore(tC.store),s.deleteObjectStore(rC.store),_A(t)),o=o.next(()=>function(){const e=i.store(rC.store),t=new rC(0,0,tE.min().toTimestamp(),0);return e.put(rC.key,t)}())),e<4&&4<=r&&(0!==e&&(o=o.next(()=>function(r,i){return i.store(Qk.store).Lt().next(e=>{r.deleteObjectStore(Qk.store),r.createObjectStore(Qk.store,{keyPath:Qk.keyPath,autoIncrement:!0}).createIndex(Qk.userMutationsIndex,Qk.userMutationsKeyPath,{unique:!0});const t=i.store(Qk.store),n=e.map(e=>t.put(e));return hC.waitFor(n)})}(t,i))),o=o.next(()=>{t.createObjectStore(sC.store,{keyPath:sC.keyPath})})),e<5&&5<=r&&(o=o.next(()=>this.Ce(i))),e<6&&6<=r&&(o=o.next(()=>(t.createObjectStore(eC.store),this.Ne(i)))),e<7&&7<=r&&(o=o.next(()=>this.xe(i))),e<8&&8<=r&&(o=o.next(()=>this.ke(t,i))),e<9&&9<=r&&(o=o.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),function(){const e=n.objectStore(Zk.store);e.createIndex(Zk.readTimeIndex,Zk.readTimeIndexPath,{unique:!1}),e.createIndex(Zk.collectionReadTimeIndex,Zk.collectionReadTimeIndexPath,{unique:!1})}()})),e<10&&10<=r&&(o=o.next(()=>this.$e(i))),e<11&&11<=r&&(o=o.next(()=>{t.createObjectStore(oC.store,{keyPath:oC.keyPath}),t.createObjectStore(aC.store,{keyPath:aC.keyPath})})),o}Ne(t){let n=0;return t.store(Zk.store).Kt((e,t)=>{n+=HC(t)}).next(()=>{var e=new eC(n);return t.store(eC.store).put(eC.key,e)})}Ce(n){const e=n.store(Gk.store),r=n.store(Qk.store);return e.Lt().next(e=>hC.forEach(e,t=>{var e=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.Lt(Qk.userMutationsIndex,e).next(e=>hC.forEach(e,e=>{j0(e.userId===t.userId);e=xC(this.N,e);return $C(n,t.userId,e).next(()=>{})}))}))}xe(e){const o=e.store(nC.store),t=e.store(Zk.store);return e.store(rC.store).get(rC.key).next(i=>{const s=[];return t.Kt((e,t)=>{const n=new oE(e),r=[0,Kk(n)];s.push(o.get(r).next(e=>e?hC.resolve():(e=>o.put(new nC(0,Kk(e),i.highestListenSequenceNumber)))(n)))}).next(()=>hC.waitFor(s))})}ke(e,t){e.createObjectStore(iC.store,{keyPath:iC.keyPath});const n=t.store(iC.store),r=new VC,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Kk(r)})}};return t.store(Zk.store).Kt({qt:!0},(e,t)=>{const n=new oE(e);return i(n.popLast())}).next(()=>t.store(Yk.store).Kt({qt:!0},([,e],t)=>{const n=Wk(e);return i(n.popLast())}))}$e(e){const n=e.store(tC.store);return n.Kt((e,t)=>{t=DC(t),t=LC(this.N,t);return n.put(t)})}}function _A(e){e.createObjectStore(nC.store,{keyPath:nC.keyPath}).createIndex(nC.documentTargetsIndex,nC.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(tC.store,{keyPath:tC.keyPath}).createIndex(tC.queryTargetsIndexName,tC.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(rC.store)}const wA="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class bA{constructor(e,t,n,r,i,s,o,a,c,l){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Oe=i,this.window=s,this.document=o,this.Fe=c,this.Me=l,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=e=>Promise.resolve(),!bA.bt())throw new V0(q0.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new lA(this,r),this.We=t+"main",this.N=new kC(a),this.Ge=new fC(this.We,11,new vA(this.N)),this.ze=new eA(this.referenceDelegate,this.N),this.Ht=new BC,this.He=(t=this.N,a=this.Ht,new fA(t,a)),this.Je=new FC,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===l&&L0("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Xe().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new V0(q0.FAILED_PRECONDITION,wA);return this.Ze(),this.tn(),this.en(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ze.getHighestSequenceNumber(e))}).then(e=>{this.Le=new Q0(e,this.Fe)}).then(()=>{this.Be=!0}).catch(e=>(this.Ge&&this.Ge.close(),Promise.reject(e)))}nn(t){return this.Qe=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ge.xt(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget(async()=>{this.started&&await this.Xe()}))}Xe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>TA(t).put(new sC(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.sn(t).next(e=>{e||(this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)))})}).next(()=>this.rn(t)).next(e=>this.isPrimary&&!e?this.on(t).next(()=>!1):!!e&&this.an(t).next(()=>!0))).catch(e=>{if(mC(e))return D0("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return D0("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Oe.enqueueRetryable(()=>this.Qe(e)),this.isPrimary=e})}sn(e){return IA(e).get(Hk.key).next(e=>hC.resolve(this.cn(e)))}un(e){return TA(e).delete(this.clientId)}async hn(){if(this.isPrimary&&!this.ln(this.je,18e5)){this.je=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=IC(e,sC.store);return r.Lt().next(e=>{const t=this.fn(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return hC.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Ye)for(const t of e)this.Ye.removeItem(this.dn(t.clientId))}}en(){this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Xe().then(()=>this.hn()).then(()=>this.en()))}cn(e){return!!e&&e.ownerId===this.clientId}rn(t){return this.Me?hC.resolve(!0):IA(t).get(Hk.key).next(e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)){if(this.cn(e)&&this.networkEnabled)return!0;if(!this.cn(e)){if(!e.allowTabSynchronization)throw new V0(q0.FAILED_PRECONDITION,wA);return!1}}return!(!this.networkEnabled||!this.inForeground)||TA(t).Lt().next(e=>void 0===this.fn(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,e=this.networkEnabled===e.networkEnabled;if(t||n&&e)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&D0("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Be=!1,this._n(),this.Ke&&(this.Ke.cancel(),this.Ke=null),this.mn(),this.gn(),await this.Ge.runTransaction("shutdown","readwrite",[Hk.store,sC.store],e=>{const t=new bC(e,Q0.T);return this.on(t).next(()=>this.un(t))}),this.Ge.close(),this.yn()}fn(e,t){return e.filter(e=>this.ln(e.updateTimeMs,t)&&!this.wn(e.clientId))}pn(){return this.runTransaction("getActiveClients","readonly",e=>TA(e).Lt().next(e=>this.fn(e,18e5).map(e=>e.clientId)))}get started(){return this.Be}getMutationQueue(e){return GC.Yt(e,this.N,this.Ht,this.referenceDelegate)}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getIndexManager(){return this.Ht}getBundleCache(){return this.Je}runTransaction(t,n,r){D0("IndexedDbPersistence","Starting transaction:",t);let i;return this.Ge.runTransaction(t,"readonly"===n?"readonly":"readwrite",cC,e=>(i=new bC(e,this.Le?this.Le.next():Q0.T),"readwrite-primary"===n?this.sn(i).next(e=>!!e||this.rn(i)).next(e=>{if(!e)throw L0(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable(()=>this.Qe(!1)),new V0(q0.FAILED_PRECONDITION,lC);return r(i)}).next(e=>this.an(i).next(()=>e)):this.En(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}En(e){return IA(e).get(Hk.key).next(e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)&&!this.cn(e)&&!(this.Me||this.allowTabSynchronization&&e.allowTabSynchronization))throw new V0(q0.FAILED_PRECONDITION,wA)})}an(e){var t=new Hk(this.clientId,this.allowTabSynchronization,Date.now());return IA(e).put(Hk.key,t)}static bt(){return fC.bt()}on(e){const t=IA(e);return t.get(Hk.key).next(e=>this.cn(e)?(D0("IndexedDbPersistence","Releasing primary lease."),t.delete(Hk.key)):hC.resolve())}ln(e,t){var n=Date.now();return!(e<n-t||n<e&&(L0(`Detected an update time that is in the future: ${e} > ${n}`),1))}Ze(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=()=>{this.Oe.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Xe()))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}mn(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}tn(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ue=()=>{this._n(),!gs()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match("Version/14")&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ue))}gn(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}wn(e){var t;try{var n=null!==(null===(t=this.Ye)||void 0===t?void 0:t.getItem(this.dn(e)));return D0("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return L0("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}_n(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(e){L0("Failed to set zombie client id.",e)}}yn(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(e){}}dn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function IA(e){return IC(e,Hk.store)}function TA(e){return IC(e,sC.store)}function EA(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class SA{constructor(e,t){this.progress=e,this.Tn=t}}class kA{constructor(e,t,n){this.He=e,this.In=t,this.Ht=n}An(t,n){return this.In.getAllMutationBatchesAffectingDocumentKey(t,n).next(e=>this.Rn(t,n,e))}Rn(e,t,n){return this.He.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}bn(e,n){e.forEach((e,t)=>{for(const e of n)e.applyToLocalView(t)})}Pn(t,e){return this.He.getEntries(t,e).next(e=>this.vn(t,e).next(()=>e))}vn(e,t){return this.In.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.bn(t,e))}getDocumentsMatchingQuery(e,t,n){return r=t,wE.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Vn(e,t.path):cS(t)?this.Sn(e,t,n):this.Dn(e,t,n);var r}Vn(e,t){return this.An(e,new wE(t)).next(e=>{let t=tk;return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Sn(n,r,i){const s=r.collectionGroup;let o=tk;return this.Ht.getCollectionParents(n,s).next(e=>hC.forEach(e,e=>{var t,t=(t=r,e=e.child(s),new tS(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.Dn(n,t,i).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}Dn(t,n,e){let i,s;return this.He.getDocumentsMatchingQuery(t,n,e).next(e=>(i=e,this.In.getAllMutationBatchesAffectingQuery(t,n))).next(e=>(s=e,this.Cn(t,s,i).next(t=>{i=t;for(const t of s)for(const r of t.mutations){var n=r.key;let e=i.get(n);null==e&&(e=LE.newInvalidDocument(n),i=i.insert(n,e)),MS(r,e,t.localWriteTime),e.isFoundDocument()||(i=i.remove(n))}}))).next(()=>(i.forEach((e,t)=>{gS(n,t)||(i=i.remove(e))}),i))}Cn(e,t,n){let r=ik();for(const e of t)for(const t of e.mutations)t instanceof qS&&null===n.get(t.key)&&(r=r.add(t.key));let i=n;return this.He.getEntries(e,r).next(e=>(e.forEach((e,t)=>{t.isFoundDocument()&&(i=i.insert(e,t))}),i))}}class CA{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Nn=n,this.xn=r}static kn(e,t){let n=ik(),r=ik();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new CA(e,t.fromCache,n,r)}}class AA{$n(e){this.On=e}getDocumentsMatchingQuery(t,r,i,s){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(tE.min())?this.Fn(t,r):this.On.Pn(t,s).next(e=>{const n=this.Mn(r,e);return(iS(r)||sS(r))&&this.Ln(r.limitType,n,s,i)?this.Fn(t,r):(x0()<=fo.DEBUG&&D0("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),pS(r)),this.On.getDocumentsMatchingQuery(t,r,i).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t)))})}Mn(n,e){let r=new XS(mS(n));return e.forEach((e,t)=>{gS(n,t)&&(r=r.add(t))}),r}Ln(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Fn(e,t){return x0()<=fo.DEBUG&&D0("QueryEngine","Using full collection scan to execute query:",pS(t)),this.On.getDocumentsMatchingQuery(e,t,tE.min())}}class NA{constructor(e,t,n,r){this.persistence=e,this.Bn=t,this.N=r,this.Un=new QS(J0),this.qn=new hA(e=>UE(e),jE),this.Kn=tE.min(),this.In=e.getMutationQueue(n),this.jn=e.getRemoteDocumentCache(),this.ze=e.getTargetCache(),this.Qn=new kA(this.jn,this.In,this.persistence.getIndexManager()),this.Je=e.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Un))}}function RA(e,t,n,r){return new NA(e,t,n,r)}async function PA(e,t){const n=e;let r=n.In,o=n.Qn;e=await n.persistence.runTransaction("Handle user change","readonly",i=>{let s;return n.In.getAllMutationBatches(i).next(e=>(s=e,r=n.persistence.getMutationQueue(t),o=new kA(n.jn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(i))).next(e=>{const t=[],n=[];let r=ik();for(const i of s){t.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}for(const i of e){n.push(i.batchId);for(const e of i.mutations)r=r.add(e.key)}return o.Pn(i,r).next(e=>({Wn:e,removedBatchIds:t,addedBatchIds:n}))})});return n.In=r,n.Qn=o,n.Bn.$n(n.Qn),e}function OA(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.ze.getLastRemoteSnapshotVersion(e))}function xA(e,n){const u=e,h=n.snapshotVersion;let d=u.Un;return u.persistence.runTransaction("Apply remote event","readwrite-primary",c=>{const e=u.jn.newChangeBuffer({trackRemovals:!0});d=u.Un;const l=[];n.targetChanges.forEach((e,t)=>{const n=d.get(t);if(n){l.push(u.ze.removeMatchingKeys(c,e.removedDocuments,t).next(()=>u.ze.addMatchingKeys(c,e.addedDocuments,t)));const a=e.resumeToken;var r,i,s,o;0<a.approximateByteSize()&&(r=n.withResumeToken(a,h).withSequenceNumber(c.currentSequenceNumber),d=d.insert(t,r),i=n,o=e,j0(0<(s=r).resumeToken.approximateByteSize()),0!==i.resumeToken.approximateByteSize()&&!(3e8<=s.snapshotVersion.toMicroseconds()-i.snapshotVersion.toMicroseconds()||0<o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size)||l.push(u.ze.updateTargetData(c,r)))}});let t=ek;if(n.documentUpdates.forEach((e,t)=>{n.resolvedLimboDocuments.has(e)&&l.push(u.persistence.referenceDelegate.updateLimboDocument(c,e))}),l.push(DA(c,e,n.documentUpdates,h,void 0).next(e=>{t=e})),!h.isEqual(tE.min())){const n=u.ze.getLastRemoteSnapshotVersion(c).next(e=>u.ze.setTargetsMetadata(c,c.currentSequenceNumber,h));l.push(n)}return hC.waitFor(l).next(()=>e.apply(c)).next(()=>u.Qn.vn(c,t)).next(()=>t)}).then(e=>(u.Un=d,e))}function DA(e,o,t,a,c){let n=ik();return t.forEach(e=>n=n.add(e)),o.getEntries(e,n).next(i=>{let s=ek;return t.forEach((e,t)=>{const n=i.get(e),r=(null==c?void 0:c.get(e))||a;t.isNoDocument()&&t.version.isEqual(tE.min())?(o.removeEntry(e,r),s=s.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(o.addEntry(t,r),s=s.insert(e,t)):D0("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),s})}function LA(e,r){const i=e;return i.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return i.ze.getTargetData(t,r).next(e=>e?(n=e,hC.resolve(n)):i.ze.allocateTargetId(t).next(e=>(n=new SC(r,e,0,t.currentSequenceNumber),i.ze.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=i.Un.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(i.Un=i.Un.insert(e.targetId,e),i.qn.set(r,e.targetId)),e})}async function MA(e,t,n){const r=e,i=r.Un.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!mC(e))throw e;D0("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Un=r.Un.remove(t),r.qn.delete(i.target)}function FA(e,n,r){const i=e;let s=tE.min(),o=ik();return i.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,i=r.qn.get(n);return void 0!==i?hC.resolve(r.Un.get(i)):r.ze.getTargetData(t,n)}(i,t,uS(n)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,i.ze.getMatchingKeysForTargetId(t,e.targetId).next(e=>{o=e})}).next(()=>i.Bn.getDocumentsMatchingQuery(t,n,r?s:tE.min(),r?o:ik())).next(e=>({documents:e,Gn:o})))}function UA(e,t){const n=e,r=n.ze,i=n.Un.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",e=>r.Et(e,t).next(e=>e?e.target:null))}function jA(e){const n=e;return n.persistence.runTransaction("Get new document changes","readonly",e=>function(e,t,n){const r=e;let i=ek,s=NC(n);const o=mA(t),a=IDBKeyRange.lowerBound(s,!0);return o.Kt({index:Zk.readTimeIndex,range:a},(e,t)=>{var n=CC(r.N,t);i=i.insert(n.key,n),s=t.readTime}).next(()=>({Tn:i,readTime:RC(s)}))}(n.jn,e,n.Kn)).then(({Tn:e,readTime:t})=>(n.Kn=t,e))}class qA{constructor(e){this.N=e,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(e,t){return hC.resolve(this.Yn.get(t))}saveBundleMetadata(e,t){return this.Yn.set(t.id,{id:t.id,version:t.version,createTime:wk(t.createTime)}),hC.resolve()}getNamedQuery(e,t){return hC.resolve(this.Xn.get(t))}saveNamedQuery(e,t){return this.Xn.set(t.name,{name:(t=t).name,query:MC(t.bundledQuery),readTime:wk(t.readTime)}),hC.resolve()}}class VA{constructor(){this.Zn=new XS(BA.ts),this.es=new XS(BA.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){t=new BA(e,t);this.Zn=this.Zn.add(t),this.es=this.es.add(t)}ss(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.rs(new BA(e,t))}os(e,t){e.forEach(e=>this.removeReference(e,t))}cs(e){const t=new wE(new oE([])),n=new BA(t,e),r=new BA(t,e+1),i=[];return this.es.forEachInRange([n,r],e=>{this.rs(e),i.push(e.key)}),i}us(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){var t=new wE(new oE([])),n=new BA(t,e),e=new BA(t,e+1);let r=ik();return this.es.forEachInRange([n,e],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new BA(e,0),t=this.Zn.firstAfterOrEqual(t);return null!==t&&e.isEqual(t.key)}}class BA{constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return wE.comparator(e.key,t.key)||J0(e.ls,t.ls)}static ns(e,t){return J0(e.ls,t.ls)||wE.comparator(e.key,t.key)}}class KA{constructor(e,t){this.Ht=e,this.referenceDelegate=t,this.In=[],this.fs=1,this.ds=new XS(BA.ts)}checkEmpty(e){return hC.resolve(0===this.In.length)}addMutationBatch(e,t,n,r){var i=this.fs;this.fs++,0<this.In.length&&this.In[this.In.length-1];n=new TC(i,t,n,r);this.In.push(n);for(const t of r)this.ds=this.ds.add(new BA(t.key,i)),this.Ht.addToCollectionParentIndex(e,t.key.path.popLast());return hC.resolve(n)}lookupMutationBatch(e,t){return hC.resolve(this.ws(t))}getNextMutationBatchAfterBatchId(e,t){t=this._s(t+1),t=t<0?0:t;return hC.resolve(this.In.length>t?this.In[t]:null)}getHighestUnacknowledgedBatchId(){return hC.resolve(0===this.In.length?-1:this.fs-1)}getAllMutationBatches(e){return hC.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new BA(t,0),r=new BA(t,Number.POSITIVE_INFINITY),i=[];return this.ds.forEachInRange([n,r],e=>{e=this.ws(e.ls);i.push(e)}),hC.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new XS(J0);return t.forEach(e=>{var t=new BA(e,0),e=new BA(e,Number.POSITIVE_INFINITY);this.ds.forEachInRange([t,e],e=>{n=n.add(e.ls)})}),hC.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;wE.isDocumentKey(i)||(i=i.child(""));t=new BA(new wE(i),0);let s=new XS(J0);return this.ds.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(s=s.add(e.ls)),!0)},t),hC.resolve(this.gs(s))}gs(e){const t=[];return e.forEach(e=>{e=this.ws(e);null!==e&&t.push(e)}),t}removeMutationBatch(n,r){j0(0===this.ys(r.batchId,"removed")),this.In.shift();let i=this.ds;return hC.forEach(r.mutations,e=>{var t=new BA(e.key,r.batchId);return i=i.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.ds=i})}te(e){}containsKey(e,t){var n=new BA(t,0),n=this.ds.firstAfterOrEqual(n);return hC.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.In.length,hC.resolve()}ys(e,t){return this._s(e)}_s(e){return 0===this.In.length?0:e-this.In[0].batchId}ws(e){e=this._s(e);return e<0||e>=this.In.length?null:this.In[e]}}class zA{constructor(e,t){this.Ht=e,this.ps=t,this.docs=new QS(wE.comparator),this.size=0}addEntry(e,t,n){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ps(t);return this.docs=this.docs.insert(r,{document:t.clone(),size:o,readTime:n}),this.size+=o-s,this.Ht.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return hC.resolve(n?n.document.clone():LE.newInvalidDocument(t))}getEntries(e,t){let n=ek;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.clone():LE.newInvalidDocument(e))}),hC.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=ek;const i=new wE(t.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||gS(t,i)&&(r=r.insert(i.key,i.clone()))}return hC.resolve(r)}Es(e,t){return hC.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new WA(this)}getSize(e){return hC.resolve(this.size)}}class WA extends dA{constructor(e){super(),this.Se=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.document.isValidDocument()?r.push(this.Se.addEntry(n,t.document,this.getReadTime(e))):this.Se.removeEntry(e)}),hC.waitFor(r)}getFromCache(e,t){return this.Se.getEntry(e,t)}getAllFromCache(e,t){return this.Se.getEntries(e,t)}}class $A{constructor(e){this.persistence=e,this.Ts=new hA(e=>UE(e),jE),this.lastRemoteSnapshotVersion=tE.min(),this.highestTargetId=0,this.Is=0,this.As=new VA,this.targetCount=0,this.Rs=ZC.se()}forEachTarget(e,n){return this.Ts.forEach((e,t)=>n(t)),hC.resolve()}getLastRemoteSnapshotVersion(e){return hC.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return hC.resolve(this.Is)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),hC.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Is&&(this.Is=t),hC.resolve()}ae(e){this.Ts.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Rs=new ZC(t),this.highestTargetId=t),e.sequenceNumber>this.Is&&(this.Is=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,hC.resolve()}updateTargetData(e,t){return this.ae(t),hC.resolve()}removeTargetData(e,t){return this.Ts.delete(t.target),this.As.cs(t.targetId),--this.targetCount,hC.resolve()}removeTargets(n,r,i){let s=0;const o=[];return this.Ts.forEach((e,t)=>{t.sequenceNumber<=r&&null===i.get(t.targetId)&&(this.Ts.delete(e),o.push(this.removeMatchingKeysForTargetId(n,t.targetId)),s++)}),hC.waitFor(o).next(()=>s)}getTargetCount(e){return hC.resolve(this.targetCount)}getTargetData(e,t){t=this.Ts.get(t)||null;return hC.resolve(t)}addMatchingKeys(e,t,n){return this.As.ss(t,n),hC.resolve()}removeMatchingKeys(t,e,n){this.As.os(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),hC.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.As.cs(t),hC.resolve()}getMatchingKeysForTargetId(e,t){t=this.As.hs(t);return hC.resolve(t)}containsKey(e,t){return hC.resolve(this.As.containsKey(t))}}class HA{constructor(e,t){var n;this.bs={},this.Le=new Q0(0),this.Be=!1,this.Be=!0,this.referenceDelegate=e(this),this.ze=new $A(this),this.Ht=new qC,this.He=(n=this.Ht,e=e=>this.referenceDelegate.Ps(e),new zA(n,e)),this.N=new kC(t),this.Je=new qA(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(e){let t=this.bs[e.toKey()];return t||(t=new KA(this.Ht,this.referenceDelegate),this.bs[e.toKey()]=t),t}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(e,t,n){D0("MemoryPersistence","Starting transaction:",e);const r=new GA(this.Le.next());return this.referenceDelegate.vs(),n(r).next(e=>this.referenceDelegate.Vs(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ss(t,n){return hC.or(Object.values(this.bs).map(e=>()=>e.containsKey(t,n)))}}class GA extends uC{constructor(e){super(),this.currentSequenceNumber=e}}class QA{constructor(e){this.persistence=e,this.Ds=new VA,this.Cs=null}static Ns(e){return new QA(e)}get xs(){if(this.Cs)return this.Cs;throw U0()}addReference(e,t,n){return this.Ds.addReference(n,t),this.xs.delete(n.toString()),hC.resolve()}removeReference(e,t,n){return this.Ds.removeReference(n,t),this.xs.add(n.toString()),hC.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),hC.resolve()}removeTarget(e,t){this.Ds.cs(t.targetId).forEach(e=>this.xs.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.xs.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}vs(){this.Cs=new Set}Vs(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return hC.forEach(this.xs,e=>{const t=wE.fromPath(e);return this.ks(n,t).next(e=>{e||r.removeEntry(t)})}).next(()=>(this.Cs=null,r.apply(n)))}updateLimboDocument(e,t){return this.ks(e,t).next(e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())})}Ps(e){return 0}ks(e,t){return hC.or([()=>hC.resolve(this.Ds.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ss(e,t)])}}function YA(e,t){return`firestore_clients_${e}_${t}`}function JA(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function XA(e,t){return`firestore_targets_${e}_${t}`}class ZA{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static $s(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new V0(r.error.code,r.error.message))),s?new ZA(e,t,r.state,i):(L0("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class eN{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static $s(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new V0(n.error.code,n.error.message))),i?new eN(e,n.state,r):(L0("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Os(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class tN{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static $s(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=sk;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=_E(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new tN(e,i):(L0("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class nN{constructor(e,t){this.clientId=e,this.onlineState=t}static $s(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new nN(t.clientId,t.onlineState):(L0("SharedClientState",`Failed to parse online state: ${e}`),null)}}class rN{constructor(){this.activeTargetIds=sk}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ms(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Os(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class iN{constructor(e,t,n,r,i){this.window=e,this.Oe=t,this.persistenceKey=n,this.Ls=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Bs=this.Us.bind(this),this.qs=new QS(J0),this.started=!1,this.Ks=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.js=YA(this.persistenceKey,this.Ls),this.Qs=`firestore_sequence_number_${this.persistenceKey}`,this.qs=this.qs.insert(this.Ls,new rN),this.Ws=new RegExp(`^firestore_clients_${n}_([^_]*)$`),this.Gs=new RegExp(`^firestore_mutations_${n}_(\\d+)(?:_(.*))?$`),this.zs=new RegExp(`^firestore_targets_${n}_(\\d+)$`),this.Hs=`firestore_online_state_${this.persistenceKey}`,this.Js=`firestore_bundle_loaded_${this.persistenceKey}`,this.window.addEventListener("storage",this.Bs)}static bt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.pn();for(const n of e)if(n!==this.Ls){const e=this.getItem(YA(this.persistenceKey,n));var t;!e||(t=tN.$s(n,e))&&(this.qs=this.qs.insert(t.clientId,t))}this.Ys();const n=this.storage.getItem(this.Hs);if(n){const e=this.Xs(n);e&&this.Zs(e)}for(const e of this.Ks)this.Us(e);this.Ks=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Qs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ti(this.qs)}isActiveQueryTarget(n){let r=!1;return this.qs.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.ei(e,"pending")}updateMutationState(e,t,n){this.ei(e,t,n),this.ni(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(XA(this.persistenceKey,e)))||(n=eN.$s(e,n))&&(t=n.state)),this.si.Fs(e),this.Ys(),t}removeLocalQueryTarget(e){this.si.Ms(e),this.Ys()}isLocalQueryTarget(e){return this.si.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(XA(this.persistenceKey,e))}updateQueryState(e,t,n){this.ii(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.ni(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.ri(e)}notifyBundleLoaded(){this.oi()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Bs),this.removeItem(this.js),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return D0("SharedClientState","READ",e,t),t}setItem(e,t){D0("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){D0("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Us(e){const r=e;r.storageArea===this.storage&&(D0("SharedClientState","EVENT",r.key,r.newValue),r.key!==this.js?this.Oe.enqueueRetryable(async()=>{if(this.started){if(null!==r.key)if(this.Ws.test(r.key)){if(null==r.newValue){var e=this.ai(r.key);return this.ci(e,null)}e=this.ui(r.key,r.newValue);if(e)return this.ci(e.clientId,e)}else if(this.Gs.test(r.key)){if(null!==r.newValue){var t=this.hi(r.key,r.newValue);if(t)return this.li(t)}}else if(this.zs.test(r.key)){if(null!==r.newValue){t=this.fi(r.key,r.newValue);if(t)return this.di(t)}}else if(r.key===this.Hs){if(null!==r.newValue){var n=this.Xs(r.newValue);if(n)return this.Zs(n)}}else if(r.key===this.Qs){n=function(e){let t=Q0.T;if(null!=e)try{var n=JSON.parse(e);j0("number"==typeof n),t=n}catch(e){L0("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(r.newValue);n!==Q0.T&&this.sequenceNumberHandler(n)}else if(r.key===this.Js)return this.syncEngine.wi()}else this.Ks.push(r)}):L0("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get si(){return this.qs.get(this.Ls)}Ys(){this.setItem(this.js,this.si.Os())}ei(e,t,n){const r=new ZA(this.currentUser,e,t,n),i=JA(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Os())}ni(e){e=JA(this.persistenceKey,this.currentUser,e);this.removeItem(e)}ri(e){e={clientId:this.Ls,onlineState:e};this.storage.setItem(this.Hs,JSON.stringify(e))}ii(e,t,n){const r=XA(this.persistenceKey,e),i=new eN(e,t,n);this.setItem(r,i.Os())}oi(){this.setItem(this.Js,"value-not-used")}ai(e){e=this.Ws.exec(e);return e?e[1]:null}ui(e,t){e=this.ai(e);return tN.$s(e,t)}hi(e,t){var n=this.Gs.exec(e),e=Number(n[1]),n=void 0!==n[2]?n[2]:null;return ZA.$s(new R0(n),e,t)}fi(e,t){e=this.zs.exec(e),e=Number(e[1]);return eN.$s(e,t)}Xs(e){return nN.$s(e)}async li(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine._i(e.batchId,e.state,e.error);D0("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}di(e){return this.syncEngine.mi(e.targetId,e.state,e.error)}ci(e,t){const n=t?this.qs.insert(e,t):this.qs.remove(e),r=this.ti(this.qs),i=this.ti(n),s=[],o=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||o.push(e)}),this.syncEngine.gi(s,o).then(()=>{this.qs=n})}Zs(e){this.qs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ti(e){let n=sk;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class sN{constructor(){this.yi=new rN,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.yi.Fs(e),this.pi[e]||"not-current"}updateQueryState(e,t,n){this.pi[e]=t}removeLocalQueryTarget(e){this.yi.Ms(e)}isLocalQueryTarget(e){return this.yi.activeTargetIds.has(e)}clearQueryState(e){delete this.pi[e]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(e){return this.yi.activeTargetIds.has(e)}start(){return this.yi=new rN,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class oN{Ei(e){}shutdown(){}}class aN{constructor(){this.Ti=()=>this.Ii(),this.Ai=()=>this.Ri(),this.bi=[],this.Pi()}Ei(e){this.bi.push(e)}shutdown(){window.removeEventListener("online",this.Ti),window.removeEventListener("offline",this.Ai)}Pi(){window.addEventListener("online",this.Ti),window.addEventListener("offline",this.Ai)}Ii(){D0("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.bi)e(0)}Ri(){D0("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.bi)e(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const cN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class lN{constructor(e){this.vi=e.vi,this.Vi=e.Vi}Si(e){this.Di=e}Ci(e){this.Ni=e}onMessage(e){this.xi=e}close(){this.Vi()}send(e){this.vi(e)}ki(){this.Di()}$i(e){this.Ni(e)}Oi(e){this.xi(e)}}class uN extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.Fi=t+"://"+e.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(t,e,n,r){const i=this.Bi(t,e);D0("RestConnection","Sending: ",i,n);e={};return this.Ui(e,r),this.qi(t,i,e,n).then(e=>(D0("RestConnection","Received: ",e),e),e=>{throw M0("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e})}Ki(e,t,n,r){return this.Li(e,t,n,r)}Ui(e,t){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+P0,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t)for(const n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])}Bi(e,t){e=cN[e];return`${this.Fi}/v1/${t}:${e}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}qi(a,t,n,r){return new Promise((i,s)=>{const o=new N0;o.listenOnce(T0.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case I0.NO_ERROR:var e=o.getResponseJson();D0("Connection","XHR received:",JSON.stringify(e)),i(e);break;case I0.TIMEOUT:D0("Connection",'RPC "'+a+'" timed out'),s(new V0(q0.DEADLINE_EXCEEDED,"Request time out"));break;case I0.HTTP_ERROR:var t,n=o.getStatus();if(D0("Connection",'RPC "'+a+'" failed with status:',n,"response text:",o.getResponseText()),0<n){const a=o.getResponseJson().error;a&&a.status&&a.message?(r=a.status.toLowerCase().replace(/_/g,"-"),t=0<=Object.values(q0).indexOf(r)?r:q0.UNKNOWN,s(new V0(t,a.message))):s(new V0(q0.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new V0(q0.UNAVAILABLE,"Connection failed."));break;default:U0()}}finally{D0("Connection",'RPC "'+a+'" completed.')}var r});var e=JSON.stringify(r);o.send(t,"POST",e,n,15)})}ji(e,t){const n=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=new g0,i=b0(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(s.xmlHttpFactory=new C0({})),this.Ui(s.initMessageHeaders,t),ps()||ys()||0<=fs().indexOf("Electron/")||vs()||0<=fs().indexOf("MSAppHost/")||ms()||(s.httpHeadersOverwriteParam="$httpHeaders");t=n.join("");D0("Connection","Creating WebChannel: "+t,s);const o=r.createWebChannel(t,s);let a=!1,c=!1;const l=new lN({vi:e=>{c?D0("Connection","Not sending because WebChannel is closed:",e):(a||(D0("Connection","Opening WebChannel transport."),o.open(),a=!0),D0("Connection","WebChannel sending:",e),o.send(e))},Vi:()=>o.close()}),u=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return u(o,A0.EventType.OPEN,()=>{c||D0("Connection","WebChannel transport opened.")}),u(o,A0.EventType.CLOSE,()=>{c||(c=!0,D0("Connection","WebChannel transport closed"),l.$i())}),u(o,A0.EventType.ERROR,e=>{c||(c=!0,M0("Connection","WebChannel transport errored:",e),l.$i(new V0(q0.UNAVAILABLE,"The operation could not be completed")))}),u(o,A0.EventType.MESSAGE,e=>{if(!c){e=e.data[0];j0(!!e);var n=e.error||(null===(n=e[0])||void 0===n?void 0:n.error);if(n){D0("Connection","WebChannel received error:",n);const r=n.status;let e=function(e){e=w0[e];if(void 0!==e)return GS(e)}(r),t=n.message;void 0===e&&(e=q0.INTERNAL,t="Unknown error status: "+r+" with message "+n.message),c=!0,l.$i(new V0(e,t)),o.close()}else D0("Connection","WebChannel received:",e),l.Oi(e)}}),u(i,E0.STAT_EVENT,e=>{e.stat===S0?D0("Connection","Detected buffering proxy"):e.stat===k0&&D0("Connection","Detected no buffering proxy")}),setTimeout(()=>{l.ki()},0),l}}function hN(){return"undefined"!=typeof window?window:null}function dN(){return"undefined"!=typeof document?document:null}function fN(e){return new yk(e,!0)}class pN{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Oe=e,this.timerId=t,this.Qi=n,this.Wi=r,this.Gi=i,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(e){this.cancel();var t=Math.floor(this.zi+this.Zi()),n=Math.max(0,Date.now()-this.Ji),r=Math.max(0,t-n);0<r&&D0("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.zi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,r,()=>(this.Ji=Date.now(),e())),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}class gN{constructor(e,t,n,r,i,s){this.Oe=e,this.er=n,this.nr=r,this.credentialsProvider=i,this.listener=s,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new pN(e,t)}ar(){return 1===this.state||2===this.state||4===this.state}cr(){return 2===this.state}start(){3!==this.state?this.auth():this.ur()}async stop(){this.ar()&&await this.close(0)}hr(){this.state=0,this.rr.reset()}lr(){this.cr()&&null===this.ir&&(this.ir=this.Oe.enqueueAfterDelay(this.er,6e4,()=>this.dr()))}wr(e){this._r(),this.stream.send(e)}async dr(){if(this.cr())return this.close(0)}_r(){this.ir&&(this.ir.cancel(),this.ir=null)}async close(e,t){this._r(),this.rr.cancel(),this.sr++,3!==e?this.rr.reset():t&&t.code===q0.RESOURCE_EXHAUSTED?(L0(t.toString()),L0("Using maximum backoff delay to prevent overloading the backend."),this.rr.Yi()):t&&t.code===q0.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ci(t)}mr(){}auth(){this.state=1;const e=this.gr(this.sr),t=this.sr;this.credentialsProvider.getToken().then(e=>{this.sr===t&&this.yr(e)},t=>{e(()=>{var e=new V0(q0.UNKNOWN,"Fetching auth token failed: "+t.message);return this.pr(e)})})}yr(e){const t=this.gr(this.sr);this.stream=this.Er(e),this.stream.Si(()=>{t(()=>(this.state=2,this.listener.Si()))}),this.stream.Ci(e=>{t(()=>this.pr(e))}),this.stream.onMessage(e=>{t(()=>this.onMessage(e))})}ur(){this.state=4,this.rr.Xi(async()=>{this.state=0,this.start()})}pr(e){return D0("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(3,e)}gr(t){return e=>{this.Oe.enqueueAndForget(()=>this.sr===t?e():(D0("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class mN extends gN{constructor(e,t,n,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle",t,n,i),this.N=r}Er(e){return this.nr.ji("Listen",e)}onMessage(e){this.rr.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(s=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===s?1:"REMOVE"===s?2:"CURRENT"===s?3:"RESET"===s?4:U0(),i=t.targetChange.targetIds||[],s=(o=t.targetChange.resumeToken,e.D?(j0(void 0===o||"string"==typeof o),uE.fromBase64String(o||"")):(j0(void 0===o||o instanceof Uint8Array),uE.fromUint8Array(o||new Uint8Array))),o=t.targetChange.cause,a=o&&(o=void 0===(a=o).code?q0.UNKNOWN:GS(a.code),new V0(o,a.message||""));n=new uk(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;var c=t.documentChange;c.document,c.document.name,c.document.updateTime;var s=Ek(e,c.document.name),l=wk(c.document.updateTime),a=new DE({mapValue:{fields:c.document.fields}}),l=LE.newFoundDocument(s,l,a),a=c.targetIds||[],c=c.removedTargetIds||[];n=new ck(a,c,l.key,l)}else if("documentDelete"in t){t.documentDelete;c=t.documentDelete;c.document;var l=Ek(e,c.document),u=c.readTime?wk(c.readTime):tE.min(),u=LE.newNoDocument(l,u),c=c.removedTargetIds||[];n=new ck([],c,u.key,u)}else if("documentRemove"in t){t.documentRemove;u=t.documentRemove;u.document;var h=Ek(e,u.document),u=u.removedTargetIds||[];n=new ck([],u,h,null)}else{if(!("filter"in t))return U0();{t.filter;const e=t.filter;e.targetId;h=e.count||0,t=new $S(h),h=e.targetId;n=new lk(h,t)}}var a,s;return n}(this.N,e),e=function(e){if(!("targetChange"in e))return tE.min();e=e.targetChange;return(!e.targetIds||!e.targetIds.length)&&e.readTime?wk(e.readTime):tE.min()}(e);return this.listener.Tr(t,e)}Ir(e){const t={};t.database=Ck(this.N),t.addTarget=function(e,t){let n;var r=t.target;return n=qE(r)?{documents:xk(e,r)}:{query:Dk(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=_k(e,t.resumeToken):0<t.snapshotVersion.compareTo(tE.min())&&(n.readTime=vk(e,t.snapshotVersion.toTimestamp())),n}(this.N,e);var n,e=(this.N,n=e,null==(e=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return U0()}}())?null:{"goog-listen-tags":e});e&&(t.labels=e),this.wr(t)}Ar(e){const t={};t.database=Ck(this.N),t.removeTarget=e,this.wr(t)}}class yN extends gN{constructor(e,t,n,r,i){super(e,"write_stream_connection_backoff","write_stream_idle",t,n,i),this.N=r,this.Rr=!1}get br(){return this.Rr}start(){this.Rr=!1,this.lastStreamToken=void 0,super.start()}mr(){this.Rr&&this.Pr([])}Er(e){return this.nr.ji("Write",e)}onMessage(e){if(j0(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Rr){this.rr.reset();var t=(n=e.writeResults,r=e.commitTime,n&&0<n.length?(j0(void 0!==r),n.map(e=>function(e,t){let n=e.updateTime?wk(e.updateTime):wk(t);return n.isEqual(tE.min())&&(n=wk(t)),new PS(n,e.transformResults||[])}(e,r))):[]),n=wk(e.commitTime);return this.listener.vr(n,t)}var n,r;return j0(!e.writeResults||0===e.writeResults.length),this.Rr=!0,this.listener.Vr()}Sr(){const e={};e.database=Ck(this.N),this.wr(e)}Pr(e){e={streamToken:this.lastStreamToken,writes:e.map(e=>Pk(this.N,e))};this.wr(e)}}class vN extends class{}{constructor(e,t,n){super(),this.credentials=e,this.nr=t,this.N=n,this.Dr=!1}Cr(){if(this.Dr)throw new V0(q0.FAILED_PRECONDITION,"The client has already been terminated.")}Li(t,n,r){return this.Cr(),this.credentials.getToken().then(e=>this.nr.Li(t,n,r,e)).catch(e=>{throw"FirebaseError"===e.name?(e.code===q0.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new V0(q0.UNKNOWN,e.toString())})}Ki(t,n,r){return this.Cr(),this.credentials.getToken().then(e=>this.nr.Ki(t,n,r,e)).catch(e=>{throw"FirebaseError"===e.name?(e.code===q0.UNAUTHENTICATED&&this.credentials.invalidateToken(),e):new V0(q0.UNKNOWN,e.toString())})}terminate(){this.Dr=!0}}class _N{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Nr=0,this.kr=null,this.$r=!0}Or(){0===this.Nr&&(this.Fr("Unknown"),this.kr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.kr=null,this.Mr("Backend didn't respond within 10 seconds."),this.Fr("Offline"),Promise.resolve())))}Lr(e){"Online"===this.state?this.Fr("Unknown"):(this.Nr++,1<=this.Nr&&(this.Br(),this.Mr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Fr("Offline")))}set(e){this.Br(),this.Nr=0,"Online"===e&&(this.$r=!1),this.Fr(e)}Fr(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Mr(e){e=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.$r?(L0(e),this.$r=!1):D0("OnlineStateTracker",e)}Br(){null!==this.kr&&(this.kr.cancel(),this.kr=null)}}class wN{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ur=[],this.qr=new Map,this.Kr=new Set,this.jr=[],this.Qr=i,this.Qr.Ei(e=>{n.enqueueAndForget(async()=>{NN(this)&&(D0("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.Kr.add(4),await IN(t),t.Wr.set("Unknown"),t.Kr.delete(4),await bN(t)}(this))})}),this.Wr=new _N(n,r)}}async function bN(e){if(NN(e))for(const t of e.jr)await t(!0)}async function IN(e){for(const t of e.jr)await t(!1)}function TN(e,t){const n=e;n.qr.has(t.targetId)||(n.qr.set(t.targetId,t),AN(n)?CN(n):FN(n).cr()&&SN(n,t))}function EN(e,t){const n=e,r=FN(n);n.qr.delete(t),r.cr()&&kN(n,t),0===n.qr.size&&(r.cr()?r.lr():NN(n)&&n.Wr.set("Unknown"))}function SN(e,t){e.Gr.Y(t.targetId),FN(e).Ir(t)}function kN(e,t){e.Gr.Y(t),FN(e).Ar(t)}function CN(t){t.Gr=new dk({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>t.qr.get(e)||null}),FN(t).start(),t.Wr.Or()}function AN(e){return NN(e)&&!FN(e).ar()&&0<e.qr.size}function NN(e){return 0===e.Kr.size}function RN(e){e.Gr=void 0}async function PN(e,t,n){if(!mC(t))throw t;e.Kr.add(1),await IN(e),e.Wr.set("Offline"),n=n||(()=>OA(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{D0("RemoteStore","Retrying IndexedDB access"),await n(),e.Kr.delete(1),await bN(e)})}function ON(t,n){return n().catch(e=>PN(t,e,n))}async function xN(e){const t=e,n=UN(t);let r=0<t.Ur.length?t.Ur[t.Ur.length-1].batchId:-1;for(;NN(i=t)&&i.Ur.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.In.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.Ur.length&&n.lr();break}r=e.batchId,function(e,t){e.Ur.push(t);const n=UN(e);n.cr()&&n.br&&n.Pr(t.mutations)}(t,e)}catch(e){await PN(t,e)}var i;DN(t)&&LN(t)}function DN(e){return NN(e)&&!UN(e).ar()&&0<e.Ur.length}function LN(e){UN(e).start()}async function MN(e,t){const n=e;t?(n.Kr.delete(2),await bN(n)):t||(n.Kr.add(2),await IN(n),n.Wr.set("Unknown"))}function FN(t){return t.zr||(t.zr=function(e,t,n){const r=e;return r.Cr(),new mN(t,r.nr,r.credentials,r.N,n)}(t.datastore,t.asyncQueue,{Si:async function(n){n.qr.forEach((e,t)=>{SN(n,e)})}.bind(null,t),Ci:async function(e,t){RN(e),AN(e)?(e.Wr.Lr(t),CN(e)):e.Wr.set("Unknown")}.bind(null,t),Tr:async function(e,r,t){if(e.Wr.set("Online"),r instanceof uk&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.qr.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.qr.delete(n),e.Gr.removeTarget(n))}(e)}catch(t){D0("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await PN(e,t)}else if(r instanceof ck?e.Gr.rt(r):r instanceof lk?e.Gr.ft(r):e.Gr.ct(r),!t.isEqual(tE.min()))try{const r=await OA(e.localStore);0<=t.compareTo(r)&&await function(r,i){const e=r.Gr._t(i);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.qr.get(t);n&&r.qr.set(t,n.withResumeToken(e.resumeToken,i))}}),e.targetMismatches.forEach(e=>{const t=r.qr.get(e);t&&(r.qr.set(e,t.withResumeToken(uE.EMPTY_BYTE_STRING,t.snapshotVersion)),kN(r,e),e=new SC(t.target,e,1,t.sequenceNumber),SN(r,e))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){D0("RemoteStore","Failed to raise snapshot:",r),await PN(e,r)}}.bind(null,t)}),t.jr.push(async e=>{e?(t.zr.hr(),AN(t)?CN(t):t.Wr.set("Unknown")):(await t.zr.stop(),RN(t))})),t.zr}function UN(t){return t.Hr||(t.Hr=function(e,t,n){const r=e;return r.Cr(),new yN(t,r.nr,r.credentials,r.N,n)}(t.datastore,t.asyncQueue,{Si:async function(e){UN(e).Sr()}.bind(null,t),Ci:async function(e,t){t&&UN(e).br&&await async function(e,t){if(HS(n=t.code)&&n!==q0.ABORTED){const n=e.Ur.shift();UN(e).hr(),await ON(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await xN(e)}var n}(e,t),DN(e)&&LN(e)}.bind(null,t),Vr:async function(e){const t=UN(e);for(const n of e.Ur)t.Pr(n.mutations)}.bind(null,t),vr:async function(e,t,n){const r=e.Ur.shift(),i=EC.from(r,t,n);await ON(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await xN(e)}.bind(null,t)}),t.jr.push(async e=>{e?(t.Hr.hr(),await xN(t)):(await t.Hr.stop(),0<t.Ur.length&&(D0("RemoteStore",`Stopping write stream with ${t.Ur.length} pending writes`),t.Ur=[]))})),t.Hr}class jN{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new B0,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new jN(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new V0(q0.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function qN(e,t){if(L0("AsyncQueue",`${t}: ${e}`),mC(e))return new V0(q0.UNAVAILABLE,`${t}: ${e}`);throw e}class VN{constructor(n){this.comparator=n?(e,t)=>n(e,t)||wE.comparator(e.key,t.key):(e,t)=>wE.comparator(e.key,t.key),this.keyedMap=tk,this.sortedSet=new QS(this.comparator)}static emptySet(e){return new VN(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){e=this.keyedMap.get(e);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof VN))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new VN;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class BN{constructor(){this.Jr=new QS(wE.comparator)}track(e){var t=e.doc.key,n=this.Jr.get(t);!n||0!==e.type&&3===n.type?this.Jr=this.Jr.insert(t,e):3===e.type&&1!==n.type?this.Jr=this.Jr.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Jr=this.Jr.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Jr=this.Jr.remove(t):1===e.type&&2===n.type?this.Jr=this.Jr.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Jr=this.Jr.insert(t,{type:2,doc:e.doc}):U0()}Yr(){const n=[];return this.Jr.inorderTraversal((e,t)=>{n.push(t)}),n}}class KN{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new KN(e,t,VN.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&dS(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class zN{constructor(){this.Xr=void 0,this.listeners=[]}}class WN{constructor(){this.queries=new hA(e=>fS(e),dS),this.onlineState="Unknown",this.Zr=new Set}}async function $N(e,t){const n=e,r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new zN),i)try{s.Xr=await n.onListen(r)}catch(e){const n=qN(e,`Initialization of query '${pS(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.eo(n.onlineState),!s.Xr||t.no(s.Xr)&&GN(n)}async function HN(e,t){const n=e,r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);0<=e&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function GN(e){e.Zr.forEach(e=>{e.next()})}class QN{constructor(e,t,n){this.query=e,this.so=t,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}no(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new KN(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.io?this.oo(e)&&(this.so.next(e),t=!0):this.ao(e,this.onlineState)&&(this.co(e),t=!0),this.ro=e,t}onError(e){this.so.error(e)}eo(e){this.onlineState=e;let t=!1;return this.ro&&!this.io&&this.ao(this.ro,e)&&(this.co(this.ro),t=!0),t}ao(e,t){return!e.fromCache||!(this.options.uo&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}oo(e){if(0<e.docChanges.length)return!0;var t=this.ro&&this.ro.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}co(e){e=KN.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.io=!0,this.so.next(e)}}class YN{constructor(e,t){this.payload=e,this.byteLength=t}ho(){return"metadata"in this.payload}}class JN{constructor(e){this.N=e}zn(e){return Ek(this.N,e)}Hn(e){return e.metadata.exists?Rk(this.N,e.document,!1):LE.newNoDocument(this.zn(e.metadata.name),this.Jn(e.metadata.readTime))}Jn(e){return wk(e)}}class XN{constructor(e,t,n){this.lo=e,this.localStore=t,this.N=n,this.queries=[],this.documents=[],this.progress=ZN(e)}fo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}wo(e){const t=new Map,n=new JN(this.N);for(const i of e)if(i.metadata.queries){const e=n.zn(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||ik()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=ik(),o=ek,a=nk;for(const e of n){const n=t.zn(e.metadata.name);e.document&&(s=s.add(n)),o=o.insert(n,t.Hn(e)),a=a.insert(n,t.Jn(e.metadata.readTime))}const c=i.jn.newChangeBuffer({trackRemovals:!0}),l=await LA(i,(r=r,uS(rS(oE.fromString(`__bundle__/docs/${r}`)))));return i.persistence.runTransaction("Apply bundle documents","readwrite",t=>DA(t,c,o,tE.min(),a).next(e=>(c.apply(t),e)).next(e=>i.ze.removeMatchingKeysForTargetId(t,l.targetId).next(()=>i.ze.addMatchingKeys(t,s,l.targetId)).next(()=>i.Qn.vn(t,e)).next(()=>e)))}(this.localStore,new JN(this.N),this.documents,this.lo.id),t=this.wo(this.documents);for(const e of this.queries)await async function(e,n,r=ik()){const i=await LA(e,uS(MC(n.bundledQuery))),s=e;return s.persistence.runTransaction("Save named query","readwrite",e=>{var t=wk(n.readTime);if(0<=i.snapshotVersion.compareTo(t))return s.Je.saveNamedQuery(e,n);t=i.withResumeToken(uE.EMPTY_BYTE_STRING,t);return s.Un=s.Un.insert(t.targetId,t),s.ze.updateTargetData(e,t).next(()=>s.ze.removeMatchingKeysForTargetId(e,i.targetId)).next(()=>s.ze.addMatchingKeys(e,r,i.targetId)).next(()=>s.Je.saveNamedQuery(e,n))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",new SA(Object.assign({},this.progress),e)}}function ZN(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class eR{constructor(e){this.key=e}}class tR{constructor(e){this.key=e}}class nR{constructor(e,t){this.query=e,this._o=t,this.mo=null,this.current=!1,this.yo=ik(),this.mutatedKeys=ik(),this.po=mS(e),this.Eo=new VN(this.po)}get To(){return this._o}Io(e,t){const a=t?t.Ao:new BN,c=(t||this).Eo;let l=(t||this).mutatedKeys,u=c,h=!1;const d=iS(this.query)&&c.size===this.query.limit?c.last():null,f=sS(this.query)&&c.size===this.query.limit?c.first():null;if(e.inorderTraversal((e,t)=>{const n=c.get(e),r=gS(this.query,t)?t:null,i=!!n&&this.mutatedKeys.has(n.key),s=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let o=!1;n&&r?n.data.isEqual(r.data)?i!==s&&(a.track({type:3,doc:r}),o=!0):this.Ro(n,r)||(a.track({type:2,doc:r}),o=!0,(d&&0<this.po(r,d)||f&&this.po(r,f)<0)&&(h=!0)):!n&&r?(a.track({type:0,doc:r}),o=!0):n&&!r&&(a.track({type:1,doc:n}),o=!0,(d||f)&&(h=!0)),o&&(l=r?(u=u.add(r),s?l.add(e):l.delete(e)):(u=u.delete(e),l.delete(e)))}),iS(this.query)||sS(this.query))for(;u.size>this.query.limit;){const e=iS(this.query)?u.last():u.first();u=u.delete(e.key),l=l.delete(e.key),a.track({type:1,doc:e})}return{Eo:u,Ao:a,Ln:h,mutatedKeys:l}}Ro(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.Eo;this.Eo=e.Eo,this.mutatedKeys=e.mutatedKeys;const i=e.Ao.Yr();i.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U0()}};return n(e)-n(t)}(e.type,t.type)||this.po(e.doc,t.doc)),this.bo(n);var s=t?this.Po():[],n=0===this.yo.size&&this.current?1:0,t=n!==this.mo;return this.mo=n,0!==i.length||t?{snapshot:new KN(this.query,e.Eo,r,i,e.mutatedKeys,0==n,t,!1),vo:s}:{vo:s}}eo(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Eo:this.Eo,Ao:new BN,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{vo:[]}}Vo(e){return!this._o.has(e)&&!!this.Eo.has(e)&&!this.Eo.get(e).hasLocalMutations}bo(e){e&&(e.addedDocuments.forEach(e=>this._o=this._o.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._o=this._o.delete(e)),this.current=e.current)}Po(){if(!this.current)return[];const t=this.yo;this.yo=ik(),this.Eo.forEach(e=>{this.Vo(e.key)&&(this.yo=this.yo.add(e.key))});const n=[];return t.forEach(e=>{this.yo.has(e)||n.push(new tR(e))}),this.yo.forEach(e=>{t.has(e)||n.push(new eR(e))}),n}So(e){this._o=e.Gn,this.yo=ik();e=this.Io(e.documents);return this.applyChanges(e,!0)}Do(){return KN.fromInitialDocuments(this.query,this.Eo,this.mutatedKeys,0===this.mo)}}class rR{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class iR{constructor(e){this.key=e,this.Co=!1}}class sR{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.No={},this.xo=new hA(e=>fS(e),dS),this.ko=new Map,this.$o=new Set,this.Oo=new QS(wE.comparator),this.Fo=new Map,this.Mo=new VA,this.Lo={},this.Bo=new Map,this.Uo=ZC.ie(),this.onlineState="Unknown",this.qo=void 0}get isPrimaryClient(){return!0===this.qo}}async function oR(n,e,t,r){n.Ko=(e,i,t)=>async function(e,t,n){let r=t.view.Io(i);r.Ln&&(r=await FA(e.localStore,t.query,!1).then(({documents:e})=>t.view.Io(e,r)));n=n&&n.targetChanges.get(t.targetId),n=t.view.applyChanges(r,e.isPrimaryClient,n);return gR(e,t.targetId,n.vo),n.snapshot}(n,e,t);const i=await FA(n.localStore,e,!0),s=new nR(e,i.Gn),o=s.Io(i.documents),a=ak.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),c=s.applyChanges(o,n.isPrimaryClient,a);gR(n,t,c.vo);r=new rR(e,t,s);return n.xo.set(e,r),n.ko.has(t)?n.ko.get(t).push(e):n.ko.set(t,[e]),c.snapshot}async function aR(e,t,n){const r=IR(e);try{const e=await function(e,r){const i=e,s=eE.now(),t=r.reduce((e,t)=>e.add(t.key),ik());let o;return i.persistence.runTransaction("Locally write mutations","readwrite",n=>i.Qn.Pn(n,t).next(e=>{o=e;const t=[];for(const n of r){const r=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=bS(r.transform,e||null);null!=i&&(null==n&&(n=DE.empty()),n.set(r.field,i))}return n||null}(n,o.get(n.key));null!=r&&t.push(new qS(n.key,r,function r(e){const i=[];return rE(e.fields,(e,t)=>{const n=new cE([e]);if(OE(t)){const e=r(t.mapValue).fields;if(0===e.length)i.push(n);else for(const t of e)i.push(n.child(t))}else i.push(n)}),new lE(i)}(r.value.mapValue),OS.exists(!0)))}return i.In.addMutationBatch(n,s,t,r)})).then(e=>(e.applyToLocalDocumentSet(o),{batchId:e.batchId,changes:o}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Lo[e.currentUser.toKey()];r=r||new QS(J0),r=r.insert(t,n),e.Lo[e.currentUser.toKey()]=r}(r,e.batchId,n),await yR(r,e.changes),await xN(r.remoteStore)}catch(e){const t=qN(e,"Failed to persist write");n.reject(t)}}async function cR(e,t){const r=e;try{const e=await xA(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.Fo.get(t);n&&(j0(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.Co=!0:0<e.modifiedDocuments.size?j0(n.Co):0<e.removedDocuments.size&&(j0(n.Co),n.Co=!1))}),await yR(r,e,t)}catch(e){await iA(e)}}function lR(n,r,e){const t=n;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const n=[];t.xo.forEach((e,t)=>{t=t.view.eo(r);t.snapshot&&n.push(t.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.eo(n)&&(r=!0)}),r&&GN(t)}(t.eventManager,r),n.length&&t.No.Tr(n),t.onlineState=r,t.isPrimaryClient&&t.sharedClientState.setOnlineState(r)}}async function uR(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=i.jn.newChangeBuffer({trackRemovals:!0});return function(e,t,r,i){const s=r.batch,n=s.keys();let o=hC.resolve();return n.forEach(n=>{o=o.next(()=>i.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);j0(null!==t),e.version.compareTo(t)<0&&(s.applyToRemoteDocument(e,r),e.isValidDocument()&&i.addEntry(e,r.commitVersion))})}),o.next(()=>e.In.removeMutationBatch(t,s))}(i,e,r,n).next(()=>n.apply(e)).next(()=>i.In.performConsistencyCheck(e)).next(()=>i.Qn.Pn(e,t))})}(n.localStore,t);dR(n,r,null),hR(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await yR(n,e)}catch(e){await iA(e)}}function hR(e,t){(e.Bo.get(t)||[]).forEach(e=>{e.resolve()}),e.Bo.delete(t)}function dR(e,t,n){const r=e;let i=r.Lo[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Lo[r.currentUser.toKey()]=i}}function fR(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.ko.get(e))t.xo.delete(r),n&&t.No.jo(r,n);t.ko.delete(e),t.isPrimaryClient&&t.Mo.cs(e).forEach(e=>{t.Mo.containsKey(e)||pR(t,e)})}function pR(e,t){e.$o.delete(t.path.canonicalString());var n=e.Oo.get(t);null!==n&&(EN(e.remoteStore,n),e.Oo=e.Oo.remove(t),e.Fo.delete(n),mR(e))}function gR(e,t,n){for(const r of n)r instanceof eR?(e.Mo.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.Oo.get(n)||e.$o.has(r)||(D0("SyncEngine","New document in limbo: "+n),e.$o.add(r),mR(e))}(e,r)):r instanceof tR?(D0("SyncEngine","Document no longer in limbo: "+r.key),e.Mo.removeReference(r.key,t),e.Mo.containsKey(r.key)||pR(e,r.key)):U0()}function mR(e){for(;0<e.$o.size&&e.Oo.size<e.maxConcurrentLimboResolutions;){var t=e.$o.values().next().value;e.$o.delete(t);var n=new wE(oE.fromString(t)),t=e.Uo.next();e.Fo.set(t,new iR(n)),e.Oo=e.Oo.insert(n,t),TN(e.remoteStore,new SC(uS(rS(n.path)),t,2,Q0.T))}}async function yR(e,n,r){const i=e,s=[],o=[],a=[];i.xo.isEmpty()||(i.xo.forEach((e,t)=>{a.push(i.Ko(t,n,r).then(e=>{e&&(i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),s.push(e),e=CA.kn(t.targetId,e),o.push(e))}))}),await Promise.all(a),i.No.Tr(s),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>hC.forEach(t,t=>hC.forEach(t.Nn,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>hC.forEach(t.xn,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!mC(e))throw e;D0("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Un.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.Un=r.Un.insert(t,i)}}}(i.localStore,o))}async function vR(r,e){const i=r;if(bR(i),IR(i),!0===e&&!0!==i.qo){const r=i.sharedClientState.getAllActiveQueryTargets(),e=await _R(i,r.toArray());i.qo=!0,await MN(i.remoteStore,!0);for(const r of e)TN(i.remoteStore,r)}else if(!1===e&&!1!==i.qo){const r=[];let n=Promise.resolve();i.ko.forEach((e,t)=>{i.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(fR(i,t),MA(i.localStore,t,!0))),EN(i.remoteStore,t)}),await n,await _R(i,r),function(){const n=i;n.Fo.forEach((e,t)=>{EN(n.remoteStore,t)}),n.Mo.us(),n.Fo=new Map,n.Oo=new QS(wE.comparator)}(),i.qo=!1,await MN(i.remoteStore,!1)}}async function _R(t,n){const r=t,i=[],s=[];for(const t of n){let e;const l=r.ko.get(t);if(l&&0!==l.length){e=await LA(r.localStore,uS(l[0]));for(const t of l){const n=r.xo.get(t),l=(o=r,a=n,c=void 0,o=await FA((c=o).localStore,a.query,!0),o=a.view.So(o),c.isPrimaryClient&&gR(c,a.targetId,o.vo),await o);l.snapshot&&s.push(l.snapshot)}}else{const l=await UA(r.localStore,t);e=await LA(r.localStore,l),await oR(r,wR(l),t,!1)}i.push(e)}var o,a,c;return r.No.Tr(s),i}function wR(e){return nS(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function bR(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=cR.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){const n=e,r=n.Fo.get(t);if(r&&r.Co)return ik().add(r.key);{let e=ik();const r=n.ko.get(t);if(!r)return e;for(const t of r){const r=n.xo.get(t);e=e.unionWith(r.view.To)}return e}}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Fo.get(t),s=i&&i.key;if(s){let e=new QS(wE.comparator);e=e.insert(s,LE.newNoDocument(s,tE.min()));const n=ik().add(s),i=new ok(tE.min(),new Map,new XS(J0),e,n);await cR(r,i),r.Oo=r.Oo.remove(s),r.Fo.delete(t),mR(r)}else await MA(r.localStore,t,!1).then(()=>fR(r,t,n)).catch(iA)}.bind(null,t),t.No.Tr=function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.no(e)&&(r=!0);i.Xr=e}}r&&GN(n)}.bind(null,t.eventManager),t.No.jo=function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}.bind(null,t.eventManager),t}function IR(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=uR.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=async function(e,t,n){const r=e;try{const e=await function(e,r){const i=e;return i.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return i.In.lookupMutationBatch(t,r).next(e=>(j0(null!==e),n=e.keys(),i.In.removeMutationBatch(t,e))).next(()=>i.In.performConsistencyCheck(t)).next(()=>i.Qn.Pn(t,n))})}(r.localStore,t);dR(r,t,n),hR(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await yR(r,e)}catch(n){await iA(n)}}.bind(null,t),t}class TR{constructor(){this.synchronizeTabs=!1}async initialize(e){this.N=fN(e.databaseInfo.databaseId),this.sharedClientState=this.Wo(e),this.persistence=this.Go(e),await this.persistence.start(),this.gcScheduler=this.zo(e),this.localStore=this.Ho(e)}zo(e){return null}Ho(e){return RA(this.persistence,new AA,e.initialUser,this.N)}Go(e){return new HA(QA.Ns,this.N)}Wo(e){return new sN}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class ER extends TR{constructor(e,t,n){super(),this.Jo=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=e;return t.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(){const e=mA(t);let r=tE.min();return e.Kt({index:Zk.readTimeIndex,reverse:!0},(e,t,n)=>{t.readTime&&(r=RC(t.readTime)),n.done()}).next(()=>r)}()).then(e=>{t.Kn=e})}(this.localStore),await this.Jo.initialize(this,e),await IR(this.Jo.syncEngine),await xN(this.Jo.remoteStore),await this.persistence.nn(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Ho(e){return RA(this.persistence,new AA,e.initialUser,this.N)}zo(e){var t=this.persistence.referenceDelegate.garbageCollector;return new aA(t,e.asyncQueue)}Go(e){var t=EA(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?WC.withCacheSize(this.cacheSizeBytes):WC.DEFAULT;return new bA(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,hN(),dN(),this.N,this.sharedClientState,!!this.forceOwnership)}Wo(e){return new sN}}class SR extends ER{constructor(e,t){super(e,t,!1),this.Jo=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);e=this.Jo.syncEngine;this.sharedClientState instanceof iN&&(this.sharedClientState.syncEngine={_i:async function(e,t,n,r){var i=e;null!==(e=await function(e,n){const r=e,i=r.In;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>i.Xt(t,n).next(e=>e?r.Qn.Pn(t,e):hC.resolve(null)))}(i.localStore,t))?("pending"===n?await xN(i.remoteStore):"acknowledged"===n||"rejected"===n?(dR(i,t,r||null),hR(i,t),i.localStore.In.te(t)):U0(),await yR(i,e)):D0("SyncEngine","Cannot apply mutation batch with id: "+t)}.bind(null,e),mi:async function(e,t,n,r){const i=e;if(i.qo)D0("SyncEngine","Ignoring unexpected query state notification.");else if(i.ko.has(t))switch(n){case"current":case"not-current":{const e=await jA(i.localStore),r=ok.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await yR(i,e,r);break}case"rejected":await MA(i.localStore,t,!0),fR(i,t,r);break;default:U0()}}.bind(null,e),gi:async function(e,t,n){const r=bR(e);if(r.qo){for(const e of t)if(r.ko.has(e))D0("SyncEngine","Adding an already active target "+e);else{const t=await UA(r.localStore,e),n=await LA(r.localStore,t);await oR(r,wR(t),n.targetId,!1),TN(r.remoteStore,n)}for(const e of n)r.ko.has(e)&&await MA(r.localStore,e,!1).then(()=>{EN(r.remoteStore,e),fR(r,e)}).catch(iA)}}.bind(null,e),pn:function(e){return e.localStore.persistence.pn()}.bind(null,e),wi:async function(e){const t=e;return jA(t.localStore).then(e=>yR(t,e))}.bind(null,e)},await this.sharedClientState.start()),await this.persistence.nn(async e=>{await vR(this.Jo.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())})}Wo(e){var t=hN();if(!iN.bt(t))throw new V0(q0.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=EA(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new iN(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class kR{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>lR(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){D0("SyncEngine","User change. New user:",t.toKey());const r=await PA(n.localStore,t);n.currentUser=t,(e=n).Bo.forEach(e=>{e.forEach(e=>{e.reject(new V0(q0.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Bo.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await yR(n,r.Wn)}}.bind(null,this.syncEngine),await MN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new WN}createDatastore(e){var t,n=fN(e.databaseInfo.databaseId),t=(t=e.databaseInfo,new uN(t));return e=e.credentials,t=t,n=n,new vN(e,t,n)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>lR(this.syncEngine,e,0),e=new(aN.bt()?aN:oN),new wN(t,n,r,i,e);var t,n,r,i}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new sR(e,t,n,r,i,s);return o&&(a.qo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;D0("RemoteStore","RemoteStore shutting down."),t.Kr.add(5),await IN(t),t.Qr.shutdown(),t.Wr.set("Unknown")}(this.remoteStore)}}function CR(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class AR{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Yo(this.observer.next,e)}error(e){this.observer.error?this.Yo(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Xo(){this.muted=!0}Yo(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class NR{constructor(e,t){this.Zo=e,this.N=t,this.metadata=new B0,this.buffer=new Uint8Array,this.ta=new TextDecoder("utf-8"),this.ea().then(e=>{e&&e.ho()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.Zo.cancel()}async getMetadata(){return this.metadata.promise}async Qo(){return await this.getMetadata(),this.ea()}async ea(){var e=await this.na();if(null===e)return null;var t=this.ta.decode(e),n=Number(t);isNaN(n)&&this.sa(`length string (${t}) is not valid number`);t=await this.ia(n);return new YN(JSON.parse(t),e.length+n)}ra(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async na(){for(;this.ra()<0&&!await this.oa(););if(0===this.buffer.length)return null;var e=this.ra();e<0&&this.sa("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async ia(e){for(;this.buffer.length<e;)await this.oa()&&this.sa("Reached the end of bundle when more is expected.");var t=this.ta.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}sa(e){throw this.Zo.cancel(),new Error(`Invalid bundle format: ${e}`)}async oa(){var e=await this.Zo.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class RR{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new V0(q0.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=Ck(r.N)+"/documents",i={documents:t.map(e=>Tk(r.N,e))},s=await r.Ki("BatchGetDocuments",n,i),o=new Map;s.forEach(e=>{const t=(n=r.N,"found"in(e=e)?function(e,t){j0(!!t.found),t.found.name,t.found.updateTime;var n=Ek(e,t.found.name),e=wk(t.found.updateTime),t=new DE({mapValue:{fields:t.found.fields}});return LE.newFoundDocument(n,e,t)}(n,e):"missing"in e?function(e,t){j0(!!t.missing),j0(!!t.readTime);e=Ek(e,t.missing),t=wk(t.readTime);return LE.newNoDocument(e,t)}(n,e):U0());var n;o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{e=o.get(e.toString());j0(!!e),a.push(e)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new zS(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{t=wE.fromPath(t);this.mutations.push(new WS(t,this.precondition(t)))}),await async function(e,t){const n=e,r=Ck(n.N)+"/documents",i={writes:t.map(e=>Pk(n.N,e))};await n.Li("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw U0();t=tE.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new V0(q0.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?OS.updateTime(t):OS.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return OS.exists(!0);if(t.isEqual(tE.min()))throw new V0(q0.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return OS.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class PR{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.aa=5,this.rr=new pN(this.asyncQueue,"transaction_retry")}run(){--this.aa,this.ca()}ca(){this.rr.Xi(async()=>{const t=new RR(this.datastore),e=this.ua(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.ha(e)}))}).catch(e=>{this.ha(e)})})}ua(e){try{var t=this.updateFunction(e);return!yE(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}ha(e){0<this.aa&&this.la(e)?(--this.aa,this.asyncQueue.enqueueAndForget(()=>(this.ca(),Promise.resolve()))):this.deferred.reject(e)}la(e){if("FirebaseError"!==e.name)return!1;e=e.code;return"aborted"===e||"failed-precondition"===e||!HS(e)}}class OR{constructor(e,t,n){this.credentials=e,this.asyncQueue=t,this.databaseInfo=n,this.user=R0.UNAUTHENTICATED,this.clientId=Y0.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(t,async e=>{D0("FirestoreClient","Received user=",e.uid),await this.credentialListener(e),this.user=e})}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.credentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new V0(q0.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new B0;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.shutdown(),n.resolve()}catch(e){var t=qN(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function xR(e,t){e.asyncQueue.verifyOperationInProgress(),D0("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await PA(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function DR(e,t){e.asyncQueue.verifyOperationInProgress();var n=await LR(e);D0("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>async function(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),D0("RemoteStore","RemoteStore received new credentials");e=NN(n);n.Kr.add(3),await IN(n),e&&n.Wr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Kr.delete(3),await bN(n)}(t.remoteStore,e)),e.onlineComponents=t}async function LR(e){return e.offlineComponents||(D0("FirestoreClient","Using default OfflineComponentProvider"),await xR(e,new TR)),e.offlineComponents}async function MR(e){return e.onlineComponents||(D0("FirestoreClient","Using default OnlineComponentProvider"),await DR(e,new kR)),e.onlineComponents}function FR(e){return LR(e).then(e=>e.persistence)}function UR(e){return LR(e).then(e=>e.localStore)}function jR(e){return MR(e).then(e=>e.remoteStore)}function qR(e){return MR(e).then(e=>e.syncEngine)}async function VR(e){const t=await MR(e),n=t.eventManager;return n.onListen=async function(e,t){const n=bR(e);let r,i;const s=n.xo.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Do();else{const e=await LA(n.localStore,uS(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await oR(n,t,r,"current"===s),n.isPrimaryClient&&TN(n.remoteStore,e)}return i}.bind(null,t.syncEngine),n.onUnlisten=async function(e,t){const n=e,r=n.xo.get(t),i=n.ko.get(r.targetId);if(1<i.length)return n.ko.set(r.targetId,i.filter(e=>!dS(e,t))),void n.xo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await MA(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),EN(n.remoteStore,r.targetId),fR(n,r.targetId)}).catch(iA)):(fR(n,r.targetId),await MA(n.localStore,r.targetId,!0))}.bind(null,t.syncEngine),n}function BR(e,t,n={}){const r=new B0;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,i,s,o){const e=new AR({next:e=>{r.enqueueAndForget(()=>HN(n,a));var t=e.docs.has(i);!t&&e.fromCache?o.reject(new V0(q0.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&s&&"server"===s.source?o.reject(new V0(q0.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(e)},error:e=>o.reject(e)}),a=new QN(rS(i.path),e,{includeMetadataChanges:!0,uo:!0});return $N(n,a)}(await VR(e),e.asyncQueue,t,n,r)),r.promise}function KR(e,t,n={}){const r=new B0;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,i){const s=new AR({next:e=>{n.enqueueAndForget(()=>HN(t,o)),e.fromCache&&"server"===r.source?i.reject(new V0(q0.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(e)},error:e=>i.reject(e)}),o=new QN(e,s,{includeMetadataChanges:!0,uo:!0});return $N(t,o)}(await VR(e),e.asyncQueue,t,n,r)),r.promise}function zR(e,t,n,r){const i=function(e,t){e="string"==typeof e?(new TextEncoder).encode(e):e;return e=function(e){if(e instanceof Uint8Array)return CR(e,void 0);if(e instanceof ArrayBuffer)return CR(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(e),t=t,new NR(e,t)}(n,fN(t));e.asyncQueue.enqueueAndForget(async()=>{!function(e,t,n){const r=e;!async function(t,n,r){try{var i=await n.getMetadata();if(await function(e,t){const n=e,r=wk(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Je.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,i))return await n.close(),void r._completeWith({taskState:"Success",documentsLoaded:i.totalDocuments,bytesLoaded:i.totalBytes,totalDocuments:i.totalDocuments,totalBytes:i.totalBytes});r._updateProgress(ZN(i));const o=new XN(i,t.localStore,n.N);let e=await n.Qo();for(;e;){const t=await o.fo(e);t&&r._updateProgress(t),e=await n.Qo()}var s=await o.complete();await yR(t,s.Tn,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Je.saveBundleMetadata(e,t))}(t.localStore,i),r._completeWith(s.progress)}catch(t){M0("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t)}}(r,t,n).then(()=>{r.sharedClientState.notifyBundleLoaded()})}(await qR(e),i,r)})}class WR{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class $R{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof $R&&e.projectId===this.projectId&&e.database===this.database}}const HR=new Map;function GR(e,t,n){if(!n)throw new V0(q0.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function QR(e,t,n,r){if(!0===t&&!0===r)throw new V0(q0.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function YR(e){if(!wE.isDocumentKey(e))throw new V0(q0.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function JR(e){if(wE.isDocumentKey(e))throw new V0(q0.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function XR(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":U0();if(t instanceof Array)return"an array";var e=function(){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}();return e?`a custom ${e} object`:"an object"}function ZR(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new V0(q0.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");e=XR(e);throw new V0(q0.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}function eP(e,t){if(t<=0)throw new V0(q0.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class tP{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new V0(q0.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new V0(q0.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,QR("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class nP{constructor(e,t){this._credentials=t,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new tP({}),this._settingsFrozen=!1,e instanceof $R?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new V0(q0.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $R(e.options.projectId)}(e))}get app(){if(!this._app)throw new V0(q0.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new V0(q0.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new tP(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new z0;switch(e.type){case"gapi":var t=e.client;return j0(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new G0(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new V0(q0.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=HR.get(e);t&&(D0("ComponentProvider","Removing Datastore"),HR.delete(e),t.terminate())}(this),Promise.resolve()}}class rP{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new sP(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new rP(this.firestore,e,this._key)}}class iP{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new iP(this.firestore,e,this._query)}}class sP extends iP{constructor(e,t,n){super(e,t,rS(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new rP(this.firestore,null,new wE(e))}withConverter(e){return new sP(this.firestore,e,this._path)}}function oP(e,t,...n){if(e=io(e),GR("collection","path",t),e instanceof nP){var r=oE.fromString(t,...n);return JR(r),new sP(e,null,r)}if(!(e instanceof rP||e instanceof sP))throw new V0(q0.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");n=e._path.child(oE.fromString(t,...n));return JR(n),new sP(e.firestore,null,n)}function aP(e,t,...n){if(e=io(e),GR("doc","path",t=1===arguments.length?Y0.I():t),e instanceof nP){var r=oE.fromString(t,...n);return YR(r),new rP(e,null,new wE(r))}if(!(e instanceof rP||e instanceof sP))throw new V0(q0.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");n=e._path.child(oE.fromString(t,...n));return YR(n),new rP(e.firestore,e instanceof sP?e.converter:null,new wE(n))}function cP(e,t){return e=io(e),t=io(t),(e instanceof rP||e instanceof sP)&&(t instanceof rP||t instanceof sP)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function lP(e,t){return e=io(e),t=io(t),e instanceof iP&&t instanceof iP&&e.firestore===t.firestore&&dS(e._query,t._query)&&e.converter===t.converter}class uP{constructor(){this.fa=Promise.resolve(),this.da=[],this.wa=!1,this._a=[],this.ma=null,this.ga=!1,this.ya=!1,this.pa=[],this.rr=new pN(this,"async_queue_retry"),this.Ea=()=>{var e=dN();e&&D0("AsyncQueue","Visibility state changed to "+e.visibilityState),this.rr.tr()};const e=dN();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ea)}get isShuttingDown(){return this.wa}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ta(),this.Ia(e)}enterRestrictedMode(e){if(!this.wa){this.wa=!0,this.ya=e||!1;const t=dN();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ea)}}enqueue(e){if(this.Ta(),this.wa)return new Promise(()=>{});const t=new B0;return this.Ia(()=>this.wa&&this.ya?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.da.push(e),this.Aa()))}async Aa(){if(0!==this.da.length){try{await this.da[0](),this.da.shift(),this.rr.reset()}catch(e){if(!mC(e))throw e;D0("AsyncQueue","Operation failed with retryable error: "+e)}0<this.da.length&&this.rr.Xi(()=>this.Aa())}}Ia(e){var t=this.fa.then(()=>(this.ga=!0,e().catch(e=>{throw this.ma=e,this.ga=!1,L0("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.ga=!1,e))));return this.fa=t}enqueueAfterDelay(e,t,n){this.Ta(),-1<this.pa.indexOf(e)&&(t=0);n=jN.createAndSchedule(this,e,t,n,e=>this.Ra(e));return this._a.push(n),n}Ta(){this.ma&&U0()}verifyOperationInProgress(){}async ba(){for(var e;await(e=this.fa),e!==this.fa;);}Pa(e){for(const t of this._a)if(t.timerId===e)return!0;return!1}va(t){return this.ba().then(()=>{this._a.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this._a)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.ba()})}Va(e){this.pa.push(e)}Ra(e){e=this._a.indexOf(e);this._a.splice(e,1)}}function hP(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class dP{constructor(){this._progressObserver={},this._taskCompletionResolver=new B0,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var fP,pP;class gP extends nP{constructor(e,t){super(e,t),this.type="firestore",this._queue=new uP,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||yP(this),this._firestoreClient.terminate()}}function mP(e){return e._firestoreClient||yP(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function yP(e){var t,n,r,i=e._freezeSettings(),i=(t=e._databaseId,n=(null===(r=e._app)||void 0===r?void 0:r.options.appId)||"",r=e._persistenceKey,i=i,new WR(t,n,r,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,i.useFetchStreams));e._firestoreClient=new OR(e._credentials,e._queue,i)}function vP(e,n,r){const i=new B0;return e.asyncQueue.enqueue(async()=>{try{await xR(e,r),await DR(e,n),i.resolve()}catch(e){if(!("FirebaseError"===(t=e).name?t.code===q0.FAILED_PRECONDITION||t.code===q0.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),i.reject(e)}var t}).then(()=>i.promise)}function _P(e){return function(e){const t=new B0;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;NN(n.remoteStore)||D0("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.In.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.Bo.get(e)||[];r.push(t),n.Bo.set(e,r)}catch(e){const n=qN(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await qR(e),t)),t.promise}(mP(e=ZR(e,gP)))}function wP(e){return(n=mP(e=ZR(e,gP))).asyncQueue.enqueue(async()=>{const e=await FR(n),t=await jR(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.Kr.delete(0),bN(e)}()});var n}function bP(e){return(n=mP(e=ZR(e,gP))).asyncQueue.enqueue(async()=>{const e=await FR(n),t=await jR(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.Kr.add(0),await IN(e),e.Wr.set("Offline")}()});var n}function IP(t,e){return n=mP(t=ZR(t,gP)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Je.getNamedQuery(e,t))}(await UR(n),r)).then(e=>e?new iP(t,null,e.query):null);var n,r}function TP(e){if(e._initialized||e._terminated)throw new V0(q0.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class EP{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new V0(q0.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new cE(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class SP{constructor(e){this._byteString=e}static fromBase64String(e){try{return new SP(uE.fromBase64String(e))}catch(e){throw new V0(q0.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new SP(uE.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class kP{constructor(e){this._methodName=e}}class CP{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new V0(q0.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new V0(q0.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J0(this._lat,e._lat)||J0(this._long,e._long)}}const AP=/^__.*__$/;class NP{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new qS(e,this.data,this.fieldMask,t,this.fieldTransforms):new jS(e,this.data,t,this.fieldTransforms)}}class RP{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new qS(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function PP(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw U0()}}class OP{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.N=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sa(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Da(){return this.settings.Da}Ca(e){return new OP(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Na(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Ca({path:n,xa:!1});return r.ka(e),r}$a(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Ca({path:n,xa:!1});return r.Sa(),r}Oa(e){return this.Ca({path:void 0,xa:!0})}Fa(e){return XP(e,this.settings.methodName,this.settings.Ma||!1,this.path,this.settings.La)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Sa(){if(this.path)for(let e=0;e<this.path.length;e++)this.ka(this.path.get(e))}ka(e){if(0===e.length)throw this.Fa("Document fields must not be empty");if(PP(this.Da)&&AP.test(e))throw this.Fa('Document fields cannot begin and end with "__"')}}class xP{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.N=n||fN(e)}Ba(e,t,n,r=!1){return new OP({Da:e,methodName:t,La:n,path:cE.emptyPath(),xa:!1,Ma:r},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function DP(e){var t=e._freezeSettings(),n=fN(e._databaseId);return new xP(e._databaseId,!!t.ignoreUndefinedProperties,n)}function LP(e,t,n,r,i,s={}){const o=e.Ba(s.merge||s.mergeFields?2:0,t,n,i);GP("Data must be an object, but it was:",o,r);r=$P(r,o);let a,c;if(s.merge)a=new lE(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const l of s.mergeFields){const i=QP(t,l,n);if(!o.contains(i))throw new V0(q0.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);ZP(e,i)||e.push(i)}a=new lE(e),c=o.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,c=o.fieldTransforms;return new NP(new DE(r),a,c)}class MP extends kP{_toFieldTransform(e){if(2!==e.Da)throw 1===e.Da?e.Fa(`${this._methodName}() can only appear at the top level of your update data`):e.Fa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof MP}}function FP(e,t,n){return new OP({Da:3,La:t.settings.La,methodName:e._methodName,xa:n},t.databaseId,t.N,t.ignoreUndefinedProperties)}class UP extends kP{_toFieldTransform(e){return new RS(e.path,new IS)}isEqual(e){return e instanceof UP}}class jP extends kP{constructor(e,t){super(e),this.Ua=t}_toFieldTransform(e){const t=FP(this,e,!0),n=this.Ua.map(e=>WP(e,t)),r=new TS(n);return new RS(e.path,r)}isEqual(e){return this===e}}class qP extends kP{constructor(e,t){super(e),this.Ua=t}_toFieldTransform(e){const t=FP(this,e,!0),n=this.Ua.map(e=>WP(e,t)),r=new SS(n);return new RS(e.path,r)}isEqual(e){return this===e}}class VP extends kP{constructor(e,t){super(e),this.qa=t}_toFieldTransform(e){var t=new CS(e.N,_S(e.N,this.qa));return new RS(e.path,t)}isEqual(e){return this===e}}function BP(e,i,s,t){const o=e.Ba(1,i,s);GP("Data must be an object, but it was:",o,t);const a=[],c=DE.empty();rE(t,(e,t)=>{var n=JP(i,e,s);t=io(t);e=o.$a(n);if(t instanceof MP)a.push(n);else{const r=WP(t,e);null!=r&&(a.push(n),c.set(n,r))}});t=new lE(a);return new RP(c,t,o.fieldTransforms)}function KP(t,n,e,r,i,s){const o=t.Ba(1,n,e),a=[QP(n,r,e)],c=[i];if(s.length%2!=0)throw new V0(q0.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(QP(n,s[e])),c.push(s[e+1]);const l=[],u=DE.empty();for(let e=a.length-1;0<=e;--e)if(!ZP(l,a[e])){const n=a[e];var h=io(h=c[e]);const r=o.$a(n);if(h instanceof MP)l.push(n);else{const t=WP(h,r);null!=t&&(l.push(n),u.set(n,t))}}i=new lE(l);return new RP(u,i,o.fieldTransforms)}function zP(e,t,n,r=!1){return WP(n,e.Ba(r?4:3,t))}function WP(s,e){if(HP(s=io(s)))return GP("Unsupported field value:",e,s),$P(s,e);if(s instanceof kP)return function(e,t){if(!PP(t.Da))throw t.Fa(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Fa(`${e._methodName}() is not currently supported inside arrays`);e=e._toFieldTransform(t);e&&t.fieldTransforms.push(e)}(s,e),null;if(void 0===s&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),s instanceof Array){if(e.settings.xa&&4!==e.Da)throw e.Fa("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const i of s){let e=WP(i,t.Oa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=io(s)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return _S(t.N,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=eE.fromDate(e);return{timestampValue:vk(t.N,n)}}if(e instanceof eE){n=new eE(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:vk(t.N,n)}}if(e instanceof CP)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof SP)return{bytesValue:_k(t.N,e._byteString)};if(e instanceof rP){const r=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(r))throw t.Fa(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:bk(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Fa(`Unsupported field value: ${XR(e)}`)}(0,e)}function $P(e,n){const r={};return iE(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):rE(e,(e,t)=>{t=WP(t,n.Na(e));null!=t&&(r[e]=t)}),{mapValue:{fields:r}}}function HP(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof eE||e instanceof CP||e instanceof SP||e instanceof rP||e instanceof kP)}function GP(e,t,n){if(!HP(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=XR(n);throw"an object"===n?t.Fa(e+" a custom object"):t.Fa(e+" "+n)}var r}function QP(e,t,n){if((t=io(t))instanceof EP)return t._internalPath;if("string"==typeof t)return JP(e,t);throw XP("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}const YP=new RegExp("[~\\*/\\[\\]]");function JP(t,n,r){if(0<=n.search(YP))throw XP(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new EP(...n.split("."))._internalPath}catch(e){throw XP(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function XP(e,t,n,r,i){var s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new V0(q0.INVALID_ARGUMENT,a+e+c)}function ZP(e,t){return e.some(e=>e.isEqual(t))}class eO{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new rP(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new tO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){e=this._document.data.field(nO("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e)}}}class tO extends eO{data(){return super.data()}}function nO(e,t){return"string"==typeof t?JP(e,t):(t instanceof EP?t:t._delegate)._internalPath}class rO{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class iO extends eO{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new sO(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){e=this._document.data.field(nO("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e,t.serverTimestamps)}}}class sO extends iO{data(e={}){return super.data(e)}}class oO{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new rO(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new sO(this._firestore,this._userDataWriter,e.key,e,new rO(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){e=!!e.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new V0(q0.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(s,t){if(s._snapshot.oldDocs.isEmpty()){let t=0;return s._snapshot.docChanges.map(e=>({type:"added",doc:new sO(s._firestore,s._userDataWriter,e.doc.key,e.doc,new rO(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter),oldIndex:-1,newIndex:t++}))}{let i=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new sO(s._firestore,s._userDataWriter,e.doc.key,e.doc,new rO(s._snapshot.mutatedKeys.has(e.doc.key),s._snapshot.fromCache),s.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),r=i.indexOf(e.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U0()}}(e.type),doc:t,oldIndex:n,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function aO(e,t){return e instanceof iO&&t instanceof iO?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof oO&&t instanceof oO&&e._firestore===t._firestore&&lP(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function cO(e){if(sS(e)&&0===e.explicitOrderBy.length)throw new V0(q0.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class lO{}function uO(e,...t){for(const n of t)e=n._apply(e);return e}class hO extends lO{constructor(e,t,n){super(),this.Ka=e,this.ja=t,this.Qa=n,this.type="where"}_apply(e){var t=DP(e.firestore),t=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new V0(q0.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on FieldPath.documentId().`);if("in"===s||"not-in"===s){vO(o,s);const t=[];for(const n of o)t.push(yO(r,e,n));a={arrayValue:{values:t}}}else a=yO(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||vO(o,s),a=zP(n,t,o,"in"===s||"not-in"===s);s=VE.create(i,s,a);return function(e,t){if(t.v()){const r=aS(e);if(null!==r&&!r.isEqual(t.field))throw new V0(q0.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${t.field.toString()}'`);var n=oS(e);null!==n&&_O(0,t.field,n)}const r=function(e,t){for(const n of e.filters)if(0<=t.indexOf(n.op))return n.op;return null}(e,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new V0(q0.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new V0(q0.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}(e,s),s}(e._query,"where",t,e.firestore._databaseId,this.Ka,this.ja,this.Qa);return new iP(e.firestore,e.converter,(e=e._query,t=e.filters.concat([t]),new tS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))}}class dO extends lO{constructor(e,t){super(),this.Ka=e,this.Wa=t,this.type="orderBy"}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new V0(q0.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new V0(q0.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new XE(t,n);return t=r,null!==oS(n=e)||null!==(e=aS(n))&&_O(0,e,t.field),r}(e._query,this.Ka,this.Wa);return new iP(e.firestore,e.converter,(e=e._query,t=e.explicitOrderBy.concat([t]),new tS(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class fO extends lO{constructor(e,t,n){super(),this.type=e,this.Ga=t,this.za=n}_apply(e){return new iP(e.firestore,e.converter,hS(e._query,this.Ga,this.za))}}class pO extends lO{constructor(e,t,n){super(),this.type=e,this.Ha=t,this.Ja=n}_apply(e){var t=mO(e,this.type,this.Ha,this.Ja);return new iP(e.firestore,e.converter,(e=e._query,t=t,new tS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)))}}class gO extends lO{constructor(e,t,n){super(),this.type=e,this.Ha=t,this.Ja=n}_apply(e){var t=mO(e,this.type,this.Ha,this.Ja);return new iP(e.firestore,e.converter,(e=e._query,t=t,new tS(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)))}}function mO(e,t,n,r){if(n[0]=io(n[0]),n[0]instanceof eO)return function(e,t,n,r,i){if(!r)throw new V0(q0.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of lS(e))if(n.field.isKeyField())s.push(CE(t,r.key));else{const e=r.data.field(n.field);if(gE(e))throw new V0(q0.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new V0(q0.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new YE(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=DP(e.firestore);return function(t,n,r,i,s,e){const o=t.explicitOrderBy;if(s.length>o.length)throw new V0(q0.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let e=0;e<s.length;e++){const c=s[e];if(o[e].field.isKeyField()){if("string"!=typeof c)throw new V0(q0.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof c}`);if(!cS(t)&&-1!==c.indexOf("/"))throw new V0(q0.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${i}() must be a plain document ID, but '${c}' contains a slash.`);const r=t.path.child(oE.fromString(c));if(!wE.isDocumentKey(r))throw new V0(q0.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${i}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);const s=new wE(r);a.push(CE(n,s))}else{const t=zP(r,i,c);a.push(t)}}return new YE(a,e)}(e._query,e.firestore._databaseId,i,t,n,r)}function yO(e,t,n){if("string"==typeof(n=io(n))){if(""===n)throw new V0(q0.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!cS(t)&&-1!==n.indexOf("/"))throw new V0(q0.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);t=t.path.child(oE.fromString(n));if(!wE.isDocumentKey(t))throw new V0(q0.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${t}' is not because it has an odd number of segments (${t.length}).`);return CE(e,new wE(t))}if(n instanceof rP)return CE(e,n._key);throw new V0(q0.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${XR(n)}.`)}function vO(e,t){if(!Array.isArray(e)||0===e.length)throw new V0(q0.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new V0(q0.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function _O(e,t,n){if(!n.isEqual(t))throw new V0(q0.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class wO{convertValue(e,t="none"){switch(bE(e)){case 0:return null;case 1:return e.booleanValue;case 2:return fE(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(pE(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw U0()}}convertObject(e,n){const r={};return rE(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new CP(fE(e.latitude),fE(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){t=t.mapValue.fields.__previous_value__;return gE(t)?e(t):t}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(mE(e));default:return null}}convertTimestamp(e){e=dE(e);return new eE(e.seconds,e.nanos)}convertDocumentKey(e,t){const n=oE.fromString(e);j0(Bk(n));const r=new $R(n.get(1),n.get(3)),i=new wE(n.popFirst(5));return r.isEqual(t)||L0(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function bO(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class IO extends wO{constructor(e){super(),this.firestore=e}convertBytes(e){return new SP(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new rP(this.firestore,null,e)}}class TO{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=DP(e)}set(e,t,n){this._verifyNotCommitted();const r=EO(e,this._firestore),i=bO(r.converter,t,n),s=LP(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,OS.none())),this}update(e,t,n,...r){this._verifyNotCommitted();e=EO(e,this._firestore);let i;return i="string"==typeof(t=io(t))||t instanceof EP?KP(this._dataReader,"WriteBatch.update",e._key,t,n,r):BP(this._dataReader,"WriteBatch.update",e._key,t),this._mutations.push(i.toMutation(e._key,OS.exists(!0))),this}delete(e){this._verifyNotCommitted();e=EO(e,this._firestore);return this._mutations=this._mutations.concat(new zS(e._key,OS.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V0(q0.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function EO(e,t){if((e=io(e)).firestore!==t)throw new V0(q0.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class SO extends wO{constructor(e){super(),this.firestore=e}convertBytes(e){return new SP(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new rP(this.firestore,null,e)}}function kO(t){t=ZR(t,rP);const n=ZR(t.firestore,gP),e=mP(n),r=new SO(n);return function(e,t){const n=new B0;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.Qn.An(e,t))}(t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new V0(q0.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){t=qN(e,`Failed to get document '${t} from cache`);n.reject(t)}}(await UR(e),t,n)),n.promise}(e,t._key).then(e=>new iO(n,r,t._key,e,new rO(null!==e&&e.hasLocalMutations,!0),t.converter))}function CO(t){t=ZR(t,iP);const n=ZR(t.firestore,gP),e=mP(n),r=new SO(n);return function(e,t){const n=new B0;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await FA(e,t,!0),i=new nR(t,r.Gn),s=i.Io(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){t=qN(e,`Failed to execute query '${t} against cache`);n.reject(t)}}(await UR(e),t,n)),n.promise}(e,t._query).then(e=>new oO(n,r,t,e))}function AO(e,t,n){e=ZR(e,rP);var r=ZR(e.firestore,gP),t=bO(e.converter,t,n);return OO(r,[LP(DP(r),"setDoc",e._key,t,null!==e.converter,n).toMutation(e._key,OS.none())])}function NO(e,t,n,...r){e=ZR(e,rP);var i=ZR(e.firestore,gP),s=DP(i);let o;return o="string"==typeof(t=io(t))||t instanceof EP?KP(s,"updateDoc",e._key,t,n,r):BP(s,"updateDoc",e._key,t),OO(i,[o.toMutation(e._key,OS.exists(!0))])}function RO(t,...n){var e;t=io(t);let r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||hP(n[i])||(r=n[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges};if(hP(n[i])){const t=n[i];n[i]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[i+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[i+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let o,a,c;if(t instanceof rP)a=ZR(t.firestore,gP),c=rS(t._key.path),o={next:e=>{n[i]&&n[i](xO(a,t,e))},error:n[i+1],complete:n[i+2]};else{const l=ZR(t,iP);a=ZR(l.firestore,gP),c=l._query;const u=new SO(a);o={next:e=>{n[i]&&n[i](new oO(a,u,l,e))},error:n[i+1],complete:n[i+2]},cO(t._query)}return function(e,t,n,r){const i=new AR(r),s=new QN(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>$N(await VR(e),s)),()=>{i.Xo(),e.asyncQueue.enqueueAndForget(async()=>HN(await VR(e),s))}}(mP(a),c,s,o)}function PO(e,t){return function(e,t){const n=new AR(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Zr.add(t),t.next()}(await VR(e),n)),()=>{n.Xo(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Zr.delete(t)}(await VR(e),n))}}(mP(e=ZR(e,gP)),hP(t)?t:{next:t})}function OO(e,t){return function(e,t){const n=new B0;return e.asyncQueue.enqueueAndForget(async()=>aR(await qR(e),t,n)),n.promise}(mP(e),t)}function xO(e,t,n){var r=n.docs.get(t._key),i=new SO(e);return new iO(e,i,t._key,r,new rO(n.hasPendingWrites,n.fromCache),t.converter)}class DO extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=DP(e)}get(e){const n=EO(e,this._firestore),r=new IO(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return U0();const t=e[0];if(t.isFoundDocument())return new eO(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new eO(this._firestore,r,n._key,null,n.converter);throw U0()})}set(e,t,n){e=EO(e,this._firestore),t=bO(e.converter,t,n),n=LP(this._dataReader,"Transaction.set",e._key,t,null!==e.converter,n);return this._transaction.set(e._key,n),this}update(e,t,n,...r){e=EO(e,this._firestore),t="string"==typeof(t=io(t))||t instanceof EP?KP(this._dataReader,"Transaction.update",e._key,t,n,r):BP(this._dataReader,"Transaction.update",e._key,t);return this._transaction.update(e._key,t),this}delete(e){e=EO(e,this._firestore);return this._transaction.delete(e._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=EO(e,this._firestore),n=new SO(this._firestore);return super.get(e).then(e=>new iO(this._firestore,n,t._key,e._document,new rO(!1,!1),t.converter))}}function LO(t,n){return function(t,n){const r=new B0;return t.asyncQueue.enqueueAndForget(async()=>{var e=await MR(t).then(e=>e.datastore);new PR(t.asyncQueue,e,n,r).run()}),r.promise}(mP(t),e=>n(new DO(t,e)))}E=Mo,P0=E,Oo(new so("firestore",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=new gP(n,new $0(e.getProvider("auth-internal")));return t=Object.assign({useFetchStreams:!0},t),r._setSettings(t),r},"PUBLIC")),qo("@firebase/firestore","3.0.2",void 0);function MO(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new V0("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function FO(){if("undefined"==typeof Uint8Array)throw new V0("unimplemented","Uint8Arrays are not available in this environment.")}function UO(){if("undefined"==typeof atob)throw new V0("unimplemented","Blobs are unavailable in Firestore in this environment.")}class jO{constructor(e){this._delegate=e}static fromBase64String(e){return UO(),new jO(SP.fromBase64String(e))}static fromUint8Array(e){return FO(),new jO(SP.fromUint8Array(e))}toBase64(){return UO(),this._delegate.toBase64()}toUint8Array(){return FO(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function qO(e){return function(e,t){if("object"!=typeof e||null===e)return;var n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return 1;return}(e,["next","error","complete"])}class VO{enableIndexedDbPersistence(e,t){return function(e,t){TP(e=ZR(e,gP));var n=mP(e),r=e._freezeSettings(),e=new kR;return vP(n,e,new ER(e,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){TP(e=ZR(e,gP));var t=mP(e),n=e._freezeSettings(),e=new kR;return vP(t,e,new SR(e,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new V0(q0.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new B0;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!fC.bt())return Promise.resolve();e+="main";await fC.delete(e)}(EA(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class BO{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof $R||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||M0("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(n,e,r,i={}){const s=(n=ZR(n,nP))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&M0("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${r}`,ssl:!1})),i.mockUserToken){let e,t;if("string"==typeof i.mockUserToken)e=i.mockUserToken,t=R0.MOCK_USER;else{e=ds(i.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new V0(q0.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new R0(s)}n._credentials=new W0(new K0(e,t))}}(this._delegate,e,t,n)}enableNetwork(){return wP(this._delegate)}disableNetwork(){return bP(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,QR("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return _P(this._delegate)}onSnapshotsInSync(e){return PO(this._delegate,e)}get app(){if(!this._appCompat)throw new V0("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new nx(this,oP(this._delegate,e))}catch(e){throw GO(e,"collection()","Firestore.collection()")}}doc(e){try{return new HO(this,aP(this._delegate,e))}catch(e){throw GO(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ZO(this,function(e,t){if(e=ZR(e,nP),GR("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new V0(q0.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new iP(e,null,(t=t,new tS(oE.emptyPath(),t)))}(this._delegate,e))}catch(e){throw GO(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return LO(this._delegate,e=>t(new zO(this,e)))}batch(){return mP(this._delegate),new WO(new TO(this._delegate,e=>OO(this._delegate,e)))}loadBundle(e){return t=this._delegate,n=e,r=mP(t=ZR(t,gP)),e=new dP,zR(r,t._databaseId,n,e),e;var t,n,r}namedQuery(e){return IP(this._delegate,e).then(e=>e?new ZO(this,e):null)}}class KO extends wO{constructor(e){super(),this.firestore=e}convertBytes(e){return new jO(new SP(e))}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return HO.forKey(e,this.firestore,null)}}class zO{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new KO(e)}get(e){const t=rx(e);return this._delegate.get(t).then(e=>new JO(this._firestore,new iO(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){e=rx(e);return n?(MO("Transaction.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=rx(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=rx(e);return this._delegate.delete(e),this}}class WO{constructor(e){this._delegate=e}set(e,t,n){e=rx(e);return n?(MO("WriteBatch.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=rx(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=rx(e);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class $O{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){e=new sO(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new XO(this._firestore,e),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=$O.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new $O(e,new KO(e),t),r.set(t,i)),i}}$O.INSTANCES=new WeakMap;class HO{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new KO(e)}static forPath(e,t,n){if(e.length%2!=0)throw new V0("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new HO(t,new rP(t._delegate,n,new wE(e)))}static forKey(e,t,n){return new HO(t,new rP(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new nx(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new nx(this.firestore,oP(this._delegate,e))}catch(e){throw GO(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=io(e))instanceof rP&&cP(this._delegate,e)}set(e,t){t=MO("DocumentReference.set",t);try{return t?AO(this._delegate,e,t):AO(this._delegate,e)}catch(e){throw GO(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?NO(this._delegate,e):NO(this._delegate,e,t,...n)}catch(e){throw GO(e,"updateDoc()","DocumentReference.update()")}}delete(){return OO(ZR((e=this._delegate).firestore,gP),[new zS(e._key,OS.none())]);var e}onSnapshot(...e){var t=QO(e),e=YO(e,e=>new JO(this.firestore,new iO(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return RO(this._delegate,t,e)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?kO:"server"===(null==e?void 0:e.source)?function(t){t=ZR(t,rP);const n=ZR(t.firestore,gP);return BR(mP(n),t._key,{source:"server"}).then(e=>xO(n,t,e))}:function(t){t=ZR(t,rP);const n=ZR(t.firestore,gP);return BR(mP(n),t._key).then(e=>xO(n,t,e))})(this._delegate),t.then(e=>new JO(this.firestore,new iO(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new HO(this.firestore,e?this._delegate.withConverter($O.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function GO(e,t,n){return e.message=e.message.replace(t,n),e}function QO(e){for(const t of e)if("object"==typeof t&&!qO(t))return t;return{}}function YO(e,t){let n;return n=qO(e[0])?e[0]:qO(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{n.next&&n.next(t(e))},error:null===(e=n.error)||void 0===e?void 0:e.bind(n),complete:null===(e=n.complete)||void 0===e?void 0:e.bind(n)}}class JO{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new HO(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return aO(this._delegate,e._delegate)}}class XO extends JO{data(e){e=this._delegate.data(e);return void 0!==e||U0(),e}}class ZO{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new KO(e)}where(e,t,n){try{return new ZO(this.firestore,uO(this._delegate,(r=e,i=t,s=n,r=nO("where",e),new hO(r,i,s))))}catch(e){throw GO(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new ZO(this.firestore,uO(this._delegate,([n,r="asc"]=[e,t],n=nO("orderBy",n),new dO(n,r))))}catch(e){throw GO(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r}limit(e){try{return new ZO(this.firestore,uO(this._delegate,(eP("limit",t=e),new fO("limit",t,"F"))))}catch(e){throw GO(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new ZO(this.firestore,uO(this._delegate,(eP("limitToLast",t=e),new fO("limitToLast",t,"L"))))}catch(e){throw GO(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new ZO(this.firestore,uO(this._delegate,function(...e){return new pO("startAt",e,!0)}(...e)))}catch(e){throw GO(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ZO(this.firestore,uO(this._delegate,function(...e){return new pO("startAfter",e,!1)}(...e)))}catch(e){throw GO(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ZO(this.firestore,uO(this._delegate,function(...e){return new gO("endBefore",e,!0)}(...e)))}catch(e){throw GO(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ZO(this.firestore,uO(this._delegate,function(...e){return new gO("endAt",e,!1)}(...e)))}catch(e){throw GO(e,"endAt()","Query.endAt()")}}isEqual(e){return lP(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?CO:"server"===(null==e?void 0:e.source)?function(t){t=ZR(t,iP);const n=ZR(t.firestore,gP),e=mP(n),r=new SO(n);return KR(e,t._query,{source:"server"}).then(e=>new oO(n,r,t,e))}:function(t){t=ZR(t,iP);const n=ZR(t.firestore,gP),e=mP(n),r=new SO(n);return cO(t._query),KR(e,t._query).then(e=>new oO(n,r,t,e))})(this._delegate),t.then(e=>new tx(this.firestore,new oO(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=QO(e),e=YO(e,e=>new tx(this.firestore,new oO(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return RO(this._delegate,t,e)}withConverter(e){return new ZO(this.firestore,e?this._delegate.withConverter($O.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class ex{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new XO(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class tx{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ZO(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new XO(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new ex(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new XO(this._firestore,e))})}isEqual(e){return aO(this._delegate,e._delegate)}}class nx extends ZO{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new HO(this.firestore,e):null}doc(e){try{return void 0===e?new HO(this.firestore,aP(this._delegate)):new HO(this.firestore,aP(this._delegate,e))}catch(e){throw GO(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=ZR(e.firestore,gP),r=aP(e),i=bO(e.converter,t);return OO(n,[LP(DP(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,OS.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new HO(this.firestore,e))}isEqual(e){return cP(this._delegate,e._delegate)}withConverter(e){return new nx(this.firestore,e?this._delegate.withConverter($O.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function rx(e){return ZR(e,rP)}const ix={Firestore:BO,GeoPoint:CP,Timestamp:eE,Blob:jO,Transaction:zO,WriteBatch:WO,DocumentReference:HO,DocumentSnapshot:JO,Query:ZO,QueryDocumentSnapshot:XO,QuerySnapshot:tx,CollectionReference:nx,FieldPath:class e{constructor(...e){this._delegate=new EP(...e)}static documentId(){return new e(cE.keyField().canonicalString())}isEqual(e){return(e=io(e))instanceof EP&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class n{constructor(e){this._delegate=e}static serverTimestamp(){const e=new UP("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){const e=new MP("deleteField");return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){const t=function(...e){return new jP("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){const t=function(...e){return new qP("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){const t=new VP("increment",e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){e=e,O0.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};fP=Go,pP=(e,t)=>new BO(e,t,new VO),fP.INTERNAL.registerComponent(new so("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("firestore").getImmediate();return pP(t,e)},"PUBLIC").setServiceProps(Object.assign({},ix))),fP.registerVersion("@firebase/firestore-compat","0.1.2");const sx="type.googleapis.com/google.protobuf.Int64Value",ox="type.googleapis.com/google.protobuf.UInt64Value";function ax(e,t){const n={};for(const r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}function cx(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case sx:case ox:var t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>cx(e)):"function"==typeof e||"object"==typeof e?ax(e,e=>cx(e)):e}const lx="functions",ux={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class hx extends Ss{constructor(e,t,n){super(`${lx}/${e}`,t||""),this.details=n}}function dx(e,t){let n=function(e){if(200<=e&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=n,i=void 0;try{var s=t&&t.error;if(s){const e=s.status;if("string"==typeof e){if(!ux[e])return new hx("internal","internal");n=ux[e],r=e}var o=s.message;"string"==typeof o&&(r=o),i=s.details,void 0!==i&&(i=cx(i))}}catch(e){}return"ok"===n?null:new hx(n,r,i)}class fx{constructor(e,t,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{var e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(){if(this.appCheck){var e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken()}}}const px="us-central1";class gx{constructor(e,t,n,r,i=px,s){this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new fx(t,n,r),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{var o=new URL(i);this.customDomain=o.origin,this.region=px}catch(e){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){var t=this.app.options.projectId;return null===this.emulatorOrigin?null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`:`${this.emulatorOrigin}/${t}/${this.region}/${e}`}}function mx(t,n,r){return e=>async function(e,t,n,r){const i=e._url(t),s={data:n=function t(e){if(null==e)return null;if("number"==typeof(e=e instanceof Number?e.valueOf():e)&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>t(e));if("function"==typeof e||"object"==typeof e)return ax(e,e=>t(e));throw new Error("Data cannot be encoded in JSON: "+e)}(n)},o={},a=await e.contextProvider.getContext();a.authToken&&(o.Authorization="Bearer "+a.authToken);a.messagingToken&&(o["Firebase-Instance-ID-Token"]=a.messagingToken);null!==a.appCheckToken&&(o["X-Firebase-AppCheck"]=a.appCheckToken);r=r.timeout||7e4,r=await Promise.race([async function(e,t,n,r){n["Content-Type"]="application/json";let i;try{i=await r(e,{method:"POST",body:JSON.stringify(t),headers:n})}catch(e){return{status:0,json:null}}let s=null;try{s=await i.json()}catch(e){}return{status:i.status,json:s}}(i,s,o,e.fetchImpl),function(n){return new Promise((e,t)=>{setTimeout(()=>{t(new hx("deadline-exceeded","deadline-exceeded"))},n)})}(r),e.cancelAllRequests]);if(!r)throw new hx("cancelled","Firebase Functions instance was deleted.");e=dx(r.status,r.json);if(e)throw e;if(!r.json)throw new hx("internal","Response is not valid JSON object.");let c=r.json.data;void 0===c&&(c=r.json.result);if(void 0===c)throw new hx("internal","Response is missing data field.");r=cx(c);return{data:r}}(t,n,e,r||{})}var yx;function vx(e,t,n){io(e).emulatorOrigin=`http://${t}:${n}`}yx=fetch.bind(self),Oo(new so(lx,(e,{instanceIdentifier:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("messaging-internal"),e=e.getProvider("app-check-internal");return new gx(n,r,i,e,t,yx)},"PUBLIC").setMultipleInstances(!0)),qo("@firebase/functions","0.7.1");var _x,wx,bx,Ix;class Tx{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return mx(io(this._delegate),e,t)}useFunctionsEmulator(e){e=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(null==e)throw new Ss("functions","No origin provided to useFunctionsEmulator()");if(null==e[2])throw new Ss("functions","Port missing in origin provided to useFunctionsEmulator()");return vx(this._delegate,e[1],Number(e[2]))}useEmulator(e,t){return vx(this._delegate,e,t)}}const Ex=(e,{instanceIdentifier:t})=>{var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("functions").getImmediate({identifier:null!=t?t:"us-central1"});return new Tx(n,t)};_x={Functions:Tx},Go.INTERNAL.registerComponent(new so("functions-compat",Ex,"PUBLIC").setServiceProps(_x).setMultipleInstances(!0)),Go.registerVersion("@firebase/functions-compat","0.1.2");const Sx="/firebase-messaging-sw.js",kx="/firebase-cloud-messaging-push-scope",Cx="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",Ax="https://fcmregistrations.googleapis.com/v1",Nx="google.c.a.c_id",Rx="google.c.a.c_l",Px="google.c.a.ts";function Ox(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(E={})[E.DATA_MESSAGE=1]="DATA_MESSAGE",E[E.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(E=wx=wx||{}).PUSH_RECEIVED="push-received",E.NOTIFICATION_CLICKED="notification-clicked";const xx="fcm_token_details_db",Dx=5,Lx="fcm_token_object_Store";async function Mx(s){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(xx))return null}let o=null;const e=await aa(xx,Dx,async e=>{var t;if(!(e.oldVersion<2)&&e.objectStoreNames.contains(Lx)){const i=e.transaction.objectStore(Lx);var n,r=await i.index("fcmSenderId").get(s);await i.clear(),r&&(2===e.oldVersion?(n=r).auth&&n.p256dh&&n.endpoint&&(o={token:n.fcmToken,createTime:null!==(t=n.createTime)&&void 0!==t?t:Date.now(),subscriptionOptions:{auth:n.auth,p256dh:n.p256dh,endpoint:n.endpoint,swScope:n.swScope,vapidKey:"string"==typeof n.vapidKey?n.vapidKey:Ox(n.vapidKey)}}):3===e.oldVersion?(n=r,o={token:n.fcmToken,createTime:n.createTime,subscriptionOptions:{auth:Ox(n.auth),p256dh:Ox(n.p256dh),endpoint:n.endpoint,swScope:n.swScope,vapidKey:Ox(n.vapidKey)}}):4===e.oldVersion&&(r=r,o={token:r.fcmToken,createTime:r.createTime,subscriptionOptions:{auth:Ox(r.auth),p256dh:Ox(r.p256dh),endpoint:r.endpoint,swScope:r.swScope,vapidKey:Ox(r.vapidKey)}}))}});return e.close(),await ca(xx),await ca("fcm_vapid_details_db"),await ca("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(o)?o:null}const Fx="firebase-messaging-database",Ux=1,jx="firebase-messaging-store";let qx=null;function Vx(){return qx=qx||aa(Fx,Ux,e=>{0===e.oldVersion&&e.createObjectStore(jx)}),qx}async function Bx(e){var t=zx(e);const n=await Vx();t=await n.transaction(jx).objectStore(jx).get(t);if(t)return t;t=await Mx(e.appConfig.senderId);return t?(await Kx(e,t),t):void 0}async function Kx(e,t){e=zx(e);const n=await Vx(),r=n.transaction(jx,"readwrite");return await r.objectStore(jx).put(t,e),await r.complete,t}function zx({appConfig:e}){return e.appId}const Wx=new Cs("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function $x(e,t){var n={method:"DELETE",headers:await Gx(e)};try{const s=await fetch(`${Hx(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw Wx.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw Wx.create("token-unsubscribe-failed",{errorInfo:e})}}function Hx({projectId:e}){return`${Ax}/projects/${e}/registrations`}async function Gx({appConfig:e,installations:t}){t=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function Qx({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==Cx&&(i.web.applicationPubKey=r),i}const Yx=6048e5;async function Jx(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:Ox(t.getKey("auth")),p256dh:Ox(t.getKey("p256dh"))},a=await Bx(e.firebaseDependencies);if(a){if(n=a.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,n=o.p256dh===n.p256dh,r&&i&&s&&n)return Date.now()>=a.createTime+Yx?async function(t,e){try{var n=await async function(e,t){var n=await Gx(e),r=Qx(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${Hx(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw Wx.create("token-update-failed",{errorInfo:e})}if(i.error){r=i.error.message;throw Wx.create("token-update-failed",{errorInfo:r})}if(!i.token)throw Wx.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await Kx(t.firebaseDependencies,r),n}catch(e){throw await Xx(t),e}}(e,{token:a.token,createTime:Date.now(),subscriptionOptions:o}):a.token;try{await $x(e.firebaseDependencies,a.token)}catch(e){console.warn(e)}return Zx(e.firebaseDependencies,o)}return Zx(e.firebaseDependencies,o)}async function Xx(e){var t=await Bx(e.firebaseDependencies);t&&(await $x(e.firebaseDependencies,t.token),await async function(e){e=zx(e);const t=await Vx(),n=t.transaction(jx,"readwrite");await n.objectStore(jx).delete(e),await n.complete}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function Zx(e,t){t={token:await async function(e,t){var n=await Gx(e),t=Qx(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const i=await fetch(Hx(e.appConfig),t);r=await i.json()}catch(e){throw Wx.create("token-subscribe-failed",{errorInfo:e})}if(r.error){t=r.error.message;throw Wx.create("token-subscribe-failed",{errorInfo:t})}if(!r.token)throw Wx.create("token-subscribe-no-token");return r.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await Kx(e,t),t.token}function eD(e){var t,n,r,i={from:e.from,collapseKey:e.collapse_key,messageId:e.fcm_message_id};return n=i,(r=e).notification&&(n.notification={},(t=r.notification.title)&&(n.notification.title=t),(t=r.notification.body)&&(n.notification.body=t),(r=r.notification.image)&&(n.notification.image=r)),n=i,(r=e).data&&(n.data=r.data),n=i,(r=e).fcmOptions&&(n.fcmOptions={},(e=r.fcmOptions.link)&&(n.fcmOptions.link=e),(r=r.fcmOptions.analytics_label)&&(n.fcmOptions.analyticsLabel=r)),i}function tD(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));return r.join("")}function nD(e){return Wx.create("missing-app-config-values",{valueName:e})}tD("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),tD("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class rD{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw nD("App Configuration Object");if(!e.name)throw nD("App Name");var{options:t}=e;for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw nD(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}async function iD(e){try{e.swRegistration=await navigator.serviceWorker.register(Sx,{scope:kx}),e.swRegistration.update().catch(()=>{})}catch(e){throw Wx.create("failed-service-worker-registration",{browserErrorMessage:e.message})}}async function sD(e,t){if(!navigator)throw Wx.create("only-available-in-window");if("default"===Notification.permission&&await Notification.requestPermission(),"granted"!==Notification.permission)throw Wx.create("permission-blocked");var n,r;return n=e,await((r=null==t?void 0:t.vapidKey)?n.vapidKey=r:n.vapidKey||(n.vapidKey=Cx)),await async function(e,t){if(t||e.swRegistration||await iD(e),t||!e.swRegistration){if(!(t instanceof ServiceWorkerRegistration))throw Wx.create("invalid-sw-registration");e.swRegistration=t}}(e,null==t?void 0:t.serviceWorkerRegistration),Jx(e)}async function oD(e,t,n){t=function(e){switch(e){case wx.NOTIFICATION_CLICKED:return"notification_open";case wx.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(t);const r=await e.firebaseDependencies.analyticsProvider.get();r.logEvent(t,{message_id:n[Nx],message_name:n[Rx],message_time:n[Px],message_device_time:Math.floor(Date.now()/1e3)})}async function aD(e,t){var n,r=t.data;r.isFirebaseMessaging&&(e.onMessageHandler&&r.messageType===wx.PUSH_RECEIVED&&("function"==typeof e.onMessageHandler?e.onMessageHandler(eD(r)):e.onMessageHandler.next(eD(r))),n=r.data,"object"==typeof(t=n)&&t&&Nx in t&&"1"===n["google.c.a.e"]&&await oD(e,r.messageType,n))}function cD(e){return async function(e){if(!navigator)throw Wx.create("only-available-in-window");return e.swRegistration||await iD(e),Xx(e)}(e=io(e))}function lD(e,t){return function(e,t){if(!navigator)throw Wx.create("only-available-in-window");return e.onMessageHandler=t,()=>{e.onMessageHandler=null}}(e=io(e),t)}Oo(new so("messaging",e=>{const t=new rD(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",e=>aD(t,e)),t},"PUBLIC")),Oo(new so("messaging-internal",e=>{const t=e.getProvider("messaging").getImmediate();return{getToken:e=>sD(t,e)}},"PRIVATE"));const uD="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",hD="https://fcmregistrations.googleapis.com/v1",dD="FCM_MSG",fD="google.c.a.c_id",pD=3,gD=1;function mD(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(E=bx=bx||{})[E.DATA_MESSAGE=1]="DATA_MESSAGE",E[E.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION",(E=Ix=Ix||{}).PUSH_RECEIVED="push-received",E.NOTIFICATION_CLICKED="notification-clicked";const yD="fcm_token_details_db",vD=5,_D="fcm_token_object_Store";async function wD(s){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(yD))return null}let o=null;const e=await aa(yD,vD,async e=>{var t;if(!(e.oldVersion<2)&&e.objectStoreNames.contains(_D)){const i=e.transaction.objectStore(_D);var n,r=await i.index("fcmSenderId").get(s);await i.clear(),r&&(2===e.oldVersion?(n=r).auth&&n.p256dh&&n.endpoint&&(o={token:n.fcmToken,createTime:null!==(t=n.createTime)&&void 0!==t?t:Date.now(),subscriptionOptions:{auth:n.auth,p256dh:n.p256dh,endpoint:n.endpoint,swScope:n.swScope,vapidKey:"string"==typeof n.vapidKey?n.vapidKey:mD(n.vapidKey)}}):3===e.oldVersion?(n=r,o={token:n.fcmToken,createTime:n.createTime,subscriptionOptions:{auth:mD(n.auth),p256dh:mD(n.p256dh),endpoint:n.endpoint,swScope:n.swScope,vapidKey:mD(n.vapidKey)}}):4===e.oldVersion&&(r=r,o={token:r.fcmToken,createTime:r.createTime,subscriptionOptions:{auth:mD(r.auth),p256dh:mD(r.p256dh),endpoint:r.endpoint,swScope:r.swScope,vapidKey:mD(r.vapidKey)}}))}});return e.close(),await ca(yD),await ca("fcm_vapid_details_db"),await ca("undefined"),function(e){if(!e||!e.subscriptionOptions)return!1;var{subscriptionOptions:t}=e;return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}(o)?o:null}const bD="firebase-messaging-database",ID=1,TD="firebase-messaging-store";let ED=null;function SD(){return ED=ED||aa(bD,ID,e=>{0===e.oldVersion&&e.createObjectStore(TD)}),ED}async function kD(e){var t=AD(e);const n=await SD();t=await n.transaction(TD).objectStore(TD).get(t);if(t)return t;t=await wD(e.appConfig.senderId);return t?(await CD(e,t),t):void 0}async function CD(e,t){e=AD(e);const n=await SD(),r=n.transaction(TD,"readwrite");return await r.objectStore(TD).put(t,e),await r.complete,t}function AD({appConfig:e}){return e.appId}const ND=new Cs("messaging","Messaging",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."});async function RD(e,t){var n={method:"DELETE",headers:await OD(e)};try{const s=await fetch(`${PD(e.appConfig)}/${t}`,n);var r=await s.json();if(r.error){var i=r.error.message;throw ND.create("token-unsubscribe-failed",{errorInfo:i})}}catch(e){throw ND.create("token-unsubscribe-failed",{errorInfo:e})}}function PD({projectId:e}){return`${hD}/projects/${e}/registrations`}async function OD({appConfig:e,installations:t}){t=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function xD({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const i={web:{endpoint:n,auth:t,p256dh:e}};return r!==uD&&(i.web.applicationPubKey=r),i}const DD=6048e5;async function LD(e){const t=await async function(e,t){var n=await e.pushManager.getSubscription();if(n)return n;return e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}(t)})}(e.swRegistration,e.vapidKey);var n,r,i,s,o={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:mD(t.getKey("auth")),p256dh:mD(t.getKey("p256dh"))},a=await kD(e.firebaseDependencies);if(a){if(n=a.subscriptionOptions,r=o.vapidKey===n.vapidKey,i=o.endpoint===n.endpoint,s=o.auth===n.auth,n=o.p256dh===n.p256dh,r&&i&&s&&n)return Date.now()>=a.createTime+DD?async function(t,e){try{var n=await async function(e,t){var n=await OD(e),r=xD(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let i;try{const s=await fetch(`${PD(e.appConfig)}/${t.token}`,r);i=await s.json()}catch(e){throw ND.create("token-update-failed",{errorInfo:e})}if(i.error){r=i.error.message;throw ND.create("token-update-failed",{errorInfo:r})}if(!i.token)throw ND.create("token-update-no-token");return i.token}(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await CD(t.firebaseDependencies,r),n}catch(e){throw await MD(t),e}}(e,{token:a.token,createTime:Date.now(),subscriptionOptions:o}):a.token;try{await RD(e.firebaseDependencies,a.token)}catch(e){console.warn(e)}return FD(e.firebaseDependencies,o)}return FD(e.firebaseDependencies,o)}async function MD(e){var t=await kD(e.firebaseDependencies);t&&(await RD(e.firebaseDependencies,t.token),await async function(e){e=AD(e);const t=await SD(),n=t.transaction(TD,"readwrite");await n.objectStore(TD).delete(e),await n.complete}(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function FD(e,t){t={token:await async function(e,t){var n=await OD(e),t=xD(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const i=await fetch(PD(e.appConfig),t);r=await i.json()}catch(e){throw ND.create("token-subscribe-failed",{errorInfo:e})}if(r.error){t=r.error.message;throw ND.create("token-subscribe-failed",{errorInfo:t})}if(!r.token)throw ND.create("token-subscribe-no-token");return r.token}(e,t),createTime:Date.now(),subscriptionOptions:t};return await CD(e,t),t.token}jD("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),jD("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");async function UD(e,t){t=function(e,t){const n={};e.from&&(n.project_number=e.from);e.fcm_message_id&&(n.message_id=e.fcm_message_id);n.instance_id=t,e.notification?n.message_type=bx.DISPLAY_NOTIFICATION.toString():n.message_type=bx.DATA_MESSAGE.toString();n.sdk_platform=pD.toString(),n.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(n.collapse_key=e.collapse_key);n.event=gD.toString(),null!==(t=e.fcmOptions)&&void 0!==t&&t.analytics_label&&(n.analytics_label=null===(e=e.fcmOptions)||void 0===e?void 0:e.analytics_label);return n}(t,await e.firebaseDependencies.installations.getId());!function(e,t){const n={};n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),e.logEvents.push(n)}(e,t)}function jD(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));return r.join("")}async function qD(e,t){var n=function({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}(e);if(n){t.deliveryMetricsExportedToBigQueryEnabled&&await UD(t,n);var r,i,s=await BD();if(s.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")))return function(e,t){t.isFirebaseMessaging=!0,t.messageType=Ix.PUSH_RECEIVED;for(const n of e)n.postMessage(t)}(s,n);n.notification&&await function(e){var{actions:t}=e,{maxActions:n}=Notification;t&&n&&t.length>n&&console.warn(`This browser only supports ${n} actions. The remaining actions will not be displayed.`);return self.registration.showNotification(null!==(n=e.title)&&void 0!==n?n:"",e)}(function(e){const t=Object.assign({},e.notification);return t.data={[dD]:e},t}(n)),t&&t.onBackgroundMessageHandler&&(i={from:(r=n).from,collapseKey:r.collapse_key,messageId:r.fcm_message_id},e=i,(s=r).notification&&(e.notification={},(n=s.notification.title)&&(e.notification.title=n),(n=s.notification.body)&&(e.notification.body=n),(s=s.notification.image)&&(e.notification.image=s)),e=i,(s=r).data&&(e.data=s.data),e=i,(s=r).fcmOptions&&(e.fcmOptions={},(r=s.fcmOptions.link)&&(e.fcmOptions.link=r),(s=s.fcmOptions.analytics_label)&&(e.fcmOptions.analyticsLabel=s)),i=i,"function"==typeof t.onBackgroundMessageHandler?t.onBackgroundMessageHandler(i):t.onBackgroundMessageHandler.next(i))}}async function VD(e){const t=null===(i=null===(n=e.notification)||void 0===n?void 0:n.data)||void 0===i?void 0:i[dD];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var n=function(e){var t;var n=null!==(t=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==t?t:null===(n=e.notification)||void 0===n?void 0:n.click_action;if(n)return n;return function(e){return"object"==typeof e&&e&&fD in e}(e.data)?self.location.origin:null}(t);if(n){var r,i=new URL(n,self.location.href),e=new URL(self.location.origin);if(i.host===e.host){let e=await async function(e){var t=await BD();for(const r of t){var n=new URL(r.url,self.location.href);if(e.host===n.host)return r}return null}(i);if(e?e=await e.focus():(e=await self.clients.openWindow(n),r=3e3,await new Promise(e=>{setTimeout(e,r)})),e)return t.messageType=Ix.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}}function BD(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function KD(e){return ND.create("missing-app-config-values",{valueName:e})}class zD{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=function(e){if(!e||!e.options)throw KD("App Configuration Object");if(!e.name)throw KD("App Name");var{options:t}=e;for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw KD(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}function WD(e,t){return function(e,t){if(void 0!==self.document)throw ND.create("only-available-in-sw");return e.onBackgroundMessageHandler=t,()=>{e.onBackgroundMessageHandler=null}}(e=io(e),t)}Oo(new so("messaging-sw",e=>{const t=new zD(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(qD(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(async function(e,t){var{newSubscription:e}=e;e?(e=await kD(t.firebaseDependencies),await MD(t),t.vapidKey=null!==(e=null===(e=null==e?void 0:e.subscriptionOptions)||void 0===e?void 0:e.vapidKey)&&void 0!==e?e:uD,await LD(t)):await MD(t)}(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(VD(e))}),t},"PUBLIC"));var $D,HD,GD;class QD{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return async function(e,t){return sD(e=io(e),t)}(this._delegate,e)}async deleteToken(){return cD(this._delegate)}onMessage(e){return lD(this._delegate,e)}onBackgroundMessage(e){return WD(this._delegate,e)}}const YD={isSupported:function(){return self&&"ServiceWorkerGlobalScope"in self?"indexedDB"in self&&null!==indexedDB&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"indexedDB"in window&&null!==indexedDB&&navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}};Go.INTERNAL.registerComponent(new so("messaging-compat",e=>self&&"ServiceWorkerGlobalScope"in self?new QD(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging-sw").getImmediate()):new QD(e.getProvider("app-compat").getImmediate(),e.getProvider("messaging").getImmediate()),"PUBLIC").setServiceProps(YD)),Go.registerVersion("@firebase/messaging-compat","0.1.0"),(E=$D=$D||{})[E.NO_ERROR=0]="NO_ERROR",E[E.NETWORK_ERROR=1]="NETWORK_ERROR",E[E.ABORT=2]="ABORT";const JD="firebasestorage.googleapis.com",XD="storageBucket";class ZD extends Ss{constructor(e,t){super(e1(e),`Firebase Storage: ${t} (${e1(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ZD.prototype)}_codeEquals(e){return e1(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function e1(e){return"storage/"+e}function t1(){return new ZD("unknown","An unknown error occurred, please check the error payload for server response.")}function n1(){return new ZD("canceled","User canceled the upload/download.")}function r1(){return new ZD("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function i1(e){return new ZD("invalid-argument",e)}function s1(){return new ZD("app-deleted","The Firebase app was deleted.")}function o1(e){return new ZD("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function a1(e,t){return new ZD("invalid-format","String does not match format '"+e+"': "+t)}function c1(e){throw new ZD("internal-error","Internal error: "+e)}class l1{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=$D.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=$D.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=$D.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,n,r){if(this.sent_)throw c1("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw c1("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw c1("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponseText(){if(!this.sent_)throw c1("cannot .getResponseText() before sending");return this.xhr_.responseText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class u1{createConnection(){return new l1}}class h1{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=h1.makeFromUrl(t,e)}catch(e){return new h1(t,"")}if(""===n.path)return n;throw t=t,new ZD("invalid-default-bucket","Invalid default bucket '"+t+"'.")}static makeFromUrl(t,e){let n=null;var r="([A-Za-z0-9.\\-_]+)";var i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}var o=e.replace(/[.]/g,"\\."),o=new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),e=e===JD?"(?:storage.googleapis.com|storage.cloud.google.com)":e,a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:o,indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${e}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let e=0;e<a.length;e++){const u=a[e];var c=u.regex.exec(t);if(c){var l=c[u.indices.bucket];let e=c[u.indices.path];e=e||"",n=new h1(l,e),u.postModify(n);break}}if(null==n)throw r=t,new ZD("invalid-url","Invalid URL '"+r+"'.");return n}}class d1{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=0){}}function f1(e){return"string"==typeof e||e instanceof String}function p1(e){return g1()&&e instanceof Blob}function g1(){return"undefined"!=typeof Blob}function m1(e,t,n,r){if(r<t)throw i1(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n<r)throw i1(`Invalid value for '${e}'. Expected ${n} or less.`)}function y1(e,t,n){let r=null==n?`https://${t}`:t;return`${n}://${r}/v0${e}`}function v1(e){const t=encodeURIComponent;let n="?";for(const i in e){var r;e.hasOwnProperty(i)&&(r=t(i)+"="+t(e[i]),n=n+r+"&")}return n=n.slice(0,-1),n}class _1{constructor(e,t,n,r,i,s,o,a,c,l,u){this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=s.slice(),this.callback_=o,this.errorCallback_=a,this.progressCallback_=l,this.timeout_=c,this.pool_=u,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const c=this;function e(e,t){const n=c.resolve_,r=c.reject_,i=t.connection;if(t.wasSuccessCode)try{var s=c.callback_(i,i.getResponseText());void 0!==s?n(s):n()}catch(e){r(e)}else if(null!==i){const a=t1();a.serverResponse=i.getResponseText(),c.errorCallback_?r(c.errorCallback_(i,a)):r(a)}else{var o;t.canceled?(o=(c.appDelete_?s1:n1)(),r(o)):(o=new ZD("retry-limit-exceeded","Max retry time for operation exceeded, please try again."),r(o))}}this.canceled_?e(0,new w1(!1,null,!0)):this.backoffId_=function(t,n,e){let r=1,i=null,s=!1,o=0;function a(){return 2===o}let c=!1;function l(...e){c||(c=!0,n.apply(null,e))}function u(e){i=setTimeout(()=>{i=null,t(h,a())},e)}function h(e,...t){if(!c)if(e)l.call(null,e,...t);else if(a()||s)l.call(null,e,...t);else{r<64&&(r*=2);let e;e=1===o?(o=2,0):1e3*(r+Math.random()),u(e)}}let d=!1;function f(e){d||(d=!0,c||(null!==i?(e||(o=2),clearTimeout(i),u(0)):e||(o=1)))}return u(0),setTimeout(()=>{f(s=!0)},e),f}(function(r,e){if(e)r(!1,new w1(!1,null,!0));else{const s=c.pool_.createConnection();function i(e){var t=e.loaded,e=e.lengthComputable?e.total:-1;null!==c.progressCallback_&&c.progressCallback_(t,e)}c.pendingConnection_=s,null!==c.progressCallback_&&s.addUploadProgressListener(i),s.send(c.url_,c.method_,c.body_,c.headers_).then(()=>{null!==c.progressCallback_&&s.removeUploadProgressListener(i),c.pendingConnection_=null;var e,t=s.getErrorCode()===$D.NO_ERROR,n=s.getStatus();t&&!c.isRetryStatusCode_(n)?(e=-1!==c.successCodes_.indexOf(n),r(!0,new w1(e,s))):(e=s.getErrorCode()===$D.ABORT,r(!1,new w1(!1,null,e)))})}},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){var t=500<=e&&e<600,n=-1!==[408,429].indexOf(e),e=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||e}}class w1{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function b1(...t){const e="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==e){const n=new e;for(let e=0;e<t.length;e++)n.append(t[e]);return n.getBlob()}if(g1())return new Blob(t);throw new ZD("unsupported-environment","This browser doesn't seem to support creating Blobs")}const I1={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class T1{constructor(e,t){this.data=e,this.contentType=t||null}}function E1(e,t){switch(e){case I1.RAW:return new T1(S1(t));case I1.BASE64:case I1.BASE64URL:return new T1(k1(e,t));case I1.DATA_URL:return new T1(function(e){e=new C1(e);return e.base64?k1(I1.BASE64,e.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw a1(I1.DATA_URL,"Malformed data URL.")}return S1(t)}(e.rest)}(t),function(e){e=new C1(e);return e.contentType}(t))}throw t1()}function S1(n){const r=[];for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);var i,s;e<=127?r.push(e):e<=2047?r.push(192|e>>6,128|63&e):55296==(64512&e)?t<n.length-1&&56320==(64512&n.charCodeAt(t+1))?(i=e,s=n.charCodeAt(++t),e=65536|(1023&i)<<10|1023&s,r.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e)):r.push(239,191,189):56320==(64512&e)?r.push(239,191,189):r.push(224|e>>12,128|e>>6&63,128|63&e)}return new Uint8Array(r)}function k1(t,e){switch(t){case I1.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw a1(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case I1.BASE64URL:r=-1!==e.indexOf("+"),n=-1!==e.indexOf("/");if(r||n)throw a1(t,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}let i;try{i=atob(e)}catch(e){throw a1(t,"Invalid character found")}const s=new Uint8Array(i.length);for(let e=0;e<i.length;e++)s[e]=i.charCodeAt(e);return s}class C1{constructor(e){this.base64=!1,this.contentType=null;var t,n=e.match(/^data:([^,]+)?,/);if(null===n)throw a1(I1.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;null!=r&&(this.base64=(t=r,n=";base64",t.length>=n.length&&t.substring(t.length-n.length)===n),this.contentType=this.base64?r.substring(0,r.length-";base64".length):r),this.rest=e.substring(e.indexOf(",")+1)}}class A1{constructor(e,t){let n=0,r="";p1(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(p1(this.data_)){var n=this.data_,r=(i=e,r=t,(n=n).webkitSlice?n.webkitSlice(i,r):n.mozSlice?n.mozSlice(i,r):n.slice?n.slice(i,r):null);return null===r?null:new A1(r)}var i,r,e=new Uint8Array(this.data_.buffer,e,t-e);return new A1(e,!0)}static getBlob(...e){if(g1()){var t=e.map(e=>e instanceof A1?e.data_:e);return new A1(b1.apply(null,t))}{const r=e.map(e=>f1(e)?E1(I1.RAW,e).data:e.data_);let t=0;r.forEach(e=>{t+=e.byteLength});const i=new Uint8Array(t);let n=0;return r.forEach(t=>{for(let e=0;e<t.length;e++)i[n++]=t[e]}),new A1(i,!0)}}uploadData(){return this.data_}}function N1(e){let t;try{t=JSON.parse(e)}catch(e){return null}return"object"!=typeof(e=t)||Array.isArray(e)?null:t}function R1(e){var t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function P1(e,t){return t}class O1{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||P1}}let x1=null;function D1(){if(x1)return x1;const e=[];e.push(new O1("bucket")),e.push(new O1("generation")),e.push(new O1("metageneration")),e.push(new O1("name","fullPath",!0));const t=new O1("name");t.xform=function(e,t){return!f1(t=t)||t.length<2?t:R1(t)},e.push(t);const n=new O1("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new O1("timeCreated")),e.push(new O1("updated")),e.push(new O1("md5Hash",null,!0)),e.push(new O1("cacheControl",null,!0)),e.push(new O1("contentDisposition",null,!0)),e.push(new O1("contentEncoding",null,!0)),e.push(new O1("contentLanguage",null,!0)),e.push(new O1("contentType",null,!0)),e.push(new O1("metadata","customMetadata",!0)),x1=e,x1}function L1(n,r){Object.defineProperty(n,"ref",{get:function(){var e=n.bucket,t=n.fullPath,t=new h1(e,t);return r._makeStorageReference(t)}})}function M1(e,t,n){t=N1(t);return null===t?null:function(e,t,n){const r={type:"file"};var i=n.length;for(let e=0;e<i;e++){const s=n[e];r[s.local]=s.xform(r,t[s.server])}return L1(r,e),r}(e,t,n)}function F1(t,n){const r={};var i=n.length;for(let e=0;e<i;e++){var s=n[e];s.writable&&(r[s.server]=t[s.local])}return JSON.stringify(r)}const U1="prefixes",j1="items";function q1(e,t,n){n=N1(n);return null===n?null:function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[U1])for(const o of n[U1]){var i=o.replace(/\/$/,""),i=e._makeStorageReference(new h1(t,i));r.prefixes.push(i)}if(n[j1])for(const a of n[j1]){var s=e._makeStorageReference(new h1(t,a.name));r.items.push(s)}return r}(e,t,n)}class V1{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function B1(e){if(!e)throw t1()}function K1(n,r){return function(e,t){return B1(null!==(t=M1(n,t,r))),t}}function z1(n,r){return function(e,t){return B1(null!==(t=q1(n,r,t))),t}}function W1(r,i){return function(e,t){var n=M1(r,t,i);return B1(null!==n),function(r,e,i,s){if(null===(e=N1(e)))return null;if(!f1(e.downloadTokens))return null;const t=e.downloadTokens;if(0===t.length)return null;const o=encodeURIComponent,n=t.split(",");return n.map(e=>{var t=r.bucket,n=r.fullPath;return y1("/b/"+o(t)+"/o/"+o(n),i,s)+v1({alt:"media",token:e})})[0]}(n,t,r.host,r._protocol)}}function $1(i){return function(e,t){let n;var r;return n=401===e.getStatus()?e.getResponseText().includes("Firebase App Check token is invalid")?new ZD("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new ZD("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(r=i.bucket,new ZD("quota-exceeded","Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(e=i.path,new ZD("unauthorized","User does not have permission to access '"+e+"'.")):t,n.serverResponse=t.serverResponse,n}}function H1(r){const i=$1(r);return function(e,t){let n=i(e,t);return 404===e.getStatus()&&(n=(e=r.path,new ZD("object-not-found","Object '"+e+"' does not exist."))),n.serverResponse=t.serverResponse,n}}function G1(e,t,n){var r=y1(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new V1(r,"GET",K1(e,n),i);return s.errorHandler=H1(t),s}function Q1(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=(e=t,(t=null)&&t.contentType||e&&e.type()||"application/octet-stream")),r}function Y1(e,t,n,r,i){var s=t.bucketOnlyServerUrl();const o={"X-Goog-Upload-Protocol":"multipart"};var a=function(){let t="";for(let e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();o["Content-Type"]="multipart/related; boundary="+a;var c=Q1(t,r,i),i="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+F1(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",a="\r\n--"+a+"--";const l=A1.getBlob(i,r,a);if(null===l)throw r1();a={name:c.fullPath},c=y1(s,e.host,e._protocol),s=e.maxUploadRetryTime;const u=new V1(c,"POST",K1(e,n),s);return u.urlParams=a,u.headers=o,u.body=l.uploadData(),u.errorHandler=$1(t),u}class J1{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function X1(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){B1(!1)}const r=t||["active"];return B1(!!n&&-1!==r.indexOf(n)),n}function Z1(e,t,n,r,i){var s=t.bucketOnlyServerUrl(),o=Q1(t,r,i),i={name:o.fullPath},s=y1(s,e.host,e._protocol),r={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},n=F1(o,n),e=e.maxUploadRetryTime;const a=new V1(s,"POST",function(e){X1(e);let t;try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){B1(!1)}return B1(f1(t)),t},e);return a.urlParams=i,a.headers=r,a.body=n,a.errorHandler=$1(t),a}function eL(e,t,n,r){e=e.maxUploadRetryTime;const i=new V1(n,"POST",function(e){var t=X1(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){B1(!1)}return n||B1(!1),e=Number(n),B1(!isNaN(e)),new J1(e,r.size(),"final"===t)},e);return i.headers={"X-Goog-Upload-Command":"query"},i.errorHandler=$1(t),i}function tL(e,o,t,a,n,c,r,i){const l=new J1(0,0);if(r?(l.current=r.current,l.total=r.total):(l.current=0,l.total=a.size()),a.size()!==l.total)throw new ZD("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var s=l.total-l.current;let u=s;0<n&&(u=Math.min(u,n));r=l.current,n=r+u,s={"X-Goog-Upload-Command":u===s?"upload, finalize":"upload","X-Goog-Upload-Offset":`${l.current}`};const h=a.slice(r,n);if(null===h)throw r1();n=o.maxUploadRetryTime;const d=new V1(t,"POST",function(e,t){var n=X1(e,["active","final"]),r=l.current+u,i=a.size();let s;return s="final"===n?K1(o,c)(e,t):null,new J1(r,i,"final"===n,s)},n);return d.headers=s,d.body=h.uploadData(),d.progressCallback=i||null,d.errorHandler=$1(e),d}const nL={STATE_CHANGED:"state_changed"},rL={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function iL(e){switch(e){case"running":case"pausing":case"canceling":return rL.RUNNING;case"paused":return rL.PAUSED;case"success":return rL.SUCCESS;case"canceled":return rL.CANCELED;case"error":default:return rL.ERROR}}class sL{constructor(e,t,n){"function"==typeof e||null!=t||null!=n?(this.next=e,this.error=null!=t?t:void 0,this.complete=null!=n?n:void 0):(this.next=(e=e).next,this.error=e.error,this.complete=e.complete)}}function oL(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class aL{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=D1(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=e,this._transition("error"))},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(e){return 262144<e.size()}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(n){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([e,t])=>{switch(this._state){case"running":n(e,t);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{var n=Z1(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const i=this._uploadUrl;this._resolveToken((e,t)=>{var n=eL(this._ref.storage,this._ref._location,i,this._blob);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const i=262144*this._chunkMultiplier,s=new J1(this._transferred,this._blob.size()),o=this._uploadUrl;this._resolveToken((e,t)=>{let n;try{n=tL(this._ref._location,this._ref.storage,o,this._blob,i,this._mappings,s,this._makeProgressCallback())}catch(e){return this._error=e,void this._transition("error")}const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{var n=G1(this._ref.storage,this._ref._location,this._mappings);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{var n=Y1(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata);const r=this._ref.storage._makeRequest(n,e,t);this._request=r,r.getPromise().then(e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=n1(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){var e=iL(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new sL(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){e=this._observers.indexOf(e);-1!==e&&this._observers.splice(e,1)}_notifyObservers(){this._finishPromise();const e=this._observers.slice();e.forEach(e=>{this._notifyObserver(e)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(iL(this._state)){case rL.SUCCESS:oL(this._resolve.bind(null,this.snapshot))();break;case rL.CANCELED:case rL.ERROR:const t=this._reject;oL(t.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(iL(this._state)){case rL.RUNNING:case rL.PAUSED:e.next&&oL(e.next.bind(e,this.snapshot))();break;case rL.SUCCESS:e.complete&&oL(e.complete.bind(e))();break;case rL.CANCELED:case rL.ERROR:e.error&&oL(e.error.bind(e,this._error))();break;default:e.error&&oL(e.error.bind(e,this._error))()}}resume(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){var e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class cL{constructor(e,t){this._service=e,t instanceof h1?this._location=t:this._location=h1.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new cL(e,t)}get root(){var e=new h1(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return R1(this._location.path)}get storage(){return this._service}get parent(){var e=function(e){if(0===e.length)return null;var t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;e=new h1(this._location.bucket,e);return new cL(this._service,e)}_throwIfRoot(e){if(""===this._location.path)throw o1(e)}}function lL(e){const t={prefixes:[],items:[]};return async function e(t,n,r){const i={pageToken:r};const s=await uL(t,i);n.prefixes.push(...s.prefixes);n.items.push(...s.items);null!=s.nextPageToken&&await e(t,n,s.nextPageToken)}(e,t).then(()=>t)}async function uL(e,t){null!=t&&"number"==typeof t.maxResults&&m1("options.maxResults",1,1e3,t.maxResults);t=t||{},t=function(e,t,n,r,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&0<n.length&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i),r=y1(t.bucketOnlyServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const o=new V1(r,"GET",z1(e,t.bucket),i);return o.urlParams=s,o.errorHandler=$1(t),o}(e.storage,e._location,"/",t.pageToken,t.maxResults);return(await e.storage.makeRequestWithTokens(t)).getPromise()}async function hL(e,t){e._throwIfRoot("updateMetadata");t=function(e,t,n,r){var i=y1(t.fullServerUrl(),e.host,e._protocol),s=F1(n,r),n=e.maxOperationRetryTime;const o=new V1(i,"PATCH",K1(e,r),n);return o.headers={"Content-Type":"application/json; charset=utf-8"},o.body=s,o.errorHandler=H1(t),o}(e.storage,e._location,t,D1());return(await e.storage.makeRequestWithTokens(t)).getPromise()}async function dL(e){e._throwIfRoot("getDownloadURL");var t=function(e,t,n){var r=y1(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime;const s=new V1(r,"GET",W1(e,n),i);return s.errorHandler=H1(t),s}(e.storage,e._location,D1());return(await e.storage.makeRequestWithTokens(t)).getPromise().then(e=>{if(null===e)throw new ZD("no-download-url","The given file does not have any download URLs.");return e})}async function fL(e){e._throwIfRoot("deleteObject");var t=function(e,t){var n=y1(t.fullServerUrl(),e.host,e._protocol),e=e.maxOperationRetryTime;const r=new V1(n,"DELETE",function(e,t){},e);return r.successCodes=[200,204],r.errorHandler=H1(t),r}(e.storage,e._location);return(await e.storage.makeRequestWithTokens(t)).getPromise()}function pL(e,t){var n,t=(n=e._location.path,t=(t=t).split("/").filter(e=>0<e.length).join("/"),0===n.length?t:n+"/"+t),t=new h1(e._location.bucket,t);return new cL(e.storage,t)}function gL(e,t){if(e instanceof vL){var n=e;if(null==n._bucket)throw new ZD("no-default-bucket","No default bucket found. Did you set the '"+XD+"' property when initializing the app?");n=new cL(n,n._bucket);return null!=t?gL(n,t):n}return void 0!==t?pL(e,t):e}function mL(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof vL)return n=e,r=t,new cL(n,r);throw i1("To use ref(service, url), the first argument must be a Storage instance.")}return gL(e,t);var n,r}function yL(e,t){t=null==t?void 0:t[XD];return null==t?null:h1.makeFromBucketSpec(t,e)}class vL{constructor(e,t,n,r,i,s){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._pool=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=JD,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?h1.makeFromBucketSpec(i,this._host):yL(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=h1.makeFromBucketSpec(this._url,e):this._bucket=yL(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){m1("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){m1("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){var t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new cL(this,e)}_makeRequest(e,t,n){if(this._deleted)return new d1(s1());{const l=(r=e,i=this._appId,s=t,o=n,a=this._pool,c=this._firebaseVersion,e=v1(r.urlParams),t=r.url+e,n=Object.assign({},r.headers),e=n,(i=i)&&(e["X-Firebase-GMPID"]=i),i=n,null!==(s=s)&&0<s.length&&(i.Authorization="Firebase "+s),c=c,n["X-Firebase-Storage-Version"]="webjs/"+(null!=c?c:"AppManager"),c=n,null!==(o=o)&&(c["X-Firebase-AppCheck"]=o),new _1(t,r.method,n,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,a));return this._requests.add(l),l.getPromise().then(()=>this._requests.delete(l),()=>this._requests.delete(l)),l}var r,i,s,o,a,c}async makeRequestWithTokens(e){var[t,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n)}}function _L(e,t,n){return e=io(e),t=t,n=n,(e=e)._throwIfRoot("uploadBytesResumable"),new aL(e,new A1(t),n)}function wL(e){return async function(e){e._throwIfRoot("getMetadata");var t=G1(e.storage,e._location,D1());return(await e.storage.makeRequestWithTokens(t)).getPromise()}(e=io(e))}function bL(e,t){return mL(e=io(e),t)}function IL(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";var{mockUserToken:r}=r;r&&(e._overrideAuthToken="string"==typeof r?r:ds(r,e.app.options.projectId))}(e,t,n,r)}Oo(new so("storage",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),e=e.getProvider("app-check-internal");return new vL(n,r,e,new u1,t,Mo)},"PUBLIC").setMultipleInstances(!0)),qo("@firebase/storage","0.8.2");class TL{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class EL{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new TL(this._delegate.snapshot,this,this._ref)}then(t,e){return this._delegate.then(e=>{if(t)return t(new TL(e,this,this._ref))},e)}on(e,t,n,r){let i=void 0;return t&&(i="function"==typeof t?e=>t(new TL(e,this,this._ref)):{next:t.next?e=>t.next(new TL(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class SL{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new kL(e,this._service))}get items(){return this._delegate.items.map(e=>new kL(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class kL{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){e=pL(this._delegate,e);return new kL(e,this.storage)}get root(){return new kL(this._delegate.root,this.storage)}get parent(){var e=this._delegate.parent;return null==e?null:new kL(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new EL(_L(this._delegate,e,t),this)}putString(e,t=I1.RAW,n){this._throwIfRoot("putString");e=E1(t,e);const r=Object.assign({},n);return null==r.contentType&&null!=e.contentType&&(r.contentType=e.contentType),new EL(new aL(this._delegate,new A1(e.data,!0),r),this)}listAll(){return lL(io(this._delegate)).then(e=>new SL(e,this.storage))}list(e){return t=this._delegate,e=e||void 0,uL(t=io(t),e).then(e=>new SL(e,this.storage));var t}getMetadata(){return wL(this._delegate)}updateMetadata(e){return hL(io(this._delegate),e)}getDownloadURL(){return dL(io(this._delegate))}delete(){return this._throwIfRoot("delete"),fL(io(this._delegate))}_throwIfRoot(e){if(""===this._delegate._location.path)throw o1(e)}}class CL{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(AL(e))throw i1("ref() expected a child path but got a URL, use refFromURL instead.");return new kL(bL(this._delegate,e),this)}refFromURL(e){if(!AL(e))throw i1("refFromURL() expected a full URL but got a child path, use ref() instead.");try{h1.makeFromUrl(e,this._delegate.host)}catch(e){throw i1("refFromUrl() expected a valid full URL but got an invalid one.")}return new kL(bL(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){IL(this._delegate,e,t,n)}}function AL(e){return/^[A-Za-z]+:\/\//.test(e)}function NL(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("storage").getImmediate({identifier:t});return new CL(n,t)}HD=Go,GD={TaskState:rL,TaskEvent:nL,StringFormat:I1,Storage:CL,Reference:kL},HD.INTERNAL.registerComponent(new so("storage-compat",NL,"PUBLIC").setServiceProps(GD).setMultipleInstances(!0)),HD.registerVersion("@firebase/storage-compat","0.1.2");const RL="0.5.0",PL="FB-PERF-TRACE-MEASURE",OL="@firebase/performance/config",xL="@firebase/performance/configexpire";var DL,LL,ML,E="Performance";const FL=new Cs("performance",E,{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),UL=new _o(E);UL.logLevel=fo.INFO;let jL,qL;class VL{constructor(e){if(!(this.window=e))throw FL.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled?!!ws()||(UL.info("IndexedDB is not supported by current browswer"),!1):(UL.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,n){if(this.PerformanceObserver){const t=new this.PerformanceObserver(e=>{for(const t of e.getEntries())n(t)});t.observe({entryTypes:[e]})}}static getInstance(){return void 0===jL&&(jL=new VL(qL)),jL}}let BL;function KL(t,n){var e=t.length-n.length;if(e<0||1<e)throw FL.create("invalid String merger input");const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),n.length>e&&r.push(n.charAt(e));return r.join("")}let zL;class WL{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=KL("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=KL("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return void 0===zL&&(zL=new WL),zL}}(E=DL=DL||{})[E.UNKNOWN=0]="UNKNOWN",E[E.VISIBLE=1]="VISIBLE",E[E.HIDDEN=2]="HIDDEN";const $L=["firebase_","google_","ga_"],HL=new RegExp("^[a-zA-Z]\\w*$");function GL(){switch(VL.getInstance().document.visibilityState){case"visible":return DL.VISIBLE;case"hidden":return DL.HIDDEN;default:return DL.UNKNOWN}}function QL(e){e=null===(e=e.options)||void 0===e?void 0:e.appId;if(!e)throw FL.create("no app id");return e}const YL="0.0.1",JL={loggingEnabled:!0},XL="FIREBASE_INSTALLATIONS_AUTH";function ZL(e,t){var r,i,n=function(){const e=VL.getInstance().localStorage;if(e){var t=e.getItem(xL);if(t&&function(e){return Number(e)>Date.now()}(t)){t=e.getItem(OL);if(t)try{return JSON.parse(t)}catch(e){return}}}}();return n?(tM(n),Promise.resolve()):(i=t,function(e){const t=e.getToken();return t.then(e=>{}),t}((r=e).installations).then(e=>{var t=function(e){if(!(e=null===(e=e.options)||void 0===e?void 0:e.projectId))throw FL.create("no project id");return e}(r.app),n=function(e){if(!(e=null===(e=e.options)||void 0===e?void 0:e.apiKey))throw FL.create("no api key");return e}(r.app),e=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=${n}`,{method:"POST",headers:{Authorization:`${XL} ${e}`},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:QL(r.app),app_version:RL,sdk_version:YL})});return fetch(e).then(e=>{if(e.ok)return e.json();throw FL.create("RC response not ok")})}).catch(()=>{UL.info(eM)}).then(tM).then(e=>function(e){const t=VL.getInstance().localStorage;e&&t&&(t.setItem(OL,JSON.stringify(e)),t.setItem(xL,String(Date.now()+60*WL.getInstance().configTimeToLive*60*1e3)))}(e),()=>{}))}const eM="Could not fetch config, will use default configs";function tM(e){if(!e)return e;const t=WL.getInstance();var n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=JL.loggingEnabled,n.fpr_log_source&&(t.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(t.logEndPointUrl=n.fpr_log_endpoint_url),n.fpr_log_transport_key&&(t.transportKey=n.fpr_log_transport_key),void 0!==n.fpr_vc_network_request_sampling_rate&&(t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),t.logTraceAfterSampling=nM(t.tracesSamplingRate),t.logNetworkAfterSampling=nM(t.networkRequestsSamplingRate),e}function nM(e){return Math.random()<=e}let rM=1,iM;function sM(e){var t;return rM=2,iM=iM||(t=e,function(){const n=VL.getInstance().document;return new Promise(e=>{if(n&&"complete"!==n.readyState){const t=()=>{"complete"===n.readyState&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}().then(()=>function(e){const t=e.getId();return t.then(e=>{BL=e}),t}(t.installations)).then(e=>ZL(t,e)).then(()=>oM(),()=>oM())),iM}function oM(){rM=3}const aM=1e4,cM=3,lM=1e3;let uM=cM,hM=[],dM=!1;function fM(e){setTimeout(()=>{if(0!==uM)return hM.length?void function(){const e=hM.splice(0,lM),t=e.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)})),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:WL.getInstance().logSource,log_event:t};!function(e,r){return function(e){var t=WL.getInstance().getFlTransportFullUrl();return fetch(t,{method:"POST",body:JSON.stringify(e)})}(e).then(e=>(e.ok||UL.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let n=aM;isNaN(t)||(n=Math.max(t,n));e=e.logResponseDetails;Array.isArray(e)&&0<e.length&&"RETRY_REQUEST_LATER"===e[0].responseAction&&(hM=[...r,...hM],UL.info("Retry transport request later.")),uM=cM,fM(n)})}(n,e).catch(()=>{hM=[...e,...hM],uM--,UL.info(`Tries left: ${uM}.`),fM(aM)})}():fM(aM)},e)}function pM(t){return(...e)=>{!function(e){if(!e.eventTime||!e.message)throw FL.create("invalid cc log");hM=[...hM,e]}({message:t(...e),eventTime:Date.now()})}}let gM;function mM(e,t){gM=gM||pM(_M),gM(e,t)}function yM(e){var t=WL.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&VL.getInstance().requiredApisAvailable()&&(e.isAuto&&GL()!==DL.VISIBLE||(3===rM?vM(e):sM(e.performanceController).then(()=>vM(e),()=>vM(e))))}function vM(e){var t;!BL||(t=WL.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>mM(e,1),0)}function _M(e,t){return 0===t?(t={url:e.url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},t={application_info:wM(e.performanceController.app),network_request_metric:t},JSON.stringify(t)):function(e){const t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);var n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);e={application_info:wM(e.performanceController.app),trace_metric:t};return JSON.stringify(e)}(e)}function wM(e){return{google_app_id:QL(e),app_instance_id:BL,web_app_info:{sdk_version:RL,page_url:VL.getInstance().getUrl(),service_worker_status:"serviceWorker"in(e=VL.getInstance().navigator)?e.serviceWorker.controller?2:3:1,visibility_state:GL(),effective_connection_type:function(){var e=VL.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}const bM=["_fp","_fcp","_fid"];class IM{constructor(e,t,n=!1,r){this.performanceController=e,this.name=t,this.isAuto=n,this.state=1,this.customAttributes={},this.counters={},this.api=VL.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-${this.name}`,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-${this.name}`,this.traceMeasure=r||`${PL}-${this.randomId}-${this.name}`,r&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw FL.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw FL.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),yM(this)}record(e,t,n){if(e<=0)throw FL.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw FL.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object.assign({},n.attributes)),n&&n.metrics)for(const r of Object.keys(n.metrics))isNaN(Number(n.metrics[r]))||(this.counters[r]=Number(Math.floor(n.metrics[r])));yM(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(n=e,r=this.name,0===n.length||100<n.length||!(r&&r.startsWith("_wt_")&&-1<bM.indexOf(n))&&n.startsWith("_"))throw FL.create("invalid custom metric name",{customMetricName:e});var n,r;this.counters[e]=(e=t,(t=Math.floor(e))<e&&UL.info(`Metric value should be an Integer, setting the value as : ${t}.`),t)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var n,r,i=!(0===(n=e).length||40<n.length)&&(!$L.some(e=>n.startsWith(e))&&!!n.match(HL)),r=0!==(r=t).length&&r.length<=100;if(i&&r)this.customAttributes[e]=t;else{if(!i)throw FL.create("invalid attribute name",{attributeName:e});if(!r)throw FL.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure),e=e&&e[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,n,r){var i=VL.getInstance().getUrl();if(i){const s=new IM(e,"_wt_"+i,!0);i=Math.floor(1e3*VL.getInstance().getTimeOrigin());s.setStartTime(i),t&&t[0]&&(s.setDuration(Math.floor(1e3*t[0].duration)),s.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),s.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),s.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));n&&((t=n.find(e=>"first-paint"===e.name))&&t.startTime&&s.putMetric("_fp",Math.floor(1e3*t.startTime)),(n=n.find(e=>"first-contentful-paint"===e.name))&&n.startTime&&s.putMetric("_fcp",Math.floor(1e3*n.startTime)),r&&s.putMetric("_fid",Math.floor(1e3*r))),yM(s)}}static createUserTimingTrace(e,t){yM(new IM(e,t,!1,t))}}function TM(e,t){const n=t;var r,i;n&&void 0!==n.responseStart&&(i=VL.getInstance().getTimeOrigin(),r=Math.floor(1e3*(n.startTime+i)),t=n.responseStart?Math.floor(1e3*(n.responseStart-n.startTime)):void 0,i=Math.floor(1e3*(n.responseEnd-n.startTime)),function(e){const t=WL.getInstance();var n,r,i;t.instrumentationEnabled&&(n=e.url,r=t.logEndPointUrl.split("?")[0],i=t.flTransportEndpointUrl.split("?")[0],n!==r&&n!==i&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout(()=>mM(e,0),0))}({performanceController:e,url:n.name&&n.name.split("?")[0],responsePayloadBytes:n.transferSize,startTimeUs:r,timeToResponseInitiatedUs:t,timeToResponseCompletedUs:i}))}const EM=5e3;function SM(e){BL&&(setTimeout(()=>function(n){const e=VL.getInstance(),r=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{IM.createOobTrace(n,r,i),t=void 0},EM);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),IM.createOobTrace(n,r,i,e))})}else IM.createOobTrace(n,r,i)}(e),0),setTimeout(()=>function(t){const e=VL.getInstance(),n=e.getEntriesByType("resource");for(const r of n)TM(t,r);e.setupObserver("resource",e=>TM(t,e))}(e),0),setTimeout(()=>function(t){const e=VL.getInstance(),n=e.getEntriesByType("measure");for(const r of n)kM(t,r);e.setupObserver("measure",e=>kM(t,e))}(e),0))}function kM(e,t){const n=t.name;n.substring(0,PL.length)!==PL&&IM.createUserTimingTrace(e,n)}class CM{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),VL.getInstance().requiredApisAvailable()?bs().then(e=>{e&&(dM||(fM(5500),dM=!0),sM(this).then(()=>SM(this),()=>SM(this)),this.initialized=!0)}).catch(e=>{UL.info(`Environment doesn't support IndexedDB: ${e}`)}):UL.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){WL.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return WL.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){WL.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return WL.getInstance().dataCollectionEnabled}}Oo(new so("performance",(e,{options:t})=>{var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==n.name)throw FL.create("FB not default");if("undefined"==typeof window)throw FL.create("no window");e=window,qL=e;const i=new CM(n,r);return i._init(t),i},"PUBLIC")),qo("@firebase/performance","0.5.0");class AM{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return t=this._delegate,e=e,t=io(t),new IM(t,e);var t}}function NM(e){var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("performance").getImmediate();return new AM(t,e)}(LL=Go).INTERNAL.registerComponent(new so("performance-compat",NM,"PUBLIC")),LL.registerVersion("@firebase/performance-compat","0.1.0");const RM="@firebase/remote-config";class PM{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}const OM=new Cs("remoteconfig","Remote Config",{"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}."});const xM=["1","true","t","yes","y","on"];class DM{constructor(e,t=""){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return"static"!==this._source&&0<=xM.indexOf(this._value.toLowerCase())}asNumber(){if("static"===this._source)return 0;let e=Number(this._value);return isNaN(e)&&(e=0),e}getSource(){return this._source}}async function LM(e){const t=io(e);var[n,e]=await Promise.all([t._storage.getLastSuccessfulFetchResponse(),t._storage.getActiveConfigEtag()]);return!!(n&&n.config&&n.eTag&&n.eTag!==e)&&(await Promise.all([t._storageCache.setActiveConfig(n.config),t._storage.setActiveConfigEtag(n.eTag)]),!0)}function MM(e){const t=io(e);return t._initializePromise||(t._initializePromise=t._storageCache.loadFromStorage().then(()=>{t._isInitializationComplete=!0})),t._initializePromise}async function FM(t){const n=io(t),e=new PM;setTimeout(async()=>{e.abort()},n.settings.fetchTimeoutMillis);try{await n._client.fetch({cacheMaxAgeMillis:n.settings.minimumFetchIntervalMillis,signal:e}),await n._storageCache.setLastFetchStatus("success")}catch(e){r=(r="fetch-throttle",(t=e)instanceof Ss&&-1!==t.code.indexOf(r)?"throttle":"failure");throw await n._storageCache.setLastFetchStatus(r),e}var r}function UM(n){const e=io(n);return[t={},r={}]=[e._storageCache.getActiveConfig(),e.defaultConfig],Object.keys(Object.assign(Object.assign({},t),r)).reduce((e,t)=>(e[t]=jM(n,t),e),{});var t,r}function jM(e,t){const n=io(e);n._isInitializationComplete||n._logger.debug(`A value was requested for key "${t}" before SDK initialization completed.`+" Await on ensureInitialized if the intent was to get a previously activated value.");e=n._storageCache.getActiveConfig();return e&&void 0!==e[t]?new DM("remote",e[t]):n.defaultConfig&&void 0!==n.defaultConfig[t]?new DM("default",String(n.defaultConfig[t])):(n._logger.debug(`Returning static value for key "${t}".`+" Define a default or remote value if this is unintentional."),new DM("static"))}class qM{constructor(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,t=n<=e;return this.logger.debug("Config fetch cache check."+` Cache age millis: ${n}.`+` Cache max age millis (minimumFetchIntervalMillis setting): ${e}.`+` Is cache hit: ${t}.`),t}async fetch(e){var[t,n]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(n&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return n;e.eTag=n&&n.eTag;e=await this.client.fetch(e);const r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return 200===e.status&&r.push(this.storage.setLastSuccessfulFetchResponse(e)),await Promise.all(r),e}}class VM{constructor(e,t,n,r,i,s){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=s}async fetch(n){var[e,t]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),r=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,i={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":n.eTag||"*"},t={sdk_version:this.sdkVersion,app_instance_id:e,app_instance_id_token:t,app_id:this.appId,language_code:(t=navigator).languages&&t.languages[0]||t.language},t={method:"POST",headers:i,body:JSON.stringify(t)},r=fetch(r,t),t=new Promise((e,t)=>{n.signal.addEventListener(()=>{const e=new Error("The operation was aborted.");e.name="AbortError",t(e)})});let s;try{await Promise.race([r,t]),s=await r}catch(e){let t="fetch-client-network";throw"AbortError"===e.name&&(t="fetch-timeout"),OM.create(t,{originalErrorMessage:e.message})}let o=s.status;r=s.headers.get("ETag")||void 0;let a,c;if(200===s.status){let e;try{e=await s.json()}catch(e){throw OM.create("fetch-client-parse",{originalErrorMessage:e.message})}a=e.entries,c=e.state}if("INSTANCE_STATE_UNSPECIFIED"===c?o=500:"NO_CHANGE"===c?o=304:"NO_TEMPLATE"!==c&&"EMPTY_CONFIG"!==c||(a={}),304!==o&&200!==o)throw OM.create("fetch-status",{httpStatus:o});return{status:o,eTag:r,config:a}}}class BM{constructor(e,t){this.client=e,this.storage=t}async fetch(e){var t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(t,{throttleEndTimeMillis:e,backoffCount:n}){var i,s;i=t.signal,s=e,await new Promise((e,t)=>{var n=Math.max(s-Date.now(),0);const r=setTimeout(e,n);i.addEventListener(()=>{clearTimeout(r),t(OM.create("fetch-throttle",{throttleEndTimeMillis:s}))})});try{var r=await this.client.fetch(t);return await this.storage.deleteThrottleMetadata(),r}catch(e){if(!function(e){if(e instanceof Ss&&e.customData){e=Number(e.customData.httpStatus);return 429===e||500===e||503===e||504===e}}(e))throw e;n={throttleEndTimeMillis:Date.now()+ro(n),backoffCount:n+1};return await this.storage.setThrottleMetadata(n),this.attemptFetch(t,n)}}}class KM{constructor(e,t,n,r,i){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}function zM(e,t){e=e.target.error||void 0;return OM.create(t,{originalErrorMessage:e&&e.message})}const WM="app_namespace_store";class $M{constructor(e,t,n,r=function(){return new Promise((t,n)=>{const e=indexedDB.open("firebase_remote_config",1);e.onerror=e=>{n(zM(e,"storage-open"))},e.onsuccess=e=>{t(e.target.result)},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(WM,{keyPath:"compositeKey"})}})}()){this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(o){const a=await this.openDbPromise;return new Promise((t,n)=>{const e=a.transaction([WM],"readonly"),r=e.objectStore(WM);var i=this.createCompositeKey(o);try{const s=r.get(i);s.onerror=e=>{n(zM(e,"storage-get"))},s.onsuccess=e=>{e=e.target.result;t(e?e.value:void 0)}}catch(e){n(OM.create("storage-get",{originalErrorMessage:e&&e.message}))}})}async set(o,a){const c=await this.openDbPromise;return new Promise((e,t)=>{const n=c.transaction([WM],"readwrite"),r=n.objectStore(WM);var i=this.createCompositeKey(o);try{const s=r.put({compositeKey:i,value:a});s.onerror=e=>{t(zM(e,"storage-set"))},s.onsuccess=()=>{e()}}catch(e){t(OM.create("storage-set",{originalErrorMessage:e&&e.message}))}})}async delete(o){const a=await this.openDbPromise;return new Promise((e,t)=>{const n=a.transaction([WM],"readwrite"),r=n.objectStore(WM);var i=this.createCompositeKey(o);try{const s=r.delete(i);s.onerror=e=>{t(zM(e,"storage-delete"))},s.onsuccess=()=>{e()}}catch(e){t(OM.create("storage-delete",{originalErrorMessage:e&&e.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}class HM{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){var e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),e=await e;e&&(this.lastFetchStatus=e);t=await t;t&&(this.lastSuccessfulFetchTimestampMillis=t);n=await n;n&&(this.activeConfig=n)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}Oo(new so("remote-config",function(e,{instanceIdentifier:t}){var n=e.getProvider("app").getImmediate(),r=e.getProvider("installations-internal").getImmediate();if("undefined"==typeof window)throw OM.create("registration-window");var{projectId:i,apiKey:s,appId:e}=n.options;if(!i)throw OM.create("registration-project-id");if(!s)throw OM.create("registration-api-key");if(!e)throw OM.create("registration-app-id");t=t||"firebase";const o=new $M(e,n.name,t),a=new HM(o),c=new _o(RM);c.logLevel=fo.ERROR;e=new VM(r,Mo,t,i,s,e),e=new BM(e,o),e=new qM(e,o,a,c),e=new KM(n,e,a,o,c);return MM(e),e},"PUBLIC").setMultipleInstances(!0)),qo(RM,"0.2.0");class GM{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return LM(this._delegate)}ensureInitialized(){return MM(this._delegate)}fetch(){return FM(this._delegate)}fetchAndActivate(){return async function(e){return await FM(e=io(e)),LM(e)}(this._delegate)}getAll(){return UM(this._delegate)}getBoolean(e){return jM(io(this._delegate),e).asBoolean()}getNumber(e){return jM(io(this._delegate),e).asNumber()}getString(e){return jM(io(this._delegate),e).asString()}getValue(e){return jM(this._delegate,e)}setLogLevel(e){!function(e,t){const n=io(e);switch(t){case"debug":n._logger.logLevel=fo.DEBUG;break;case"silent":n._logger.logLevel=fo.SILENT;break;default:n._logger.logLevel=fo.ERROR}}(this._delegate,e)}}function QM(e,{instanceIdentifier:t}){var n=e.getProvider("app-compat").getImmediate(),t=e.getProvider("remote-config").getImmediate({identifier:t});return new GM(n,t)}return(ML=Go).INTERNAL.registerComponent(new so("remoteConfig-compat",QM,"PUBLIC").setMultipleInstances(!0)),ML.registerVersion("@firebase/remote-config-compat","0.1.0"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Go.registerVersion("firebase","9.0.2","compat-cdn"),Go});
//# sourceMappingURL=firebase-compat.js.map
